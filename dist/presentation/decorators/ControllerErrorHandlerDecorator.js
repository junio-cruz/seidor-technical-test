var mh=Object.create;var xr=Object.defineProperty;var Ch=Object.getOwnPropertyDescriptor;var bh=Object.getOwnPropertyNames;var hh=Object.getPrototypeOf,Bh=Object.prototype.hasOwnProperty;var d=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Zh=(t,e)=>{for(var n in e)xr(t,n,{get:e[n],enumerable:!0})},Bu=(t,e,n,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of bh(e))!Bh.call(t,i)&&i!==n&&xr(t,i,{get:()=>e[i],enumerable:!(r=Ch(e,i))||r.enumerable});return t};var Gh=(t,e,n)=>(n=t!=null?mh(hh(t)):{},Bu(e||!t||!t.__esModule?xr(n,"default",{value:t,enumerable:!0}):n,t)),yh=t=>Bu(xr({},"__esModule",{value:!0}),t);var se=d(L=>{Object.defineProperty(L,"__esModule",{value:!0});var Zu=Object.prototype.toString;function Ah(t){switch(Zu.call(t)){case"[object Error]":case"[object Exception]":case"[object DOMException]":return!0;default:return Or(t,Error)}}function Jt(t,e){return Zu.call(t)===`[object ${e}]`}function fh(t){return Jt(t,"ErrorEvent")}function Sh(t){return Jt(t,"DOMError")}function Wh(t){return Jt(t,"DOMException")}function Rh(t){return Jt(t,"String")}function Gu(t){return typeof t=="object"&&t!==null&&"__sentry_template_string__"in t&&"__sentry_template_values__"in t}function Vh(t){return t===null||Gu(t)||typeof t!="object"&&typeof t!="function"}function yu(t){return Jt(t,"Object")}function Hh(t){return typeof Event<"u"&&Or(t,Event)}function vh(t){return typeof Element<"u"&&Or(t,Element)}function _h(t){return Jt(t,"RegExp")}function Nh(t){return!!(t&&t.then&&typeof t.then=="function")}function Eh(t){return yu(t)&&"nativeEvent"in t&&"preventDefault"in t&&"stopPropagation"in t}function Yh(t){return typeof t=="number"&&t!==t}function Or(t,e){try{return t instanceof e}catch{return!1}}function Xh(t){return!!(typeof t=="object"&&t!==null&&(t.__isVue||t._isVue))}L.isDOMError=Sh;L.isDOMException=Wh;L.isElement=vh;L.isError=Ah;L.isErrorEvent=fh;L.isEvent=Hh;L.isInstanceOf=Or;L.isNaN=Yh;L.isParameterizedString=Gu;L.isPlainObject=yu;L.isPrimitive=Vh;L.isRegExp=_h;L.isString=Rh;L.isSyntheticEvent=Eh;L.isThenable=Nh;L.isVueViewModel=Xh});var Rn=d(Bt=>{Object.defineProperty(Bt,"__esModule",{value:!0});var Mr=se();function Th(t,e=0){return typeof t!="string"||e===0||t.length<=e?t:`${t.slice(0,e)}...`}function Fh(t,e){let n=t,r=n.length;if(r<=150)return n;e>r&&(e=r);let i=Math.max(e-60,0);i<5&&(i=0);let o=Math.min(i+140,r);return o>r-5&&(o=r),o===r&&(i=Math.max(o-140,0)),n=n.slice(i,o),i>0&&(n=`'{snip} ${n}`),o<r&&(n+=" {snip}"),n}function wh(t,e){if(!Array.isArray(t))return"";let n=[];for(let r=0;r<t.length;r++){let i=t[r];try{Mr.isVueViewModel(i)?n.push("[VueViewModel]"):n.push(String(i))}catch{n.push("[value cannot be serialized]")}}return n.join(e)}function Au(t,e,n=!1){return Mr.isString(t)?Mr.isRegExp(e)?e.test(t):Mr.isString(e)?n?t===e:t.includes(e):!1:!1}function Uh(t,e=[],n=!1){return e.some(r=>Au(t,r,n))}Bt.isMatchingPattern=Au;Bt.safeJoin=wh;Bt.snipLine=Fh;Bt.stringMatchesSomePattern=Uh;Bt.truncate=Th});var Wu=d(Zs=>{Object.defineProperty(Zs,"__esModule",{value:!0});var hs=se(),Kh=Rn();function Jh(t,e,n=250,r,i,o,s){if(!o.exception||!o.exception.values||!s||!hs.isInstanceOf(s.originalException,Error))return;let a=o.exception.values.length>0?o.exception.values[o.exception.values.length-1]:void 0;a&&(o.exception.values=kh(Bs(t,e,i,s.originalException,r,o.exception.values,a,0),n))}function Bs(t,e,n,r,i,o,s,a){if(o.length>=n+1)return o;let c=[...o];if(hs.isInstanceOf(r[i],Error)){fu(s,a);let l=t(e,r[i]),g=c.length;Su(l,i,g,a),c=Bs(t,e,n,r[i],i,[l,...c],l,g)}return Array.isArray(r.errors)&&r.errors.forEach((l,g)=>{if(hs.isInstanceOf(l,Error)){fu(s,a);let u=t(e,l),I=c.length;Su(u,`errors[${g}]`,I,a),c=Bs(t,e,n,l,i,[u,...c],u,I)}}),c}function fu(t,e){t.mechanism=t.mechanism||{type:"generic",handled:!0},t.mechanism={...t.mechanism,is_exception_group:!0,exception_id:e}}function Su(t,e,n,r){t.mechanism=t.mechanism||{type:"generic",handled:!0},t.mechanism={...t.mechanism,type:"chained",source:e,exception_id:n,parent_id:r}}function kh(t,e){return t.map(n=>(n.value&&(n.value=Kh.truncate(n.value,e)),n))}Zs.applyAggregateErrorsToEvent=Jh});var x=d(Vn=>{Object.defineProperty(Vn,"__esModule",{value:!0});function Dr(t){return t&&t.Math==Math?t:void 0}var Gs=typeof globalThis=="object"&&Dr(globalThis)||typeof window=="object"&&Dr(window)||typeof self=="object"&&Dr(self)||typeof global=="object"&&Dr(global)||function(){return this}()||{};function Lh(){return Gs}function zh(t,e,n){let r=n||Gs,i=r.__SENTRY__=r.__SENTRY__||{};return i[t]||(i[t]=e())}Vn.GLOBAL_OBJ=Gs;Vn.getGlobalObject=Lh;Vn.getGlobalSingleton=zh});var ys=d(Lt=>{Object.defineProperty(Lt,"__esModule",{value:!0});var xh=se(),Oh=x(),kt=Oh.getGlobalObject(),Mh=80;function Dh(t,e={}){if(!t)return"<unknown>";try{let n=t,r=5,i=[],o=0,s=0,a=" > ",c=a.length,l,g=Array.isArray(e)?e:e.keyAttrs,u=!Array.isArray(e)&&e.maxStringLength||Mh;for(;n&&o++<r&&(l=Ph(n,g),!(l==="html"||o>1&&s+i.length*c+l.length>=u));)i.push(l),s+=l.length,n=n.parentNode;return i.reverse().join(a)}catch{return"<unknown>"}}function Ph(t,e){let n=t,r=[],i,o,s,a,c;if(!n||!n.tagName)return"";if(kt.HTMLElement&&n instanceof HTMLElement&&n.dataset&&n.dataset.sentryComponent)return n.dataset.sentryComponent;r.push(n.tagName.toLowerCase());let l=e&&e.length?e.filter(u=>n.getAttribute(u)).map(u=>[u,n.getAttribute(u)]):null;if(l&&l.length)l.forEach(u=>{r.push(`[${u[0]}="${u[1]}"]`)});else if(n.id&&r.push(`#${n.id}`),i=n.className,i&&xh.isString(i))for(o=i.split(/\s+/),c=0;c<o.length;c++)r.push(`.${o[c]}`);let g=["aria-label","type","name","title","alt"];for(c=0;c<g.length;c++)s=g[c],a=n.getAttribute(s),a&&r.push(`[${s}="${a}"]`);return r.join("")}function jh(){try{return kt.document.location.href}catch{return""}}function Qh(t){return kt.document&&kt.document.querySelector?kt.document.querySelector(t):null}function qh(t){if(!kt.HTMLElement)return null;let e=t,n=5;for(let r=0;r<n;r++){if(!e)return null;if(e instanceof HTMLElement&&e.dataset.sentryComponent)return e.dataset.sentryComponent;e=e.parentNode}return null}Lt.getComponentName=qh;Lt.getDomElement=Qh;Lt.getLocationHref=jh;Lt.htmlTreeAsString=Dh});var Ge=d(As=>{Object.defineProperty(As,"__esModule",{value:!0});var $h=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__;As.DEBUG_BUILD=$h});var me=d(zt=>{Object.defineProperty(zt,"__esModule",{value:!0});var eB=Ge(),fs=x(),tB="Sentry Logger ",Ss=["debug","info","warn","error","log","assert","trace"],Ws={};function Ru(t){if(!("console"in fs.GLOBAL_OBJ))return t();let e=fs.GLOBAL_OBJ.console,n={},r=Object.keys(Ws);r.forEach(i=>{let o=Ws[i];n[i]=e[i],e[i]=o});try{return t()}finally{r.forEach(i=>{e[i]=n[i]})}}function nB(){let t=!1,e={enable:()=>{t=!0},disable:()=>{t=!1},isEnabled:()=>t};return eB.DEBUG_BUILD?Ss.forEach(n=>{e[n]=(...r)=>{t&&Ru(()=>{fs.GLOBAL_OBJ.console[n](`${tB}[${n}]:`,...r)})}}):Ss.forEach(n=>{e[n]=()=>{}}),e}var rB=nB();zt.CONSOLE_LEVELS=Ss;zt.consoleSandbox=Ru;zt.logger=rB;zt.originalConsoleMethods=Ws});var Rs=d(vn=>{Object.defineProperty(vn,"__esModule",{value:!0});var iB=Ge(),Hn=me(),oB=/^(?:(\w+):)\/\/(?:(\w+)(?::(\w+)?)?@)([\w.-]+)(?::(\d+))?\/(.+)/;function sB(t){return t==="http"||t==="https"}function aB(t,e=!1){let{host:n,path:r,pass:i,port:o,projectId:s,protocol:a,publicKey:c}=t;return`${a}://${c}${e&&i?`:${i}`:""}@${n}${o?`:${o}`:""}/${r&&`${r}/`}${s}`}function Vu(t){let e=oB.exec(t);if(!e){Hn.consoleSandbox(()=>{console.error(`Invalid Sentry Dsn: ${t}`)});return}let[n,r,i="",o,s="",a]=e.slice(1),c="",l=a,g=l.split("/");if(g.length>1&&(c=g.slice(0,-1).join("/"),l=g.pop()),l){let u=l.match(/^\d+/);u&&(l=u[0])}return Hu({host:o,pass:i,path:c,projectId:l,port:s,protocol:n,publicKey:r})}function Hu(t){return{protocol:t.protocol,publicKey:t.publicKey||"",pass:t.pass||"",host:t.host,port:t.port||"",path:t.path||"",projectId:t.projectId}}function cB(t){if(!iB.DEBUG_BUILD)return!0;let{port:e,projectId:n,protocol:r}=t;return["protocol","publicKey","host","projectId"].find(s=>t[s]?!1:(Hn.logger.error(`Invalid Sentry Dsn: ${s} missing`),!0))?!1:n.match(/^\d+$/)?sB(r)?e&&isNaN(parseInt(e,10))?(Hn.logger.error(`Invalid Sentry Dsn: Invalid port ${e}`),!1):!0:(Hn.logger.error(`Invalid Sentry Dsn: Invalid protocol ${r}`),!1):(Hn.logger.error(`Invalid Sentry Dsn: Invalid projectId ${n}`),!1)}function lB(t){let e=typeof t=="string"?Vu(t):Hu(t);if(!(!e||!cB(e)))return e}vn.dsnFromString=Vu;vn.dsnToString=aB;vn.makeDsn=lB});var vs=d(Hs=>{Object.defineProperty(Hs,"__esModule",{value:!0});var Vs=class extends Error{constructor(e,n="warn"){super(e),this.message=e,this.name=new.target.prototype.constructor.name,Object.setPrototypeOf(this,new.target.prototype),this.logLevel=n}};Hs.SentryError=Vs});var ae=d(Ce=>{Object.defineProperty(Ce,"__esModule",{value:!0});var gB=ys(),uB=Ge(),xt=se(),dB=me(),vu=Rn();function IB(t,e,n){if(!(e in t))return;let r=t[e],i=n(r);typeof i=="function"&&Yu(i,r),t[e]=i}function Eu(t,e,n){try{Object.defineProperty(t,e,{value:n,writable:!0,configurable:!0})}catch{uB.DEBUG_BUILD&&dB.logger.log(`Failed to add non-enumerable property "${e}" to object`,t)}}function Yu(t,e){try{let n=e.prototype||{};t.prototype=e.prototype=n,Eu(t,"__sentry_original__",e)}catch{}}function pB(t){return t.__sentry_original__}function mB(t){return Object.keys(t).map(e=>`${encodeURIComponent(e)}=${encodeURIComponent(t[e])}`).join("&")}function Xu(t){if(xt.isError(t))return{message:t.message,name:t.name,stack:t.stack,...Nu(t)};if(xt.isEvent(t)){let e={type:t.type,target:_u(t.target),currentTarget:_u(t.currentTarget),...Nu(t)};return typeof CustomEvent<"u"&&xt.isInstanceOf(t,CustomEvent)&&(e.detail=t.detail),e}else return t}function _u(t){try{return xt.isElement(t)?gB.htmlTreeAsString(t):Object.prototype.toString.call(t)}catch{return"<unknown>"}}function Nu(t){if(typeof t=="object"&&t!==null){let e={};for(let n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}else return{}}function CB(t,e=40){let n=Object.keys(Xu(t));if(n.sort(),!n.length)return"[object has no keys]";if(n[0].length>=e)return vu.truncate(n[0],e);for(let r=n.length;r>0;r--){let i=n.slice(0,r).join(", ");if(!(i.length>e))return r===n.length?i:vu.truncate(i,e)}return""}function bB(t){return _s(t,new Map)}function _s(t,e){if(hB(t)){let n=e.get(t);if(n!==void 0)return n;let r={};e.set(t,r);for(let i of Object.keys(t))typeof t[i]<"u"&&(r[i]=_s(t[i],e));return r}if(Array.isArray(t)){let n=e.get(t);if(n!==void 0)return n;let r=[];return e.set(t,r),t.forEach(i=>{r.push(_s(i,e))}),r}return t}function hB(t){if(!xt.isPlainObject(t))return!1;try{let e=Object.getPrototypeOf(t).constructor.name;return!e||e==="Object"}catch{return!0}}function BB(t){let e;switch(!0){case t==null:e=new String(t);break;case(typeof t=="symbol"||typeof t=="bigint"):e=Object(t);break;case xt.isPrimitive(t):e=new t.constructor(t);break;default:e=t;break}return e}Ce.addNonEnumerableProperty=Eu;Ce.convertToPlainObject=Xu;Ce.dropUndefinedKeys=bB;Ce.extractExceptionKeysForMessage=CB;Ce.fill=IB;Ce.getOriginalFunction=pB;Ce.markFunctionWrapped=Yu;Ce.objectify=BB;Ce.urlEncode=mB});var jr=d(Pr=>{Object.defineProperty(Pr,"__esModule",{value:!0});function Tu(t,e=!1){return!(e||t&&!t.startsWith("/")&&!t.match(/^[A-Z]:/)&&!t.startsWith(".")&&!t.match(/^[a-zA-Z]([a-zA-Z0-9.\-+])*:\/\//))&&t!==void 0&&!t.includes("node_modules/")}function ZB(t){let e=/^\s*[-]{4,}$/,n=/at (?:async )?(?:(.+?)\s+\()?(?:(.+):(\d+):(\d+)?|([^)]+))\)?/;return r=>{let i=r.match(n);if(i){let o,s,a,c,l;if(i[1]){a=i[1];let I=a.lastIndexOf(".");if(a[I-1]==="."&&I--,I>0){o=a.slice(0,I),s=a.slice(I+1);let m=o.indexOf(".Module");m>0&&(a=a.slice(m+1),o=o.slice(0,m))}c=void 0}s&&(c=o,l=s),s==="<anonymous>"&&(l=void 0,a=void 0),a===void 0&&(l=l||"<anonymous>",a=c?`${c}.${l}`:l);let g=i[2]&&i[2].startsWith("file://")?i[2].slice(7):i[2],u=i[5]==="native";return g&&g.match(/\/[A-Z]:/)&&(g=g.slice(1)),!g&&i[5]&&!u&&(g=i[5]),{filename:g,module:t?t(g):void 0,function:a,lineno:parseInt(i[3],10)||void 0,colno:parseInt(i[4],10)||void 0,in_app:Tu(g,u)}}if(r.match(e))return{filename:r}}}Pr.filenameIsInApp=Tu;Pr.node=ZB});var Qr=d(rt=>{Object.defineProperty(rt,"__esModule",{value:!0});var Uu=jr(),Ku=50,Fu=/\(error: (.*)\)/,wu=/captureMessage|captureException/;function Ju(...t){let e=t.sort((n,r)=>n[0]-r[0]).map(n=>n[1]);return(n,r=0)=>{let i=[],o=n.split(`
`);for(let s=r;s<o.length;s++){let a=o[s];if(a.length>1024)continue;let c=Fu.test(a)?a.replace(Fu,"$1"):a;if(!c.match(/\S*Error: /)){for(let l of e){let g=l(c);if(g){i.push(g);break}}if(i.length>=Ku)break}}return ku(i)}}function GB(t){return Array.isArray(t)?Ju(...t):t}function ku(t){if(!t.length)return[];let e=Array.from(t);return/sentryWrapped/.test(e[e.length-1].function||"")&&e.pop(),e.reverse(),wu.test(e[e.length-1].function||"")&&(e.pop(),wu.test(e[e.length-1].function||"")&&e.pop()),e.slice(0,Ku).map(n=>({...n,filename:n.filename||e[e.length-1].filename,function:n.function||"?"}))}var Ns="<anonymous>";function yB(t){try{return!t||typeof t!="function"?Ns:t.name||Ns}catch{return Ns}}function AB(t){return[90,Uu.node(t)]}rt.filenameIsInApp=Uu.filenameIsInApp;rt.createStackParser=Ju;rt.getFunctionName=yB;rt.nodeStackLineParser=AB;rt.stackParserFromStackParserOptions=GB;rt.stripSentryFramesAndReverse=ku});var we=d(Mt=>{Object.defineProperty(Mt,"__esModule",{value:!0});var fB=Ge(),SB=me(),WB=Qr(),Ot={},Lu={};function RB(t,e){Ot[t]=Ot[t]||[],Ot[t].push(e)}function VB(){Object.keys(Ot).forEach(t=>{Ot[t]=void 0})}function HB(t,e){Lu[t]||(e(),Lu[t]=!0)}function vB(t,e){let n=t&&Ot[t];if(n)for(let r of n)try{r(e)}catch(i){fB.DEBUG_BUILD&&SB.logger.error(`Error while triggering instrumentation handler.
Type: ${t}
Name: ${WB.getFunctionName(r)}
Error:`,i)}}Mt.addHandler=RB;Mt.maybeInstrument=HB;Mt.resetInstrumentationHandlers=VB;Mt.triggerHandlers=vB});var Ts=d(Xs=>{Object.defineProperty(Xs,"__esModule",{value:!0});var Es=me(),_B=ae(),qr=x(),Ys=we();function NB(t){let e="console";Ys.addHandler(e,t),Ys.maybeInstrument(e,EB)}function EB(){"console"in qr.GLOBAL_OBJ&&Es.CONSOLE_LEVELS.forEach(function(t){t in qr.GLOBAL_OBJ.console&&_B.fill(qr.GLOBAL_OBJ.console,t,function(e){return Es.originalConsoleMethods[t]=e,function(...n){let r={args:n,level:t};Ys.triggerHandlers("console",r);let i=Es.originalConsoleMethods[t];i&&i.apply(qr.GLOBAL_OBJ.console,n)}})})}Xs.addConsoleInstrumentationHandler=NB});var _n=d(ye=>{Object.defineProperty(ye,"__esModule",{value:!0});var YB=ae(),Fs=Rn(),XB=x();function TB(){let t=XB.GLOBAL_OBJ,e=t.crypto||t.msCrypto,n=()=>Math.random()*16;try{if(e&&e.randomUUID)return e.randomUUID().replace(/-/g,"");e&&e.getRandomValues&&(n=()=>{let r=new Uint8Array(1);return e.getRandomValues(r),r[0]})}catch{}return("10000000100040008000"+1e11).replace(/[018]/g,r=>(r^(n()&15)>>r/4).toString(16))}function zu(t){return t.exception&&t.exception.values?t.exception.values[0]:void 0}function FB(t){let{message:e,event_id:n}=t;if(e)return e;let r=zu(t);return r?r.type&&r.value?`${r.type}: ${r.value}`:r.type||r.value||n||"<unknown>":n||"<unknown>"}function wB(t,e,n){let r=t.exception=t.exception||{},i=r.values=r.values||[],o=i[0]=i[0]||{};o.value||(o.value=e||""),o.type||(o.type=n||"Error")}function UB(t,e){let n=zu(t);if(!n)return;let r={type:"generic",handled:!0},i=n.mechanism;if(n.mechanism={...r,...i,...e},e&&"data"in e){let o={...i&&i.data,...e.data};n.mechanism.data=o}}var KB=/^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+([0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$/;function JB(t){let e=t.match(KB)||[],n=parseInt(e[1],10),r=parseInt(e[2],10),i=parseInt(e[3],10);return{buildmetadata:e[5],major:isNaN(n)?void 0:n,minor:isNaN(r)?void 0:r,patch:isNaN(i)?void 0:i,prerelease:e[4]}}function kB(t,e,n=5){if(e.lineno===void 0)return;let r=t.length,i=Math.max(Math.min(r-1,e.lineno-1),0);e.pre_context=t.slice(Math.max(0,i-n),i).map(o=>Fs.snipLine(o,0)),e.context_line=Fs.snipLine(t[Math.min(r-1,i)],e.colno||0),e.post_context=t.slice(Math.min(i+1,r),i+1+n).map(o=>Fs.snipLine(o,0))}function LB(t){if(t&&t.__sentry_captured__)return!0;try{YB.addNonEnumerableProperty(t,"__sentry_captured__",!0)}catch{}return!1}function zB(t){return Array.isArray(t)?t:[t]}ye.addContextToFrame=kB;ye.addExceptionMechanism=UB;ye.addExceptionTypeValue=wB;ye.arrayify=zB;ye.checkOrSetAlreadyCaught=LB;ye.getEventDescription=FB;ye.parseSemver=JB;ye.uuid4=TB});var Js=d(ei=>{Object.defineProperty(ei,"__esModule",{value:!0});var xB=_n(),$r=ae(),OB=x(),ws=we(),Dt=OB.GLOBAL_OBJ,MB=1e3,xu,Us,Ks;function DB(t){let e="dom";ws.addHandler(e,t),ws.maybeInstrument(e,Mu)}function Mu(){if(!Dt.document)return;let t=ws.triggerHandlers.bind(null,"dom"),e=Ou(t,!0);Dt.document.addEventListener("click",e,!1),Dt.document.addEventListener("keypress",e,!1),["EventTarget","Node"].forEach(n=>{let r=Dt[n]&&Dt[n].prototype;!r||!r.hasOwnProperty||!r.hasOwnProperty("addEventListener")||($r.fill(r,"addEventListener",function(i){return function(o,s,a){if(o==="click"||o=="keypress")try{let c=this,l=c.__sentry_instrumentation_handlers__=c.__sentry_instrumentation_handlers__||{},g=l[o]=l[o]||{refCount:0};if(!g.handler){let u=Ou(t);g.handler=u,i.call(this,o,u,a)}g.refCount++}catch{}return i.call(this,o,s,a)}}),$r.fill(r,"removeEventListener",function(i){return function(o,s,a){if(o==="click"||o=="keypress")try{let c=this,l=c.__sentry_instrumentation_handlers__||{},g=l[o];g&&(g.refCount--,g.refCount<=0&&(i.call(this,o,g.handler,a),g.handler=void 0,delete l[o]),Object.keys(l).length===0&&delete c.__sentry_instrumentation_handlers__)}catch{}return i.call(this,o,s,a)}}))})}function PB(t){if(t.type!==Us)return!1;try{if(!t.target||t.target._sentryId!==Ks)return!1}catch{}return!0}function jB(t,e){return t!=="keypress"?!1:!e||!e.tagName?!0:!(e.tagName==="INPUT"||e.tagName==="TEXTAREA"||e.isContentEditable)}function Ou(t,e=!1){return n=>{if(!n||n._sentryCaptured)return;let r=QB(n);if(jB(n.type,r))return;$r.addNonEnumerableProperty(n,"_sentryCaptured",!0),r&&!r._sentryId&&$r.addNonEnumerableProperty(r,"_sentryId",xB.uuid4());let i=n.type==="keypress"?"input":n.type;PB(n)||(t({event:n,name:i,global:e}),Us=n.type,Ks=r?r._sentryId:void 0),clearTimeout(xu),xu=Dt.setTimeout(()=>{Ks=void 0,Us=void 0},MB)}}function QB(t){try{return t.target}catch{return null}}ei.addClickKeypressInstrumentationHandler=DB;ei.instrumentDOM=Mu});var zs=d(Ae=>{Object.defineProperty(Ae,"__esModule",{value:!0});var qB=Ge(),$B=me(),eZ=x(),ti=eZ.getGlobalObject();function tZ(){try{return new ErrorEvent(""),!0}catch{return!1}}function nZ(){try{return new DOMError(""),!0}catch{return!1}}function rZ(){try{return new DOMException(""),!0}catch{return!1}}function Ls(){if(!("fetch"in ti))return!1;try{return new Headers,new Request("http://www.example.com"),new Response,!0}catch{return!1}}function ks(t){return t&&/^function fetch\(\)\s+\{\s+\[native code\]\s+\}$/.test(t.toString())}function iZ(){if(typeof EdgeRuntime=="string")return!0;if(!Ls())return!1;if(ks(ti.fetch))return!0;let t=!1,e=ti.document;if(e&&typeof e.createElement=="function")try{let n=e.createElement("iframe");n.hidden=!0,e.head.appendChild(n),n.contentWindow&&n.contentWindow.fetch&&(t=ks(n.contentWindow.fetch)),e.head.removeChild(n)}catch(n){qB.DEBUG_BUILD&&$B.logger.warn("Could not create sandbox iframe for pure fetch check, bailing to window.fetch: ",n)}return t}function oZ(){return"ReportingObserver"in ti}function sZ(){if(!Ls())return!1;try{return new Request("_",{referrerPolicy:"origin"}),!0}catch{return!1}}Ae.isNativeFetch=ks;Ae.supportsDOMError=nZ;Ae.supportsDOMException=rZ;Ae.supportsErrorEvent=tZ;Ae.supportsFetch=Ls;Ae.supportsNativeFetch=iZ;Ae.supportsReferrerPolicy=sZ;Ae.supportsReportingObserver=oZ});var Os=d(ni=>{Object.defineProperty(ni,"__esModule",{value:!0});var aZ=ae(),cZ=zs(),Du=x(),Nn=we();function lZ(t){let e="fetch";Nn.addHandler(e,t),Nn.maybeInstrument(e,gZ)}function gZ(){cZ.supportsNativeFetch()&&aZ.fill(Du.GLOBAL_OBJ,"fetch",function(t){return function(...e){let{method:n,url:r}=ju(e),i={args:e,fetchData:{method:n,url:r},startTimestamp:Date.now()};return Nn.triggerHandlers("fetch",{...i}),t.apply(Du.GLOBAL_OBJ,e).then(o=>{let s={...i,endTimestamp:Date.now(),response:o};return Nn.triggerHandlers("fetch",s),o},o=>{let s={...i,endTimestamp:Date.now(),error:o};throw Nn.triggerHandlers("fetch",s),o})}})}function xs(t,e){return!!t&&typeof t=="object"&&!!t[e]}function Pu(t){return typeof t=="string"?t:t?xs(t,"url")?t.url:t.toString?t.toString():"":""}function ju(t){if(t.length===0)return{method:"GET",url:""};if(t.length===2){let[n,r]=t;return{url:Pu(n),method:xs(r,"method")?String(r.method).toUpperCase():"GET"}}let e=t[0];return{url:Pu(e),method:xs(e,"method")?String(e.method).toUpperCase():"GET"}}ni.addFetchInstrumentationHandler=lZ;ni.parseFetchArgs=ju});var js=d(Ps=>{Object.defineProperty(Ps,"__esModule",{value:!0});var Ms=x(),Ds=we(),ri=null;function uZ(t){let e="error";Ds.addHandler(e,t),Ds.maybeInstrument(e,dZ)}function dZ(){ri=Ms.GLOBAL_OBJ.onerror,Ms.GLOBAL_OBJ.onerror=function(t,e,n,r,i){let o={column:r,error:i,line:n,msg:t,url:e};return Ds.triggerHandlers("error",o),ri&&!ri.__SENTRY_LOADER__?ri.apply(this,arguments):!1},Ms.GLOBAL_OBJ.onerror.__SENTRY_INSTRUMENTED__=!0}Ps.addGlobalErrorInstrumentationHandler=uZ});var ea=d($s=>{Object.defineProperty($s,"__esModule",{value:!0});var Qs=x(),qs=we(),ii=null;function IZ(t){let e="unhandledrejection";qs.addHandler(e,t),qs.maybeInstrument(e,pZ)}function pZ(){ii=Qs.GLOBAL_OBJ.onunhandledrejection,Qs.GLOBAL_OBJ.onunhandledrejection=function(t){let e=t;return qs.triggerHandlers("unhandledrejection",e),ii&&!ii.__SENTRY_LOADER__?ii.apply(this,arguments):!0},Qs.GLOBAL_OBJ.onunhandledrejection.__SENTRY_INSTRUMENTED__=!0}$s.addGlobalUnhandledRejectionInstrumentationHandler=IZ});var na=d(ta=>{Object.defineProperty(ta,"__esModule",{value:!0});var mZ=x(),oi=mZ.getGlobalObject();function CZ(){let t=oi.chrome,e=t&&t.app&&t.app.runtime,n="history"in oi&&!!oi.history.pushState&&!!oi.history.replaceState;return!e&&n}ta.supportsHistory=CZ});var ia=d(ra=>{Object.defineProperty(ra,"__esModule",{value:!0});var Qu=ae();Ge();me();var bZ=x(),hZ=na(),ai=we(),En=bZ.GLOBAL_OBJ,si;function BZ(t){let e="history";ai.addHandler(e,t),ai.maybeInstrument(e,ZZ)}function ZZ(){if(!hZ.supportsHistory())return;let t=En.onpopstate;En.onpopstate=function(...n){let r=En.location.href,i=si;si=r;let o={from:i,to:r};if(ai.triggerHandlers("history",o),t)try{return t.apply(this,n)}catch{}};function e(n){return function(...r){let i=r.length>2?r[2]:void 0;if(i){let o=si,s=String(i);si=s;let a={from:o,to:s};ai.triggerHandlers("history",a)}return n.apply(this,r)}}Qu.fill(En.history,"pushState",e),Qu.fill(En.history,"replaceState",e)}ra.addHistoryInstrumentationHandler=BZ});var oa=d(Xn=>{Object.defineProperty(Xn,"__esModule",{value:!0});var li=se(),ci=ae(),GZ=x(),gi=we(),yZ=GZ.GLOBAL_OBJ,Yn="__sentry_xhr_v3__";function AZ(t){let e="xhr";gi.addHandler(e,t),gi.maybeInstrument(e,qu)}function qu(){if(!yZ.XMLHttpRequest)return;let t=XMLHttpRequest.prototype;ci.fill(t,"open",function(e){return function(...n){let r=Date.now(),i=li.isString(n[0])?n[0].toUpperCase():void 0,o=fZ(n[1]);if(!i||!o)return e.apply(this,n);this[Yn]={method:i,url:o,request_headers:{}},i==="POST"&&o.match(/sentry_key/)&&(this.__sentry_own_request__=!0);let s=()=>{let a=this[Yn];if(a&&this.readyState===4){try{a.status_code=this.status}catch{}let c={args:[i,o],endTimestamp:Date.now(),startTimestamp:r,xhr:this};gi.triggerHandlers("xhr",c)}};return"onreadystatechange"in this&&typeof this.onreadystatechange=="function"?ci.fill(this,"onreadystatechange",function(a){return function(...c){return s(),a.apply(this,c)}}):this.addEventListener("readystatechange",s),ci.fill(this,"setRequestHeader",function(a){return function(...c){let[l,g]=c,u=this[Yn];return u&&li.isString(l)&&li.isString(g)&&(u.request_headers[l.toLowerCase()]=g),a.apply(this,c)}}),e.apply(this,n)}}),ci.fill(t,"send",function(e){return function(...n){let r=this[Yn];if(!r)return e.apply(this,n);n[0]!==void 0&&(r.body=n[0]);let i={args:[r.method,r.url],startTimestamp:Date.now(),xhr:this};return gi.triggerHandlers("xhr",i),e.apply(this,n)}})}function fZ(t){if(li.isString(t))return t;try{return t.toString()}catch{}}Xn.SENTRY_XHR_DATA_KEY=Yn;Xn.addXhrInstrumentationHandler=AZ;Xn.instrumentXHR=qu});var od=d(be=>{Object.defineProperty(be,"__esModule",{value:!0});var SZ=Ge(),WZ=me(),$u=Ts(),ed=Js(),td=Os(),nd=js(),rd=ea(),id=ia(),sa=oa();function RZ(t,e){switch(t){case"console":return $u.addConsoleInstrumentationHandler(e);case"dom":return ed.addClickKeypressInstrumentationHandler(e);case"xhr":return sa.addXhrInstrumentationHandler(e);case"fetch":return td.addFetchInstrumentationHandler(e);case"history":return id.addHistoryInstrumentationHandler(e);case"error":return nd.addGlobalErrorInstrumentationHandler(e);case"unhandledrejection":return rd.addGlobalUnhandledRejectionInstrumentationHandler(e);default:SZ.DEBUG_BUILD&&WZ.logger.warn("unknown instrumentation type:",t)}}be.addConsoleInstrumentationHandler=$u.addConsoleInstrumentationHandler;be.addClickKeypressInstrumentationHandler=ed.addClickKeypressInstrumentationHandler;be.addFetchInstrumentationHandler=td.addFetchInstrumentationHandler;be.addGlobalErrorInstrumentationHandler=nd.addGlobalErrorInstrumentationHandler;be.addGlobalUnhandledRejectionInstrumentationHandler=rd.addGlobalUnhandledRejectionInstrumentationHandler;be.addHistoryInstrumentationHandler=id.addHistoryInstrumentationHandler;be.SENTRY_XHR_DATA_KEY=sa.SENTRY_XHR_DATA_KEY;be.addXhrInstrumentationHandler=sa.addXhrInstrumentationHandler;be.addInstrumentationHandler=RZ});var aa=d(ui=>{Object.defineProperty(ui,"__esModule",{value:!0});function VZ(){return typeof __SENTRY_BROWSER_BUNDLE__<"u"&&!!__SENTRY_BROWSER_BUNDLE__}function HZ(){return"npm"}ui.getSDKSource=HZ;ui.isBrowserBundle=VZ});var ca=d((Tn,Ii)=>{Object.defineProperty(Tn,"__esModule",{value:!0});var vZ=aa();function _Z(){return!vZ.isBrowserBundle()&&Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]"}function di(t,e){return t.require(e)}function NZ(t){let e;try{e=di(Ii,t)}catch{}try{let{cwd:n}=di(Ii,"process");e=di(Ii,`${n()}/node_modules/${t}`)}catch{}return e}Tn.dynamicRequire=di;Tn.isNodeEnv=_Z;Tn.loadModule=NZ});var ad=d(la=>{Object.defineProperty(la,"__esModule",{value:!0});var EZ=ca(),sd=x();function YZ(){return typeof window<"u"&&(!EZ.isNodeEnv()||XZ())}function XZ(){return sd.GLOBAL_OBJ.process!==void 0&&sd.GLOBAL_OBJ.process.type==="renderer"}la.isBrowser=YZ});var ua=d(ga=>{Object.defineProperty(ga,"__esModule",{value:!0});function TZ(){let t=typeof WeakSet=="function",e=t?new WeakSet:[];function n(i){if(t)return e.has(i)?!0:(e.add(i),!1);for(let o=0;o<e.length;o++)if(e[o]===i)return!0;return e.push(i),!1}function r(i){if(t)e.delete(i);else for(let o=0;o<e.length;o++)if(e[o]===i){e.splice(o,1);break}}return[n,r]}ga.memoBuilder=TZ});var Fn=d(Pt=>{Object.defineProperty(Pt,"__esModule",{value:!0});var da=se(),FZ=ua(),wZ=ae(),UZ=Qr();function cd(t,e=100,n=1/0){try{return pi("",t,e,n)}catch(r){return{ERROR:`**non-serializable** (${r})`}}}function ld(t,e=3,n=100*1024){let r=cd(t,e);return LZ(r)>n?ld(t,e-1,n):r}function pi(t,e,n=1/0,r=1/0,i=FZ.memoBuilder()){let[o,s]=i;if(e==null||["number","boolean","string"].includes(typeof e)&&!da.isNaN(e))return e;let a=KZ(t,e);if(!a.startsWith("[object "))return a;if(e.__sentry_skip_normalization__)return e;let c=typeof e.__sentry_override_normalization_depth__=="number"?e.__sentry_override_normalization_depth__:n;if(c===0)return a.replace("object ","");if(o(e))return"[Circular ~]";let l=e;if(l&&typeof l.toJSON=="function")try{let m=l.toJSON();return pi("",m,c-1,r,i)}catch{}let g=Array.isArray(e)?[]:{},u=0,I=wZ.convertToPlainObject(e);for(let m in I){if(!Object.prototype.hasOwnProperty.call(I,m))continue;if(u>=r){g[m]="[MaxProperties ~]";break}let C=I[m];g[m]=pi(m,C,c-1,r,i),u++}return s(e),g}function KZ(t,e){try{if(t==="domain"&&e&&typeof e=="object"&&e._events)return"[Domain]";if(t==="domainEmitter")return"[DomainEmitter]";if(typeof global<"u"&&e===global)return"[Global]";if(typeof window<"u"&&e===window)return"[Window]";if(typeof document<"u"&&e===document)return"[Document]";if(da.isVueViewModel(e))return"[VueViewModel]";if(da.isSyntheticEvent(e))return"[SyntheticEvent]";if(typeof e=="number"&&e!==e)return"[NaN]";if(typeof e=="function")return`[Function: ${UZ.getFunctionName(e)}]`;if(typeof e=="symbol")return`[${String(e)}]`;if(typeof e=="bigint")return`[BigInt: ${String(e)}]`;let n=JZ(e);return/^HTML(\w*)Element$/.test(n)?`[HTMLElement: ${n}]`:`[object ${n}]`}catch(n){return`**non-serializable** (${n})`}}function JZ(t){let e=Object.getPrototypeOf(t);return e?e.constructor.name:"null prototype"}function kZ(t){return~-encodeURI(t).split(/%..|./).length}function LZ(t){return kZ(JSON.stringify(t))}function zZ(t,e){let n=e.replace(/\\/g,"/").replace(/[|\\{}()[\]^$+*?.]/g,"\\$&"),r=t;try{r=decodeURI(t)}catch{}return r.replace(/\\/g,"/").replace(/webpack:\/?/g,"").replace(new RegExp(`(file://)?/*${n}/*`,"ig"),"app:///")}Pt.normalize=cd;Pt.normalizeToSize=ld;Pt.normalizeUrlToBase=zZ;Pt.walk=pi});var md=d(Ue=>{Object.defineProperty(Ue,"__esModule",{value:!0});function ud(t,e){let n=0;for(let r=t.length-1;r>=0;r--){let i=t[r];i==="."?t.splice(r,1):i===".."?(t.splice(r,1),n++):n&&(t.splice(r,1),n--)}if(e)for(;n--;n)t.unshift("..");return t}var xZ=/^(\S+:\\|\/?)([\s\S]*?)((?:\.{1,2}|[^/\\]+?|)(\.[^./\\]*|))(?:[/\\]*)$/;function dd(t){let e=t.length>1024?`<truncated>${t.slice(-1024)}`:t,n=xZ.exec(e);return n?n.slice(1):[]}function Ia(...t){let e="",n=!1;for(let r=t.length-1;r>=-1&&!n;r--){let i=r>=0?t[r]:"/";i&&(e=`${i}/${e}`,n=i.charAt(0)==="/")}return e=ud(e.split("/").filter(r=>!!r),!n).join("/"),(n?"/":"")+e||"."}function gd(t){let e=0;for(;e<t.length&&t[e]==="";e++);let n=t.length-1;for(;n>=0&&t[n]==="";n--);return e>n?[]:t.slice(e,n-e+1)}function OZ(t,e){t=Ia(t).slice(1),e=Ia(e).slice(1);let n=gd(t.split("/")),r=gd(e.split("/")),i=Math.min(n.length,r.length),o=i;for(let a=0;a<i;a++)if(n[a]!==r[a]){o=a;break}let s=[];for(let a=o;a<n.length;a++)s.push("..");return s=s.concat(r.slice(o)),s.join("/")}function Id(t){let e=pd(t),n=t.slice(-1)==="/",r=ud(t.split("/").filter(i=>!!i),!e).join("/");return!r&&!e&&(r="."),r&&n&&(r+="/"),(e?"/":"")+r}function pd(t){return t.charAt(0)==="/"}function MZ(...t){return Id(t.join("/"))}function DZ(t){let e=dd(t),n=e[0],r=e[1];return!n&&!r?".":(r&&(r=r.slice(0,r.length-1)),n+r)}function PZ(t,e){let n=dd(t)[2];return e&&n.slice(e.length*-1)===e&&(n=n.slice(0,n.length-e.length)),n}Ue.basename=PZ;Ue.dirname=DZ;Ue.isAbsolute=pd;Ue.join=MZ;Ue.normalizePath=Id;Ue.relative=OZ;Ue.resolve=Ia});var pa=d(Un=>{Object.defineProperty(Un,"__esModule",{value:!0});var jZ=se(),Ke;(function(t){t[t.PENDING=0]="PENDING";let n=1;t[t.RESOLVED=n]="RESOLVED";let r=2;t[t.REJECTED=r]="REJECTED"})(Ke||(Ke={}));function QZ(t){return new wn(e=>{e(t)})}function qZ(t){return new wn((e,n)=>{n(t)})}var wn=class t{constructor(e){t.prototype.__init.call(this),t.prototype.__init2.call(this),t.prototype.__init3.call(this),t.prototype.__init4.call(this),this._state=Ke.PENDING,this._handlers=[];try{e(this._resolve,this._reject)}catch(n){this._reject(n)}}then(e,n){return new t((r,i)=>{this._handlers.push([!1,o=>{if(!e)r(o);else try{r(e(o))}catch(s){i(s)}},o=>{if(!n)i(o);else try{r(n(o))}catch(s){i(s)}}]),this._executeHandlers()})}catch(e){return this.then(n=>n,e)}finally(e){return new t((n,r)=>{let i,o;return this.then(s=>{o=!1,i=s,e&&e()},s=>{o=!0,i=s,e&&e()}).then(()=>{if(o){r(i);return}n(i)})})}__init(){this._resolve=e=>{this._setResult(Ke.RESOLVED,e)}}__init2(){this._reject=e=>{this._setResult(Ke.REJECTED,e)}}__init3(){this._setResult=(e,n)=>{if(this._state===Ke.PENDING){if(jZ.isThenable(n)){n.then(this._resolve,this._reject);return}this._state=e,this._value=n,this._executeHandlers()}}}__init4(){this._executeHandlers=()=>{if(this._state===Ke.PENDING)return;let e=this._handlers.slice();this._handlers=[],e.forEach(n=>{n[0]||(this._state===Ke.RESOLVED&&n[1](this._value),this._state===Ke.REJECTED&&n[2](this._value),n[0]=!0)})}}};Un.SyncPromise=wn;Un.rejectedSyncPromise=qZ;Un.resolvedSyncPromise=QZ});var Cd=d(Ca=>{Object.defineProperty(Ca,"__esModule",{value:!0});var $Z=vs(),ma=pa();function eG(t){let e=[];function n(){return t===void 0||e.length<t}function r(s){return e.splice(e.indexOf(s),1)[0]}function i(s){if(!n())return ma.rejectedSyncPromise(new $Z.SentryError("Not adding Promise because buffer limit was reached."));let a=s();return e.indexOf(a)===-1&&e.push(a),a.then(()=>r(a)).then(null,()=>r(a).then(null,()=>{})),a}function o(s){return new ma.SyncPromise((a,c)=>{let l=e.length;if(!l)return a(!0);let g=setTimeout(()=>{s&&s>0&&a(!1)},s);e.forEach(u=>{ma.resolvedSyncPromise(u).then(()=>{--l||(clearTimeout(g),a(!0))},c)})})}return{$:e,add:i,drain:o}}Ca.makePromiseBuffer=eG});var bd=d(ba=>{Object.defineProperty(ba,"__esModule",{value:!0});function tG(t){let e={},n=0;for(;n<t.length;){let r=t.indexOf("=",n);if(r===-1)break;let i=t.indexOf(";",n);if(i===-1)i=t.length;else if(i<r){n=t.lastIndexOf(";",r-1)+1;continue}let o=t.slice(n,r).trim();if(e[o]===void 0){let s=t.slice(r+1,i).trim();s.charCodeAt(0)===34&&(s=s.slice(1,-1));try{e[o]=s.indexOf("%")!==-1?decodeURIComponent(s):s}catch{e[o]=s}}n=i+1}return e}ba.parseCookie=tG});var ha=d(jt=>{Object.defineProperty(jt,"__esModule",{value:!0});function nG(t){if(!t)return{};let e=t.match(/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/);if(!e)return{};let n=e[6]||"",r=e[8]||"";return{host:e[4],path:e[5],protocol:e[2],search:n,hash:r,relative:e[5]+n+r}}function rG(t){return t.split(/[\?#]/,1)[0]}function iG(t){return t.split(/\\?\//).filter(e=>e.length>0&&e!==",").length}function oG(t){let{protocol:e,host:n,path:r}=t,i=n&&n.replace(/^.*@/,"[filtered]:[filtered]@").replace(/(:80)$/,"").replace(/(:443)$/,"")||"";return`${e?`${e}://`:""}${i}${r}`}jt.getNumberOfUrlSegments=iG;jt.getSanitizedUrlString=oG;jt.parseUrl=nG;jt.stripUrlQueryAndFragment=rG});var yd=d(Je=>{Object.defineProperty(Je,"__esModule",{value:!0});var sG=bd(),aG=Ge(),hd=se(),cG=me(),lG=Fn(),gG=ha(),uG={ip:!1,request:!0,transaction:!0,user:!0},dG=["cookies","data","headers","method","query_string","url"],Bd=["id","username","email"];function IG(t,e,n){if(t){if(!t.metadata.source||t.metadata.source==="url"){let[r,i]=mi(e,{path:!0,method:!0});t.updateName(r),t.setMetadata({source:i})}t.setAttribute("url",e.originalUrl||e.url),e.baseUrl&&t.setAttribute("baseUrl",e.baseUrl),t.setData("query",Zd(e,n))}}function mi(t,e={}){let n=t.method&&t.method.toUpperCase(),r="",i="url";e.customRoute||t.route?(r=e.customRoute||`${t.baseUrl||""}${t.route&&t.route.path}`,i="route"):(t.originalUrl||t.url)&&(r=gG.stripUrlQueryAndFragment(t.originalUrl||t.url||""));let o="";return e.method&&n&&(o+=n),e.method&&e.path&&(o+=" "),e.path&&r&&(o+=r),[o,i]}function pG(t,e){switch(e){case"path":return mi(t,{path:!0})[0];case"handler":return t.route&&t.route.stack&&t.route.stack[0]&&t.route.stack[0].name||"<anonymous>";case"methodPath":default:{let n=t._reconstructedRoute?t._reconstructedRoute:void 0;return mi(t,{path:!0,method:!0,customRoute:n})[0]}}}function mG(t,e){let n={};return(Array.isArray(e)?e:Bd).forEach(i=>{t&&i in t&&(n[i]=t[i])}),n}function Ba(t,e){let{include:n=dG,deps:r}=e||{},i={},o=t.headers||{},s=t.method,a=o.host||t.hostname||t.host||"<no host>",c=t.protocol==="https"||t.socket&&t.socket.encrypted?"https":"http",l=t.originalUrl||t.url||"",g=l.startsWith(c)?l:`${c}://${a}${l}`;return n.forEach(u=>{switch(u){case"headers":{i.headers=o,n.includes("cookies")||delete i.headers.cookie;break}case"method":{i.method=s;break}case"url":{i.url=g;break}case"cookies":{i.cookies=t.cookies||o.cookie&&sG.parseCookie(o.cookie)||{};break}case"query_string":{i.query_string=Zd(t,r);break}case"data":{if(s==="GET"||s==="HEAD")break;t.body!==void 0&&(i.data=hd.isString(t.body)?t.body:JSON.stringify(lG.normalize(t.body)));break}default:({}).hasOwnProperty.call(t,u)&&(i[u]=t[u])}}),i}function CG(t,e,n){let r={...uG,...n&&n.include};if(r.request){let i=Array.isArray(r.request)?Ba(e,{include:r.request,deps:n&&n.deps}):Ba(e,{deps:n&&n.deps});t.request={...t.request,...i}}if(r.user){let i=e.user&&hd.isPlainObject(e.user)?mG(e.user,r.user):{};Object.keys(i).length&&(t.user={...t.user,...i})}if(r.ip){let i=e.ip||e.socket&&e.socket.remoteAddress;i&&(t.user={...t.user,ip_address:i})}return r.transaction&&!t.transaction&&(t.transaction=pG(e,r.transaction)),t}function Zd(t,e){let n=t.originalUrl||t.url||"";if(n){n.startsWith("/")&&(n=`http://dogs.are.great${n}`);try{return t.query||typeof URL<"u"&&new URL(n).search.slice(1)||e&&e.url&&e.url.parse(n).query||void 0}catch{return}}}function Gd(t){let e={};try{t.forEach((n,r)=>{typeof n=="string"&&(e[r]=n)})}catch{aG.DEBUG_BUILD&&cG.logger.warn("Sentry failed extracting headers from a request object. If you see this, please file an issue.")}return e}function bG(t){let e=Gd(t.headers);return{method:t.method,url:t.url,headers:e}}Je.DEFAULT_USER_INCLUDES=Bd;Je.addRequestDataToEvent=CG;Je.addRequestDataToTransaction=IG;Je.extractPathForTransaction=mi;Je.extractRequestData=Ba;Je.winterCGHeadersToDict=Gd;Je.winterCGRequestToRequestData=bG});var Sd=d(Kn=>{Object.defineProperty(Kn,"__esModule",{value:!0});var Ad=["fatal","error","warning","log","info","debug"];function hG(t){return fd(t)}function fd(t){return t==="warn"?"warning":Ad.includes(t)?t:"log"}Kn.severityFromString=hG;Kn.severityLevelFromString=fd;Kn.validSeverityLevels=Ad});var Za=d(he=>{Object.defineProperty(he,"__esModule",{value:!0});var Wd=x(),Rd=1e3;function Vd(){return Date.now()/Rd}function BG(){let{performance:t}=Wd.GLOBAL_OBJ;if(!t||!t.now)return Vd;let e=Date.now()-t.now(),n=t.timeOrigin==null?e:t.timeOrigin;return()=>(n+t.now())/Rd}var Hd=BG(),ZG=Hd;he._browserPerformanceTimeOriginMode=void 0;var GG=(()=>{let{performance:t}=Wd.GLOBAL_OBJ;if(!t||!t.now){he._browserPerformanceTimeOriginMode="none";return}let e=3600*1e3,n=t.now(),r=Date.now(),i=t.timeOrigin?Math.abs(t.timeOrigin+n-r):e,o=i<e,s=t.timing&&t.timing.navigationStart,c=typeof s=="number"?Math.abs(s+n-r):e,l=c<e;return o||l?i<=c?(he._browserPerformanceTimeOriginMode="timeOrigin",t.timeOrigin):(he._browserPerformanceTimeOriginMode="navigationStart",s):(he._browserPerformanceTimeOriginMode="dateNow",r)})();he.browserPerformanceTimeOrigin=GG;he.dateTimestampInSeconds=Vd;he.timestampInSeconds=Hd;he.timestampWithMs=ZG});var ya=d(it=>{Object.defineProperty(it,"__esModule",{value:!0});var yG=Ge(),AG=se(),fG=me(),SG="baggage",Ga="sentry-",_d=/^sentry-/,Nd=8192;function WG(t){if(!AG.isString(t)&&!Array.isArray(t))return;let e={};if(Array.isArray(t))e=t.reduce((r,i)=>{let o=vd(i);for(let s of Object.keys(o))r[s]=o[s];return r},{});else{if(!t)return;e=vd(t)}let n=Object.entries(e).reduce((r,[i,o])=>{if(i.match(_d)){let s=i.slice(Ga.length);r[s]=o}return r},{});if(Object.keys(n).length>0)return n}function RG(t){if(!t)return;let e=Object.entries(t).reduce((n,[r,i])=>(i&&(n[`${Ga}${r}`]=i),n),{});return VG(e)}function vd(t){return t.split(",").map(e=>e.split("=").map(n=>decodeURIComponent(n.trim()))).reduce((e,[n,r])=>(e[n]=r,e),{})}function VG(t){if(Object.keys(t).length!==0)return Object.entries(t).reduce((e,[n,r],i)=>{let o=`${encodeURIComponent(n)}=${encodeURIComponent(r)}`,s=i===0?o:`${e},${o}`;return s.length>Nd?(yG.DEBUG_BUILD&&fG.logger.warn(`Not adding key: ${n} with val: ${r} to baggage header due to exceeding baggage size limits.`),e):s},"")}it.BAGGAGE_HEADER_NAME=SG;it.MAX_BAGGAGE_STRING_LENGTH=Nd;it.SENTRY_BAGGAGE_KEY_PREFIX=Ga;it.SENTRY_BAGGAGE_KEY_PREFIX_REGEX=_d;it.baggageHeaderToDynamicSamplingContext=WG;it.dynamicSamplingContextToSentryBaggageHeader=RG});var Xd=d(Qt=>{Object.defineProperty(Qt,"__esModule",{value:!0});var HG=ya(),Ci=_n(),Ed=new RegExp("^[ \\t]*([0-9a-f]{32})?-?([0-9a-f]{16})?-?([01])?[ \\t]*$");function Yd(t){if(!t)return;let e=t.match(Ed);if(!e)return;let n;return e[3]==="1"?n=!0:e[3]==="0"&&(n=!1),{traceId:e[1],parentSampled:n,parentSpanId:e[2]}}function vG(t,e){let n=Yd(t),r=HG.baggageHeaderToDynamicSamplingContext(e),{traceId:i,parentSpanId:o,parentSampled:s}=n||{},a={traceId:i||Ci.uuid4(),spanId:Ci.uuid4().substring(16),sampled:s};return o&&(a.parentSpanId=o),r&&(a.dsc=r),{traceparentData:n,dynamicSamplingContext:r,propagationContext:a}}function _G(t=Ci.uuid4(),e=Ci.uuid4().substring(16),n){let r="";return n!==void 0&&(r=n?"-1":"-0"),`${t}-${e}${r}`}Qt.TRACEPARENT_REGEXP=Ed;Qt.extractTraceparentData=Yd;Qt.generateSentryTraceHeader=_G;Qt.tracingContextFromHeaders=vG});var fa=d(ce=>{Object.defineProperty(ce,"__esModule",{value:!0});var NG=Rs(),EG=Fn(),Td=ae();function YG(t,e=[]){return[t,e]}function XG(t,e){let[n,r]=t;return[n,[...r,e]]}function Fd(t,e){let n=t[1];for(let r of n){let i=r[0].type;if(e(r,i))return!0}return!1}function TG(t,e){return Fd(t,(n,r)=>e.includes(r))}function Aa(t,e){return(e||new TextEncoder).encode(t)}function FG(t,e){let[n,r]=t,i=JSON.stringify(n);function o(s){typeof i=="string"?i=typeof s=="string"?i+s:[Aa(i,e),s]:i.push(typeof s=="string"?Aa(s,e):s)}for(let s of r){let[a,c]=s;if(o(`
${JSON.stringify(a)}
`),typeof c=="string"||c instanceof Uint8Array)o(c);else{let l;try{l=JSON.stringify(c)}catch{l=JSON.stringify(EG.normalize(c))}o(l)}}return typeof i=="string"?i:wG(i)}function wG(t){let e=t.reduce((i,o)=>i+o.length,0),n=new Uint8Array(e),r=0;for(let i of t)n.set(i,r),r+=i.length;return n}function UG(t,e,n){let r=typeof t=="string"?e.encode(t):t;function i(c){let l=r.subarray(0,c);return r=r.subarray(c+1),l}function o(){let c=r.indexOf(10);return c<0&&(c=r.length),JSON.parse(n.decode(i(c)))}let s=o(),a=[];for(;r.length;){let c=o(),l=typeof c.length=="number"?c.length:void 0;a.push([c,l?i(l):o()])}return[s,a]}function KG(t,e){let n=typeof t.data=="string"?Aa(t.data,e):t.data;return[Td.dropUndefinedKeys({type:"attachment",length:n.length,filename:t.filename,content_type:t.contentType,attachment_type:t.attachmentType}),n]}var JG={session:"session",sessions:"session",attachment:"attachment",transaction:"transaction",event:"error",client_report:"internal",user_report:"default",profile:"profile",replay_event:"replay",replay_recording:"replay",check_in:"monitor",feedback:"feedback",statsd:"unknown"};function kG(t){return JG[t]}function LG(t){if(!t||!t.sdk)return;let{name:e,version:n}=t.sdk;return{name:e,version:n}}function zG(t,e,n,r){let i=t.sdkProcessingMetadata&&t.sdkProcessingMetadata.dynamicSamplingContext;return{event_id:t.event_id,sent_at:new Date().toISOString(),...e&&{sdk:e},...!!n&&r&&{dsn:NG.dsnToString(r)},...i&&{trace:Td.dropUndefinedKeys({...i})}}}ce.addItemToEnvelope=XG;ce.createAttachmentEnvelopeItem=KG;ce.createEnvelope=YG;ce.createEventEnvelopeHeaders=zG;ce.envelopeContainsItemType=TG;ce.envelopeItemTypeToDataCategory=kG;ce.forEachEnvelopeItem=Fd;ce.getSdkMetadataForEnvelopeHeader=LG;ce.parseEnvelope=UG;ce.serializeEnvelope=FG});var wd=d(Sa=>{Object.defineProperty(Sa,"__esModule",{value:!0});var xG=fa(),OG=Za();function MG(t,e,n){let r=[{type:"client_report"},{timestamp:n||OG.dateTimestampInSeconds(),discarded_events:t}];return xG.createEnvelope(e?{dsn:e}:{},[r])}Sa.createClientReportEnvelope=MG});var kd=d(Zt=>{Object.defineProperty(Zt,"__esModule",{value:!0});var Ud=60*1e3;function Kd(t,e=Date.now()){let n=parseInt(`${t}`,10);if(!isNaN(n))return n*1e3;let r=Date.parse(`${t}`);return isNaN(r)?Ud:r-e}function Jd(t,e){return t[e]||t.all||0}function DG(t,e,n=Date.now()){return Jd(t,e)>n}function PG(t,{statusCode:e,headers:n},r=Date.now()){let i={...t},o=n&&n["x-sentry-rate-limits"],s=n&&n["retry-after"];if(o)for(let a of o.trim().split(",")){let[c,l]=a.split(":",2),g=parseInt(c,10),u=(isNaN(g)?60:g)*1e3;if(!l)i.all=r+u;else for(let I of l.split(";"))i[I]=r+u}else s?i.all=r+Kd(s,r):e===429&&(i.all=r+60*1e3);return i}Zt.DEFAULT_RETRY_AFTER=Ud;Zt.disabledUntil=Jd;Zt.isRateLimited=DG;Zt.parseRetryAfterHeader=Kd;Zt.updateRateLimits=PG});var xd=d(Wa=>{Object.defineProperty(Wa,"__esModule",{value:!0});function Ld(t,e,n){let r=e.match(/([a-z_]+)\.(.*)/i);if(r===null)t[e]=n;else{let i=t[r[1]];Ld(i,r[2],n)}}function jG(t,e,n={}){return Array.isArray(e)?zd(t,e,n):QG(t,e,n)}function zd(t,e,n){let r=e.find(i=>i.name===t.name);if(r){for(let[i,o]of Object.entries(n))Ld(r,i,o);return e}return[...e,t]}function QG(t,e,n){return i=>{let o=e(i);return t.allowExclusionByUser&&!o.find(a=>a.name===t.name)?o:zd(t,o,n)}}Wa.addOrUpdateIntegration=jG});var Od=d(Ra=>{Object.defineProperty(Ra,"__esModule",{value:!0});function qG(t){let e=[],n={};return{add(r,i){for(;e.length>=t;){let o=e.shift();o!==void 0&&delete n[o]}n[r]&&this.delete(r),e.push(r),n[r]=i},clear(){n={},e=[]},get(r){return n[r]},size(){return e.length},delete(r){if(!n[r])return!1;delete n[r];for(let i=0;i<e.length;i++)if(e[i]===r){e.splice(i,1);break}return!0}}}Ra.makeFifoCache=qG});var Pd=d(qt=>{Object.defineProperty(qt,"__esModule",{value:!0});var Va=se(),Md=_n(),$G=Fn(),ey=ae();function Ha(t,e){return t(e.stack||"",1)}function Dd(t,e){let n={type:e.name||e.constructor.name,value:e.message},r=Ha(t,e);return r.length&&(n.stacktrace={frames:r}),n}function ty(t){if("name"in t&&typeof t.name=="string"){let e=`'${t.name}' captured as exception`;return"message"in t&&typeof t.message=="string"&&(e+=` with message '${t.message}'`),e}else return"message"in t&&typeof t.message=="string"?t.message:`Object captured as exception with keys: ${ey.extractExceptionKeysForMessage(t)}`}function ny(t,e,n,r){let i=typeof t=="function"?t().getClient():t,o=n,a=r&&r.data&&r.data.mechanism||{handled:!0,type:"generic"},c;if(!Va.isError(n)){if(Va.isPlainObject(n)){let g=i&&i.getOptions().normalizeDepth;c={__serialized__:$G.normalizeToSize(n,g)};let u=ty(n);o=r&&r.syntheticException||new Error(u),o.message=u}else o=r&&r.syntheticException||new Error(n),o.message=n;a.synthetic=!0}let l={exception:{values:[Dd(e,o)]}};return c&&(l.extra=c),Md.addExceptionTypeValue(l,void 0,void 0),Md.addExceptionMechanism(l,a),{...l,event_id:r&&r.event_id}}function ry(t,e,n="info",r,i){let o={event_id:r&&r.event_id,level:n};if(i&&r&&r.syntheticException){let s=Ha(t,r.syntheticException);s.length&&(o.exception={values:[{value:e,stacktrace:{frames:s}}]})}if(Va.isParameterizedString(e)){let{__sentry_template_string__:s,__sentry_template_values__:a}=e;return o.logentry={message:s,params:a},o}return o.message=e,o}qt.eventFromMessage=ry;qt.eventFromUnknownInput=ny;qt.exceptionFromError=Dd;qt.parseStackFrames=Ha});var jd=d(va=>{Object.defineProperty(va,"__esModule",{value:!0});function iy(t,...e){let n=new String(String.raw(t,...e));return n.__sentry_template_string__=t.join("\0").replace(/%/g,"%%").replace(/\0/g,"%s"),n.__sentry_template_values__=e,n}va.parameterize=iy});var Qd=d(bi=>{Object.defineProperty(bi,"__esModule",{value:!0});var oy=ae(),sy=jr();function ay(t,e,n,r){let i=t(),o=!1,s=!0;return setInterval(()=>{let a=i.getTimeMs();o===!1&&a>e+n&&(o=!0,s&&r()),a<e+n&&(o=!1)},20),{poll:()=>{i.reset()},enabled:a=>{s=a}}}function cy(t,e,n){let r=e?e.replace(/^file:\/\//,""):void 0,i=t.location.columnNumber?t.location.columnNumber+1:void 0,o=t.location.lineNumber?t.location.lineNumber+1:void 0;return oy.dropUndefinedKeys({filename:r,module:n(r),function:t.functionName||"?",colno:i,lineno:o,in_app:r?sy.filenameIsInApp(r):void 0})}bi.callFrameToStackFrame=cy;bi.watchdogTimer=ay});var qd=d(Na=>{Object.defineProperty(Na,"__esModule",{value:!0});var _a=class{constructor(e){this._maxSize=e,this._cache=new Map}get size(){return this._cache.size}get(e){let n=this._cache.get(e);if(n!==void 0)return this._cache.delete(e),this._cache.set(e,n),n}set(e,n){this._cache.size>=this._maxSize&&this._cache.delete(this._cache.keys().next().value),this._cache.set(e,n)}remove(e){let n=this._cache.get(e);return n&&this._cache.delete(e),n}clear(){this._cache.clear()}keys(){return Array.from(this._cache.keys())}values(){let e=[];return this._cache.forEach(n=>e.push(n)),e}};Na.LRUMap=_a});var Ya=d(Ea=>{Object.defineProperty(Ea,"__esModule",{value:!0});function ly(t,e){return t??e()}Ea._nullishCoalesce=ly});var $d=d(Xa=>{Object.defineProperty(Xa,"__esModule",{value:!0});var gy=Ya();async function uy(t,e){return gy._nullishCoalesce(t,e)}Xa._asyncNullishCoalesce=uy});var Fa=d(Ta=>{Object.defineProperty(Ta,"__esModule",{value:!0});async function dy(t){let e,n=t[0],r=1;for(;r<t.length;){let i=t[r],o=t[r+1];if(r+=2,(i==="optionalAccess"||i==="optionalCall")&&n==null)return;i==="access"||i==="optionalAccess"?(e=n,n=await o(n)):(i==="call"||i==="optionalCall")&&(n=await o((...s)=>n.call(e,...s)),e=void 0)}return n}Ta._asyncOptionalChain=dy});var eI=d(wa=>{Object.defineProperty(wa,"__esModule",{value:!0});var Iy=Fa();async function py(t){let e=await Iy._asyncOptionalChain(t);return e??!0}wa._asyncOptionalChainDelete=py});var Ka=d(Ua=>{Object.defineProperty(Ua,"__esModule",{value:!0});function my(t){let e,n=t[0],r=1;for(;r<t.length;){let i=t[r],o=t[r+1];if(r+=2,(i==="optionalAccess"||i==="optionalCall")&&n==null)return;i==="access"||i==="optionalAccess"?(e=n,n=o(n)):(i==="call"||i==="optionalCall")&&(n=o((...s)=>n.call(e,...s)),e=void 0)}return n}Ua._optionalChain=my});var tI=d(Ja=>{Object.defineProperty(Ja,"__esModule",{value:!0});var Cy=Ka();function by(t){let e=Cy._optionalChain(t);return e??!0}Ja._optionalChainDelete=by});var nI=d(ka=>{Object.defineProperty(ka,"__esModule",{value:!0});function hy(t){return t.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}ka.escapeStringForRegex=hy});var b=d(p=>{Object.defineProperty(p,"__esModule",{value:!0});var By=Wu(),hi=ys(),La=Rs(),Zy=vs(),za=x(),Gy=od(),O=se(),yy=ad(),Bi=me(),Ay=ua(),ot=_n(),xa=ca(),Zi=Fn(),ke=ae(),Gt=md(),fy=Cd(),yt=yd(),Oa=Sd(),Jn=Qr(),kn=Rn(),st=zs(),Ma=pa(),Ln=Za(),Gi=Xd(),rI=aa(),fe=fa(),Sy=wd(),zn=kd(),$t=ya(),yi=ha(),Wy=xd(),Ry=Od(),Ai=Pd(),Vy=jd(),iI=Qd(),Hy=qd(),vy=$d(),_y=Fa(),Ny=eI(),Ey=Ya(),Yy=Ka(),Xy=tI(),Ty=Ts(),Fy=Js(),oI=oa(),wy=Os(),Uy=ia(),Ky=js(),Jy=ea(),ky=we(),Ly=jr(),zy=nI(),xy=na();p.applyAggregateErrorsToEvent=By.applyAggregateErrorsToEvent;p.getComponentName=hi.getComponentName;p.getDomElement=hi.getDomElement;p.getLocationHref=hi.getLocationHref;p.htmlTreeAsString=hi.htmlTreeAsString;p.dsnFromString=La.dsnFromString;p.dsnToString=La.dsnToString;p.makeDsn=La.makeDsn;p.SentryError=Zy.SentryError;p.GLOBAL_OBJ=za.GLOBAL_OBJ;p.getGlobalObject=za.getGlobalObject;p.getGlobalSingleton=za.getGlobalSingleton;p.addInstrumentationHandler=Gy.addInstrumentationHandler;p.isDOMError=O.isDOMError;p.isDOMException=O.isDOMException;p.isElement=O.isElement;p.isError=O.isError;p.isErrorEvent=O.isErrorEvent;p.isEvent=O.isEvent;p.isInstanceOf=O.isInstanceOf;p.isNaN=O.isNaN;p.isParameterizedString=O.isParameterizedString;p.isPlainObject=O.isPlainObject;p.isPrimitive=O.isPrimitive;p.isRegExp=O.isRegExp;p.isString=O.isString;p.isSyntheticEvent=O.isSyntheticEvent;p.isThenable=O.isThenable;p.isVueViewModel=O.isVueViewModel;p.isBrowser=yy.isBrowser;p.CONSOLE_LEVELS=Bi.CONSOLE_LEVELS;p.consoleSandbox=Bi.consoleSandbox;p.logger=Bi.logger;p.originalConsoleMethods=Bi.originalConsoleMethods;p.memoBuilder=Ay.memoBuilder;p.addContextToFrame=ot.addContextToFrame;p.addExceptionMechanism=ot.addExceptionMechanism;p.addExceptionTypeValue=ot.addExceptionTypeValue;p.arrayify=ot.arrayify;p.checkOrSetAlreadyCaught=ot.checkOrSetAlreadyCaught;p.getEventDescription=ot.getEventDescription;p.parseSemver=ot.parseSemver;p.uuid4=ot.uuid4;p.dynamicRequire=xa.dynamicRequire;p.isNodeEnv=xa.isNodeEnv;p.loadModule=xa.loadModule;p.normalize=Zi.normalize;p.normalizeToSize=Zi.normalizeToSize;p.normalizeUrlToBase=Zi.normalizeUrlToBase;p.walk=Zi.walk;p.addNonEnumerableProperty=ke.addNonEnumerableProperty;p.convertToPlainObject=ke.convertToPlainObject;p.dropUndefinedKeys=ke.dropUndefinedKeys;p.extractExceptionKeysForMessage=ke.extractExceptionKeysForMessage;p.fill=ke.fill;p.getOriginalFunction=ke.getOriginalFunction;p.markFunctionWrapped=ke.markFunctionWrapped;p.objectify=ke.objectify;p.urlEncode=ke.urlEncode;p.basename=Gt.basename;p.dirname=Gt.dirname;p.isAbsolute=Gt.isAbsolute;p.join=Gt.join;p.normalizePath=Gt.normalizePath;p.relative=Gt.relative;p.resolve=Gt.resolve;p.makePromiseBuffer=fy.makePromiseBuffer;p.DEFAULT_USER_INCLUDES=yt.DEFAULT_USER_INCLUDES;p.addRequestDataToEvent=yt.addRequestDataToEvent;p.addRequestDataToTransaction=yt.addRequestDataToTransaction;p.extractPathForTransaction=yt.extractPathForTransaction;p.extractRequestData=yt.extractRequestData;p.winterCGHeadersToDict=yt.winterCGHeadersToDict;p.winterCGRequestToRequestData=yt.winterCGRequestToRequestData;p.severityFromString=Oa.severityFromString;p.severityLevelFromString=Oa.severityLevelFromString;p.validSeverityLevels=Oa.validSeverityLevels;p.createStackParser=Jn.createStackParser;p.getFunctionName=Jn.getFunctionName;p.nodeStackLineParser=Jn.nodeStackLineParser;p.stackParserFromStackParserOptions=Jn.stackParserFromStackParserOptions;p.stripSentryFramesAndReverse=Jn.stripSentryFramesAndReverse;p.isMatchingPattern=kn.isMatchingPattern;p.safeJoin=kn.safeJoin;p.snipLine=kn.snipLine;p.stringMatchesSomePattern=kn.stringMatchesSomePattern;p.truncate=kn.truncate;p.isNativeFetch=st.isNativeFetch;p.supportsDOMError=st.supportsDOMError;p.supportsDOMException=st.supportsDOMException;p.supportsErrorEvent=st.supportsErrorEvent;p.supportsFetch=st.supportsFetch;p.supportsNativeFetch=st.supportsNativeFetch;p.supportsReferrerPolicy=st.supportsReferrerPolicy;p.supportsReportingObserver=st.supportsReportingObserver;p.SyncPromise=Ma.SyncPromise;p.rejectedSyncPromise=Ma.rejectedSyncPromise;p.resolvedSyncPromise=Ma.resolvedSyncPromise;Object.defineProperty(p,"_browserPerformanceTimeOriginMode",{enumerable:!0,get:()=>Ln._browserPerformanceTimeOriginMode});p.browserPerformanceTimeOrigin=Ln.browserPerformanceTimeOrigin;p.dateTimestampInSeconds=Ln.dateTimestampInSeconds;p.timestampInSeconds=Ln.timestampInSeconds;p.timestampWithMs=Ln.timestampWithMs;p.TRACEPARENT_REGEXP=Gi.TRACEPARENT_REGEXP;p.extractTraceparentData=Gi.extractTraceparentData;p.generateSentryTraceHeader=Gi.generateSentryTraceHeader;p.tracingContextFromHeaders=Gi.tracingContextFromHeaders;p.getSDKSource=rI.getSDKSource;p.isBrowserBundle=rI.isBrowserBundle;p.addItemToEnvelope=fe.addItemToEnvelope;p.createAttachmentEnvelopeItem=fe.createAttachmentEnvelopeItem;p.createEnvelope=fe.createEnvelope;p.createEventEnvelopeHeaders=fe.createEventEnvelopeHeaders;p.envelopeContainsItemType=fe.envelopeContainsItemType;p.envelopeItemTypeToDataCategory=fe.envelopeItemTypeToDataCategory;p.forEachEnvelopeItem=fe.forEachEnvelopeItem;p.getSdkMetadataForEnvelopeHeader=fe.getSdkMetadataForEnvelopeHeader;p.parseEnvelope=fe.parseEnvelope;p.serializeEnvelope=fe.serializeEnvelope;p.createClientReportEnvelope=Sy.createClientReportEnvelope;p.DEFAULT_RETRY_AFTER=zn.DEFAULT_RETRY_AFTER;p.disabledUntil=zn.disabledUntil;p.isRateLimited=zn.isRateLimited;p.parseRetryAfterHeader=zn.parseRetryAfterHeader;p.updateRateLimits=zn.updateRateLimits;p.BAGGAGE_HEADER_NAME=$t.BAGGAGE_HEADER_NAME;p.MAX_BAGGAGE_STRING_LENGTH=$t.MAX_BAGGAGE_STRING_LENGTH;p.SENTRY_BAGGAGE_KEY_PREFIX=$t.SENTRY_BAGGAGE_KEY_PREFIX;p.SENTRY_BAGGAGE_KEY_PREFIX_REGEX=$t.SENTRY_BAGGAGE_KEY_PREFIX_REGEX;p.baggageHeaderToDynamicSamplingContext=$t.baggageHeaderToDynamicSamplingContext;p.dynamicSamplingContextToSentryBaggageHeader=$t.dynamicSamplingContextToSentryBaggageHeader;p.getNumberOfUrlSegments=yi.getNumberOfUrlSegments;p.getSanitizedUrlString=yi.getSanitizedUrlString;p.parseUrl=yi.parseUrl;p.stripUrlQueryAndFragment=yi.stripUrlQueryAndFragment;p.addOrUpdateIntegration=Wy.addOrUpdateIntegration;p.makeFifoCache=Ry.makeFifoCache;p.eventFromMessage=Ai.eventFromMessage;p.eventFromUnknownInput=Ai.eventFromUnknownInput;p.exceptionFromError=Ai.exceptionFromError;p.parseStackFrames=Ai.parseStackFrames;p.parameterize=Vy.parameterize;p.callFrameToStackFrame=iI.callFrameToStackFrame;p.watchdogTimer=iI.watchdogTimer;p.LRUMap=Hy.LRUMap;p._asyncNullishCoalesce=vy._asyncNullishCoalesce;p._asyncOptionalChain=_y._asyncOptionalChain;p._asyncOptionalChainDelete=Ny._asyncOptionalChainDelete;p._nullishCoalesce=Ey._nullishCoalesce;p._optionalChain=Yy._optionalChain;p._optionalChainDelete=Xy._optionalChainDelete;p.addConsoleInstrumentationHandler=Ty.addConsoleInstrumentationHandler;p.addClickKeypressInstrumentationHandler=Fy.addClickKeypressInstrumentationHandler;p.SENTRY_XHR_DATA_KEY=oI.SENTRY_XHR_DATA_KEY;p.addXhrInstrumentationHandler=oI.addXhrInstrumentationHandler;p.addFetchInstrumentationHandler=wy.addFetchInstrumentationHandler;p.addHistoryInstrumentationHandler=Uy.addHistoryInstrumentationHandler;p.addGlobalErrorInstrumentationHandler=Ky.addGlobalErrorInstrumentationHandler;p.addGlobalUnhandledRejectionInstrumentationHandler=Jy.addGlobalUnhandledRejectionInstrumentationHandler;p.resetInstrumentationHandlers=ky.resetInstrumentationHandlers;p.filenameIsInApp=Ly.filenameIsInApp;p.escapeStringForRegex=zy.escapeStringForRegex;p.supportsHistory=xy.supportsHistory});var J=d(Da=>{Object.defineProperty(Da,"__esModule",{value:!0});var Oy=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__;Da.DEBUG_BUILD=Oy});var en=d(Pa=>{Object.defineProperty(Pa,"__esModule",{value:!0});var My="production";Pa.DEFAULT_ENVIRONMENT=My});var On=d(xn=>{Object.defineProperty(xn,"__esModule",{value:!0});var fi=b(),Dy=J();function sI(){return fi.getGlobalSingleton("globalEventProcessors",()=>[])}function Py(t){sI().push(t)}function ja(t,e,n,r=0){return new fi.SyncPromise((i,o)=>{let s=t[r];if(e===null||typeof s!="function")i(e);else{let a=s({...e},n);Dy.DEBUG_BUILD&&s.id&&a===null&&fi.logger.log(`Event processor "${s.id}" dropped event`),fi.isThenable(a)?a.then(c=>ja(t,c,n,r+1).then(i)).then(null,o):ja(t,a,n,r+1).then(i).then(null,o)}})}xn.addGlobalEventProcessor=Py;xn.getGlobalEventProcessors=sI;xn.notifyEventProcessors=ja});var tn=d(Dn=>{Object.defineProperty(Dn,"__esModule",{value:!0});var Mn=b();function jy(t){let e=Mn.timestampInSeconds(),n={sid:Mn.uuid4(),init:!0,timestamp:e,started:e,duration:0,status:"ok",errors:0,ignoreDuration:!1,toJSON:()=>qy(n)};return t&&Qa(n,t),n}function Qa(t,e={}){if(e.user&&(!t.ipAddress&&e.user.ip_address&&(t.ipAddress=e.user.ip_address),!t.did&&!e.did&&(t.did=e.user.id||e.user.email||e.user.username)),t.timestamp=e.timestamp||Mn.timestampInSeconds(),e.abnormal_mechanism&&(t.abnormal_mechanism=e.abnormal_mechanism),e.ignoreDuration&&(t.ignoreDuration=e.ignoreDuration),e.sid&&(t.sid=e.sid.length===32?e.sid:Mn.uuid4()),e.init!==void 0&&(t.init=e.init),!t.did&&e.did&&(t.did=`${e.did}`),typeof e.started=="number"&&(t.started=e.started),t.ignoreDuration)t.duration=void 0;else if(typeof e.duration=="number")t.duration=e.duration;else{let n=t.timestamp-t.started;t.duration=n>=0?n:0}e.release&&(t.release=e.release),e.environment&&(t.environment=e.environment),!t.ipAddress&&e.ipAddress&&(t.ipAddress=e.ipAddress),!t.userAgent&&e.userAgent&&(t.userAgent=e.userAgent),typeof e.errors=="number"&&(t.errors=e.errors),e.status&&(t.status=e.status)}function Qy(t,e){let n={};e?n={status:e}:t.status==="ok"&&(n={status:"exited"}),Qa(t,n)}function qy(t){return Mn.dropUndefinedKeys({sid:`${t.sid}`,init:t.init,started:new Date(t.started*1e3).toISOString(),timestamp:new Date(t.timestamp*1e3).toISOString(),status:t.status,errors:t.errors,did:typeof t.did=="number"||typeof t.did=="string"?`${t.did}`:void 0,duration:t.duration,abnormal_mechanism:t.abnormal_mechanism,attrs:{release:t.release,environment:t.environment,ip_address:t.ipAddress,user_agent:t.userAgent}})}Dn.closeSession=Qy;Dn.makeSession=jy;Dn.updateSession=Qa});var $=d(Le=>{Object.defineProperty(Le,"__esModule",{value:!0});var qa=b(),$y=0,cI=1;function eA(t){let{spanId:e,traceId:n}=t.spanContext(),{data:r,op:i,parent_span_id:o,status:s,tags:a,origin:c}=lI(t);return qa.dropUndefinedKeys({data:r,op:i,parent_span_id:o,span_id:e,status:s,tags:a,trace_id:n,origin:c})}function tA(t){let{traceId:e,spanId:n}=t.spanContext(),r=gI(t);return qa.generateSentryTraceHeader(e,n,r)}function nA(t){return typeof t=="number"?aI(t):Array.isArray(t)?t[0]+t[1]/1e9:t instanceof Date?aI(t.getTime()):qa.timestampInSeconds()}function aI(t){return t>9999999999?t/1e3:t}function lI(t){return rA(t)?t.getSpanJSON():typeof t.toJSON=="function"?t.toJSON():{}}function rA(t){return typeof t.getSpanJSON=="function"}function gI(t){let{traceFlags:e}=t.spanContext();return!!(e&cI)}Le.TRACE_FLAG_NONE=$y;Le.TRACE_FLAG_SAMPLED=cI;Le.spanIsSampled=gI;Le.spanTimeInputToSeconds=nA;Le.spanToJSON=lI;Le.spanToTraceContext=eA;Le.spanToTraceHeader=tA});var Si=d(nn=>{Object.defineProperty(nn,"__esModule",{value:!0});var re=b(),iA=en(),uI=On(),ec=Ri(),$a=Wi(),oA=$();function sA(t,e,n,r,i,o){let{normalizeDepth:s=3,normalizeMaxBreadth:a=1e3}=t,c={...e,event_id:e.event_id||n.event_id||re.uuid4(),timestamp:e.timestamp||re.dateTimestampInSeconds()},l=n.integrations||t.integrations.map(B=>B.name);aA(c,t),cA(c,l),e.type===void 0&&II(c,t.stackParser);let g=gA(r,n.captureContext);n.mechanism&&re.addExceptionMechanism(c,n.mechanism);let u=i&&i.getEventProcessors?i.getEventProcessors():[],I=ec.getGlobalScope().getScopeData();if(o){let B=o.getScopeData();$a.mergeScopeData(I,B)}if(g){let B=g.getScopeData();$a.mergeScopeData(I,B)}let m=[...n.attachments||[],...I.attachments];m.length&&(n.attachments=m),$a.applyScopeDataToEvent(c,I);let C=[...u,...uI.getGlobalEventProcessors(),...I.eventProcessors];return uI.notifyEventProcessors(C,c,n).then(B=>(B&&pI(B),typeof s=="number"&&s>0?lA(B,s,a):B))}function aA(t,e){let{environment:n,release:r,dist:i,maxValueLength:o=250}=e;"environment"in t||(t.environment="environment"in e?n:iA.DEFAULT_ENVIRONMENT),t.release===void 0&&r!==void 0&&(t.release=r),t.dist===void 0&&i!==void 0&&(t.dist=i),t.message&&(t.message=re.truncate(t.message,o));let s=t.exception&&t.exception.values&&t.exception.values[0];s&&s.value&&(s.value=re.truncate(s.value,o));let a=t.request;a&&a.url&&(a.url=re.truncate(a.url,o))}var dI=new WeakMap;function II(t,e){let n=re.GLOBAL_OBJ._sentryDebugIds;if(!n)return;let r,i=dI.get(e);i?r=i:(r=new Map,dI.set(e,r));let o=Object.keys(n).reduce((s,a)=>{let c,l=r.get(a);l?c=l:(c=e(a),r.set(a,c));for(let g=c.length-1;g>=0;g--){let u=c[g];if(u.filename){s[u.filename]=n[a];break}}return s},{});try{t.exception.values.forEach(s=>{s.stacktrace.frames.forEach(a=>{a.filename&&(a.debug_id=o[a.filename])})})}catch{}}function pI(t){let e={};try{t.exception.values.forEach(r=>{r.stacktrace.frames.forEach(i=>{i.debug_id&&(i.abs_path?e[i.abs_path]=i.debug_id:i.filename&&(e[i.filename]=i.debug_id),delete i.debug_id)})})}catch{}if(Object.keys(e).length===0)return;t.debug_meta=t.debug_meta||{},t.debug_meta.images=t.debug_meta.images||[];let n=t.debug_meta.images;Object.keys(e).forEach(r=>{n.push({type:"sourcemap",code_file:r,debug_id:e[r]})})}function cA(t,e){e.length>0&&(t.sdk=t.sdk||{},t.sdk.integrations=[...t.sdk.integrations||[],...e])}function lA(t,e,n){if(!t)return null;let r={...t,...t.breadcrumbs&&{breadcrumbs:t.breadcrumbs.map(i=>({...i,...i.data&&{data:re.normalize(i.data,e,n)}}))},...t.user&&{user:re.normalize(t.user,e,n)},...t.contexts&&{contexts:re.normalize(t.contexts,e,n)},...t.extra&&{extra:re.normalize(t.extra,e,n)}};return t.contexts&&t.contexts.trace&&r.contexts&&(r.contexts.trace=t.contexts.trace,t.contexts.trace.data&&(r.contexts.trace.data=re.normalize(t.contexts.trace.data,e,n))),t.spans&&(r.spans=t.spans.map(i=>{let o=oA.spanToJSON(i).data;return o&&(i.data=re.normalize(o,e,n)),i})),r}function gA(t,e){if(!e)return t;let n=t?t.clone():new ec.Scope;return n.update(e),n}function uA(t){if(t)return dA(t)?{captureContext:t}:pA(t)?{captureContext:t}:t}function dA(t){return t instanceof ec.Scope||typeof t=="function"}var IA=["user","level","extra","contexts","tags","fingerprint","requestSession","propagationContext"];function pA(t){return Object.keys(t).some(e=>IA.includes(e))}nn.applyDebugIds=II;nn.applyDebugMeta=pI;nn.parseEventHintOrCaptureContext=uA;nn.prepareEvent=sA});var Be=d(v=>{Object.defineProperty(v,"__esModule",{value:!0});var ze=b(),mA=en(),Vi=J(),w=Se(),tc=tn(),CA=Si();function bA(t,e){return w.getCurrentHub().captureException(t,CA.parseEventHintOrCaptureContext(e))}function hA(t,e){let n=typeof e=="string"?e:void 0,r=typeof e!="string"?{captureContext:e}:void 0;return w.getCurrentHub().captureMessage(t,n,r)}function BA(t,e){return w.getCurrentHub().captureEvent(t,e)}function ZA(t){w.getCurrentHub().configureScope(t)}function GA(t,e){w.getCurrentHub().addBreadcrumb(t,e)}function yA(t,e){w.getCurrentHub().setContext(t,e)}function AA(t){w.getCurrentHub().setExtras(t)}function fA(t,e){w.getCurrentHub().setExtra(t,e)}function SA(t){w.getCurrentHub().setTags(t)}function WA(t,e){w.getCurrentHub().setTag(t,e)}function RA(t){w.getCurrentHub().setUser(t)}function mI(...t){let e=w.getCurrentHub();if(t.length===2){let[n,r]=t;return n?e.withScope(()=>(e.getStackTop().scope=n,r(n))):e.withScope(r)}return e.withScope(t[0])}function VA(t){return w.runWithAsyncContext(()=>t(w.getIsolationScope()))}function HA(t,e){return mI(n=>(n.setSpan(t),e(n)))}function vA(t,e){return w.getCurrentHub().startTransaction({...t},e)}function nc(t,e){let n=Pn(),r=rn();if(!r)Vi.DEBUG_BUILD&&ze.logger.warn("Cannot capture check-in. No client defined.");else if(!r.captureCheckIn)Vi.DEBUG_BUILD&&ze.logger.warn("Cannot capture check-in. Client does not support sending check-ins.");else return r.captureCheckIn(t,e,n);return ze.uuid4()}function _A(t,e,n){let r=nc({monitorSlug:t,status:"in_progress"},n),i=ze.timestampInSeconds();function o(a){nc({monitorSlug:t,status:a,checkInId:r,duration:ze.timestampInSeconds()-i})}let s;try{s=e()}catch(a){throw o("error"),a}return ze.isThenable(s)?Promise.resolve(s).then(()=>{o("ok")},()=>{o("error")}):o("ok"),s}async function NA(t){let e=rn();return e?e.flush(t):(Vi.DEBUG_BUILD&&ze.logger.warn("Cannot flush events. No client defined."),Promise.resolve(!1))}async function EA(t){let e=rn();return e?e.close(t):(Vi.DEBUG_BUILD&&ze.logger.warn("Cannot flush events and disable SDK. No client defined."),Promise.resolve(!1))}function YA(){return w.getCurrentHub().lastEventId()}function rn(){return w.getCurrentHub().getClient()}function Pn(){return w.getCurrentHub().getScope()}function XA(t){let e=rn(),n=w.getIsolationScope(),r=Pn(),{release:i,environment:o=mA.DEFAULT_ENVIRONMENT}=e&&e.getOptions()||{},{userAgent:s}=ze.GLOBAL_OBJ.navigator||{},a=tc.makeSession({release:i,environment:o,user:r.getUser()||n.getUser(),...s&&{userAgent:s},...t}),c=n.getSession();return c&&c.status==="ok"&&tc.updateSession(c,{status:"exited"}),rc(),n.setSession(a),r.setSession(a),a}function rc(){let t=w.getIsolationScope(),e=Pn(),n=e.getSession()||t.getSession();n&&tc.closeSession(n),CI(),t.setSession(),e.setSession()}function CI(){let t=w.getIsolationScope(),e=Pn(),n=rn(),r=e.getSession()||t.getSession();r&&n&&n.captureSession&&n.captureSession(r)}function TA(t=!1){if(t){rc();return}CI()}v.addBreadcrumb=GA;v.captureCheckIn=nc;v.captureEvent=BA;v.captureException=bA;v.captureMessage=hA;v.captureSession=TA;v.close=EA;v.configureScope=ZA;v.endSession=rc;v.flush=NA;v.getClient=rn;v.getCurrentScope=Pn;v.lastEventId=YA;v.setContext=yA;v.setExtra=fA;v.setExtras=AA;v.setTag=WA;v.setTags=SA;v.setUser=RA;v.startSession=XA;v.startTransaction=vA;v.withActiveSpan=HA;v.withIsolationScope=VA;v.withMonitor=_A;v.withScope=mI});var on=d(ic=>{Object.defineProperty(ic,"__esModule",{value:!0});function FA(t){return t.transaction}ic.getRootSpan=FA});var sn=d(Hi=>{Object.defineProperty(Hi,"__esModule",{value:!0});var wA=b(),UA=en(),bI=Be(),KA=on(),oc=$();function hI(t,e,n){let r=e.getOptions(),{publicKey:i}=e.getDsn()||{},{segment:o}=n&&n.getUser()||{},s=wA.dropUndefinedKeys({environment:r.environment||UA.DEFAULT_ENVIRONMENT,release:r.release,user_segment:o,public_key:i,trace_id:t});return e.emit&&e.emit("createDsc",s),s}function JA(t){let e=bI.getClient();if(!e)return{};let n=hI(oc.spanToJSON(t).trace_id||"",e,bI.getCurrentScope()),r=KA.getRootSpan(t);if(!r)return n;let i=r&&r._frozenDynamicSamplingContext;if(i)return i;let{sampleRate:o,source:s}=r.metadata;o!=null&&(n.sample_rate=`${o}`);let a=oc.spanToJSON(r);return s&&s!=="url"&&(n.transaction=a.description),n.sampled=String(oc.spanIsSampled(r)),e.emit&&e.emit("createDsc",n),n}Hi.getDynamicSamplingContextFromClient=hI;Hi.getDynamicSamplingContextFromSpan=JA});var Wi=d(Qn=>{Object.defineProperty(Qn,"__esModule",{value:!0});var jn=b(),kA=sn(),LA=on(),BI=$();function zA(t,e){let{fingerprint:n,span:r,breadcrumbs:i,sdkProcessingMetadata:o,propagationContext:s}=e;OA(t,e),r&&PA(t,r),jA(t,n),MA(t,i),DA(t,o,s)}function xA(t,e){let{extra:n,tags:r,user:i,contexts:o,level:s,sdkProcessingMetadata:a,breadcrumbs:c,fingerprint:l,eventProcessors:g,attachments:u,propagationContext:I,transactionName:m,span:C}=e;an(t,"extra",n),an(t,"tags",r),an(t,"user",i),an(t,"contexts",o),an(t,"sdkProcessingMetadata",a),s&&(t.level=s),m&&(t.transactionName=m),C&&(t.span=C),c.length&&(t.breadcrumbs=[...t.breadcrumbs,...c]),l.length&&(t.fingerprint=[...t.fingerprint,...l]),g.length&&(t.eventProcessors=[...t.eventProcessors,...g]),u.length&&(t.attachments=[...t.attachments,...u]),t.propagationContext={...t.propagationContext,...I}}function an(t,e,n){if(n&&Object.keys(n).length){t[e]={...t[e]};for(let r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[e][r]=n[r])}}function OA(t,e){let{extra:n,tags:r,user:i,contexts:o,level:s,transactionName:a}=e,c=jn.dropUndefinedKeys(n);c&&Object.keys(c).length&&(t.extra={...c,...t.extra});let l=jn.dropUndefinedKeys(r);l&&Object.keys(l).length&&(t.tags={...l,...t.tags});let g=jn.dropUndefinedKeys(i);g&&Object.keys(g).length&&(t.user={...g,...t.user});let u=jn.dropUndefinedKeys(o);u&&Object.keys(u).length&&(t.contexts={...u,...t.contexts}),s&&(t.level=s),a&&(t.transaction=a)}function MA(t,e){let n=[...t.breadcrumbs||[],...e];t.breadcrumbs=n.length?n:void 0}function DA(t,e,n){t.sdkProcessingMetadata={...t.sdkProcessingMetadata,...e,propagationContext:n}}function PA(t,e){t.contexts={trace:BI.spanToTraceContext(e),...t.contexts};let n=LA.getRootSpan(e);if(n){t.sdkProcessingMetadata={dynamicSamplingContext:kA.getDynamicSamplingContextFromSpan(e),...t.sdkProcessingMetadata};let r=BI.spanToJSON(n).description;r&&(t.tags={transaction:r,...t.tags})}}function jA(t,e){t.fingerprint=t.fingerprint?jn.arrayify(t.fingerprint):[],e&&(t.fingerprint=t.fingerprint.concat(e)),t.fingerprint&&!t.fingerprint.length&&delete t.fingerprint}Qn.applyScopeDataToEvent=zA;Qn.mergeAndOverwriteScopeData=an;Qn.mergeScopeData=xA});var Ri=d(qn=>{Object.defineProperty(qn,"__esModule",{value:!0});var We=b(),ZI=On(),QA=tn(),qA=Wi(),$A=100,vi,_i=class t{constructor(){this._notifyingListeners=!1,this._scopeListeners=[],this._eventProcessors=[],this._breadcrumbs=[],this._attachments=[],this._user={},this._tags={},this._extra={},this._contexts={},this._sdkProcessingMetadata={},this._propagationContext=GI()}static clone(e){return e?e.clone():new t}clone(){let e=new t;return e._breadcrumbs=[...this._breadcrumbs],e._tags={...this._tags},e._extra={...this._extra},e._contexts={...this._contexts},e._user=this._user,e._level=this._level,e._span=this._span,e._session=this._session,e._transactionName=this._transactionName,e._fingerprint=this._fingerprint,e._eventProcessors=[...this._eventProcessors],e._requestSession=this._requestSession,e._attachments=[...this._attachments],e._sdkProcessingMetadata={...this._sdkProcessingMetadata},e._propagationContext={...this._propagationContext},e._client=this._client,e}setClient(e){this._client=e}getClient(){return this._client}addScopeListener(e){this._scopeListeners.push(e)}addEventProcessor(e){return this._eventProcessors.push(e),this}setUser(e){return this._user=e||{email:void 0,id:void 0,ip_address:void 0,segment:void 0,username:void 0},this._session&&QA.updateSession(this._session,{user:e}),this._notifyScopeListeners(),this}getUser(){return this._user}getRequestSession(){return this._requestSession}setRequestSession(e){return this._requestSession=e,this}setTags(e){return this._tags={...this._tags,...e},this._notifyScopeListeners(),this}setTag(e,n){return this._tags={...this._tags,[e]:n},this._notifyScopeListeners(),this}setExtras(e){return this._extra={...this._extra,...e},this._notifyScopeListeners(),this}setExtra(e,n){return this._extra={...this._extra,[e]:n},this._notifyScopeListeners(),this}setFingerprint(e){return this._fingerprint=e,this._notifyScopeListeners(),this}setLevel(e){return this._level=e,this._notifyScopeListeners(),this}setTransactionName(e){return this._transactionName=e,this._notifyScopeListeners(),this}setContext(e,n){return n===null?delete this._contexts[e]:this._contexts[e]=n,this._notifyScopeListeners(),this}setSpan(e){return this._span=e,this._notifyScopeListeners(),this}getSpan(){return this._span}getTransaction(){let e=this._span;return e&&e.transaction}setSession(e){return e?this._session=e:delete this._session,this._notifyScopeListeners(),this}getSession(){return this._session}update(e){if(!e)return this;if(typeof e=="function"){let n=e(this);return n instanceof t?n:this}return e instanceof t?(this._tags={...this._tags,...e._tags},this._extra={...this._extra,...e._extra},this._contexts={...this._contexts,...e._contexts},e._user&&Object.keys(e._user).length&&(this._user=e._user),e._level&&(this._level=e._level),e._fingerprint&&(this._fingerprint=e._fingerprint),e._requestSession&&(this._requestSession=e._requestSession),e._propagationContext&&(this._propagationContext=e._propagationContext)):We.isPlainObject(e)&&(e=e,this._tags={...this._tags,...e.tags},this._extra={...this._extra,...e.extra},this._contexts={...this._contexts,...e.contexts},e.user&&(this._user=e.user),e.level&&(this._level=e.level),e.fingerprint&&(this._fingerprint=e.fingerprint),e.requestSession&&(this._requestSession=e.requestSession),e.propagationContext&&(this._propagationContext=e.propagationContext)),this}clear(){return this._breadcrumbs=[],this._tags={},this._extra={},this._user={},this._contexts={},this._level=void 0,this._transactionName=void 0,this._fingerprint=void 0,this._requestSession=void 0,this._span=void 0,this._session=void 0,this._notifyScopeListeners(),this._attachments=[],this._propagationContext=GI(),this}addBreadcrumb(e,n){let r=typeof n=="number"?n:$A;if(r<=0)return this;let i={timestamp:We.dateTimestampInSeconds(),...e},o=this._breadcrumbs;return o.push(i),this._breadcrumbs=o.length>r?o.slice(-r):o,this._notifyScopeListeners(),this}getLastBreadcrumb(){return this._breadcrumbs[this._breadcrumbs.length-1]}clearBreadcrumbs(){return this._breadcrumbs=[],this._notifyScopeListeners(),this}addAttachment(e){return this._attachments.push(e),this}getAttachments(){return this.getScopeData().attachments}clearAttachments(){return this._attachments=[],this}getScopeData(){let{_breadcrumbs:e,_attachments:n,_contexts:r,_tags:i,_extra:o,_user:s,_level:a,_fingerprint:c,_eventProcessors:l,_propagationContext:g,_sdkProcessingMetadata:u,_transactionName:I,_span:m}=this;return{breadcrumbs:e,attachments:n,contexts:r,tags:i,extra:o,user:s,level:a,fingerprint:c||[],eventProcessors:l,propagationContext:g,sdkProcessingMetadata:u,transactionName:I,span:m}}applyToEvent(e,n={},r=[]){qA.applyScopeDataToEvent(e,this.getScopeData());let i=[...r,...ZI.getGlobalEventProcessors(),...this._eventProcessors];return ZI.notifyEventProcessors(i,e,n)}setSDKProcessingMetadata(e){return this._sdkProcessingMetadata={...this._sdkProcessingMetadata,...e},this}setPropagationContext(e){return this._propagationContext=e,this}getPropagationContext(){return this._propagationContext}captureException(e,n){let r=n&&n.event_id?n.event_id:We.uuid4();if(!this._client)return We.logger.warn("No client configured on scope - will not capture exception!"),r;let i=new Error("Sentry syntheticException");return this._client.captureException(e,{originalException:e,syntheticException:i,...n,event_id:r},this),r}captureMessage(e,n,r){let i=r&&r.event_id?r.event_id:We.uuid4();if(!this._client)return We.logger.warn("No client configured on scope - will not capture message!"),i;let o=new Error(e);return this._client.captureMessage(e,n,{originalException:e,syntheticException:o,...r,event_id:i},this),i}captureEvent(e,n){let r=n&&n.event_id?n.event_id:We.uuid4();return this._client?(this._client.captureEvent(e,{...n,event_id:r},this),r):(We.logger.warn("No client configured on scope - will not capture event!"),r)}_notifyScopeListeners(){this._notifyingListeners||(this._notifyingListeners=!0,this._scopeListeners.forEach(e=>{e(this)}),this._notifyingListeners=!1)}};function ef(){return vi||(vi=new _i),vi}function tf(t){vi=t}function GI(){return{traceId:We.uuid4(),spanId:We.uuid4().substring(16)}}qn.Scope=_i;qn.getGlobalScope=ef;qn.setGlobalScope=tf});var ac=d(sc=>{Object.defineProperty(sc,"__esModule",{value:!0});var nf="7.94.1";sc.SDK_VERSION=nf});var Se=d(ie=>{Object.defineProperty(ie,"__esModule",{value:!0});var Q=b(),rf=en(),cc=J(),yI=Ri(),lc=tn(),of=ac(),Ni=parseFloat(of.SDK_VERSION),sf=100,cn=class{constructor(e,n,r,i=Ni){this._version=i;let o;n?o=n:(o=new yI.Scope,o.setClient(e));let s;r?s=r:(s=new yI.Scope,s.setClient(e)),this._stack=[{scope:o}],e&&this.bindClient(e),this._isolationScope=s}isOlderThan(e){return this._version<e}bindClient(e){let n=this.getStackTop();n.client=e,n.scope.setClient(e),e&&e.setupIntegrations&&e.setupIntegrations()}pushScope(){let e=this.getScope().clone();return this.getStack().push({client:this.getClient(),scope:e}),e}popScope(){return this.getStack().length<=1?!1:!!this.getStack().pop()}withScope(e){let n=this.pushScope(),r;try{r=e(n)}catch(i){throw this.popScope(),i}return Q.isThenable(r)?r.then(i=>(this.popScope(),i),i=>{throw this.popScope(),i}):(this.popScope(),r)}getClient(){return this.getStackTop().client}getScope(){return this.getStackTop().scope}getIsolationScope(){return this._isolationScope}getStack(){return this._stack}getStackTop(){return this._stack[this._stack.length-1]}captureException(e,n){let r=this._lastEventId=n&&n.event_id?n.event_id:Q.uuid4(),i=new Error("Sentry syntheticException");return this.getScope().captureException(e,{originalException:e,syntheticException:i,...n,event_id:r}),r}captureMessage(e,n,r){let i=this._lastEventId=r&&r.event_id?r.event_id:Q.uuid4(),o=new Error(e);return this.getScope().captureMessage(e,n,{originalException:e,syntheticException:o,...r,event_id:i}),i}captureEvent(e,n){let r=n&&n.event_id?n.event_id:Q.uuid4();return e.type||(this._lastEventId=r),this.getScope().captureEvent(e,{...n,event_id:r}),r}lastEventId(){return this._lastEventId}addBreadcrumb(e,n){let{scope:r,client:i}=this.getStackTop();if(!i)return;let{beforeBreadcrumb:o=null,maxBreadcrumbs:s=sf}=i.getOptions&&i.getOptions()||{};if(s<=0)return;let c={timestamp:Q.dateTimestampInSeconds(),...e},l=o?Q.consoleSandbox(()=>o(c,n)):c;l!==null&&(i.emit&&i.emit("beforeAddBreadcrumb",l,n),r.addBreadcrumb(l,s))}setUser(e){this.getScope().setUser(e),this.getIsolationScope().setUser(e)}setTags(e){this.getScope().setTags(e),this.getIsolationScope().setTags(e)}setExtras(e){this.getScope().setExtras(e),this.getIsolationScope().setExtras(e)}setTag(e,n){this.getScope().setTag(e,n),this.getIsolationScope().setTag(e,n)}setExtra(e,n){this.getScope().setExtra(e,n),this.getIsolationScope().setExtra(e,n)}setContext(e,n){this.getScope().setContext(e,n),this.getIsolationScope().setContext(e,n)}configureScope(e){let{scope:n,client:r}=this.getStackTop();r&&e(n)}run(e){let n=gc(this);try{e(this)}finally{gc(n)}}getIntegration(e){let n=this.getClient();if(!n)return null;try{return n.getIntegration(e)}catch{return cc.DEBUG_BUILD&&Q.logger.warn(`Cannot retrieve integration ${e.id} from the current Hub`),null}}startTransaction(e,n){let r=this._callExtensionMethod("startTransaction",e,n);return cc.DEBUG_BUILD&&!r&&(this.getClient()?Q.logger.warn(`Tracing extension 'startTransaction' has not been added. Call 'addTracingExtensions' before calling 'init':
Sentry.addTracingExtensions();
Sentry.init({...});
`):Q.logger.warn("Tracing extension 'startTransaction' is missing. You should 'init' the SDK before calling 'startTransaction'")),r}traceHeaders(){return this._callExtensionMethod("traceHeaders")}captureSession(e=!1){if(e)return this.endSession();this._sendSessionUpdate()}endSession(){let n=this.getStackTop().scope,r=n.getSession();r&&lc.closeSession(r),this._sendSessionUpdate(),n.setSession()}startSession(e){let{scope:n,client:r}=this.getStackTop(),{release:i,environment:o=rf.DEFAULT_ENVIRONMENT}=r&&r.getOptions()||{},{userAgent:s}=Q.GLOBAL_OBJ.navigator||{},a=lc.makeSession({release:i,environment:o,user:n.getUser(),...s&&{userAgent:s},...e}),c=n.getSession&&n.getSession();return c&&c.status==="ok"&&lc.updateSession(c,{status:"exited"}),this.endSession(),n.setSession(a),a}shouldSendDefaultPii(){let e=this.getClient(),n=e&&e.getOptions();return!!(n&&n.sendDefaultPii)}_sendSessionUpdate(){let{scope:e,client:n}=this.getStackTop(),r=e.getSession();r&&n&&n.captureSession&&n.captureSession(r)}_callExtensionMethod(e,...n){let i=At().__SENTRY__;if(i&&i.extensions&&typeof i.extensions[e]=="function")return i.extensions[e].apply(this,n);cc.DEBUG_BUILD&&Q.logger.warn(`Extension method ${e} couldn't be found, doing nothing.`)}};function At(){return Q.GLOBAL_OBJ.__SENTRY__=Q.GLOBAL_OBJ.__SENTRY__||{extensions:{},hub:void 0},Q.GLOBAL_OBJ}function gc(t){let e=At(),n=$n(e);return Ei(e,t),n}function AI(){let t=At();if(t.__SENTRY__&&t.__SENTRY__.acs){let e=t.__SENTRY__.acs.getCurrentHub();if(e)return e}return fI(t)}function af(){return AI().getIsolationScope()}function fI(t=At()){return(!SI(t)||$n(t).isOlderThan(Ni))&&Ei(t,new cn),$n(t)}function cf(t,e=fI()){if(!SI(t)||$n(t).isOlderThan(Ni)){let n=e.getClient(),r=e.getScope(),i=e.getIsolationScope();Ei(t,new cn(n,r.clone(),i.clone()))}}function lf(t){let e=At();e.__SENTRY__=e.__SENTRY__||{},e.__SENTRY__.acs=t}function gf(t,e={}){let n=At();return n.__SENTRY__&&n.__SENTRY__.acs?n.__SENTRY__.acs.runWithAsyncContext(t,e):t()}function SI(t){return!!(t&&t.__SENTRY__&&t.__SENTRY__.hub)}function $n(t){return Q.getGlobalSingleton("hub",()=>new cn,t)}function Ei(t,e){if(!t)return!1;let n=t.__SENTRY__=t.__SENTRY__||{};return n.hub=e,!0}ie.API_VERSION=Ni;ie.Hub=cn;ie.ensureHubOnCarrier=cf;ie.getCurrentHub=AI;ie.getHubFromCarrier=$n;ie.getIsolationScope=af;ie.getMainCarrier=At;ie.makeMain=gc;ie.runWithAsyncContext=gf;ie.setAsyncContextStrategy=lf;ie.setHubOnCarrier=Ei});var Yi=d(er=>{Object.defineProperty(er,"__esModule",{value:!0});var WI=b(),uf=Se();function df(t){return(t||uf.getCurrentHub()).getScope().getTransaction()}var If=WI.extractTraceparentData;er.stripUrlQueryAndFragment=WI.stripUrlQueryAndFragment;er.extractTraceparentData=If;er.getActiveTransaction=df});var VI=d(Ic=>{Object.defineProperty(Ic,"__esModule",{value:!0});var uc=b(),pf=J(),mf=Yi(),RI=!1;function Cf(){RI||(RI=!0,uc.addGlobalErrorInstrumentationHandler(dc),uc.addGlobalUnhandledRejectionInstrumentationHandler(dc))}function dc(){let t=mf.getActiveTransaction();if(t){let e="internal_error";pf.DEBUG_BUILD&&uc.logger.log(`[Tracing] Transaction: ${e} -> Global error occured`),t.setStatus(e)}}dc.tag="sentry_tracingErrorCallback";Ic.registerErrorInstrumentation=Cf});var nr=d(tr=>{Object.defineProperty(tr,"__esModule",{value:!0});var bf="sentry.source",hf="sentry.sample_rate",Bf="sentry.op";tr.SEMANTIC_ATTRIBUTE_SENTRY_OP=Bf;tr.SEMANTIC_ATTRIBUTE_SENTRY_SAMPLE_RATE=hf;tr.SEMANTIC_ATTRIBUTE_SENTRY_SOURCE=bf});var Ti=d(rr=>{Object.defineProperty(rr,"__esModule",{value:!0});var ft=b(),HI=J(),Xi=nr(),vI=on(),ln=$(),pc=class{constructor(e=1e3){this._maxlen=e,this.spans=[]}add(e){this.spans.length>this._maxlen?e.spanRecorder=void 0:this.spans.push(e)}},mc=class t{constructor(e={}){this._traceId=e.traceId||ft.uuid4(),this._spanId=e.spanId||ft.uuid4().substring(16),this._startTime=e.startTimestamp||ft.timestampInSeconds(),this.tags=e.tags?{...e.tags}:{},this.data=e.data?{...e.data}:{},this._attributes=e.attributes?{...e.attributes}:{},this.instrumenter=e.instrumenter||"sentry",this.origin=e.origin||"manual",this._name=e.name||e.description,e.parentSpanId&&(this.parentSpanId=e.parentSpanId),"sampled"in e&&(this._sampled=e.sampled),e.op&&this.setAttribute(Xi.SEMANTIC_ATTRIBUTE_SENTRY_OP,e.op),e.status&&(this._status=e.status),e.endTimestamp&&(this._endTime=e.endTimestamp)}get name(){return this._name||""}set name(e){this.updateName(e)}get description(){return this._name}set description(e){this._name=e}get traceId(){return this._traceId}set traceId(e){this._traceId=e}get spanId(){return this._spanId}set spanId(e){this._spanId=e}get sampled(){return this._sampled}set sampled(e){this._sampled=e}get attributes(){return this._attributes}set attributes(e){this._attributes=e}get startTimestamp(){return this._startTime}set startTimestamp(e){this._startTime=e}get endTimestamp(){return this._endTime}set endTimestamp(e){this._endTime=e}get status(){return this._status}set status(e){this._status=e}get op(){return this._attributes[Xi.SEMANTIC_ATTRIBUTE_SENTRY_OP]}set op(e){this.setAttribute(Xi.SEMANTIC_ATTRIBUTE_SENTRY_OP,e)}spanContext(){let{_spanId:e,_traceId:n,_sampled:r}=this;return{spanId:e,traceId:n,traceFlags:r?ln.TRACE_FLAG_SAMPLED:ln.TRACE_FLAG_NONE}}startChild(e){let n=new t({...e,parentSpanId:this._spanId,sampled:this._sampled,traceId:this._traceId});n.spanRecorder=this.spanRecorder,n.spanRecorder&&n.spanRecorder.add(n);let r=vI.getRootSpan(this);if(n.transaction=r,HI.DEBUG_BUILD&&r){let i=e&&e.op||"< unknown op >",o=ln.spanToJSON(n).description||"< unknown name >",s=r.spanContext().spanId,a=`[Tracing] Starting '${i}' span on transaction '${o}' (${s}).`;ft.logger.log(a),this._logMessage=a}return n}setTag(e,n){return this.tags={...this.tags,[e]:n},this}setData(e,n){return this.data={...this.data,[e]:n},this}setAttribute(e,n){n===void 0?delete this._attributes[e]:this._attributes[e]=n}setAttributes(e){Object.keys(e).forEach(n=>this.setAttribute(n,e[n]))}setStatus(e){return this._status=e,this}setHttpStatus(e){this.setTag("http.status_code",String(e)),this.setData("http.response.status_code",e);let n=_I(e);return n!=="unknown_error"&&this.setStatus(n),this}setName(e){this.updateName(e)}updateName(e){return this._name=e,this}isSuccess(){return this._status==="ok"}finish(e){return this.end(e)}end(e){if(this._endTime)return;let n=vI.getRootSpan(this);if(HI.DEBUG_BUILD&&n&&n.spanContext().spanId!==this._spanId){let r=this._logMessage;r&&ft.logger.log(r.replace("Starting","Finishing"))}this._endTime=ln.spanTimeInputToSeconds(e)}toTraceparent(){return ln.spanToTraceHeader(this)}toContext(){return ft.dropUndefinedKeys({data:this._getData(),description:this._name,endTimestamp:this._endTime,op:this.op,parentSpanId:this.parentSpanId,sampled:this._sampled,spanId:this._spanId,startTimestamp:this._startTime,status:this._status,tags:this.tags,traceId:this._traceId})}updateWithContext(e){return this.data=e.data||{},this._name=e.name||e.description,this._endTime=e.endTimestamp,this.op=e.op,this.parentSpanId=e.parentSpanId,this._sampled=e.sampled,this._spanId=e.spanId||this._spanId,this._startTime=e.startTimestamp||this._startTime,this._status=e.status,this.tags=e.tags||{},this._traceId=e.traceId||this._traceId,this}getTraceContext(){return ln.spanToTraceContext(this)}getSpanJSON(){return ft.dropUndefinedKeys({data:this._getData(),description:this._name,op:this._attributes[Xi.SEMANTIC_ATTRIBUTE_SENTRY_OP],parent_span_id:this.parentSpanId,span_id:this._spanId,start_timestamp:this._startTime,status:this._status,tags:Object.keys(this.tags).length>0?this.tags:void 0,timestamp:this._endTime,trace_id:this._traceId,origin:this.origin})}isRecording(){return!this._endTime&&!!this._sampled}toJSON(){return this.getSpanJSON()}_getData(){let{data:e,_attributes:n}=this,r=Object.keys(e).length>0,i=Object.keys(n).length>0;if(!(!r&&!i))return r&&i?{...e,...n}:r?e:n}};function _I(t){if(t<400&&t>=100)return"ok";if(t>=400&&t<500)switch(t){case 401:return"unauthenticated";case 403:return"permission_denied";case 404:return"not_found";case 409:return"already_exists";case 413:return"failed_precondition";case 429:return"resource_exhausted";default:return"invalid_argument"}if(t>=500&&t<600)switch(t){case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline_exceeded";default:return"internal_error"}return"unknown_error"}rr.Span=mc;rr.SpanRecorder=pc;rr.spanStatusfromHttpCode=_I});var Ui=d(bc=>{Object.defineProperty(bc,"__esModule",{value:!0});var ir=b(),Fi=J(),Zf=Se(),or=nr(),wi=$(),NI=sn(),EI=Ti(),Cc=class extends EI.Span{constructor(e,n){super(e),this._measurements={},this._contexts={},this._hub=n||Zf.getCurrentHub(),this._name=e.name||"",this._metadata={...e.metadata},this._trimEnd=e.trimEnd,this.transaction=this;let r=this._metadata.dynamicSamplingContext;r&&(this._frozenDynamicSamplingContext={...r})}get name(){return this._name}set name(e){this.setName(e)}get metadata(){return{source:"custom",spanMetadata:{},...this._metadata,...this._attributes[or.SEMANTIC_ATTRIBUTE_SENTRY_SOURCE]&&{source:this._attributes[or.SEMANTIC_ATTRIBUTE_SENTRY_SOURCE]},...this._attributes[or.SEMANTIC_ATTRIBUTE_SENTRY_SAMPLE_RATE]&&{sampleRate:this._attributes[or.SEMANTIC_ATTRIBUTE_SENTRY_SAMPLE_RATE]}}}set metadata(e){this._metadata=e}setName(e,n="custom"){this._name=e,this.setAttribute(or.SEMANTIC_ATTRIBUTE_SENTRY_SOURCE,n)}updateName(e){return this._name=e,this}initSpanRecorder(e=1e3){this.spanRecorder||(this.spanRecorder=new EI.SpanRecorder(e)),this.spanRecorder.add(this)}setContext(e,n){n===null?delete this._contexts[e]:this._contexts[e]=n}setMeasurement(e,n,r=""){this._measurements[e]={value:n,unit:r}}setMetadata(e){this._metadata={...this._metadata,...e}}end(e){let n=wi.spanTimeInputToSeconds(e),r=this._finishTransaction(n);if(r)return this._hub.captureEvent(r)}toContext(){let e=super.toContext();return ir.dropUndefinedKeys({...e,name:this._name,trimEnd:this._trimEnd})}updateWithContext(e){return super.updateWithContext(e),this._name=e.name||"",this._trimEnd=e.trimEnd,this}getDynamicSamplingContext(){return NI.getDynamicSamplingContextFromSpan(this)}setHub(e){this._hub=e}_finishTransaction(e){if(this._endTime!==void 0)return;this._name||(Fi.DEBUG_BUILD&&ir.logger.warn("Transaction has no name, falling back to `<unlabeled transaction>`."),this._name="<unlabeled transaction>"),super.end(e);let n=this._hub.getClient();if(n&&n.emit&&n.emit("finishTransaction",this),this._sampled!==!0){Fi.DEBUG_BUILD&&ir.logger.log("[Tracing] Discarding transaction because its trace was not chosen to be sampled."),n&&n.recordDroppedEvent("sample_rate","transaction");return}let r=this.spanRecorder?this.spanRecorder.spans.filter(c=>c!==this&&wi.spanToJSON(c).timestamp):[];if(this._trimEnd&&r.length>0){let c=r.map(l=>wi.spanToJSON(l).timestamp).filter(Boolean);this._endTime=c.reduce((l,g)=>l>g?l:g)}let{metadata:i}=this,{source:o}=i,s={contexts:{...this._contexts,trace:wi.spanToTraceContext(this)},spans:r,start_timestamp:this._startTime,tags:this.tags,timestamp:this._endTime,transaction:this._name,type:"transaction",sdkProcessingMetadata:{...i,dynamicSamplingContext:NI.getDynamicSamplingContextFromSpan(this)},...o&&{transaction_info:{source:o}}};return Object.keys(this._measurements).length>0&&(Fi.DEBUG_BUILD&&ir.logger.log("[Measurements] Adding measurements to transaction",JSON.stringify(this._measurements,void 0,2)),s.measurements=this._measurements),Fi.DEBUG_BUILD&&ir.logger.log(`[Tracing] Finishing ${this.op} transaction: ${this._name}.`),s}};bc.Transaction=Cc});var Bc=d(sr=>{Object.defineProperty(sr,"__esModule",{value:!0});var M=b(),ee=J(),Ki=$(),Gf=Ti(),yf=Ui(),Ji={idleTimeout:1e3,finalTimeout:3e4,heartbeatInterval:5e3},Af="finishReason",gn=["heartbeatFailed","idleTimeout","documentHidden","finalTimeout","externalFinish","cancelled"],ki=class extends Gf.SpanRecorder{constructor(e,n,r,i){super(i),this._pushActivity=e,this._popActivity=n,this.transactionSpanId=r}add(e){if(e.spanContext().spanId!==this.transactionSpanId){let n=e.end;e.end=(...r)=>(this._popActivity(e.spanContext().spanId),n.apply(e,r)),Ki.spanToJSON(e).timestamp===void 0&&this._pushActivity(e.spanContext().spanId)}super.add(e)}},hc=class extends yf.Transaction{constructor(e,n,r=Ji.idleTimeout,i=Ji.finalTimeout,o=Ji.heartbeatInterval,s=!1,a=!1){super(e,n),this._idleHub=n,this._idleTimeout=r,this._finalTimeout=i,this._heartbeatInterval=o,this._onScope=s,this.activities={},this._heartbeatCounter=0,this._finished=!1,this._idleTimeoutCanceledPermanently=!1,this._beforeFinishCallbacks=[],this._finishReason=gn[4],this._autoFinishAllowed=!a,s&&(ee.DEBUG_BUILD&&M.logger.log(`Setting idle transaction on scope. Span ID: ${this.spanContext().spanId}`),n.getScope().setSpan(this)),a||this._restartIdleTimeout(),setTimeout(()=>{this._finished||(this.setStatus("deadline_exceeded"),this._finishReason=gn[3],this.end())},this._finalTimeout)}end(e){let n=Ki.spanTimeInputToSeconds(e);if(this._finished=!0,this.activities={},this.op==="ui.action.click"&&this.setAttribute(Af,this._finishReason),this.spanRecorder){ee.DEBUG_BUILD&&M.logger.log("[Tracing] finishing IdleTransaction",new Date(n*1e3).toISOString(),this.op);for(let r of this._beforeFinishCallbacks)r(this,n);this.spanRecorder.spans=this.spanRecorder.spans.filter(r=>{if(r.spanContext().spanId===this.spanContext().spanId)return!0;Ki.spanToJSON(r).timestamp||(r.setStatus("cancelled"),r.end(n),ee.DEBUG_BUILD&&M.logger.log("[Tracing] cancelling span since transaction ended early",JSON.stringify(r,void 0,2)));let{start_timestamp:i,timestamp:o}=Ki.spanToJSON(r),s=i&&i<n,a=(this._finalTimeout+this._idleTimeout)/1e3,c=o&&i&&o-i<a;if(ee.DEBUG_BUILD){let l=JSON.stringify(r,void 0,2);s?c||M.logger.log("[Tracing] discarding Span since it finished after Transaction final timeout",l):M.logger.log("[Tracing] discarding Span since it happened after Transaction was finished",l)}return s&&c}),ee.DEBUG_BUILD&&M.logger.log("[Tracing] flushing IdleTransaction")}else ee.DEBUG_BUILD&&M.logger.log("[Tracing] No active IdleTransaction");if(this._onScope){let r=this._idleHub.getScope();r.getTransaction()===this&&r.setSpan(void 0)}return super.end(e)}registerBeforeFinishCallback(e){this._beforeFinishCallbacks.push(e)}initSpanRecorder(e){if(!this.spanRecorder){let n=i=>{this._finished||this._pushActivity(i)},r=i=>{this._finished||this._popActivity(i)};this.spanRecorder=new ki(n,r,this.spanContext().spanId,e),ee.DEBUG_BUILD&&M.logger.log("Starting heartbeat"),this._pingHeartbeat()}this.spanRecorder.add(this)}cancelIdleTimeout(e,{restartOnChildSpanChange:n}={restartOnChildSpanChange:!0}){this._idleTimeoutCanceledPermanently=n===!1,this._idleTimeoutID&&(clearTimeout(this._idleTimeoutID),this._idleTimeoutID=void 0,Object.keys(this.activities).length===0&&this._idleTimeoutCanceledPermanently&&(this._finishReason=gn[5],this.end(e)))}setFinishReason(e){this._finishReason=e}sendAutoFinishSignal(){this._autoFinishAllowed||(ee.DEBUG_BUILD&&M.logger.log("[Tracing] Received finish signal for idle transaction."),this._restartIdleTimeout(),this._autoFinishAllowed=!0)}_restartIdleTimeout(e){this.cancelIdleTimeout(),this._idleTimeoutID=setTimeout(()=>{!this._finished&&Object.keys(this.activities).length===0&&(this._finishReason=gn[1],this.end(e))},this._idleTimeout)}_pushActivity(e){this.cancelIdleTimeout(void 0,{restartOnChildSpanChange:!this._idleTimeoutCanceledPermanently}),ee.DEBUG_BUILD&&M.logger.log(`[Tracing] pushActivity: ${e}`),this.activities[e]=!0,ee.DEBUG_BUILD&&M.logger.log("[Tracing] new activities count",Object.keys(this.activities).length)}_popActivity(e){if(this.activities[e]&&(ee.DEBUG_BUILD&&M.logger.log(`[Tracing] popActivity ${e}`),delete this.activities[e],ee.DEBUG_BUILD&&M.logger.log("[Tracing] new activities count",Object.keys(this.activities).length)),Object.keys(this.activities).length===0){let n=M.timestampInSeconds();this._idleTimeoutCanceledPermanently?this._autoFinishAllowed&&(this._finishReason=gn[5],this.end(n)):this._restartIdleTimeout(n+this._idleTimeout/1e3)}}_beat(){if(this._finished)return;let e=Object.keys(this.activities).join("");e===this._prevHeartbeatString?this._heartbeatCounter++:this._heartbeatCounter=1,this._prevHeartbeatString=e,this._heartbeatCounter>=3?this._autoFinishAllowed&&(ee.DEBUG_BUILD&&M.logger.log("[Tracing] Transaction finished because of no change for 3 heart beats"),this.setStatus("deadline_exceeded"),this._finishReason=gn[0],this.end()):this._pingHeartbeat()}_pingHeartbeat(){ee.DEBUG_BUILD&&M.logger.log(`pinging Heartbeat -> current counter: ${this._heartbeatCounter}`),setTimeout(()=>{this._beat()},this._heartbeatInterval)}};sr.IdleTransaction=hc;sr.IdleTransactionSpanRecorder=ki;sr.TRACING_DEFAULTS=Ji});var Li=d(Zc=>{Object.defineProperty(Zc,"__esModule",{value:!0});var ff=Be();function Sf(t){if(typeof __SENTRY_TRACING__=="boolean"&&!__SENTRY_TRACING__)return!1;let e=ff.getClient(),n=t||e&&e.getOptions();return!!n&&(n.enableTracing||"tracesSampleRate"in n||"tracesSampler"in n)}Zc.hasTracingEnabled=Sf});var YI=d(Gc=>{Object.defineProperty(Gc,"__esModule",{value:!0});var St=b(),un=J(),zi=nr(),Wf=Li(),Rf=$();function Vf(t,e,n){if(!Wf.hasTracingEnabled(e))return t.sampled=!1,t;if(t.sampled!==void 0)return t.setAttribute(zi.SEMANTIC_ATTRIBUTE_SENTRY_SAMPLE_RATE,Number(t.sampled)),t;let r;return typeof e.tracesSampler=="function"?(r=e.tracesSampler(n),t.setAttribute(zi.SEMANTIC_ATTRIBUTE_SENTRY_SAMPLE_RATE,Number(r))):n.parentSampled!==void 0?r=n.parentSampled:typeof e.tracesSampleRate<"u"?(r=e.tracesSampleRate,t.setAttribute(zi.SEMANTIC_ATTRIBUTE_SENTRY_SAMPLE_RATE,Number(r))):(r=1,t.setAttribute(zi.SEMANTIC_ATTRIBUTE_SENTRY_SAMPLE_RATE,r)),Hf(r)?r?(t.sampled=Math.random()<r,t.sampled?(un.DEBUG_BUILD&&St.logger.log(`[Tracing] starting ${t.op} transaction - ${Rf.spanToJSON(t).description}`),t):(un.DEBUG_BUILD&&St.logger.log(`[Tracing] Discarding transaction because it's not included in the random sample (sampling rate = ${Number(r)})`),t)):(un.DEBUG_BUILD&&St.logger.log(`[Tracing] Discarding transaction because ${typeof e.tracesSampler=="function"?"tracesSampler returned 0 or false":"a negative sampling decision was inherited or tracesSampleRate is set to 0"}`),t.sampled=!1,t):(un.DEBUG_BUILD&&St.logger.warn("[Tracing] Discarding transaction because of invalid sample rate."),t.sampled=!1,t)}function Hf(t){return St.isNaN(t)||!(typeof t=="number"||typeof t=="boolean")?(un.DEBUG_BUILD&&St.logger.warn(`[Tracing] Given sample rate is invalid. Sample rate must be a boolean or a number between 0 and 1. Got ${JSON.stringify(t)} of type ${JSON.stringify(typeof t)}.`),!1):t<0||t>1?(un.DEBUG_BUILD&&St.logger.warn(`[Tracing] Given sample rate is invalid. Sample rate must be between 0 and 1. Got ${t}.`),!1):!0}Gc.sampleTransaction=Vf});var yc=d(xi=>{Object.defineProperty(xi,"__esModule",{value:!0});var vf=b(),_f=J(),Nf=Se(),Ef=$(),Yf=VI(),Xf=Bc(),XI=YI(),Tf=Ui();function Ff(){let e=this.getScope().getSpan();return e?{"sentry-trace":Ef.spanToTraceHeader(e)}:{}}function wf(t,e){let n=this.getClient(),r=n&&n.getOptions()||{},i=r.instrumenter||"sentry",o=t.instrumenter||"sentry";i!==o&&(_f.DEBUG_BUILD&&vf.logger.error(`A transaction was started with instrumenter=\`${o}\`, but the SDK is configured with the \`${i}\` instrumenter.
The transaction will not be sampled. Please use the ${i} instrumentation to start transactions.`),t.sampled=!1);let s=new Tf.Transaction(t,this);return s=XI.sampleTransaction(s,r,{parentSampled:t.parentSampled,transactionContext:t,...e}),s.isRecording()&&s.initSpanRecorder(r._experiments&&r._experiments.maxSpans),n&&n.emit&&n.emit("startTransaction",s),s}function Uf(t,e,n,r,i,o,s,a=!1){let c=t.getClient(),l=c&&c.getOptions()||{},g=new Xf.IdleTransaction(e,t,n,r,s,i,a);return g=XI.sampleTransaction(g,l,{parentSampled:e.parentSampled,transactionContext:e,...o}),g.isRecording()&&g.initSpanRecorder(l._experiments&&l._experiments.maxSpans),c&&c.emit&&c.emit("startTransaction",g),g}function Kf(){let t=Nf.getMainCarrier();t.__SENTRY__&&(t.__SENTRY__.extensions=t.__SENTRY__.extensions||{},t.__SENTRY__.extensions.startTransaction||(t.__SENTRY__.extensions.startTransaction=wf),t.__SENTRY__.extensions.traceHeaders||(t.__SENTRY__.extensions.traceHeaders=Ff),Yf.registerErrorInstrumentation())}xi.addTracingExtensions=Kf;xi.startIdleTransaction=Uf});var Ac=d(ar=>{Object.defineProperty(ar,"__esModule",{value:!0});ar.SpanStatus=void 0;(function(t){let e="ok";t.Ok=e;let n="deadline_exceeded";t.DeadlineExceeded=n;let r="unauthenticated";t.Unauthenticated=r;let i="permission_denied";t.PermissionDenied=i;let o="not_found";t.NotFound=o;let s="resource_exhausted";t.ResourceExhausted=s;let a="invalid_argument";t.InvalidArgument=a;let c="unimplemented";t.Unimplemented=c;let l="unavailable";t.Unavailable=l;let g="internal_error";t.InternalError=g;let u="unknown_error";t.UnknownError=u;let I="cancelled";t.Cancelled=I;let m="already_exists";t.AlreadyExists=m;let C="failed_precondition";t.FailedPrecondition=C;let Z="aborted";t.Aborted=Z;let B="out_of_range";t.OutOfRange=B;let S="data_loss";t.DataLoss=S})(ar.SpanStatus||(ar.SpanStatus={}))});var Sc=d(fc=>{Object.defineProperty(fc,"__esModule",{value:!0});var Jf=b();function kf(t,e,n=()=>{}){let r;try{r=t()}catch(i){throw e(i),n(),i}return Lf(r,e,n)}function Lf(t,e,n){return Jf.isThenable(t)?t.then(r=>(n(),r),r=>{throw e(r),n(),r}):(n(),t)}fc.handleCallbackErrors=kf});var UI=d(xe=>{Object.defineProperty(xe,"__esModule",{value:!0});var Wc=b(),zf=J(),cr=Be(),Oi=Se(),Rc=Sc(),TI=Li(),Vc=$();function xf(t,e,n=()=>{},r=()=>{}){let i=Oi.getCurrentHub(),o=cr.getCurrentScope(),s=o.getSpan(),a=Mi(t),c=Hc(i,s,a);return o.setSpan(c),Rc.handleCallbackErrors(()=>e(c),l=>{c&&c.setStatus("internal_error"),n(l,c)},()=>{c&&c.end(),o.setSpan(s),r()})}function FI(t,e){let n=Mi(t);return cr.withScope(t.scope,r=>{let i=Oi.getCurrentHub(),o=r.getSpan(),s=Hc(i,o,n);return r.setSpan(s),Rc.handleCallbackErrors(()=>e(s),()=>{if(s){let{status:a}=Vc.spanToJSON(s);(!a||a==="ok")&&s.setStatus("internal_error")}},()=>s&&s.end())})}var Of=FI;function Mf(t,e){let n=Mi(t);return cr.withScope(t.scope,r=>{let i=Oi.getCurrentHub(),o=r.getSpan(),s=Hc(i,o,n);r.setSpan(s);function a(){s&&s.end()}return Rc.handleCallbackErrors(()=>e(s,a),()=>{if(s&&s.isRecording()){let{status:c}=Vc.spanToJSON(s);(!c||c==="ok")&&s.setStatus("internal_error")}})})}function Df(t){if(!TI.hasTracingEnabled())return;let e=Mi(t),n=Oi.getCurrentHub(),r=t.scope?t.scope.getSpan():wI();return r?r.startChild(e):n.startTransaction(e)}function wI(){return cr.getCurrentScope().getSpan()}function Pf({sentryTrace:t,baggage:e},n){let r=cr.getCurrentScope(),{traceparentData:i,dynamicSamplingContext:o,propagationContext:s}=Wc.tracingContextFromHeaders(t,e);r.setPropagationContext(s),zf.DEBUG_BUILD&&i&&Wc.logger.log(`[Tracing] Continuing trace ${i.traceId}.`);let a={...i,metadata:Wc.dropUndefinedKeys({dynamicSamplingContext:i&&!o?{}:o})};return n?n(a):a}function Hc(t,e,n){if(TI.hasTracingEnabled())return e?e.startChild(n):t.startTransaction(n)}function Mi(t){if(t.startTime){let e={...t};return e.startTimestamp=Vc.spanTimeInputToSeconds(t.startTime),delete e.startTime,e}return t}xe.continueTrace=Pf;xe.getActiveSpan=wI;xe.startActiveSpan=Of;xe.startInactiveSpan=Df;xe.startSpan=FI;xe.startSpanManual=Mf;xe.trace=xf});var KI=d(vc=>{Object.defineProperty(vc,"__esModule",{value:!0});var jf=Yi();function Qf(t,e,n){let r=jf.getActiveTransaction();r&&r.setMeasurement(t,e,n)}vc.setMeasurement=Qf});var _c=d(Di=>{Object.defineProperty(Di,"__esModule",{value:!0});var dn=b();function qf(t,e){return e&&(t.sdk=t.sdk||{},t.sdk.name=t.sdk.name||e.name,t.sdk.version=t.sdk.version||e.version,t.sdk.integrations=[...t.sdk.integrations||[],...e.integrations||[]],t.sdk.packages=[...t.sdk.packages||[],...e.packages||[]]),t}function $f(t,e,n,r){let i=dn.getSdkMetadataForEnvelopeHeader(n),o={sent_at:new Date().toISOString(),...i&&{sdk:i},...!!r&&e&&{dsn:dn.dsnToString(e)}},s="aggregates"in t?[{type:"sessions"},t]:[{type:"session"},t.toJSON()];return dn.createEnvelope(o,[s])}function eS(t,e,n,r){let i=dn.getSdkMetadataForEnvelopeHeader(n),o=t.type&&t.type!=="replay_event"?t.type:"event";qf(t,n&&n.sdk);let s=dn.createEventEnvelopeHeaders(t,i,r,e);delete t.sdkProcessingMetadata;let a=[{type:o},t];return dn.createEnvelope(s,[a])}Di.createEventEnvelope=eS;Di.createSessionEnvelope=$f});var Yc=d(Ec=>{Object.defineProperty(Ec,"__esModule",{value:!0});var tS=b(),nS=Be(),Nc=class{constructor(e,n){this._client=e,this.flushTimeout=60,this._pendingAggregates={},this._isEnabled=!0,this._intervalId=setInterval(()=>this.flush(),this.flushTimeout*1e3),this._sessionAttrs=n}flush(){let e=this.getSessionAggregates();e.aggregates.length!==0&&(this._pendingAggregates={},this._client.sendSession(e))}getSessionAggregates(){let e=Object.keys(this._pendingAggregates).map(r=>this._pendingAggregates[parseInt(r)]),n={attrs:this._sessionAttrs,aggregates:e};return tS.dropUndefinedKeys(n)}close(){clearInterval(this._intervalId),this._isEnabled=!1,this.flush()}incrementSessionStatusCount(){if(!this._isEnabled)return;let e=nS.getCurrentScope(),n=e.getRequestSession();n&&n.status&&(this._incrementSessionStatusCount(n.status,new Date),e.setRequestSession(void 0))}_incrementSessionStatusCount(e,n){let r=new Date(n).setSeconds(0,0);this._pendingAggregates[r]=this._pendingAggregates[r]||{};let i=this._pendingAggregates[r];switch(i.started||(i.started=new Date(r).toISOString()),e){case"errored":return i.errored=(i.errored||0)+1,i.errored;case"ok":return i.exited=(i.exited||0)+1,i.exited;default:return i.crashed=(i.crashed||0)+1,i.crashed}}};Ec.SessionFlusher=Nc});var ji=d(Pi=>{Object.defineProperty(Pi,"__esModule",{value:!0});var Xc=b(),rS="7";function JI(t){let e=t.protocol?`${t.protocol}:`:"",n=t.port?`:${t.port}`:"";return`${e}//${t.host}${n}${t.path?`/${t.path}`:""}/api/`}function iS(t){return`${JI(t)}${t.projectId}/envelope/`}function oS(t,e){return Xc.urlEncode({sentry_key:t.publicKey,sentry_version:rS,...e&&{sentry_client:`${e.name}/${e.version}`}})}function sS(t,e={}){let n=typeof e=="string"?e:e.tunnel,r=typeof e=="string"||!e._metadata?void 0:e._metadata.sdk;return n||`${iS(t)}?${oS(t,r)}`}function aS(t,e){let n=Xc.makeDsn(t);if(!n)return"";let r=`${JI(n)}embed/error-page/`,i=`dsn=${Xc.dsnToString(n)}`;for(let o in e)if(o!=="dsn"&&o!=="onClose")if(o==="user"){let s=e.user;if(!s)continue;s.name&&(i+=`&name=${encodeURIComponent(s.name)}`),s.email&&(i+=`&email=${encodeURIComponent(s.email)}`)}else i+=`&${encodeURIComponent(o)}=${encodeURIComponent(e[o])}`;return`${r}?${i}`}Pi.getEnvelopeEndpointWithUrlEncodedAuth=sS;Pi.getReportDialogEndpoint=aS});var Me=d(Oe=>{Object.defineProperty(Oe,"__esModule",{value:!0});var Qi=b(),Tc=J(),cS=On(),lS=Be(),gS=Se(),Fc=[];function uS(t){let e={};return t.forEach(n=>{let{name:r}=n,i=e[r];i&&!i.isDefaultInstance&&n.isDefaultInstance||(e[r]=n)}),Object.keys(e).map(n=>e[n])}function dS(t){let e=t.defaultIntegrations||[],n=t.integrations;e.forEach(s=>{s.isDefaultInstance=!0});let r;Array.isArray(n)?r=[...e,...n]:typeof n=="function"?r=Qi.arrayify(n(e)):r=e;let i=uS(r),o=mS(i,s=>s.name==="Debug");if(o!==-1){let[s]=i.splice(o,1);i.push(s)}return i}function IS(t,e){let n={};return e.forEach(r=>{r&&kI(t,r,n)}),n}function kI(t,e,n){if(n[e.name]){Tc.DEBUG_BUILD&&Qi.logger.log(`Integration skipped because it was already installed: ${e.name}`);return}if(n[e.name]=e,Fc.indexOf(e.name)===-1&&(e.setupOnce(cS.addGlobalEventProcessor,gS.getCurrentHub),Fc.push(e.name)),e.setup&&typeof e.setup=="function"&&e.setup(t),t.on&&typeof e.preprocessEvent=="function"){let r=e.preprocessEvent.bind(e);t.on("preprocessEvent",(i,o)=>r(i,o,t))}if(t.addEventProcessor&&typeof e.processEvent=="function"){let r=e.processEvent.bind(e),i=Object.assign((o,s)=>r(o,s,t),{id:e.name});t.addEventProcessor(i)}Tc.DEBUG_BUILD&&Qi.logger.log(`Integration installed: ${e.name}`)}function pS(t){let e=lS.getClient();if(!e||!e.addIntegration){Tc.DEBUG_BUILD&&Qi.logger.warn(`Cannot add integration "${t.name}" because no SDK Client is available.`);return}e.addIntegration(t)}function mS(t,e){for(let n=0;n<t.length;n++)if(e(t[n])===!0)return n;return-1}function CS(t,e){return Object.assign(function(...r){return e(...r)},{id:t})}function bS(t){return t}Oe.addIntegration=pS;Oe.convertIntegrationFnToClass=CS;Oe.defineIntegration=bS;Oe.getIntegrationsToSetup=dS;Oe.installedIntegrations=Fc;Oe.setupIntegration=kI;Oe.setupIntegrations=IS});var In=d(Ze=>{Object.defineProperty(Ze,"__esModule",{value:!0});var hS="c",BS="g",ZS="s",GS="d",yS=/[^a-zA-Z0-9_/.-]+/g,AS=/[^\w\d_:/@.{}[\]$-]+/g,fS=5e3,SS=1e4,WS=1e4;Ze.COUNTER_METRIC_TYPE=hS;Ze.DEFAULT_BROWSER_FLUSH_INTERVAL=fS;Ze.DEFAULT_FLUSH_INTERVAL=SS;Ze.DISTRIBUTION_METRIC_TYPE=GS;Ze.GAUGE_METRIC_TYPE=BS;Ze.MAX_WEIGHT=WS;Ze.NAME_AND_TAG_KEY_NORMALIZATION_REGEX=yS;Ze.SET_METRIC_TYPE=ZS;Ze.TAG_VALUE_NORMALIZATION_REGEX=AS});var lr=d(pn=>{Object.defineProperty(pn,"__esModule",{value:!0});var RS=b(),LI=In();function VS(t,e,n,r){let i=Object.entries(RS.dropUndefinedKeys(r)).sort((o,s)=>o[0].localeCompare(s[0]));return`${t}${e}${n}${i}`}function HS(t){let e=0;for(let n=0;n<t.length;n++){let r=t.charCodeAt(n);e=(e<<5)-e+r,e&=e}return e>>>0}function vS(t){let e="";for(let n of t){let r=Object.entries(n.tags),i=r.length>0?`|#${r.map(([o,s])=>`${o}:${s}`).join(",")}`:"";e+=`${n.name}@${n.unit}:${n.metric}|${n.metricType}${i}|T${n.timestamp}
`}return e}function _S(t){let e={};for(let n in t)if(Object.prototype.hasOwnProperty.call(t,n)){let r=n.replace(LI.NAME_AND_TAG_KEY_NORMALIZATION_REGEX,"_");e[r]=String(t[n]).replace(LI.TAG_VALUE_NORMALIZATION_REGEX,"_")}return e}pn.getBucketKey=VS;pn.sanitizeTags=_S;pn.serializeMetricBuckets=vS;pn.simpleHash=HS});var xI=d(wc=>{Object.defineProperty(wc,"__esModule",{value:!0});var zI=b(),NS=lr();function ES(t,e,n,r){let i={sent_at:new Date().toISOString()};n&&n.sdk&&(i.sdk={name:n.sdk.name,version:n.sdk.version}),r&&e&&(i.dsn=zI.dsnToString(e));let o=YS(t);return zI.createEnvelope(i,[o])}function YS(t){let e=NS.serializeMetricBuckets(t);return[{type:"statsd",length:e.length},e]}wc.createMetricEnvelope=ES});var Kc=d(qi=>{Object.defineProperty(qi,"__esModule",{value:!0});var V=b(),XS=ji(),Re=J(),OI=_c(),TS=Be(),FS=Se(),MI=Me(),wS=xI(),DI=tn(),US=sn(),KS=Si(),PI="Not capturing exception because it's already been captured.",Uc=class{constructor(e){if(this._options=e,this._integrations={},this._integrationsInitialized=!1,this._numProcessing=0,this._outcomes={},this._hooks={},this._eventProcessors=[],e.dsn?this._dsn=V.makeDsn(e.dsn):Re.DEBUG_BUILD&&V.logger.warn("No DSN provided, client will not send events."),this._dsn){let n=XS.getEnvelopeEndpointWithUrlEncodedAuth(this._dsn,e);this._transport=e.transport({recordDroppedEvent:this.recordDroppedEvent.bind(this),...e.transportOptions,url:n})}}captureException(e,n,r){if(V.checkOrSetAlreadyCaught(e)){Re.DEBUG_BUILD&&V.logger.log(PI);return}let i=n&&n.event_id;return this._process(this.eventFromException(e,n).then(o=>this._captureEvent(o,n,r)).then(o=>{i=o})),i}captureMessage(e,n,r,i){let o=r&&r.event_id,s=V.isParameterizedString(e)?e:String(e),a=V.isPrimitive(e)?this.eventFromMessage(s,n,r):this.eventFromException(e,r);return this._process(a.then(c=>this._captureEvent(c,r,i)).then(c=>{o=c})),o}captureEvent(e,n,r){if(n&&n.originalException&&V.checkOrSetAlreadyCaught(n.originalException)){Re.DEBUG_BUILD&&V.logger.log(PI);return}let i=n&&n.event_id;return this._process(this._captureEvent(e,n,r).then(o=>{i=o})),i}captureSession(e){typeof e.release!="string"?Re.DEBUG_BUILD&&V.logger.warn("Discarded session because of missing or non-string release"):(this.sendSession(e),DI.updateSession(e,{init:!1}))}getDsn(){return this._dsn}getOptions(){return this._options}getSdkMetadata(){return this._options._metadata}getTransport(){return this._transport}flush(e){let n=this._transport;return n?(this.metricsAggregator&&this.metricsAggregator.flush(),this._isClientDoneProcessing(e).then(r=>n.flush(e).then(i=>r&&i))):V.resolvedSyncPromise(!0)}close(e){return this.flush(e).then(n=>(this.getOptions().enabled=!1,this.metricsAggregator&&this.metricsAggregator.close(),n))}getEventProcessors(){return this._eventProcessors}addEventProcessor(e){this._eventProcessors.push(e)}setupIntegrations(e){(e&&!this._integrationsInitialized||this._isEnabled()&&!this._integrationsInitialized)&&this._setupIntegrations()}init(){this._isEnabled()&&this._setupIntegrations()}getIntegrationById(e){return this.getIntegrationByName(e)}getIntegrationByName(e){return this._integrations[e]}getIntegration(e){try{return this._integrations[e.id]||null}catch{return Re.DEBUG_BUILD&&V.logger.warn(`Cannot retrieve integration ${e.id} from the current Client`),null}}addIntegration(e){MI.setupIntegration(this,e,this._integrations)}sendEvent(e,n={}){this.emit("beforeSendEvent",e,n);let r=OI.createEventEnvelope(e,this._dsn,this._options._metadata,this._options.tunnel);for(let o of n.attachments||[])r=V.addItemToEnvelope(r,V.createAttachmentEnvelopeItem(o,this._options.transportOptions&&this._options.transportOptions.textEncoder));let i=this._sendEnvelope(r);i&&i.then(o=>this.emit("afterSendEvent",e,o),null)}sendSession(e){let n=OI.createSessionEnvelope(e,this._dsn,this._options._metadata,this._options.tunnel);this._sendEnvelope(n)}recordDroppedEvent(e,n,r){if(this._options.sendClientReports){let i=`${e}:${n}`;Re.DEBUG_BUILD&&V.logger.log(`Adding outcome: "${i}"`),this._outcomes[i]=this._outcomes[i]+1||1}}captureAggregateMetrics(e){Re.DEBUG_BUILD&&V.logger.log(`Flushing aggregated metrics, number of metrics: ${e.length}`);let n=wS.createMetricEnvelope(e,this._dsn,this._options._metadata,this._options.tunnel);this._sendEnvelope(n)}on(e,n){this._hooks[e]||(this._hooks[e]=[]),this._hooks[e].push(n)}emit(e,...n){this._hooks[e]&&this._hooks[e].forEach(r=>r(...n))}_setupIntegrations(){this._integrations=MI.setupIntegrations(this,this._options.integrations),this._integrationsInitialized=!0}_updateSessionFromEvent(e,n){let r=!1,i=!1,o=n.exception&&n.exception.values;if(o){i=!0;for(let c of o){let l=c.mechanism;if(l&&l.handled===!1){r=!0;break}}}let s=e.status==="ok";(s&&e.errors===0||s&&r)&&(DI.updateSession(e,{...r&&{status:"crashed"},errors:e.errors||Number(i||r)}),this.captureSession(e))}_isClientDoneProcessing(e){return new V.SyncPromise(n=>{let r=0,i=1,o=setInterval(()=>{this._numProcessing==0?(clearInterval(o),n(!0)):(r+=i,e&&r>=e&&(clearInterval(o),n(!1)))},i)})}_isEnabled(){return this.getOptions().enabled!==!1&&this._transport!==void 0}_prepareEvent(e,n,r,i=FS.getIsolationScope()){let o=this.getOptions(),s=Object.keys(this._integrations);return!n.integrations&&s.length>0&&(n.integrations=s),this.emit("preprocessEvent",e,n),KS.prepareEvent(o,e,n,r,this,i).then(a=>{if(a===null)return a;let{propagationContext:c}=a.sdkProcessingMetadata||{};if(!(a.contexts&&a.contexts.trace)&&c){let{traceId:g,spanId:u,parentSpanId:I,dsc:m}=c;a.contexts={trace:{trace_id:g,span_id:u,parent_span_id:I},...a.contexts};let C=m||US.getDynamicSamplingContextFromClient(g,this,r);a.sdkProcessingMetadata={dynamicSamplingContext:C,...a.sdkProcessingMetadata}}return a})}_captureEvent(e,n={},r){return this._processEvent(e,n,r).then(i=>i.event_id,i=>{if(Re.DEBUG_BUILD){let o=i;o.logLevel==="log"?V.logger.log(o.message):V.logger.warn(o)}})}_processEvent(e,n,r){let i=this.getOptions(),{sampleRate:o}=i,s=QI(e),a=jI(e),c=e.type||"error",l=`before send for type \`${c}\``;if(a&&typeof o=="number"&&Math.random()>o)return this.recordDroppedEvent("sample_rate","error",e),V.rejectedSyncPromise(new V.SentryError(`Discarding event because it's not included in the random sample (sampling rate = ${o})`,"log"));let g=c==="replay_event"?"replay":c;return this._prepareEvent(e,n,r).then(u=>{if(u===null)throw this.recordDroppedEvent("event_processor",g,e),new V.SentryError("An event processor returned `null`, will not send event.","log");if(n.data&&n.data.__sentry__===!0)return u;let m=kS(i,u,n);return JS(m,l)}).then(u=>{if(u===null)throw this.recordDroppedEvent("before_send",g,e),new V.SentryError(`${l} returned \`null\`, will not send event.`,"log");let I=r&&r.getSession();!s&&I&&this._updateSessionFromEvent(I,u);let m=u.transaction_info;if(s&&m&&u.transaction!==e.transaction){let C="custom";u.transaction_info={...m,source:C}}return this.sendEvent(u,n),u}).then(null,u=>{throw u instanceof V.SentryError?u:(this.captureException(u,{data:{__sentry__:!0},originalException:u}),new V.SentryError(`Event processing pipeline threw an error, original event will not be sent. Details have been sent as a new event.
Reason: ${u}`))})}_process(e){this._numProcessing++,e.then(n=>(this._numProcessing--,n),n=>(this._numProcessing--,n))}_sendEnvelope(e){if(this.emit("beforeEnvelope",e),this._isEnabled()&&this._transport)return this._transport.send(e).then(null,n=>{Re.DEBUG_BUILD&&V.logger.error("Error while sending event:",n)});Re.DEBUG_BUILD&&V.logger.error("Transport disabled")}_clearOutcomes(){let e=this._outcomes;return this._outcomes={},Object.keys(e).map(n=>{let[r,i]=n.split(":");return{reason:r,category:i,quantity:e[n]}})}};function JS(t,e){let n=`${e} must return \`null\` or a valid event.`;if(V.isThenable(t))return t.then(r=>{if(!V.isPlainObject(r)&&r!==null)throw new V.SentryError(n);return r},r=>{throw new V.SentryError(`${e} rejected with ${r}`)});if(!V.isPlainObject(t)&&t!==null)throw new V.SentryError(n);return t}function kS(t,e,n){let{beforeSend:r,beforeSendTransaction:i}=t;return jI(e)&&r?r(e,n):QI(e)&&i?i(e,n):e}function jI(t){return t.type===void 0}function QI(t){return t.type==="transaction"}function LS(t){let e=TS.getClient();!e||!e.addEventProcessor||e.addEventProcessor(t)}qi.BaseClient=Uc;qi.addEventProcessor=LS});var Lc=d(kc=>{Object.defineProperty(kc,"__esModule",{value:!0});var Jc=b();function zS(t,e,n,r,i){let o={sent_at:new Date().toISOString()};n&&n.sdk&&(o.sdk={name:n.sdk.name,version:n.sdk.version}),r&&i&&(o.dsn=Jc.dsnToString(i)),e&&(o.trace=Jc.dropUndefinedKeys(e));let s=xS(t);return Jc.createEnvelope(o,[s])}function xS(t){return[{type:"check_in"},t]}kc.createCheckInEnvelope=zS});var zc=d(Wt=>{Object.defineProperty(Wt,"__esModule",{value:!0});var $i=In(),OS=lr(),eo=class{constructor(e){this._value=e}get weight(){return 1}add(e){this._value+=e}toString(){return`${this._value}`}},to=class{constructor(e){this._last=e,this._min=e,this._max=e,this._sum=e,this._count=1}get weight(){return 5}add(e){this._last=e,e<this._min&&(this._min=e),e>this._max&&(this._max=e),this._sum+=e,this._count++}toString(){return`${this._last}:${this._min}:${this._max}:${this._sum}:${this._count}`}},no=class{constructor(e){this._value=[e]}get weight(){return this._value.length}add(e){this._value.push(e)}toString(){return this._value.join(":")}},ro=class{constructor(e){this.first=e,this._value=new Set([e])}get weight(){return this._value.size}add(e){this._value.add(e)}toString(){return Array.from(this._value).map(e=>typeof e=="string"?OS.simpleHash(e):e).join(":")}},MS={[$i.COUNTER_METRIC_TYPE]:eo,[$i.GAUGE_METRIC_TYPE]:to,[$i.DISTRIBUTION_METRIC_TYPE]:no,[$i.SET_METRIC_TYPE]:ro};Wt.CounterMetric=eo;Wt.DistributionMetric=no;Wt.GaugeMetric=to;Wt.METRIC_MAP=MS;Wt.SetMetric=ro});var ep=d(Oc=>{Object.defineProperty(Oc,"__esModule",{value:!0});var qI=b(),gr=In(),DS=zc(),$I=lr(),xc=class{constructor(e){this._client=e,this._buckets=new Map,this._bucketsTotalWeight=0,this._interval=setInterval(()=>this._flush(),gr.DEFAULT_FLUSH_INTERVAL),this._flushShift=Math.floor(Math.random()*gr.DEFAULT_FLUSH_INTERVAL/1e3),this._forceFlush=!1}add(e,n,r,i="none",o={},s=qI.timestampInSeconds()){let a=Math.floor(s),c=n.replace(gr.NAME_AND_TAG_KEY_NORMALIZATION_REGEX,"_"),l=$I.sanitizeTags(o),g=$I.getBucketKey(e,c,i,l),u=this._buckets.get(g);u?(u.metric.add(r),u.timestamp<a&&(u.timestamp=a)):(u={metric:new DS.METRIC_MAP[e](r),timestamp:a,metricType:e,name:c,unit:i,tags:l},this._buckets.set(g,u)),this._bucketsTotalWeight+=u.metric.weight,this._bucketsTotalWeight>=gr.MAX_WEIGHT&&this.flush()}flush(){this._forceFlush=!0,this._flush()}close(){this._forceFlush=!0,clearInterval(this._interval),this._flush()}_flush(){if(this._forceFlush){this._forceFlush=!1,this._bucketsTotalWeight=0,this._captureMetrics(this._buckets),this._buckets.clear();return}let e=Math.floor(qI.timestampInSeconds())-gr.DEFAULT_FLUSH_INTERVAL/1e3-this._flushShift,n=new Map;for(let[r,i]of this._buckets)i.timestamp<=e&&(n.set(r,i),this._bucketsTotalWeight-=i.metric.weight);for(let[r]of n)this._buckets.delete(r);this._captureMetrics(n)}_captureMetrics(e){if(e.size>0&&this._client.captureAggregateMetrics){let n=Array.from(e).map(([,r])=>r);this._client.captureAggregateMetrics(n)}}};Oc.MetricsAggregator=xc});var np=d(Dc=>{Object.defineProperty(Dc,"__esModule",{value:!0});var De=b(),PS=Kc(),jS=Lc(),io=J(),QS=Be(),qS=ep(),$S=Yc(),eW=yc(),tW=$(),nW=on(),tp=sn();Ac();var Mc=class extends PS.BaseClient{constructor(e){eW.addTracingExtensions(),super(e),e._experiments&&e._experiments.metricsAggregator&&(this.metricsAggregator=new qS.MetricsAggregator(this))}eventFromException(e,n){return De.resolvedSyncPromise(De.eventFromUnknownInput(QS.getClient(),this._options.stackParser,e,n))}eventFromMessage(e,n="info",r){return De.resolvedSyncPromise(De.eventFromMessage(this._options.stackParser,e,n,r,this._options.attachStacktrace))}captureException(e,n,r){if(this._options.autoSessionTracking&&this._sessionFlusher&&r){let i=r.getRequestSession();i&&i.status==="ok"&&(i.status="errored")}return super.captureException(e,n,r)}captureEvent(e,n,r){if(this._options.autoSessionTracking&&this._sessionFlusher&&r&&(e.type||"exception")==="exception"&&e.exception&&e.exception.values&&e.exception.values.length>0){let s=r.getRequestSession();s&&s.status==="ok"&&(s.status="errored")}return super.captureEvent(e,n,r)}close(e){return this._sessionFlusher&&this._sessionFlusher.close(),super.close(e)}initSessionFlusher(){let{release:e,environment:n}=this._options;e?this._sessionFlusher=new $S.SessionFlusher(this,{release:e,environment:n}):io.DEBUG_BUILD&&De.logger.warn("Cannot initialise an instance of SessionFlusher if no release is provided!")}captureCheckIn(e,n,r){let i="checkInId"in e&&e.checkInId?e.checkInId:De.uuid4();if(!this._isEnabled())return io.DEBUG_BUILD&&De.logger.warn("SDK not enabled, will not capture checkin."),i;let o=this.getOptions(),{release:s,environment:a,tunnel:c}=o,l={check_in_id:i,monitor_slug:e.monitorSlug,status:e.status,release:s,environment:a};"duration"in e&&(l.duration=e.duration),n&&(l.monitor_config={schedule:n.schedule,checkin_margin:n.checkinMargin,max_runtime:n.maxRuntime,timezone:n.timezone});let[g,u]=this._getTraceInfoFromScope(r);u&&(l.contexts={trace:u});let I=jS.createCheckInEnvelope(l,g,this.getSdkMetadata(),c,this.getDsn());return io.DEBUG_BUILD&&De.logger.info("Sending checkin:",e.monitorSlug,e.status),this._sendEnvelope(I),i}_captureRequestSession(){this._sessionFlusher?this._sessionFlusher.incrementSessionStatusCount():io.DEBUG_BUILD&&De.logger.warn("Discarded request mode session because autoSessionTracking option was disabled")}_prepareEvent(e,n,r,i){return this._options.platform&&(e.platform=e.platform||this._options.platform),this._options.runtime&&(e.contexts={...e.contexts,runtime:(e.contexts||{}).runtime||this._options.runtime}),this._options.serverName&&(e.server_name=e.server_name||this._options.serverName),super._prepareEvent(e,n,r,i)}_getTraceInfoFromScope(e){if(!e)return[void 0,void 0];let n=e.getSpan();if(n)return[nW.getRootSpan(n)?tp.getDynamicSamplingContextFromSpan(n):void 0,tW.spanToTraceContext(n)];let{traceId:r,spanId:i,parentSpanId:o,dsc:s}=e.getPropagationContext(),a={trace_id:r,span_id:i,parent_span_id:o};return s?[s,a]:[tp.getDynamicSamplingContextFromClient(r,this,e),a]}};Dc.ServerRuntimeClient=Mc});var op=d(oo=>{Object.defineProperty(oo,"__esModule",{value:!0});var rp=b(),rW=J(),iW=Be(),oW=Se();function sW(t,e){e.debug===!0&&(rW.DEBUG_BUILD?rp.logger.enable():rp.consoleSandbox(()=>{console.warn("[Sentry] Cannot initialize SDK with `debug` option using a non-debug bundle.")})),iW.getCurrentScope().update(e.initialScope);let r=new t(e);ip(r),aW(r)}function ip(t){let n=oW.getCurrentHub().getStackTop();n.client=t,n.scope.setClient(t)}function aW(t){t.init?t.init():t.setupIntegrations&&t.setupIntegrations()}oo.initAndBind=sW;oo.setCurrentClient=ip});var lp=d(so=>{Object.defineProperty(so,"__esModule",{value:!0});var te=b(),sp=J(),cp=30;function cW(t,e,n=te.makePromiseBuffer(t.bufferSize||cp)){let r={},i=s=>n.drain(s);function o(s){let a=[];if(te.forEachEnvelopeItem(s,(u,I)=>{let m=te.envelopeItemTypeToDataCategory(I);if(te.isRateLimited(r,m)){let C=ap(u,I);t.recordDroppedEvent("ratelimit_backoff",m,C)}else a.push(u)}),a.length===0)return te.resolvedSyncPromise();let c=te.createEnvelope(s[0],a),l=u=>{te.forEachEnvelopeItem(c,(I,m)=>{let C=ap(I,m);t.recordDroppedEvent(u,te.envelopeItemTypeToDataCategory(m),C)})},g=()=>e({body:te.serializeEnvelope(c,t.textEncoder)}).then(u=>(u.statusCode!==void 0&&(u.statusCode<200||u.statusCode>=300)&&sp.DEBUG_BUILD&&te.logger.warn(`Sentry responded with status code ${u.statusCode} to sent event.`),r=te.updateRateLimits(r,u),u),u=>{throw l("network_error"),u});return n.add(g).then(u=>u,u=>{if(u instanceof te.SentryError)return sp.DEBUG_BUILD&&te.logger.error("Skipped sending event because buffer is full."),l("queue_overflow"),te.resolvedSyncPromise();throw u})}return o.__sentry__baseTransport__=!0,{send:o,flush:i}}function ap(t,e){if(!(e!=="event"&&e!=="transaction"))return Array.isArray(t)?t[1]:void 0}so.DEFAULT_TRANSPORT_BUFFER_SIZE=cp;so.createTransport=cW});var up=d(ur=>{Object.defineProperty(ur,"__esModule",{value:!0});var jc=b(),lW=J(),gp=100,Qc=5e3,gW=36e5;function Pc(t,e){lW.DEBUG_BUILD&&jc.logger.info(`[Offline]: ${t}`,e)}function uW(t){return e=>{let n=t(e),r=e.createStore?e.createStore(e):void 0,i=Qc,o;function s(g,u,I){return jc.envelopeContainsItemType(g,["replay_event","replay_recording","client_report"])?!1:e.shouldStore?e.shouldStore(g,u,I):!0}function a(g){r&&(o&&clearTimeout(o),o=setTimeout(async()=>{o=void 0;let u=await r.pop();u&&(Pc("Attempting to send previously queued event"),l(u).catch(I=>{Pc("Failed to retry sending",I)}))},g),typeof o!="number"&&o.unref&&o.unref())}function c(){o||(a(i),i=Math.min(i*2,gW))}async function l(g){try{let u=await n.send(g),I=gp;if(u){if(u.headers&&u.headers["retry-after"])I=jc.parseRetryAfterHeader(u.headers["retry-after"]);else if((u.statusCode||0)>=400)return u}return a(I),i=Qc,u}catch(u){if(r&&await s(g,u,i))return await r.insert(g),c(),Pc("Error sending. Event queued",u),{};throw u}}return e.flushAtStartup&&c(),{send:l,flush:g=>n.flush(g)}}}ur.MIN_DELAY=gp;ur.START_DELAY=Qc;ur.makeOfflineTransport=uW});var Ip=d(ao=>{Object.defineProperty(ao,"__esModule",{value:!0});var dp=b(),dW=ji();function qc(t,e){let n;return dp.forEachEnvelopeItem(t,(r,i)=>(e.includes(i)&&(n=Array.isArray(r)?r[1]:void 0),!!n)),n}function IW(t,e){return n=>{let r=t(n);return{send:async i=>{let o=qc(i,["event","transaction","profile","replay_event"]);return o&&(o.release=e),r.send(i)},flush:i=>r.flush(i)}}}function pW(t,e){return n=>{let r=t(n),i={};function o(c,l){let g=l?`${c}:${l}`:c;if(!i[g]){let u=dp.dsnFromString(c);if(!u)return;let I=dW.getEnvelopeEndpointWithUrlEncodedAuth(u);i[g]=l?IW(t,l)({...n,url:I}):t({...n,url:I})}return i[g]}async function s(c){function l(I){let m=I&&I.length?I:["event"];return qc(c,m)}let g=e({envelope:c,getEvent:l}).map(I=>typeof I=="string"?o(I,void 0):o(I.dsn,I.release)).filter(I=>!!I);return g.length===0&&g.push(r),(await Promise.all(g.map(I=>I.send(c))))[0]}async function a(c){let l=[...Object.keys(i).map(u=>i[u]),r];return(await Promise.all(l.map(u=>u.flush(c)))).every(u=>u)}return{send:s,flush:a}}}ao.eventFromEnvelope=qc;ao.makeMultiplexedTransport=pW});var mp=d($c=>{Object.defineProperty($c,"__esModule",{value:!0});function mW(t,e){let n=e&&hW(e)?e.getClient():e,r=n&&n.getDsn(),i=n&&n.getOptions().tunnel;return bW(t,r)||CW(t,i)}function CW(t,e){return e?pp(t)===pp(e):!1}function bW(t,e){return e?t.includes(e.host):!1}function pp(t){return t[t.length-1]==="/"?t.slice(0,-1):t}function hW(t){return t.getClient!==void 0}$c.isSentryRequestUrl=mW});var Bp=d(dr=>{Object.defineProperty(dr,"__esModule",{value:!0});var el=b(),bp=new Map,Cp=new Set;function BW(t){if(el.GLOBAL_OBJ._sentryModuleMetadata)for(let e of Object.keys(el.GLOBAL_OBJ._sentryModuleMetadata)){let n=el.GLOBAL_OBJ._sentryModuleMetadata[e];if(Cp.has(e))continue;Cp.add(e);let r=t(e);for(let i of r.reverse())if(i.filename){bp.set(i.filename,n);break}}}function hp(t,e){return BW(t),bp.get(e)}function ZW(t,e){try{e.exception.values.forEach(n=>{if(n.stacktrace)for(let r of n.stacktrace.frames||[]){if(!r.filename)continue;let i=hp(t,r.filename);i&&(r.module_metadata=i)}})}catch{}}function GW(t){try{t.exception.values.forEach(e=>{if(e.stacktrace)for(let n of e.stacktrace.frames||[])delete n.module_metadata})}catch{}}dr.addMetadataToStackFrames=ZW;dr.getMetadataForUrl=hp;dr.stripMetadataFromStackFrames=GW});var fp=d(co=>{Object.defineProperty(co,"__esModule",{value:!0});var yW=b(),Gp=Me(),Zp=Bp(),yp="ModuleMetadata",AW=()=>({name:yp,setupOnce(){},setup(t){typeof t.on=="function"&&t.on("beforeEnvelope",e=>{yW.forEachEnvelopeItem(e,(n,r)=>{if(r==="event"){let i=Array.isArray(n)?n[1]:void 0;i&&(Zp.stripMetadataFromStackFrames(i),n[1]=i)}})})},processEvent(t,e,n){let r=n.getOptions().stackParser;return Zp.addMetadataToStackFrames(r,t),t}}),Ap=Gp.defineIntegration(AW),fW=Gp.convertIntegrationFnToClass(yp,Ap);co.ModuleMetadata=fW;co.moduleMetadataIntegration=Ap});var Hp=d(lo=>{Object.defineProperty(lo,"__esModule",{value:!0});var Sp=b(),Wp=Me(),SW=$(),tl={include:{cookies:!0,data:!0,headers:!0,ip:!1,query_string:!0,url:!0,user:{id:!0,username:!0,email:!0}},transactionNamingScheme:"methodPath"},Rp="RequestData",WW=(t={})=>{let e=Sp.addRequestDataToEvent,n={...tl,...t,include:{method:!0,...tl.include,...t.include,user:t.include&&typeof t.include.user=="boolean"?t.include.user:{...tl.include.user,...(t.include||{}).user}}};return{name:Rp,setupOnce(){},processEvent(r,i,o){let{transactionNamingScheme:s}=n,{sdkProcessingMetadata:a={}}=r,c=a.request;if(!c)return r;let l=a.requestDataOptionsFromExpressHandler||a.requestDataOptionsFromGCPWrapper||VW(n),g=e(r,c,l);if(r.type==="transaction"||s==="handler")return g;let I=c._sentryTransaction;if(I){let m=SW.spanToJSON(I).description||"",C=HW(o)==="sentry.javascript.nextjs"?m.startsWith("/api"):s!=="path",[Z]=Sp.extractPathForTransaction(c,{path:!0,method:C,customRoute:m});g.transaction=Z}return g}}},Vp=Wp.defineIntegration(WW),RW=Wp.convertIntegrationFnToClass(Rp,Vp);function VW(t){let{transactionNamingScheme:e,include:{ip:n,user:r,...i}}=t,o=[];for(let[a,c]of Object.entries(i))c&&o.push(a);let s;if(r===void 0)s=!0;else if(typeof r=="boolean")s=r;else{let a=[];for(let[c,l]of Object.entries(r))l&&a.push(c);s=a}return{include:{ip:n,user:s,request:o.length!==0?o:void 0,transaction:e}}}function HW(t){try{return t.getOptions()._metadata.sdk.name}catch{return}}lo.RequestData=RW;lo.requestDataIntegration=Vp});var nl=d(uo=>{Object.defineProperty(uo,"__esModule",{value:!0});var z=b(),Rt=J(),vp=Me(),vW=[/^Script error\.?$/,/^Javascript error: Script error\.? on line 0$/],_W=[/^.*\/healthcheck$/,/^.*\/healthy$/,/^.*\/live$/,/^.*\/ready$/,/^.*\/heartbeat$/,/^.*\/health$/,/^.*\/healthz$/],_p="InboundFilters",NW=(t={})=>({name:_p,setupOnce(){},processEvent(e,n,r){let i=r.getOptions(),o=YW(t,i);return XW(e,o)?null:e}}),Np=vp.defineIntegration(NW),EW=vp.convertIntegrationFnToClass(_p,Np);function YW(t={},e={}){return{allowUrls:[...t.allowUrls||[],...e.allowUrls||[]],denyUrls:[...t.denyUrls||[],...e.denyUrls||[]],ignoreErrors:[...t.ignoreErrors||[],...e.ignoreErrors||[],...t.disableErrorDefaults?[]:vW],ignoreTransactions:[...t.ignoreTransactions||[],...e.ignoreTransactions||[],...t.disableTransactionDefaults?[]:_W],ignoreInternal:t.ignoreInternal!==void 0?t.ignoreInternal:!0}}function XW(t,e){return e.ignoreInternal&&JW(t)?(Rt.DEBUG_BUILD&&z.logger.warn(`Event dropped due to being internal Sentry Error.
Event: ${z.getEventDescription(t)}`),!0):TW(t,e.ignoreErrors)?(Rt.DEBUG_BUILD&&z.logger.warn(`Event dropped due to being matched by \`ignoreErrors\` option.
Event: ${z.getEventDescription(t)}`),!0):FW(t,e.ignoreTransactions)?(Rt.DEBUG_BUILD&&z.logger.warn(`Event dropped due to being matched by \`ignoreTransactions\` option.
Event: ${z.getEventDescription(t)}`),!0):wW(t,e.denyUrls)?(Rt.DEBUG_BUILD&&z.logger.warn(`Event dropped due to being matched by \`denyUrls\` option.
Event: ${z.getEventDescription(t)}.
Url: ${go(t)}`),!0):UW(t,e.allowUrls)?!1:(Rt.DEBUG_BUILD&&z.logger.warn(`Event dropped due to not being matched by \`allowUrls\` option.
Event: ${z.getEventDescription(t)}.
Url: ${go(t)}`),!0)}function TW(t,e){return t.type||!e||!e.length?!1:KW(t).some(n=>z.stringMatchesSomePattern(n,e))}function FW(t,e){if(t.type!=="transaction"||!e||!e.length)return!1;let n=t.transaction;return n?z.stringMatchesSomePattern(n,e):!1}function wW(t,e){if(!e||!e.length)return!1;let n=go(t);return n?z.stringMatchesSomePattern(n,e):!1}function UW(t,e){if(!e||!e.length)return!0;let n=go(t);return n?z.stringMatchesSomePattern(n,e):!0}function KW(t){let e=[];t.message&&e.push(t.message);let n;try{n=t.exception.values[t.exception.values.length-1]}catch{}return n&&n.value&&(e.push(n.value),n.type&&e.push(`${n.type}: ${n.value}`)),Rt.DEBUG_BUILD&&e.length===0&&z.logger.error(`Could not extract message for event ${z.getEventDescription(t)}`),e}function JW(t){try{return t.exception.values[0].type==="SentryError"}catch{}return!1}function kW(t=[]){for(let e=t.length-1;e>=0;e--){let n=t[e];if(n&&n.filename!=="<anonymous>"&&n.filename!=="[native code]")return n.filename||null}return null}function go(t){try{let e;try{e=t.exception.values[0].stacktrace.frames}catch{}return e?kW(e):null}catch{return Rt.DEBUG_BUILD&&z.logger.error(`Cannot extract url for event ${z.getEventDescription(t)}`),null}}uo.InboundFilters=EW;uo.inboundFiltersIntegration=Np});var rl=d(Io=>{Object.defineProperty(Io,"__esModule",{value:!0});var LW=b(),Yp=Me(),Ep,Xp="FunctionToString",zW=()=>({name:Xp,setupOnce(){Ep=Function.prototype.toString;try{Function.prototype.toString=function(...t){let e=LW.getOriginalFunction(this)||this;return Ep.apply(e,t)}}catch{}}}),Tp=Yp.defineIntegration(zW),xW=Yp.convertIntegrationFnToClass(Xp,Tp);Io.FunctionToString=xW;Io.functionToStringIntegration=Tp});var il=d(po=>{Object.defineProperty(po,"__esModule",{value:!0});var Fp=b(),wp=Me(),OW="cause",MW=5,Up="LinkedErrors",DW=(t={})=>{let e=t.limit||MW,n=t.key||OW;return{name:Up,setupOnce(){},preprocessEvent(r,i,o){let s=o.getOptions();Fp.applyAggregateErrorsToEvent(Fp.exceptionFromError,s.stackParser,s.maxValueLength,n,e,r,i)}}},Kp=wp.defineIntegration(DW),PW=wp.convertIntegrationFnToClass(Up,Kp);po.LinkedErrors=PW;po.linkedErrorsIntegration=Kp});var Jp=d(Ir=>{Object.defineProperty(Ir,"__esModule",{value:!0});var jW=rl(),QW=nl(),qW=il();Ir.FunctionToString=jW.FunctionToString;Ir.InboundFilters=QW.InboundFilters;Ir.LinkedErrors=qW.LinkedErrors});var zp=d(sl=>{Object.defineProperty(sl,"__esModule",{value:!0});var $W=b(),kp=In(),eR=zc(),Lp=lr(),ol=class{constructor(e){this._client=e,this._buckets=new Map,this._interval=setInterval(()=>this.flush(),kp.DEFAULT_BROWSER_FLUSH_INTERVAL)}add(e,n,r,i="none",o={},s=$W.timestampInSeconds()){let a=Math.floor(s),c=n.replace(kp.NAME_AND_TAG_KEY_NORMALIZATION_REGEX,"_"),l=Lp.sanitizeTags(o),g=Lp.getBucketKey(e,c,i,l),u=this._buckets.get(g);u?(u.metric.add(r),u.timestamp<a&&(u.timestamp=a)):this._buckets.set(g,{metric:new eR.METRIC_MAP[e](r),timestamp:a,metricType:e,name:c,unit:i,tags:l})}flush(){if(this._buckets.size!==0){if(this._client.captureAggregateMetrics){let e=Array.from(this._buckets).map(([,n])=>n);this._client.captureAggregateMetrics(e)}this._buckets.clear()}}close(){clearInterval(this._interval),this.flush()}};sl.BrowserMetricsAggregator=ol});var Dp=d(mo=>{Object.defineProperty(mo,"__esModule",{value:!0});var xp=Me(),tR=zp(),Op="MetricsAggregator",nR=()=>({name:Op,setupOnce(){},setup(t){t.metricsAggregator=new tR.BrowserMetricsAggregator(t)}}),Mp=xp.defineIntegration(nR),rR=xp.convertIntegrationFnToClass(Op,Mp);mo.MetricsAggregator=rR;mo.metricsAggregatorIntegration=Mp});var rm=d(Vt=>{Object.defineProperty(Vt,"__esModule",{value:!0});var Pp=b(),jp=J(),Qp=Be(),iR=$(),Co=In(),qp=Dp();function bo(t,e,n,r={}){let i=Qp.getClient(),o=Qp.getCurrentScope();if(i){if(!i.metricsAggregator){jp.DEBUG_BUILD&&Pp.logger.warn("No metrics aggregator enabled. Please add the MetricsAggregator integration to use metrics APIs");return}let{unit:s,tags:a,timestamp:c}=r,{release:l,environment:g}=i.getOptions(),u=o.getTransaction(),I={};l&&(I.release=l),g&&(I.environment=g),u&&(I.transaction=iR.spanToJSON(u).description||""),jp.DEBUG_BUILD&&Pp.logger.log(`Adding value of ${n} to ${t} metric ${e}`),i.metricsAggregator.add(t,e,n,s,{...I,...a},c)}}function $p(t,e=1,n){bo(Co.COUNTER_METRIC_TYPE,t,e,n)}function em(t,e,n){bo(Co.DISTRIBUTION_METRIC_TYPE,t,e,n)}function tm(t,e,n){bo(Co.SET_METRIC_TYPE,t,e,n)}function nm(t,e,n){bo(Co.GAUGE_METRIC_TYPE,t,e,n)}var oR={increment:$p,distribution:em,set:tm,gauge:nm,MetricsAggregator:qp.MetricsAggregator,metricsAggregatorIntegration:qp.metricsAggregatorIntegration};Vt.distribution=em;Vt.gauge=nm;Vt.increment=$p;Vt.metrics=oR;Vt.set=tm});var W=d(h=>{Object.defineProperty(h,"__esModule",{value:!0});var im=yc(),om=Bc(),sm=Ti(),sR=Ui(),am=Yi(),aR=Ac(),Ht=UI(),cm=sn(),cR=KI(),al=nr(),lm=_c(),E=Be(),Ve=Se(),cl=tn(),lR=Yc(),ll=Ri(),gm=On(),um=ji(),dm=Kc(),gR=np(),Im=op(),uR=lp(),dR=up(),IR=Ip(),pR=ac(),ho=Me(),pm=Wi(),mR=Si(),CR=Lc(),bR=Li(),hR=mp(),BR=Sc(),gl=$(),ZR=on(),GR=en(),mm=fp(),Cm=Hp(),bm=nl(),hm=rl(),Bm=il(),yR=Jp(),AR=rm(),fR=yR;h.addTracingExtensions=im.addTracingExtensions;h.startIdleTransaction=im.startIdleTransaction;h.IdleTransaction=om.IdleTransaction;h.TRACING_DEFAULTS=om.TRACING_DEFAULTS;h.Span=sm.Span;h.spanStatusfromHttpCode=sm.spanStatusfromHttpCode;h.Transaction=sR.Transaction;h.extractTraceparentData=am.extractTraceparentData;h.getActiveTransaction=am.getActiveTransaction;Object.defineProperty(h,"SpanStatus",{enumerable:!0,get:()=>aR.SpanStatus});h.continueTrace=Ht.continueTrace;h.getActiveSpan=Ht.getActiveSpan;h.startActiveSpan=Ht.startActiveSpan;h.startInactiveSpan=Ht.startInactiveSpan;h.startSpan=Ht.startSpan;h.startSpanManual=Ht.startSpanManual;h.trace=Ht.trace;h.getDynamicSamplingContextFromClient=cm.getDynamicSamplingContextFromClient;h.getDynamicSamplingContextFromSpan=cm.getDynamicSamplingContextFromSpan;h.setMeasurement=cR.setMeasurement;h.SEMANTIC_ATTRIBUTE_SENTRY_OP=al.SEMANTIC_ATTRIBUTE_SENTRY_OP;h.SEMANTIC_ATTRIBUTE_SENTRY_SAMPLE_RATE=al.SEMANTIC_ATTRIBUTE_SENTRY_SAMPLE_RATE;h.SEMANTIC_ATTRIBUTE_SENTRY_SOURCE=al.SEMANTIC_ATTRIBUTE_SENTRY_SOURCE;h.createEventEnvelope=lm.createEventEnvelope;h.createSessionEnvelope=lm.createSessionEnvelope;h.addBreadcrumb=E.addBreadcrumb;h.captureCheckIn=E.captureCheckIn;h.captureEvent=E.captureEvent;h.captureException=E.captureException;h.captureMessage=E.captureMessage;h.captureSession=E.captureSession;h.close=E.close;h.configureScope=E.configureScope;h.endSession=E.endSession;h.flush=E.flush;h.getClient=E.getClient;h.getCurrentScope=E.getCurrentScope;h.lastEventId=E.lastEventId;h.setContext=E.setContext;h.setExtra=E.setExtra;h.setExtras=E.setExtras;h.setTag=E.setTag;h.setTags=E.setTags;h.setUser=E.setUser;h.startSession=E.startSession;h.startTransaction=E.startTransaction;h.withActiveSpan=E.withActiveSpan;h.withIsolationScope=E.withIsolationScope;h.withMonitor=E.withMonitor;h.withScope=E.withScope;h.Hub=Ve.Hub;h.ensureHubOnCarrier=Ve.ensureHubOnCarrier;h.getCurrentHub=Ve.getCurrentHub;h.getHubFromCarrier=Ve.getHubFromCarrier;h.getIsolationScope=Ve.getIsolationScope;h.getMainCarrier=Ve.getMainCarrier;h.makeMain=Ve.makeMain;h.runWithAsyncContext=Ve.runWithAsyncContext;h.setAsyncContextStrategy=Ve.setAsyncContextStrategy;h.setHubOnCarrier=Ve.setHubOnCarrier;h.closeSession=cl.closeSession;h.makeSession=cl.makeSession;h.updateSession=cl.updateSession;h.SessionFlusher=lR.SessionFlusher;h.Scope=ll.Scope;h.getGlobalScope=ll.getGlobalScope;h.setGlobalScope=ll.setGlobalScope;h.addGlobalEventProcessor=gm.addGlobalEventProcessor;h.notifyEventProcessors=gm.notifyEventProcessors;h.getEnvelopeEndpointWithUrlEncodedAuth=um.getEnvelopeEndpointWithUrlEncodedAuth;h.getReportDialogEndpoint=um.getReportDialogEndpoint;h.BaseClient=dm.BaseClient;h.addEventProcessor=dm.addEventProcessor;h.ServerRuntimeClient=gR.ServerRuntimeClient;h.initAndBind=Im.initAndBind;h.setCurrentClient=Im.setCurrentClient;h.createTransport=uR.createTransport;h.makeOfflineTransport=dR.makeOfflineTransport;h.makeMultiplexedTransport=IR.makeMultiplexedTransport;h.SDK_VERSION=pR.SDK_VERSION;h.addIntegration=ho.addIntegration;h.convertIntegrationFnToClass=ho.convertIntegrationFnToClass;h.defineIntegration=ho.defineIntegration;h.getIntegrationsToSetup=ho.getIntegrationsToSetup;h.applyScopeDataToEvent=pm.applyScopeDataToEvent;h.mergeScopeData=pm.mergeScopeData;h.prepareEvent=mR.prepareEvent;h.createCheckInEnvelope=CR.createCheckInEnvelope;h.hasTracingEnabled=bR.hasTracingEnabled;h.isSentryRequestUrl=hR.isSentryRequestUrl;h.handleCallbackErrors=BR.handleCallbackErrors;h.spanIsSampled=gl.spanIsSampled;h.spanToJSON=gl.spanToJSON;h.spanToTraceHeader=gl.spanToTraceHeader;h.getRootSpan=ZR.getRootSpan;h.DEFAULT_ENVIRONMENT=GR.DEFAULT_ENVIRONMENT;h.ModuleMetadata=mm.ModuleMetadata;h.moduleMetadataIntegration=mm.moduleMetadataIntegration;h.RequestData=Cm.RequestData;h.requestDataIntegration=Cm.requestDataIntegration;h.InboundFilters=bm.InboundFilters;h.inboundFiltersIntegration=bm.inboundFiltersIntegration;h.FunctionToString=hm.FunctionToString;h.functionToStringIntegration=hm.functionToStringIntegration;h.LinkedErrors=Bm.LinkedErrors;h.linkedErrorsIntegration=Bm.linkedErrorsIntegration;h.metrics=AR.metrics;h.Integrations=fR});var oe=d(ul=>{Object.defineProperty(ul,"__esModule",{value:!0});var SR=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__;ul.DEBUG_BUILD=SR});var at=d(dl=>{var{_optionalChain:Zm}=b();Object.defineProperty(dl,"__esModule",{value:!0});function WR(t){let e=Zm([t,"call",r=>r(),"access",r=>r.getClient,"call",r=>r(),"optionalAccess",r=>r.getOptions,"call",r=>r()]);return(Zm([e,"optionalAccess",r=>r.instrumenter])||"sentry")!=="sentry"}dl.shouldDisableAutoInstrumentation=WR});var fm=d(pr=>{var{_optionalChain:He}=b();Object.defineProperty(pr,"__esModule",{value:!0});var Il=W(),ne=b(),Bo=oe(),RR=at(),Zo=class t{static __initStatic(){this.id="Express"}constructor(e={}){this.name=t.id,this._router=e.router||e.app,this._methods=(Array.isArray(e.methods)?e.methods:[]).concat("use")}setupOnce(e,n){if(!this._router){Bo.DEBUG_BUILD&&ne.logger.error("ExpressIntegration is missing an Express instance");return}if(RR.shouldDisableAutoInstrumentation(n)){Bo.DEBUG_BUILD&&ne.logger.log("Express Integration is skipped because of instrumenter configuration.");return}vR(this._router,this._methods),_R(this._router)}};Zo.__initStatic();function Gm(t,e){let n=t.length;switch(n){case 2:return function(r,i){let o=i.__sentry_transaction;if(o){let s=o.startChild({description:t.name,op:`middleware.express.${e}`,origin:"auto.middleware.express"});i.once("finish",()=>{s.end()})}return t.call(this,r,i)};case 3:return function(r,i,o){let s=i.__sentry_transaction,a=He([s,"optionalAccess",c=>c.startChild,"call",c=>c({description:t.name,op:`middleware.express.${e}`,origin:"auto.middleware.express"})]);t.call(this,r,i,function(...c){He([a,"optionalAccess",l=>l.end,"call",l=>l()]),o.call(this,...c)})};case 4:return function(r,i,o,s){let a=o.__sentry_transaction,c=He([a,"optionalAccess",l=>l.startChild,"call",l=>l({description:t.name,op:`middleware.express.${e}`,origin:"auto.middleware.express"})]);t.call(this,r,i,o,function(...l){He([c,"optionalAccess",g=>g.end,"call",g=>g()]),s.call(this,...l)})};default:throw new Error(`Express middleware takes 2-4 arguments. Got: ${n}`)}}function VR(t,e){return t.map(n=>typeof n=="function"?Gm(n,e):Array.isArray(n)?n.map(r=>typeof r=="function"?Gm(r,e):r):n)}function HR(t,e){let n=t[e];return t[e]=function(...r){return n.call(this,...VR(r,e))},t}function vR(t,e=[]){e.forEach(n=>HR(t,n))}function _R(t){let e="settings"in t;e&&t._router===void 0&&t.lazyrouter&&t.lazyrouter();let n=e?t._router:t;if(!n){Bo.DEBUG_BUILD&&ne.logger.debug("Cannot instrument router for URL Parameterization (did not find a valid router)."),Bo.DEBUG_BUILD&&ne.logger.debug("Routing instrumentation is currently only supported in Express 4.");return}let r=Object.getPrototypeOf(n),i=r.process_params;r.process_params=function(s,a,c,l,g){c._reconstructedRoute||(c._reconstructedRoute="");let{layerRoutePath:u,isRegex:I,isArray:m,numExtraSegments:C}=NR(s);(u||I||m)&&(c._hasParameters=!0);let Z;u?Z=u:Z=Am(c.originalUrl,c._reconstructedRoute,s.path)||"";let B=Z.split("/").filter(R=>R.length>0&&(I||m||!R.includes("*"))).join("/");B&&B.length>0&&(c._reconstructedRoute+=`/${B}${I?"/":""}`);let S=ne.getNumberOfUrlSegments(ne.stripUrlQueryAndFragment(c.originalUrl||""))+C,X=ne.getNumberOfUrlSegments(c._reconstructedRoute);if(S===X){c._hasParameters||c._reconstructedRoute!==c.originalUrl&&(c._reconstructedRoute=c.originalUrl?ne.stripUrlQueryAndFragment(c.originalUrl):c.originalUrl);let R=l.__sentry_transaction,N=R&&Il.spanToJSON(R).data||{};if(R&&N[Il.SEMANTIC_ATTRIBUTE_SENTRY_SOURCE]!=="custom"){let _=c._reconstructedRoute||"/",[Y,pe]=ne.extractPathForTransaction(c,{path:!0,method:!0,customRoute:_});R.updateName(Y),R.setAttribute(Il.SEMANTIC_ATTRIBUTE_SENTRY_SOURCE,pe)}}return i.call(this,s,a,c,l,g)}}var ym=(t,e,n)=>{if(!t||!e||!n||Object.keys(n).length===0||!He([n,"access",l=>l[0],"optionalAccess",l=>l.offset]))return;let r=n.sort((l,g)=>l.offset-g.offset),o=new RegExp(e,`${e.flags}d`).exec(t);if(!o||!o.indices)return;let[,...s]=o.indices;if(s.length!==r.length)return;let a=t,c=0;return s.forEach((l,g)=>{if(l){let[u,I]=l,m=a.substring(0,u-c),C=`:${r[g].name}`,Z=a.substring(I-c);a=m+C+Z,c=c+(I-u-C.length)}}),a};function NR(t){let e=He([t,"access",s=>s.route,"optionalAccess",s=>s.path]),n=ne.isRegExp(e),r=Array.isArray(e);if(!e){let[s]=ne.GLOBAL_OBJ.process.versions.node.split(".").map(Number);s>=16&&(e=ym(t.path,t.regexp,t.keys))}if(!e)return{isRegex:n,isArray:r,numExtraSegments:0};let i=r?Math.max(ER(e)-ne.getNumberOfUrlSegments(t.path||""),0):0;return{layerRoutePath:YR(r,e),isRegex:n,isArray:r,numExtraSegments:i}}function ER(t){return t.reduce((e,n)=>e+ne.getNumberOfUrlSegments(n.toString()),0)}function YR(t,e){return t?e.map(n=>n.toString()).join(","):e&&e.toString()}function Am(t,e,n){let r=ne.stripUrlQueryAndFragment(t||""),i=He([r,"optionalAccess",c=>c.split,"call",c=>c("/"),"access",c=>c.filter,"call",c=>c(l=>!!l)]),o=0,s=He([e,"optionalAccess",c=>c.split,"call",c=>c("/"),"access",c=>c.filter,"call",c=>c(l=>!!l),"access",c=>c.length])||0;return He([n,"optionalAccess",c=>c.split,"call",c=>c("/"),"access",c=>c.filter,"call",c=>c(l=>He([i,"optionalAccess",g=>g[s+o]])===l?(o+=1,!0):!1),"access",c=>c.join,"call",c=>c("/")])}pr.Express=Zo;pr.extractOriginalRoute=ym;pr.preventDuplicateSegments=Am});var Sm=d(ml=>{var{_optionalChain:mn}=b();Object.defineProperty(ml,"__esModule",{value:!0});var Cn=b(),pl=oe(),XR=at(),Go=class t{static __initStatic(){this.id="Postgres"}constructor(e={}){this.name=t.id,this._usePgNative=!!e.usePgNative,this._module=e.module}loadDependency(){return this._module=this._module||Cn.loadModule("pg")}setupOnce(e,n){if(XR.shouldDisableAutoInstrumentation(n)){pl.DEBUG_BUILD&&Cn.logger.log("Postgres Integration is skipped because of instrumenter configuration.");return}let r=this.loadDependency();if(!r){pl.DEBUG_BUILD&&Cn.logger.error("Postgres Integration was unable to require `pg` package.");return}let i=this._usePgNative?mn([r,"access",o=>o.native,"optionalAccess",o=>o.Client]):r.Client;if(!i){pl.DEBUG_BUILD&&Cn.logger.error("Postgres Integration was unable to access 'pg-native' bindings.");return}Cn.fill(i.prototype,"query",function(o){return function(s,a,c){let g=n().getScope().getSpan(),u={"db.system":"postgresql"};try{this.database&&(u["db.name"]=this.database),this.host&&(u["server.address"]=this.host),this.port&&(u["server.port"]=this.port),this.user&&(u["db.user"]=this.user)}catch{}let I=mn([g,"optionalAccess",C=>C.startChild,"call",C=>C({description:typeof s=="string"?s:s.text,op:"db",origin:"auto.db.postgres",data:u})]);if(typeof c=="function")return o.call(this,s,a,function(C,Z){mn([I,"optionalAccess",B=>B.end,"call",B=>B()]),c(C,Z)});if(typeof a=="function")return o.call(this,s,function(C,Z){mn([I,"optionalAccess",B=>B.end,"call",B=>B()]),a(C,Z)});let m=typeof a<"u"?o.call(this,s,a):o.call(this,s);return Cn.isThenable(m)?m.then(C=>(mn([I,"optionalAccess",Z=>Z.end,"call",Z=>Z()]),C)):(mn([I,"optionalAccess",C=>C.end,"call",C=>C()]),m)}})}};Go.__initStatic();ml.Postgres=Go});var Wm=d(bl=>{var{_optionalChain:TR}=b();Object.defineProperty(bl,"__esModule",{value:!0});var mr=b(),Cl=oe(),FR=at(),yo=class t{static __initStatic(){this.id="Mysql"}constructor(){this.name=t.id}loadDependency(){return this._module=this._module||mr.loadModule("mysql/lib/Connection.js")}setupOnce(e,n){if(FR.shouldDisableAutoInstrumentation(n)){Cl.DEBUG_BUILD&&mr.logger.log("Mysql Integration is skipped because of instrumenter configuration.");return}let r=this.loadDependency();if(!r){Cl.DEBUG_BUILD&&mr.logger.error("Mysql Integration was unable to require `mysql` package.");return}let i;try{r.prototype.connect=new Proxy(r.prototype.connect,{apply(a,c,l){return i||(i=c.config),a.apply(c,l)}})}catch{Cl.DEBUG_BUILD&&mr.logger.error("Mysql Integration was unable to instrument `mysql` config.")}function o(){return i?{"server.address":i.host,"server.port":i.port,"db.user":i.user}:{}}function s(a){if(!a)return;let c=o();Object.keys(c).forEach(l=>{a.setAttribute(l,c[l])}),a.end()}mr.fill(r,"createQuery",function(a){return function(c,l,g){let I=n().getScope().getSpan(),m=TR([I,"optionalAccess",Z=>Z.startChild,"call",Z=>Z({description:typeof c=="string"?c:c.sql,op:"db",origin:"auto.db.mysql",data:{"db.system":"mysql"}})]);if(typeof g=="function")return a.call(this,c,l,function(Z,B,S){s(m),g(Z,B,S)});if(typeof l=="function")return a.call(this,c,function(Z,B,S){s(m),l(Z,B,S)});let C=a.call(this,c,l);return C.on("end",()=>{s(m)}),C}})}};yo.__initStatic();bl.Mysql=yo});var Vm=d(hl=>{var{_optionalChain:ct}=b();Object.defineProperty(hl,"__esModule",{value:!0});var Cr=b(),Rm=oe(),wR=at(),UR=["aggregate","bulkWrite","countDocuments","createIndex","createIndexes","deleteMany","deleteOne","distinct","drop","dropIndex","dropIndexes","estimatedDocumentCount","find","findOne","findOneAndDelete","findOneAndReplace","findOneAndUpdate","indexes","indexExists","indexInformation","initializeOrderedBulkOp","insertMany","insertOne","isCapped","mapReduce","options","parallelCollectionScan","rename","replaceOne","stats","updateMany","updateOne"],KR={bulkWrite:["operations"],countDocuments:["query"],createIndex:["fieldOrSpec"],createIndexes:["indexSpecs"],deleteMany:["filter"],deleteOne:["filter"],distinct:["key","query"],dropIndex:["indexName"],find:["query"],findOne:["query"],findOneAndDelete:["filter"],findOneAndReplace:["filter","replacement"],findOneAndUpdate:["filter","update"],indexExists:["indexes"],insertMany:["docs"],insertOne:["doc"],mapReduce:["map","reduce"],rename:["newName"],replaceOne:["filter","doc"],updateMany:["filter","update"],updateOne:["filter","update"]};function JR(t){return t&&typeof t=="object"&&t.once&&typeof t.once=="function"}var Ao=class t{static __initStatic(){this.id="Mongo"}constructor(e={}){this.name=t.id,this._operations=Array.isArray(e.operations)?e.operations:UR,this._describeOperations="describeOperations"in e?e.describeOperations:!0,this._useMongoose=!!e.useMongoose}loadDependency(){let e=this._useMongoose?"mongoose":"mongodb";return this._module=this._module||Cr.loadModule(e)}setupOnce(e,n){if(wR.shouldDisableAutoInstrumentation(n)){Rm.DEBUG_BUILD&&Cr.logger.log("Mongo Integration is skipped because of instrumenter configuration.");return}let r=this.loadDependency();if(!r){let i=this._useMongoose?"mongoose":"mongodb";Rm.DEBUG_BUILD&&Cr.logger.error(`Mongo Integration was unable to require \`${i}\` package.`);return}this._instrumentOperations(r.Collection,this._operations,n)}_instrumentOperations(e,n,r){n.forEach(i=>this._patchOperation(e,i,r))}_patchOperation(e,n,r){if(!(n in e.prototype))return;let i=this._getSpanContextFromOperationArguments.bind(this);Cr.fill(e.prototype,n,function(o){return function(...s){let a=s[s.length-1],c=r(),l=c.getScope(),g=c.getClient(),u=l.getSpan(),I=ct([g,"optionalAccess",C=>C.getOptions,"call",C=>C(),"access",C=>C.sendDefaultPii]);if(typeof a!="function"||n==="mapReduce"&&s.length===2){let C=ct([u,"optionalAccess",B=>B.startChild,"call",B=>B(i(this,n,s,I))]),Z=o.call(this,...s);if(Cr.isThenable(Z))return Z.then(B=>(ct([C,"optionalAccess",S=>S.end,"call",S=>S()]),B));if(JR(Z)){let B=Z;try{B.once("close",()=>{ct([C,"optionalAccess",S=>S.end,"call",S=>S()])})}catch{ct([C,"optionalAccess",X=>X.end,"call",X=>X()])}return B}else return ct([C,"optionalAccess",B=>B.end,"call",B=>B()]),Z}let m=ct([u,"optionalAccess",C=>C.startChild,"call",C=>C(i(this,n,s.slice(0,-1)))]);return o.call(this,...s.slice(0,-1),function(C,Z){ct([m,"optionalAccess",B=>B.end,"call",B=>B()]),a(C,Z)})}})}_getSpanContextFromOperationArguments(e,n,r,i=!1){let o={"db.system":"mongodb","db.name":e.dbName,"db.operation":n,"db.mongodb.collection":e.collectionName},s={op:"db",origin:"auto.db.mongo",description:n,data:o},a=KR[n],c=Array.isArray(this._describeOperations)?this._describeOperations.includes(n):this._describeOperations;if(!a||!c||!i)return s;try{if(n==="mapReduce"){let[l,g]=r;o[a[0]]=typeof l=="string"?l:l.name||"<anonymous>",o[a[1]]=typeof g=="string"?g:g.name||"<anonymous>"}else for(let l=0;l<a.length;l++)o[`db.mongodb.${a[l]}`]=JSON.stringify(r[l])}catch{}return s}};Ao.__initStatic();hl.Mongo=Ao});var _m=d(Bl=>{Object.defineProperty(Bl,"__esModule",{value:!0});var Hm=W(),vm=b(),kR=oe(),LR=at();function zR(t){return!!t&&!!t.$use}var fo=class t{static __initStatic(){this.id="Prisma"}constructor(e={}){if(this.name=t.id,zR(e.client)&&!e.client._sentryInstrumented){vm.addNonEnumerableProperty(e.client,"_sentryInstrumented",!0);let n={};try{let r=e.client._engineConfig;if(r){let{activeProvider:i,clientVersion:o}=r;i&&(n["db.system"]=i),o&&(n["db.prisma.version"]=o)}}catch{}e.client.$use((r,i)=>{if(LR.shouldDisableAutoInstrumentation(Hm.getCurrentHub))return i(r);let o=r.action,s=r.model;return Hm.startSpan({name:s?`${s} ${o}`:o,op:"db.prisma",origin:"auto.db.prisma",data:{...n,"db.operation":o}},()=>i(r))})}else kR.DEBUG_BUILD&&vm.logger.warn("Unsupported Prisma client provided to PrismaIntegration. Provided client:",e.client)}setupOnce(){}};fo.__initStatic();Bl.Prisma=fo});var Em=d(Zl=>{var{_optionalChain:bn}=b();Object.defineProperty(Zl,"__esModule",{value:!0});var br=b(),Nm=oe(),xR=at(),So=class t{static __initStatic(){this.id="GraphQL"}constructor(){this.name=t.id}loadDependency(){return this._module=this._module||br.loadModule("graphql/execution/execute.js")}setupOnce(e,n){if(xR.shouldDisableAutoInstrumentation(n)){Nm.DEBUG_BUILD&&br.logger.log("GraphQL Integration is skipped because of instrumenter configuration.");return}let r=this.loadDependency();if(!r){Nm.DEBUG_BUILD&&br.logger.error("GraphQL Integration was unable to require graphql/execution package.");return}br.fill(r,"execute",function(i){return function(...o){let s=n().getScope(),a=s.getSpan(),c=bn([a,"optionalAccess",g=>g.startChild,"call",g=>g({description:"execute",op:"graphql.execute",origin:"auto.graphql.graphql"})]);bn([s,"optionalAccess",g=>g.setSpan,"call",g=>g(c)]);let l=i.call(this,...o);return br.isThenable(l)?l.then(g=>(bn([c,"optionalAccess",u=>u.end,"call",u=>u()]),bn([s,"optionalAccess",u=>u.setSpan,"call",u=>u(a)]),g)):(bn([c,"optionalAccess",g=>g.end,"call",g=>g()]),bn([s,"optionalAccess",g=>g.setSpan,"call",g=>g(a)]),l)}})}};So.__initStatic();Zl.GraphQL=So});var Xm=d(yl=>{var{_optionalChain:Gl}=b();Object.defineProperty(yl,"__esModule",{value:!0});var D=b(),Wo=oe(),OR=at(),Ro=class t{static __initStatic(){this.id="Apollo"}constructor(e={useNestjs:!1}){this.name=t.id,this._useNest=!!e.useNestjs}loadDependency(){return this._useNest?this._module=this._module||D.loadModule("@nestjs/graphql"):this._module=this._module||D.loadModule("apollo-server-core"),this._module}setupOnce(e,n){if(OR.shouldDisableAutoInstrumentation(n)){Wo.DEBUG_BUILD&&D.logger.log("Apollo Integration is skipped because of instrumenter configuration.");return}if(this._useNest){let r=this.loadDependency();if(!r){Wo.DEBUG_BUILD&&D.logger.error("Apollo-NestJS Integration was unable to require @nestjs/graphql package.");return}D.fill(r.GraphQLFactory.prototype,"mergeWithSchema",function(i){return function(...o){return D.fill(this.resolversExplorerService,"explore",function(s){return function(){let a=D.arrayify(s.call(this));return Ym(a,n)}}),i.call(this,...o)}})}else{let r=this.loadDependency();if(!r){Wo.DEBUG_BUILD&&D.logger.error("Apollo Integration was unable to require apollo-server-core package.");return}D.fill(r.ApolloServerBase.prototype,"constructSchema",function(i){return function(){if(!this.config.resolvers)return Wo.DEBUG_BUILD&&(this.config.schema?(D.logger.warn("Apollo integration is not able to trace `ApolloServer` instances constructed via `schema` property.If you are using NestJS with Apollo, please use `Sentry.Integrations.Apollo({ useNestjs: true })` instead."),D.logger.warn()):this.config.modules&&D.logger.warn("Apollo integration is not able to trace `ApolloServer` instances constructed via `modules` property."),D.logger.error("Skipping tracing as no resolvers found on the `ApolloServer` instance.")),i.call(this);let o=D.arrayify(this.config.resolvers);return this.config.resolvers=Ym(o,n),i.call(this)}})}}};Ro.__initStatic();function Ym(t,e){return t.map(n=>(Object.keys(n).forEach(r=>{Object.keys(n[r]).forEach(i=>{typeof n[r][i]=="function"&&MR(n,r,i,e)})}),n))}function MR(t,e,n,r){D.fill(t[e],n,function(i){return function(...o){let a=r().getScope().getSpan(),c=Gl([a,"optionalAccess",g=>g.startChild,"call",g=>g({description:`${e}.${n}`,op:"graphql.resolve",origin:"auto.graphql.apollo"})]),l=i.call(this,...o);return D.isThenable(l)?l.then(g=>(Gl([c,"optionalAccess",u=>u.end,"call",u=>u()]),g)):(Gl([c,"optionalAccess",g=>g.end,"call",g=>g()]),l)}})}yl.Apollo=Ro});var Tm=d((Al,lt)=>{Object.defineProperty(Al,"__esModule",{value:!0});var vt=b(),DR=[()=>{let t=vt.dynamicRequire(lt,"./apollo");return new t.Apollo},()=>{let t=vt.dynamicRequire(lt,"./apollo");return new t.Apollo({useNestjs:!0})},()=>{let t=vt.dynamicRequire(lt,"./graphql");return new t.GraphQL},()=>{let t=vt.dynamicRequire(lt,"./mongo");return new t.Mongo},()=>{let t=vt.dynamicRequire(lt,"./mongo");return new t.Mongo({mongoose:!0})},()=>{let t=vt.dynamicRequire(lt,"./mysql");return new t.Mysql},()=>{let t=vt.dynamicRequire(lt,"./postgres");return new t.Postgres}];Al.lazyLoadedNodePerformanceMonitoringIntegrations=DR});var Pe=d(fl=>{Object.defineProperty(fl,"__esModule",{value:!0});var PR=b(),jR=PR.GLOBAL_OBJ;fl.WINDOW=jR});var Km=d(Sl=>{Object.defineProperty(Sl,"__esModule",{value:!0});var Fm=W(),wm=b(),Um=oe(),Vo=Pe();function QR(){Vo.WINDOW&&Vo.WINDOW.document?Vo.WINDOW.document.addEventListener("visibilitychange",()=>{let t=Fm.getActiveTransaction();if(Vo.WINDOW.document.hidden&&t){let e="cancelled",{op:n,status:r}=Fm.spanToJSON(t);Um.DEBUG_BUILD&&wm.logger.log(`[Tracing] Transaction: ${e} -> since tab moved to the background, op: ${n}`),r||t.setStatus(e),t.setTag("visibilitychange","document.hidden"),t.end()}}):Um.DEBUG_BUILD&&wm.logger.warn("[Tracing] Could not set up background tab detection due to lack of global document")}Sl.registerBackgroundTabDetection=QR});var Ho=d(Wl=>{Object.defineProperty(Wl,"__esModule",{value:!0});var qR=(t,e,n)=>{let r,i;return o=>{e.value>=0&&(o||n)&&(i=e.value-(r||0),(i||r===void 0)&&(r=e.value,e.delta=i,t(e)))}};Wl.bindReporter=qR});var Jm=d(Rl=>{Object.defineProperty(Rl,"__esModule",{value:!0});var $R=()=>`v3-${Date.now()}-${Math.floor(Math.random()*(9e12-1))+1e12}`;Rl.generateUniqueID=$R});var Hl=d(Vl=>{Object.defineProperty(Vl,"__esModule",{value:!0});var hr=Pe(),e0=()=>{let t=hr.WINDOW.performance.timing,e=hr.WINDOW.performance.navigation.type,n={entryType:"navigation",startTime:0,type:e==2?"back_forward":e===1?"reload":"navigate"};for(let r in t)r!=="navigationStart"&&r!=="toJSON"&&(n[r]=Math.max(t[r]-t.navigationStart,0));return n},t0=()=>hr.WINDOW.__WEB_VITALS_POLYFILL__?hr.WINDOW.performance&&(performance.getEntriesByType&&performance.getEntriesByType("navigation")[0]||e0()):hr.WINDOW.performance&&performance.getEntriesByType&&performance.getEntriesByType("navigation")[0];Vl.getNavigationEntry=t0});var _l=d(vl=>{Object.defineProperty(vl,"__esModule",{value:!0});var n0=Hl(),r0=()=>{let t=n0.getNavigationEntry();return t&&t.activationStart||0};vl.getActivationStart=r0});var vo=d(Nl=>{Object.defineProperty(Nl,"__esModule",{value:!0});var i0=Pe(),o0=Jm(),s0=_l(),a0=Hl(),c0=(t,e)=>{let n=a0.getNavigationEntry(),r="navigate";return n&&(i0.WINDOW.document.prerendering||s0.getActivationStart()>0?r="prerender":r=n.type.replace(/_/g,"-")),{name:t,value:typeof e>"u"?-1:e,rating:"good",delta:0,entries:[],id:o0.generateUniqueID(),navigationType:r}};Nl.initMetric=c0});var Br=d(El=>{Object.defineProperty(El,"__esModule",{value:!0});var l0=(t,e,n)=>{try{if(PerformanceObserver.supportedEntryTypes.includes(t)){let r=new PerformanceObserver(i=>{e(i.getEntries())});return r.observe(Object.assign({type:t,buffered:!0},n||{})),r}}catch{}};El.observe=l0});var Zr=d(Yl=>{Object.defineProperty(Yl,"__esModule",{value:!0});var g0=Pe(),u0=(t,e)=>{let n=r=>{(r.type==="pagehide"||g0.WINDOW.document.visibilityState==="hidden")&&(t(r),e&&(removeEventListener("visibilitychange",n,!0),removeEventListener("pagehide",n,!0)))};addEventListener("visibilitychange",n,!0),addEventListener("pagehide",n,!0)};Yl.onHidden=u0});var km=d(Xl=>{Object.defineProperty(Xl,"__esModule",{value:!0});var d0=Ho(),I0=vo(),p0=Br(),m0=Zr(),C0=t=>{let e=I0.initMetric("CLS",0),n,r=0,i=[],o=a=>{a.forEach(c=>{if(!c.hadRecentInput){let l=i[0],g=i[i.length-1];r&&i.length!==0&&c.startTime-g.startTime<1e3&&c.startTime-l.startTime<5e3?(r+=c.value,i.push(c)):(r=c.value,i=[c]),r>e.value&&(e.value=r,e.entries=i,n&&n())}})},s=p0.observe("layout-shift",o);if(s){n=d0.bindReporter(t,e);let a=()=>{o(s.takeRecords()),n(!0)};return m0.onHidden(a),a}};Xl.onCLS=C0});var No=d(Tl=>{Object.defineProperty(Tl,"__esModule",{value:!0});var Lm=Pe(),b0=Zr(),_o=-1,h0=()=>Lm.WINDOW.document.visibilityState==="hidden"&&!Lm.WINDOW.document.prerendering?0:1/0,B0=()=>{b0.onHidden(({timeStamp:t})=>{_o=t},!0)},Z0=()=>(_o<0&&(_o=h0(),B0()),{get firstHiddenTime(){return _o}});Tl.getVisibilityWatcher=Z0});var zm=d(Fl=>{Object.defineProperty(Fl,"__esModule",{value:!0});var G0=Ho(),y0=No(),A0=vo(),f0=Br(),S0=Zr(),W0=t=>{let e=y0.getVisibilityWatcher(),n=A0.initMetric("FID"),r,i=a=>{a.startTime<e.firstHiddenTime&&(n.value=a.processingStart-a.startTime,n.entries.push(a),r(!0))},o=a=>{a.forEach(i)},s=f0.observe("first-input",o);r=G0.bindReporter(t,n),s&&S0.onHidden(()=>{o(s.takeRecords()),s.disconnect()},!0)};Fl.onFID=W0});var Om=d(wl=>{Object.defineProperty(wl,"__esModule",{value:!0});var R0=Ho(),V0=_l(),H0=No(),v0=vo(),_0=Br(),N0=Zr(),xm={},E0=t=>{let e=H0.getVisibilityWatcher(),n=v0.initMetric("LCP"),r,i=s=>{let a=s[s.length-1];if(a){let c=Math.max(a.startTime-V0.getActivationStart(),0);c<e.firstHiddenTime&&(n.value=c,n.entries=[a],r())}},o=_0.observe("largest-contentful-paint",i);if(o){r=R0.bindReporter(t,n);let s=()=>{xm[n.id]||(i(o.takeRecords()),o.disconnect(),xm[n.id]=!0,r(!0))};return["keydown","click"].forEach(a=>{addEventListener(a,s,{once:!0,capture:!0})}),N0.onHidden(s,!0),s}};wl.onLCP=E0});var Xo=d(hn=>{Object.defineProperty(hn,"__esModule",{value:!0});var Mm=b(),Y0=oe(),X0=km(),T0=zm(),F0=Om(),w0=Br(),Gr={},Eo={},Dm,Pm,jm;function U0(t){return Ul("cls",t,L0,Dm)}function K0(t){return Ul("lcp",t,x0,jm)}function J0(t){return Ul("fid",t,z0,Pm)}function k0(t,e){return Qm(t,e),Eo[t]||(O0(t),Eo[t]=!0),qm(t,e)}function Yo(t,e){let n=Gr[t];if(!(!n||!n.length))for(let r of n)try{r(e)}catch(i){Y0.DEBUG_BUILD&&Mm.logger.error(`Error while triggering instrumentation handler.
Type: ${t}
Name: ${Mm.getFunctionName(r)}
Error:`,i)}}function L0(){X0.onCLS(t=>{Yo("cls",{metric:t}),Dm=t})}function z0(){T0.onFID(t=>{Yo("fid",{metric:t}),Pm=t})}function x0(){F0.onLCP(t=>{Yo("lcp",{metric:t}),jm=t})}function Ul(t,e,n,r){return Qm(t,e),Eo[t]||(n(),Eo[t]=!0),r&&e({metric:r}),qm(t,e)}function O0(t){let e={};t==="event"&&(e.durationThreshold=0),w0.observe(t,n=>{Yo(t,{entries:n})},e)}function Qm(t,e){Gr[t]=Gr[t]||[],Gr[t].push(e)}function qm(t,e){return()=>{let n=Gr[t];if(!n)return;let r=n.indexOf(e);r!==-1&&n.splice(r,1)}}hn.addClsInstrumentationHandler=U0;hn.addFidInstrumentationHandler=J0;hn.addLcpInstrumentationHandler=K0;hn.addPerformanceInstrumentationHandler=k0});var $m=d(To=>{Object.defineProperty(To,"__esModule",{value:!0});function M0(t){return typeof t=="number"&&isFinite(t)}function D0(t,{startTimestamp:e,...n}){return e&&t.startTimestamp>e&&(t.startTimestamp=e),t.startChild({startTimestamp:e,...n})}To._startChild=D0;To.isMeasurementValue=M0});var iC=d(ut=>{Object.defineProperty(ut,"__esModule",{value:!0});var wo=W(),U=b(),_e=oe(),Ar=Xo(),gt=Pe(),P0=No(),je=$m(),j0=2147483647;function k(t){return t/1e3}function tC(){return gt.WINDOW&&gt.WINDOW.addEventListener&&gt.WINDOW.performance}var eC=0,F={},ve,yr;function Q0(){let t=tC();if(t&&U.browserPerformanceTimeOrigin){t.mark&&gt.WINDOW.performance.mark("sentry-tracing-init");let e=nV(),n=eV(),r=tV();return()=>{e(),n(),r()}}return()=>{}}function q0(){Ar.addPerformanceInstrumentationHandler("longtask",({entries:t})=>{for(let e of t){let n=wo.getActiveTransaction();if(!n)return;let r=k(U.browserPerformanceTimeOrigin+e.startTime),i=k(e.duration);n.startChild({description:"Main UI thread blocked",op:"ui.long-task",origin:"auto.ui.browser.metrics",startTimestamp:r,endTimestamp:r+i})}})}function $0(){Ar.addPerformanceInstrumentationHandler("event",({entries:t})=>{for(let e of t){let n=wo.getActiveTransaction();if(!n)return;if(e.name==="click"){let r=k(U.browserPerformanceTimeOrigin+e.startTime),i=k(e.duration),o={description:U.htmlTreeAsString(e.target),op:`ui.interaction.${e.name}`,origin:"auto.ui.browser.metrics",startTimestamp:r,endTimestamp:r+i},s=U.getComponentName(e.target);s&&(o.attributes={"ui.component_name":s}),n.startChild(o)}}})}function eV(){return Ar.addClsInstrumentationHandler(({metric:t})=>{let e=t.entries.pop();e&&(_e.DEBUG_BUILD&&U.logger.log("[Measurements] Adding CLS"),F.cls={value:t.value,unit:""},yr=e)})}function tV(){return Ar.addLcpInstrumentationHandler(({metric:t})=>{let e=t.entries.pop();e&&(_e.DEBUG_BUILD&&U.logger.log("[Measurements] Adding LCP"),F.lcp={value:t.value,unit:"millisecond"},ve=e)})}function nV(){return Ar.addFidInstrumentationHandler(({metric:t})=>{let e=t.entries.pop();if(!e)return;let n=k(U.browserPerformanceTimeOrigin),r=k(e.startTime);_e.DEBUG_BUILD&&U.logger.log("[Measurements] Adding FID"),F.fid={value:t.value,unit:"millisecond"},F["mark.fid"]={value:n+r,unit:"second"}})}function rV(t){let e=tC();if(!e||!gt.WINDOW.performance.getEntries||!U.browserPerformanceTimeOrigin)return;_e.DEBUG_BUILD&&U.logger.log("[Tracing] Adding & adjusting spans using Performance API");let n=k(U.browserPerformanceTimeOrigin),r=e.getEntries(),i,o,{op:s,start_timestamp:a}=wo.spanToJSON(t);if(r.slice(eC).forEach(c=>{let l=k(c.startTime),g=k(c.duration);if(!(t.op==="navigation"&&a&&n+l<a))switch(c.entryType){case"navigation":{iV(t,c,n),i=n+k(c.responseStart),o=n+k(c.requestStart);break}case"mark":case"paint":case"measure":{nC(t,c,l,g,n);let u=P0.getVisibilityWatcher(),I=c.startTime<u.firstHiddenTime;c.name==="first-paint"&&I&&(_e.DEBUG_BUILD&&U.logger.log("[Measurements] Adding FP"),F.fp={value:c.startTime,unit:"millisecond"}),c.name==="first-contentful-paint"&&I&&(_e.DEBUG_BUILD&&U.logger.log("[Measurements] Adding FCP"),F.fcp={value:c.startTime,unit:"millisecond"});break}case"resource":{rC(t,c,c.name,l,g,n);break}}}),eC=Math.max(r.length-1,0),sV(t),s==="pageload"){typeof i=="number"&&a&&(_e.DEBUG_BUILD&&U.logger.log("[Measurements] Adding TTFB"),F.ttfb={value:(i-a)*1e3,unit:"millisecond"},typeof o=="number"&&o<=i&&(F["ttfb.requestTime"]={value:(i-o)*1e3,unit:"millisecond"})),["fcp","fp","lcp"].forEach(l=>{if(!F[l]||!a||n>=a)return;let g=F[l].value,u=n+k(g),I=Math.abs((u-a)*1e3),m=I-g;_e.DEBUG_BUILD&&U.logger.log(`[Measurements] Normalized ${l} from ${g} to ${I} (${m})`),F[l].value=I});let c=F["mark.fid"];c&&F.fid&&(je._startChild(t,{description:"first input delay",endTimestamp:c.value+k(F.fid.value),op:"ui.action",origin:"auto.ui.browser.metrics",startTimestamp:c.value}),delete F["mark.fid"]),"fcp"in F||delete F.cls,Object.keys(F).forEach(l=>{wo.setMeasurement(l,F[l].value,F[l].unit)}),aV(t)}ve=void 0,yr=void 0,F={}}function nC(t,e,n,r,i){let o=i+n,s=o+r;return je._startChild(t,{description:e.name,endTimestamp:s,op:e.entryType,origin:"auto.resource.browser.metrics",startTimestamp:o}),o}function iV(t,e,n){["unloadEvent","redirect","domContentLoadedEvent","loadEvent","connect"].forEach(r=>{Fo(t,e,r,n)}),Fo(t,e,"secureConnection",n,"TLS/SSL","connectEnd"),Fo(t,e,"fetch",n,"cache","domainLookupStart"),Fo(t,e,"domainLookup",n,"DNS"),oV(t,e,n)}function Fo(t,e,n,r,i,o){let s=o?e[o]:e[`${n}End`],a=e[`${n}Start`];!a||!s||je._startChild(t,{op:"browser",origin:"auto.browser.browser.metrics",description:i||n,startTimestamp:r+k(a),endTimestamp:r+k(s)})}function oV(t,e,n){e.responseEnd&&(je._startChild(t,{op:"browser",origin:"auto.browser.browser.metrics",description:"request",startTimestamp:n+k(e.requestStart),endTimestamp:n+k(e.responseEnd)}),je._startChild(t,{op:"browser",origin:"auto.browser.browser.metrics",description:"response",startTimestamp:n+k(e.responseStart),endTimestamp:n+k(e.responseEnd)}))}function rC(t,e,n,r,i,o){if(e.initiatorType==="xmlhttprequest"||e.initiatorType==="fetch")return;let s=U.parseUrl(n),a={};Kl(a,e,"transferSize","http.response_transfer_size"),Kl(a,e,"encodedBodySize","http.response_content_length"),Kl(a,e,"decodedBodySize","http.decoded_response_content_length"),"renderBlockingStatus"in e&&(a["resource.render_blocking_status"]=e.renderBlockingStatus),s.protocol&&(a["url.scheme"]=s.protocol.split(":").pop()),s.host&&(a["server.address"]=s.host),a["url.same_origin"]=n.includes(gt.WINDOW.location.origin);let c=o+r,l=c+i;je._startChild(t,{description:n.replace(gt.WINDOW.location.origin,""),endTimestamp:l,op:e.initiatorType?`resource.${e.initiatorType}`:"resource.other",origin:"auto.resource.browser.metrics",startTimestamp:c,data:a})}function sV(t){let e=gt.WINDOW.navigator;if(!e)return;let n=e.connection;n&&(n.effectiveType&&t.setTag("effectiveConnectionType",n.effectiveType),n.type&&t.setTag("connectionType",n.type),je.isMeasurementValue(n.rtt)&&(F["connection.rtt"]={value:n.rtt,unit:"millisecond"})),je.isMeasurementValue(e.deviceMemory)&&t.setTag("deviceMemory",`${e.deviceMemory} GB`),je.isMeasurementValue(e.hardwareConcurrency)&&t.setTag("hardwareConcurrency",String(e.hardwareConcurrency))}function aV(t){ve&&(_e.DEBUG_BUILD&&U.logger.log("[Measurements] Adding LCP Data"),ve.element&&t.setTag("lcp.element",U.htmlTreeAsString(ve.element)),ve.id&&t.setTag("lcp.id",ve.id),ve.url&&t.setTag("lcp.url",ve.url.trim().slice(0,200)),t.setTag("lcp.size",ve.size)),yr&&yr.sources&&(_e.DEBUG_BUILD&&U.logger.log("[Measurements] Adding CLS Data"),yr.sources.forEach((e,n)=>t.setTag(`cls.source.${n+1}`,U.htmlTreeAsString(e.node))))}function Kl(t,e,n,r){let i=e[n];i!=null&&i<j0&&(t[r]=i)}ut._addMeasureSpans=nC;ut._addResourceSpans=rC;ut.addPerformanceEntries=rV;ut.startTrackingInteractions=$0;ut.startTrackingLongTasks=q0;ut.startTrackingWebVitals=Q0});var Jl=d(Uo=>{Object.defineProperty(Uo,"__esModule",{value:!0});var dt=W(),Bn=b();function cV(t,e,n,r,i="auto.http.browser"){if(!dt.hasTracingEnabled()||!t.fetchData)return;let o=e(t.fetchData.url);if(t.endTimestamp&&o){let I=t.fetchData.__span;if(!I)return;let m=r[I];if(m){if(t.response){m.setHttpStatus(t.response.status);let C=t.response&&t.response.headers&&t.response.headers.get("content-length");if(C){let Z=parseInt(C);Z>0&&m.setAttribute("http.response_content_length",Z)}}else t.error&&m.setStatus("internal_error");m.end(),delete r[I]}return}let s=dt.getCurrentScope(),a=dt.getClient(),c=dt.getActiveSpan(),{method:l,url:g}=t.fetchData,u=o&&c?c.startChild({data:{url:g,type:"fetch","http.method":l},description:`${l} ${g}`,op:"http.client",origin:i}):void 0;if(u&&(t.fetchData.__span=u.spanContext().spanId,r[u.spanContext().spanId]=u),n(t.fetchData.url)&&a){let I=t.args[0];t.args[1]=t.args[1]||{};let m=t.args[1];m.headers=oC(I,a,s,m,u)}return u}function oC(t,e,n,r,i){let o=i||n.getSpan(),s=o&&dt.getRootSpan(o),{traceId:a,sampled:c,dsc:l}=n.getPropagationContext(),g=o?dt.spanToTraceHeader(o):Bn.generateSentryTraceHeader(a,void 0,c),u=s?dt.getDynamicSamplingContextFromSpan(s):l||dt.getDynamicSamplingContextFromClient(a,e,n),I=Bn.dynamicSamplingContextToSentryBaggageHeader(u),m=r.headers||(typeof Request<"u"&&Bn.isInstanceOf(t,Request)?t.headers:void 0);if(m)if(typeof Headers<"u"&&Bn.isInstanceOf(m,Headers)){let C=new Headers(m);return C.append("sentry-trace",g),I&&C.append(Bn.BAGGAGE_HEADER_NAME,I),C}else if(Array.isArray(m)){let C=[...m,["sentry-trace",g]];return I&&C.push([Bn.BAGGAGE_HEADER_NAME,I]),C}else{let C="baggage"in m?m.baggage:void 0,Z=[];return Array.isArray(C)?Z.push(...C):C&&Z.push(C),I&&Z.push(I),{...m,"sentry-trace":g,baggage:Z.length>0?Z.join(","):void 0}}else return{"sentry-trace":g,baggage:I}}Uo.addTracingHeadersToFetchRequest=oC;Uo.instrumentFetchRequest=cV});var Ll=d(It=>{Object.defineProperty(It,"__esModule",{value:!0});var Qe=W(),Ee=b(),lV=Jl(),gV=Xo(),Ko=["localhost",/^\/(?!\/)/],kl={traceFetch:!0,traceXHR:!0,enableHTTPTimings:!0,tracingOrigins:Ko,tracePropagationTargets:Ko};function uV(t){let{traceFetch:e,traceXHR:n,tracePropagationTargets:r,tracingOrigins:i,shouldCreateSpanForRequest:o,enableHTTPTimings:s}={traceFetch:kl.traceFetch,traceXHR:kl.traceXHR,...t},a=typeof o=="function"?o:g=>!0,c=g=>lC(g,r||i),l={};e&&Ee.addFetchInstrumentationHandler(g=>{let u=lV.instrumentFetchRequest(g,a,c,l);s&&u&&sC(u)}),n&&Ee.addXhrInstrumentationHandler(g=>{let u=gC(g,a,c,l);s&&u&&sC(u)})}function dV(t){return t.entryType==="resource"&&"initiatorType"in t&&typeof t.nextHopProtocol=="string"&&(t.initiatorType==="fetch"||t.initiatorType==="xmlhttprequest")}function sC(t){let{url:e}=Qe.spanToJSON(t).data||{};if(!e||typeof e!="string")return;let n=gV.addPerformanceInstrumentationHandler("resource",({entries:r})=>{r.forEach(i=>{dV(i)&&i.name.endsWith(e)&&(IV(i).forEach(s=>t.setAttribute(...s)),setTimeout(n))})})}function cC(t){let e="unknown",n="unknown",r="";for(let i of t){if(i==="/"){[e,n]=t.split("/");break}if(!isNaN(Number(i))){e=r==="h"?"http":r,n=t.split(r)[1];break}r+=i}return r===t&&(e=r),{name:e,version:n}}function Ne(t=0){return((Ee.browserPerformanceTimeOrigin||performance.timeOrigin)+t)/1e3}function IV(t){let{name:e,version:n}=cC(t.nextHopProtocol),r=[];return r.push(["network.protocol.version",n],["network.protocol.name",e]),Ee.browserPerformanceTimeOrigin?[...r,["http.request.redirect_start",Ne(t.redirectStart)],["http.request.fetch_start",Ne(t.fetchStart)],["http.request.domain_lookup_start",Ne(t.domainLookupStart)],["http.request.domain_lookup_end",Ne(t.domainLookupEnd)],["http.request.connect_start",Ne(t.connectStart)],["http.request.secure_connection_start",Ne(t.secureConnectionStart)],["http.request.connection_end",Ne(t.connectEnd)],["http.request.request_start",Ne(t.requestStart)],["http.request.response_start",Ne(t.responseStart)],["http.request.response_end",Ne(t.responseEnd)]]:r}function lC(t,e){return Ee.stringMatchesSomePattern(t,e||Ko)}function gC(t,e,n,r){let i=t.xhr,o=i&&i[Ee.SENTRY_XHR_DATA_KEY];if(!Qe.hasTracingEnabled()||!i||i.__sentry_own_request__||!o)return;let s=e(o.url);if(t.endTimestamp&&s){let g=i.__sentry_xhr_span_id__;if(!g)return;let u=r[g];u&&o.status_code!==void 0&&(u.setHttpStatus(o.status_code),u.end(),delete r[g]);return}let a=Qe.getCurrentScope(),c=Qe.getActiveSpan(),l=s&&c?c.startChild({data:{type:"xhr","http.method":o.method,url:o.url},description:`${o.method} ${o.url}`,op:"http.client",origin:"auto.http.browser"}):void 0;if(l&&(i.__sentry_xhr_span_id__=l.spanContext().spanId,r[i.__sentry_xhr_span_id__]=l),i.setRequestHeader&&n(o.url))if(l){let g=l&&Qe.getRootSpan(l),u=g&&Qe.getDynamicSamplingContextFromSpan(g),I=Ee.dynamicSamplingContextToSentryBaggageHeader(u);aC(i,Qe.spanToTraceHeader(l),I)}else{let g=Qe.getClient(),{traceId:u,sampled:I,dsc:m}=a.getPropagationContext(),C=Ee.generateSentryTraceHeader(u,void 0,I),Z=m||(g?Qe.getDynamicSamplingContextFromClient(u,g,a):void 0),B=Ee.dynamicSamplingContextToSentryBaggageHeader(Z);aC(i,C,B)}return l}function aC(t,e,n){try{t.setRequestHeader("sentry-trace",e),n&&t.setRequestHeader(Ee.BAGGAGE_HEADER_NAME,n)}catch{}}It.DEFAULT_TRACE_PROPAGATION_TARGETS=Ko;It.defaultRequestInstrumentationOptions=kl;It.extractNetworkProtocol=cC;It.instrumentOutgoingRequests=uV;It.shouldAttachHeaders=lC;It.xhrCallback=gC});var dC=d(zl=>{Object.defineProperty(zl,"__esModule",{value:!0});var fr=b(),uC=oe(),Sr=Pe();function pV(t,e=!0,n=!0){if(!Sr.WINDOW||!Sr.WINDOW.location){uC.DEBUG_BUILD&&fr.logger.warn("Could not initialize routing instrumentation due to invalid location");return}let r=Sr.WINDOW.location.href,i;e&&(i=t({name:Sr.WINDOW.location.pathname,startTimestamp:fr.browserPerformanceTimeOrigin?fr.browserPerformanceTimeOrigin/1e3:void 0,op:"pageload",origin:"auto.pageload.browser",metadata:{source:"url"}})),n&&fr.addHistoryInstrumentationHandler(({to:o,from:s})=>{if(s===void 0&&r&&r.indexOf(o)!==-1){r=void 0;return}s!==o&&(r=void 0,i&&(uC.DEBUG_BUILD&&fr.logger.log(`[Tracing] Finishing current transaction with op: ${i.op}`),i.end()),i=t({name:Sr.WINDOW.location.pathname,op:"navigation",origin:"auto.navigation.browser",metadata:{source:"url"}}))})}zl.instrumentRoutingWithDefaults=pV});var mC=d(Rr=>{Object.defineProperty(Rr,"__esModule",{value:!0});var mt=W(),qe=b(),pt=oe(),mV=Km(),Jo=iC(),IC=Ll(),CV=dC(),Wr=Pe(),pC="BrowserTracing",bV={...mt.TRACING_DEFAULTS,markBackgroundTransactions:!0,routingInstrumentation:CV.instrumentRoutingWithDefaults,startTransactionOnLocationChange:!0,startTransactionOnPageLoad:!0,enableLongTask:!0,_experiments:{},...IC.defaultRequestInstrumentationOptions},xl=class{constructor(e){this.name=pC,this._hasSetTracePropagationTargets=!1,mt.addTracingExtensions(),pt.DEBUG_BUILD&&(this._hasSetTracePropagationTargets=!!(e&&(e.tracePropagationTargets||e.tracingOrigins))),this.options={...bV,...e},this.options._experiments.enableLongTask!==void 0&&(this.options.enableLongTask=this.options._experiments.enableLongTask),e&&!e.tracePropagationTargets&&e.tracingOrigins&&(this.options.tracePropagationTargets=e.tracingOrigins),this._collectWebVitals=Jo.startTrackingWebVitals(),this.options.enableLongTask&&Jo.startTrackingLongTasks(),this.options._experiments.enableInteractions&&Jo.startTrackingInteractions()}setupOnce(e,n){this._getCurrentHub=n;let i=n().getClient(),o=i&&i.getOptions(),{routingInstrumentation:s,startTransactionOnLocationChange:a,startTransactionOnPageLoad:c,markBackgroundTransactions:l,traceFetch:g,traceXHR:u,shouldCreateSpanForRequest:I,enableHTTPTimings:m,_experiments:C}=this.options,Z=o&&o.tracePropagationTargets,B=Z||this.options.tracePropagationTargets;pt.DEBUG_BUILD&&this._hasSetTracePropagationTargets&&Z&&qe.logger.warn("[Tracing] The `tracePropagationTargets` option was set in the BrowserTracing integration and top level `Sentry.init`. The top level `Sentry.init` value is being used."),s(S=>{let X=this._createRouteTransaction(S);return this.options._experiments.onStartRouteTransaction&&this.options._experiments.onStartRouteTransaction(X,S,n),X},c,a),l&&mV.registerBackgroundTabDetection(),C.enableInteractions&&this._registerInteractionListener(),IC.instrumentOutgoingRequests({traceFetch:g,traceXHR:u,tracePropagationTargets:B,shouldCreateSpanForRequest:I,enableHTTPTimings:m})}_createRouteTransaction(e){if(!this._getCurrentHub){pt.DEBUG_BUILD&&qe.logger.warn(`[Tracing] Did not create ${e.op} transaction because _getCurrentHub is invalid.`);return}let n=this._getCurrentHub(),{beforeNavigate:r,idleTimeout:i,finalTimeout:o,heartbeatInterval:s}=this.options,a=e.op==="pageload",c=a?Ol("sentry-trace"):"",l=a?Ol("baggage"):"",{traceparentData:g,dynamicSamplingContext:u,propagationContext:I}=qe.tracingContextFromHeaders(c,l),m={...e,...g,metadata:{...e.metadata,dynamicSamplingContext:g&&!u?{}:u},trimEnd:!0},C=typeof r=="function"?r(m):m,Z=C===void 0?{...m,sampled:!1}:C;Z.metadata=Z.name!==m.name?{...Z.metadata,source:"custom"}:Z.metadata,this._latestRouteName=Z.name;let B=e.data&&e.data[mt.SEMANTIC_ATTRIBUTE_SENTRY_SOURCE],S=Z.metadata&&Z.metadata.source;this._latestRouteSource=B||S,Z.sampled===!1&&pt.DEBUG_BUILD&&qe.logger.log(`[Tracing] Will not send ${Z.op} transaction because of beforeNavigate.`),pt.DEBUG_BUILD&&qe.logger.log(`[Tracing] Starting ${Z.op} transaction on scope`);let{location:X}=Wr.WINDOW,R=mt.startIdleTransaction(n,Z,i,o,!0,{location:X},s,a);a&&(Wr.WINDOW.document.addEventListener("readystatechange",()=>{["interactive","complete"].includes(Wr.WINDOW.document.readyState)&&R.sendAutoFinishSignal()}),["interactive","complete"].includes(Wr.WINDOW.document.readyState)&&R.sendAutoFinishSignal());let N=n.getScope();return a&&g?N.setPropagationContext(I):N.setPropagationContext({traceId:R.spanContext().traceId,spanId:R.spanContext().spanId,parentSpanId:R.parentSpanId,sampled:mt.spanIsSampled(R)}),R.registerBeforeFinishCallback(_=>{this._collectWebVitals(),Jo.addPerformanceEntries(_)}),R}_registerInteractionListener(){let e,n=()=>{let{idleTimeout:r,finalTimeout:i,heartbeatInterval:o}=this.options,s="ui.action.click",a=mt.getActiveTransaction();if(a&&a.op&&["navigation","pageload"].includes(a.op)){pt.DEBUG_BUILD&&qe.logger.warn(`[Tracing] Did not create ${s} transaction because a pageload or navigation transaction is in progress.`);return}if(e&&(e.setFinishReason("interactionInterrupted"),e.end(),e=void 0),!this._getCurrentHub){pt.DEBUG_BUILD&&qe.logger.warn(`[Tracing] Did not create ${s} transaction because _getCurrentHub is invalid.`);return}if(!this._latestRouteName){pt.DEBUG_BUILD&&qe.logger.warn(`[Tracing] Did not create ${s} transaction because _latestRouteName is missing.`);return}let c=this._getCurrentHub(),{location:l}=Wr.WINDOW,g={name:this._latestRouteName,op:s,trimEnd:!0,data:{[mt.SEMANTIC_ATTRIBUTE_SENTRY_SOURCE]:this._latestRouteSource||"url"}};e=mt.startIdleTransaction(c,g,r,i,!0,{location:l},o)};["click"].forEach(r=>{addEventListener(r,n,{once:!1,capture:!0})})}};function Ol(t){let e=qe.getDomElement(`meta[name=${t}]`);return e?e.getAttribute("content"):void 0}Rr.BROWSER_TRACING_INTEGRATION_ID=pC;Rr.BrowserTracing=xl;Rr.getMetaContent=Ol});var bC=d((Ml,Vr)=>{Object.defineProperty(Ml,"__esModule",{value:!0});var CC=W(),Zn=b();function hV(){let t=CC.getMainCarrier();if(!t.__SENTRY__)return;let e={mongodb(){let r=Zn.dynamicRequire(Vr,"./node/integrations/mongo");return new r.Mongo},mongoose(){let r=Zn.dynamicRequire(Vr,"./node/integrations/mongo");return new r.Mongo},mysql(){let r=Zn.dynamicRequire(Vr,"./node/integrations/mysql");return new r.Mysql},pg(){let r=Zn.dynamicRequire(Vr,"./node/integrations/postgres");return new r.Postgres}},n=Object.keys(e).filter(r=>!!Zn.loadModule(r)).map(r=>{try{return e[r]()}catch{return}}).filter(r=>r);n.length>0&&(t.__SENTRY__.integrations=[...t.__SENTRY__.integrations||[],...n])}function BV(){CC.addTracingExtensions(),Zn.isNodeEnv()&&hV()}Ml.addExtensionMethods=BV});var Dl=d(H=>{Object.defineProperty(H,"__esModule",{value:!0});var $e=W(),hC=b(),ZV=fm(),GV=Sm(),yV=Wm(),AV=Vm(),fV=_m(),SV=Em(),WV=Xm(),RV=Tm(),BC=mC(),ZC=Ll(),ko=Xo(),GC=Jl(),VV=bC();H.IdleTransaction=$e.IdleTransaction;H.Span=$e.Span;H.SpanStatus=$e.SpanStatus;H.Transaction=$e.Transaction;H.extractTraceparentData=$e.extractTraceparentData;H.getActiveTransaction=$e.getActiveTransaction;H.hasTracingEnabled=$e.hasTracingEnabled;H.spanStatusfromHttpCode=$e.spanStatusfromHttpCode;H.startIdleTransaction=$e.startIdleTransaction;H.TRACEPARENT_REGEXP=hC.TRACEPARENT_REGEXP;H.stripUrlQueryAndFragment=hC.stripUrlQueryAndFragment;H.Express=ZV.Express;H.Postgres=GV.Postgres;H.Mysql=yV.Mysql;H.Mongo=AV.Mongo;H.Prisma=fV.Prisma;H.GraphQL=SV.GraphQL;H.Apollo=WV.Apollo;H.lazyLoadedNodePerformanceMonitoringIntegrations=RV.lazyLoadedNodePerformanceMonitoringIntegrations;H.BROWSER_TRACING_INTEGRATION_ID=BC.BROWSER_TRACING_INTEGRATION_ID;H.BrowserTracing=BC.BrowserTracing;H.defaultRequestInstrumentationOptions=ZC.defaultRequestInstrumentationOptions;H.instrumentOutgoingRequests=ZC.instrumentOutgoingRequests;H.addClsInstrumentationHandler=ko.addClsInstrumentationHandler;H.addFidInstrumentationHandler=ko.addFidInstrumentationHandler;H.addLcpInstrumentationHandler=ko.addLcpInstrumentationHandler;H.addPerformanceInstrumentationHandler=ko.addPerformanceInstrumentationHandler;H.addTracingHeadersToFetchRequest=GC.addTracingHeadersToFetchRequest;H.instrumentFetchRequest=GC.instrumentFetchRequest;H.addExtensionMethods=VV.addExtensionMethods});var yC=d(Pl=>{Object.defineProperty(Pl,"__esModule",{value:!0});var HV=Dl(),vV=b();function _V(){let t=HV.lazyLoadedNodePerformanceMonitoringIntegrations.map(e=>{try{return e()}catch{return}}).filter(e=>!!e);return t.length===0&&vV.logger.warn("Performance monitoring integrations could not be automatically loaded."),t.filter(e=>!!e.loadDependency())}Pl.autoDiscoverNodePerformanceMonitoringIntegrations=_V});var $l=d(ql=>{Object.defineProperty(ql,"__esModule",{value:!0});var NV=require("os"),EV=require("util"),jl=W(),Ql=class extends jl.ServerRuntimeClient{constructor(e){e._metadata=e._metadata||{},e._metadata.sdk=e._metadata.sdk||{name:"sentry.javascript.node",packages:[{name:"npm:@sentry/node",version:jl.SDK_VERSION}],version:jl.SDK_VERSION},e.transportOptions={textEncoder:new EV.TextEncoder,...e.transportOptions};let n={...e,platform:"node",runtime:{name:"node",version:global.process.version},serverName:e.serverName||global.process.env.SENTRY_NAME||NV.hostname()};super(n)}};ql.NodeClient=Ql});var SC=d(tg=>{var{_nullishCoalesce:AC}=b();Object.defineProperty(tg,"__esModule",{value:!0});var fC=require("http");require("https");var Ye=Symbol("AgentBaseInternalState"),eg=class extends fC.Agent{constructor(e){super(e),this[Ye]={}}isSecureEndpoint(e){if(e){if(typeof e.secureEndpoint=="boolean")return e.secureEndpoint;if(typeof e.protocol=="string")return e.protocol==="https:"}let{stack:n}=new Error;return typeof n!="string"?!1:n.split(`
`).some(r=>r.indexOf("(https.js:")!==-1||r.indexOf("node:https:")!==-1)}createSocket(e,n,r){let i={...n,secureEndpoint:this.isSecureEndpoint(n)};Promise.resolve().then(()=>this.connect(e,i)).then(o=>{if(o instanceof fC.Agent)return o.addRequest(e,i);this[Ye].currentSocket=o,super.createSocket(e,n,r)},r)}createConnection(){let e=this[Ye].currentSocket;if(this[Ye].currentSocket=void 0,!e)throw new Error("No socket was returned in the `connect()` function");return e}get defaultPort(){return AC(this[Ye].defaultPort,()=>this.protocol==="https:"?443:80)}set defaultPort(e){this[Ye]&&(this[Ye].defaultPort=e)}get protocol(){return AC(this[Ye].protocol,()=>this.isSecureEndpoint()?"https:":"http:")}set protocol(e){this[Ye]&&(this[Ye].protocol=e)}};tg.Agent=eg});var WC=d(ng=>{Object.defineProperty(ng,"__esModule",{value:!0});var YV=b();function Lo(...t){YV.logger.log("[https-proxy-agent:parse-proxy-response]",...t)}function XV(t){return new Promise((e,n)=>{let r=0,i=[];function o(){let g=t.read();g?l(g):t.once("readable",o)}function s(){t.removeListener("end",a),t.removeListener("error",c),t.removeListener("readable",o)}function a(){s(),Lo("onend"),n(new Error("Proxy connection ended before receiving CONNECT response"))}function c(g){s(),Lo("onerror %o",g),n(g)}function l(g){i.push(g),r+=g.length;let u=Buffer.concat(i,r),I=u.indexOf(`\r
\r
`);if(I===-1){Lo("have not received end of HTTP headers yet..."),o();return}let m=u.slice(0,I).toString("ascii").split(`\r
`),C=m.shift();if(!C)return t.destroy(),n(new Error("No header received from proxy CONNECT response"));let Z=C.split(" "),B=+Z[1],S=Z.slice(2).join(" "),X={};for(let R of m){if(!R)continue;let N=R.indexOf(":");if(N===-1)return t.destroy(),n(new Error(`Invalid header from proxy CONNECT response: "${R}"`));let _=R.slice(0,N).toLowerCase(),Y=R.slice(N+1).trimStart(),pe=X[_];typeof pe=="string"?X[_]=[pe,Y]:Array.isArray(pe)?pe.push(Y):X[_]=Y}Lo("got proxy server response: %o %o",C,X),s(),e({connect:{statusCode:B,statusText:S,headers:X},buffered:u})}t.on("error",c),t.on("end",a),o()})}ng.parseProxyResponse=XV});var HC=d(rg=>{var{_nullishCoalesce:TV,_optionalChain:FV}=b();Object.defineProperty(rg,"__esModule",{value:!0});var wV=require("assert"),Hr=require("net"),RC=require("tls"),UV=require("url"),KV=b(),JV=SC(),kV=WC();function vr(...t){KV.logger.log("[https-proxy-agent]",...t)}var zo=class extends JV.Agent{static __initStatic(){this.protocols=["http","https"]}constructor(e,n){super(n),this.options={},this.proxy=typeof e=="string"?new UV.URL(e):e,this.proxyHeaders=TV(FV([n,"optionalAccess",o=>o.headers]),()=>({})),vr("Creating new HttpsProxyAgent instance: %o",this.proxy.href);let r=(this.proxy.hostname||this.proxy.host).replace(/^\[|\]$/g,""),i=this.proxy.port?parseInt(this.proxy.port,10):this.proxy.protocol==="https:"?443:80;this.connectOpts={ALPNProtocols:["http/1.1"],...n?VC(n,"headers"):null,host:r,port:i}}async connect(e,n){let{proxy:r}=this;if(!n.host)throw new TypeError('No "host" provided');let i;if(r.protocol==="https:"){vr("Creating `tls.Socket`: %o",this.connectOpts);let I=this.connectOpts.servername||this.connectOpts.host;i=RC.connect({...this.connectOpts,servername:I&&Hr.isIP(I)?void 0:I})}else vr("Creating `net.Socket`: %o",this.connectOpts),i=Hr.connect(this.connectOpts);let o=typeof this.proxyHeaders=="function"?this.proxyHeaders():{...this.proxyHeaders},s=Hr.isIPv6(n.host)?`[${n.host}]`:n.host,a=`CONNECT ${s}:${n.port} HTTP/1.1\r
`;if(r.username||r.password){let I=`${decodeURIComponent(r.username)}:${decodeURIComponent(r.password)}`;o["Proxy-Authorization"]=`Basic ${Buffer.from(I).toString("base64")}`}o.Host=`${s}:${n.port}`,o["Proxy-Connection"]||(o["Proxy-Connection"]=this.keepAlive?"Keep-Alive":"close");for(let I of Object.keys(o))a+=`${I}: ${o[I]}\r
`;let c=kV.parseProxyResponse(i);i.write(`${a}\r
`);let{connect:l,buffered:g}=await c;if(e.emit("proxyConnect",l),this.emit("proxyConnect",l,e),l.statusCode===200){if(e.once("socket",LV),n.secureEndpoint){vr("Upgrading socket connection to TLS");let I=n.servername||n.host;return RC.connect({...VC(n,"host","path","port"),socket:i,servername:Hr.isIP(I)?void 0:I})}return i}i.destroy();let u=new Hr.Socket({writable:!1});return u.readable=!0,e.once("socket",I=>{vr("Replaying proxy buffer for failed request"),wV.default(I.listenerCount("data")>0),I.push(g),I.push(null)}),u}};zo.__initStatic();function LV(t){t.resume()}function VC(t,...e){let n={},r;for(r in t)e.includes(r)||(n[r]=t[r]);return n}rg.HttpsProxyAgent=zo});var sg=d(og=>{var{_nullishCoalesce:ig}=b();Object.defineProperty(og,"__esModule",{value:!0});var zV=require("http"),xV=require("https"),OV=require("stream"),_C=require("url"),MV=require("zlib"),vC=W(),DV=b(),PV=HC(),jV=1024*32;function QV(t){return new OV.Readable({read(){this.push(t),this.push(null)}})}function qV(t){let e;try{e=new _C.URL(t.url)}catch{return DV.consoleSandbox(()=>{console.warn("[@sentry/node]: Invalid dsn or tunnel option, will not send any events. The tunnel option must be a full URL when used.")}),vC.createTransport(t,()=>Promise.resolve({}))}let n=e.protocol==="https:",r=$V(e,t.proxy||(n?process.env.https_proxy:void 0)||process.env.http_proxy),i=n?xV:zV,o=t.keepAlive===void 0?!1:t.keepAlive,s=r?new PV.HttpsProxyAgent(r):new i.Agent({keepAlive:o,maxSockets:30,timeout:2e3}),a=eH(t,ig(t.httpModule,()=>i),s);return vC.createTransport(t,a)}function $V(t,e){let{no_proxy:n}=process.env;if(!(n&&n.split(",").some(i=>t.host.endsWith(i)||t.hostname.endsWith(i))))return e}function eH(t,e,n){let{hostname:r,pathname:i,port:o,protocol:s,search:a}=new _C.URL(t.url);return function(l){return new Promise((g,u)=>{let I=QV(l.body),m={...t.headers};l.body.length>jV&&(m["content-encoding"]="gzip",I=I.pipe(MV.createGzip()));let C=e.request({method:"POST",agent:n,headers:m,hostname:r,path:`${i}${a}`,port:o,protocol:s,ca:t.caCerts},Z=>{Z.on("data",()=>{}),Z.on("end",()=>{}),Z.setEncoding("utf8");let B=ig(Z.headers["retry-after"],()=>null),S=ig(Z.headers["x-sentry-rate-limits"],()=>null);g({statusCode:Z.statusCode,headers:{"retry-after":B,"x-sentry-rate-limits":Array.isArray(S)?S[0]:S}})});C.on("error",u),I.pipe(C)})}}og.makeNodeTransport=qV});var _t=d(ag=>{Object.defineProperty(ag,"__esModule",{value:!0});var tH=b(),nH=tH.parseSemver(process.versions.node);ag.NODE_VERSION=nH});var YC=d(cg=>{var{_optionalChain:rH}=b();Object.defineProperty(cg,"__esModule",{value:!0});var NC=require("domain"),Nt=W();function EC(){return NC.active}function iH(){let t=EC();if(t)return Nt.ensureHubOnCarrier(t),Nt.getHubFromCarrier(t)}function oH(t){let e={};return Nt.ensureHubOnCarrier(e,t),Nt.getHubFromCarrier(e)}function sH(t,e){let n=EC();if(n&&rH([e,"optionalAccess",s=>s.reuseExisting]))return t();let r=NC.create(),i=n?Nt.getHubFromCarrier(n):void 0,o=oH(i);return Nt.setHubOnCarrier(r,o),r.bind(()=>t())()}function aH(){Nt.setAsyncContextStrategy({getCurrentHub:iH,runWithAsyncContext:sH})}cg.setDomainAsyncContextStrategy=aH});var XC=d(gg=>{var{_optionalChain:cH}=b();Object.defineProperty(gg,"__esModule",{value:!0});var lg=W(),lH=require("async_hooks"),xo;function gH(){xo||(xo=new lH.AsyncLocalStorage);function t(){return xo.getStore()}function e(r){let i={};return lg.ensureHubOnCarrier(i,r),lg.getHubFromCarrier(i)}function n(r,i){let o=t();if(o&&cH([i,"optionalAccess",a=>a.reuseExisting]))return r();let s=e(o);return xo.run(s,()=>r())}lg.setAsyncContextStrategy({getCurrentHub:t,runWithAsyncContext:n})}gg.setHooksAsyncContextStrategy=gH});var TC=d(ug=>{Object.defineProperty(ug,"__esModule",{value:!0});var uH=_t(),dH=YC(),IH=XC();function pH(){uH.NODE_VERSION.major>=14?IH.setHooksAsyncContextStrategy():dH.setDomainAsyncContextStrategy()}ug.setNodeAsyncContextStrategy=pH});var pg=d(Ig=>{Object.defineProperty(Ig,"__esModule",{value:!0});var mH=require("util"),dg=W(),FC=b(),wC="Console",CH=()=>({name:wC,setupOnce(){},setup(t){FC.addConsoleInstrumentationHandler(({args:e,level:n})=>{dg.getClient()===t&&dg.addBreadcrumb({category:"console",level:FC.severityLevelFromString(n),message:mH.format.apply(void 0,e)},{input:[...e],level:n})})}}),bH=dg.convertIntegrationFnToClass(wC,CH);Ig.Console=bH});var _r=d(mg=>{Object.defineProperty(mg,"__esModule",{value:!0});var hH=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__;mg.DEBUG_BUILD=hH});var JC=d(Et=>{var{_optionalChain:Xe}=b();Object.defineProperty(Et,"__esModule",{value:!0});var Cg=require("url"),BH=_t();function ZH(t){let{protocol:e,hostname:n,port:r}=KC(t),i=t.path?t.path:"/";return`${e}//${n}${r}${i}`}function UC(t){let{protocol:e,hostname:n,port:r}=KC(t),i=t.pathname||"/",o=t.auth?GH(t.auth):"";return`${e}//${o}${n}${r}${i}`}function GH(t){let[e,n]=t.split(":");return`${e?"[Filtered]":""}:${n?"[Filtered]":""}@`}function yH(t,e,n){if(!t)return t;let[r,i]=t.split(" ");return e.host&&!e.protocol&&(e.protocol=Xe([n,"optionalAccess",o=>o.agent,"optionalAccess",o=>o.protocol]),i=UC(e)),Xe([i,"optionalAccess",o=>o.startsWith,"call",o=>o("///")])&&(i=i.slice(2)),`${r} ${i}`}function bg(t){let e={protocol:t.protocol,hostname:typeof t.hostname=="string"&&t.hostname.startsWith("[")?t.hostname.slice(1,-1):t.hostname,hash:t.hash,search:t.search,pathname:t.pathname,path:`${t.pathname||""}${t.search||""}`,href:t.href};return t.port!==""&&(e.port=Number(t.port)),(t.username||t.password)&&(e.auth=`${t.username}:${t.password}`),e}function AH(t,e){let n,r;if(typeof e[e.length-1]=="function"&&(n=e.pop()),typeof e[0]=="string")r=bg(new Cg.URL(e[0]));else if(e[0]instanceof Cg.URL)r=bg(e[0]);else{r=e[0];try{let i=new Cg.URL(r.path||"",`${r.protocol||"http:"}//${r.hostname}`);r={pathname:i.pathname,search:i.search,hash:i.hash,...r}}catch{}}return e.length===2&&(r={...r,...e[1]}),r.protocol===void 0&&(BH.NODE_VERSION.major>8?r.protocol=Xe([Xe([t,"optionalAccess",i=>i.globalAgent]),"optionalAccess",i=>i.protocol])||Xe([r.agent,"optionalAccess",i=>i.protocol])||Xe([r._defaultAgent,"optionalAccess",i=>i.protocol]):r.protocol=Xe([r.agent,"optionalAccess",i=>i.protocol])||Xe([r._defaultAgent,"optionalAccess",i=>i.protocol])||Xe([Xe([t,"optionalAccess",i=>i.globalAgent]),"optionalAccess",i=>i.protocol])),n?[r,n]:[r]}function KC(t){let e=t.protocol||"",n=t.hostname||t.host||"",r=!t.port||t.port===80||t.port===443||/^(.*):(\d+)$/.test(n)?"":`:${t.port}`;return{protocol:e,hostname:n,port:r}}Et.cleanSpanDescription=yH;Et.extractRawUrl=ZH;Et.extractUrl=UC;Et.normalizeRequestArgs=AH;Et.urlToOptions=bg});var Zg=d(Bg=>{var{_optionalChain:Gn}=b();Object.defineProperty(Bg,"__esModule",{value:!0});var le=W(),ge=b(),hg=_r(),fH=_t(),Nr=JC(),Er=class t{static __initStatic(){this.id="Http"}__init(){this.name=t.id}constructor(e={}){t.prototype.__init.call(this),this._breadcrumbs=typeof e.breadcrumbs>"u"?!0:e.breadcrumbs,this._tracing=e.tracing?e.tracing===!0?{}:e.tracing:void 0}setupOnce(e,n){if(!this._breadcrumbs&&!this._tracing)return;let r=Gn([n,"call",c=>c(),"access",c=>c.getClient,"call",c=>c(),"optionalAccess",c=>c.getOptions,"call",c=>c()]);if(r&&r.instrumenter!=="sentry"){hg.DEBUG_BUILD&&ge.logger.log("HTTP Integration is skipped because of instrumenter configuration.");return}let i=Gn([this,"access",c=>c._tracing,"optionalAccess",c=>c.shouldCreateSpanForRequest])||Gn([r,"optionalAccess",c=>c.shouldCreateSpanForRequest]),o=Gn([r,"optionalAccess",c=>c.tracePropagationTargets])||Gn([this,"access",c=>c._tracing,"optionalAccess",c=>c.tracePropagationTargets]),s=require("http"),a=kC(s,this._breadcrumbs,i,o);if(ge.fill(s,"get",a),ge.fill(s,"request",a),fH.NODE_VERSION.major>8){let c=require("https"),l=kC(c,this._breadcrumbs,i,o);ge.fill(c,"get",l),ge.fill(c,"request",l)}}};Er.__initStatic();function kC(t,e,n,r){let i=new ge.LRUMap(100),o=new ge.LRUMap(100),s=l=>{if(n===void 0)return!0;let g=i.get(l);if(g!==void 0)return g;let u=n(l);return i.set(l,u),u},a=l=>{if(r===void 0)return!0;let g=o.get(l);if(g!==void 0)return g;let u=ge.stringMatchesSomePattern(l,r);return o.set(l,u),u};function c(l,g,u,I){le.getCurrentHub().getIntegration(Er)&&le.addBreadcrumb({category:"http",data:{status_code:I&&I.statusCode,...g},type:"http"},{event:l,request:u,response:I})}return function(g){return function(...I){let m=Nr.normalizeRequestArgs(t,I),C=m[0],Z=Nr.extractRawUrl(C),B=Nr.extractUrl(C);if(le.isSentryRequestUrl(B,le.getClient()))return g.apply(t,m);let S=le.getCurrentScope(),X=le.getActiveSpan(),R=SH(B,C),N=s(Z)?Gn([X,"optionalAccess",_=>_.startChild,"call",_=>_({op:"http.client",origin:"auto.http.node.http",description:`${R["http.method"]} ${R.url}`,data:R})]):void 0;if(a(Z))if(N){let _=le.spanToTraceHeader(N),Y=le.getDynamicSamplingContextFromSpan(N);LC(C,B,_,Y)}else{let _=le.getClient(),{traceId:Y,sampled:pe,dsc:Wn}=S.getPropagationContext(),bs=ge.generateSentryTraceHeader(Y,void 0,pe),ph=Wn||(_?le.getDynamicSamplingContextFromClient(Y,_,S):void 0);LC(C,B,bs,ph)}else hg.DEBUG_BUILD&&ge.logger.log(`[Tracing] Not adding sentry-trace header to outgoing request (${B}) due to mismatching tracePropagationTargets option.`);return g.apply(t,m).once("response",function(_){let Y=this;e&&c("response",R,Y,_),N&&(_.statusCode&&N.setHttpStatus(_.statusCode),N.updateName(Nr.cleanSpanDescription(le.spanToJSON(N).description||"",C,Y)||""),N.end())}).once("error",function(){let _=this;e&&c("error",R,_),N&&(N.setHttpStatus(500),N.updateName(Nr.cleanSpanDescription(le.spanToJSON(N).description||"",C,_)||""),N.end())})}}}function LC(t,e,n,r){if((t.headers||{})["sentry-trace"])return;hg.DEBUG_BUILD&&ge.logger.log(`[Tracing] Adding sentry-trace header ${n} to outgoing request to "${e}": `);let o=ge.dynamicSamplingContextToSentryBaggageHeader(r),s=o&&o.length>0?WH(t,o):void 0;t.headers={...t.headers,"sentry-trace":n,...s&&{baggage:s}}}function SH(t,e){let n=e.method||"GET",r={url:t,"http.method":n};return e.hash&&(r["http.fragment"]=e.hash.substring(1)),e.search&&(r["http.query"]=e.search.substring(1)),r}function WH(t,e){if(!t.headers||!t.headers.baggage)return e;if(e){if(Array.isArray(t.headers.baggage))return[...t.headers.baggage,e]}else return t.headers.baggage;return[t.headers.baggage,e]}Bg.Http=Er});var Ag=d(yg=>{Object.defineProperty(yg,"__esModule",{value:!0});var RH=W(),Oo=b(),Gg=_r(),VH=2e3;function HH(t){Oo.consoleSandbox(()=>{console.error(t)});let e=RH.getClient();e===void 0&&(Gg.DEBUG_BUILD&&Oo.logger.warn("No NodeClient was defined, we are exiting the process now."),global.process.exit(1));let n=e.getOptions(),r=n&&n.shutdownTimeout&&n.shutdownTimeout>0&&n.shutdownTimeout||VH;e.close(r).then(i=>{i||Gg.DEBUG_BUILD&&Oo.logger.warn("We reached the timeout for emptying the request buffer, still exiting now!"),global.process.exit(1)},i=>{Gg.DEBUG_BUILD&&Oo.logger.error(i)})}yg.logAndExitProcess=HH});var Sg=d(Mo=>{Object.defineProperty(Mo,"__esModule",{value:!0});var fg=W(),vH=b(),_H=_r(),zC=Ag(),xC="OnUncaughtException",NH=(t={})=>{let e={exitEvenIfOtherHandlersAreRegistered:!0,...t};return{name:xC,setupOnce(){},setup(n){global.process.on("uncaughtException",OC(n,e))}}},EH=fg.convertIntegrationFnToClass(xC,NH);function OC(t,e){let r=!1,i=!1,o=!1,s,a=t.getOptions();return Object.assign(c=>{let l=zC.logAndExitProcess;e.onFatalError?l=e.onFatalError:a.onFatalError&&(l=a.onFatalError);let u=global.process.listeners("uncaughtException").reduce((m,C)=>C.name==="domainUncaughtExceptionClear"||C.tag&&C.tag==="sentry_tracingErrorCallback"||C._errorHandler?m:m+1,0)===0,I=e.exitEvenIfOtherHandlersAreRegistered||u;r?I&&(o?(_H.DEBUG_BUILD&&vH.logger.warn("uncaught exception after calling fatal error shutdown callback - this is bad! forcing shutdown"),zC.logAndExitProcess(c)):i||(i=!0,setTimeout(()=>{o||(o=!0,l(s,c))},2e3))):(s=c,r=!0,fg.getClient()===t&&fg.captureException(c,{originalException:c,captureContext:{level:"fatal"},mechanism:{handled:!1,type:"onuncaughtexception"}}),!o&&I&&(o=!0,l(c)))},{_errorHandler:!0})}Mo.OnUncaughtException=EH;Mo.makeErrorHandler=OC});var Rg=d(Do=>{Object.defineProperty(Do,"__esModule",{value:!0});var Wg=W(),MC=b(),YH=Ag(),DC="OnUnhandledRejection",XH=(t={})=>{let e=t.mode||"warn";return{name:DC,setupOnce(){},setup(n){global.process.on("unhandledRejection",PC(n,{mode:e}))}}},TH=Wg.convertIntegrationFnToClass(DC,XH);function PC(t,e){return function(r,i){Wg.getClient()===t&&(Wg.captureException(r,{originalException:i,captureContext:{extra:{unhandledPromiseRejection:!0}},mechanism:{handled:!1,type:"onunhandledrejection"}}),FH(r,e))}}function FH(t,e){let n="This error originated either by throwing inside of an async function without a catch block, or by rejecting a promise which was not handled with .catch(). The promise rejected with the reason:";e.mode==="warn"?MC.consoleSandbox(()=>{console.warn(n),console.error(t&&t.stack?t.stack:t)}):e.mode==="strict"&&(MC.consoleSandbox(()=>{console.warn(n)}),YH.logAndExitProcess(t))}Do.OnUnhandledRejection=TH;Do.makeUnhandledPromiseHandler=PC});var vg=d(Hg=>{Object.defineProperty(Hg,"__esModule",{value:!0});var jC=require("fs"),QC=require("path"),wH=W(),Vg,qC="Modules";function UH(){try{return require.cache?Object.keys(require.cache):[]}catch{return[]}}function KH(){let t=require.main&&require.main.paths||[],e=UH(),n={},r={};return e.forEach(i=>{let o=i,s=()=>{let a=o;if(o=QC.dirname(a),!o||a===o||r[a])return;if(t.indexOf(o)<0)return s();let c=QC.join(a,"package.json");if(r[a]=!0,!jC.existsSync(c))return s();try{let l=JSON.parse(jC.readFileSync(c,"utf8"));n[l.name]=l.version}catch{}};s()}),n}function JH(){return Vg||(Vg=KH()),Vg}var kH=()=>({name:qC,setupOnce(){},processEvent(t){return t.modules={...t.modules,...JH()},t}}),LH=wH.convertIntegrationFnToClass(qC,kH);Hg.Modules=LH});var Eg=d(Ng=>{var{_optionalChain:_g}=b();Object.defineProperty(Ng,"__esModule",{value:!0});var zH=require("fs"),xH=W(),$C=b(),Po=new $C.LRUMap(100),OH=7,eb="ContextLines";function MH(t){return new Promise((e,n)=>{zH.readFile(t,"utf8",(r,i)=>{r?n(r):e(i)})})}var DH=(t={})=>{let e=t.frameContextLines!==void 0?t.frameContextLines:OH;return{name:eb,setupOnce(){},processEvent(n){return jH(n,e)}}},PH=xH.convertIntegrationFnToClass(eb,DH);async function jH(t,e){let n={},r=[];if(e>0&&_g([t,"access",i=>i.exception,"optionalAccess",i=>i.values])){for(let i of t.exception.values)if(_g([i,"access",o=>o.stacktrace,"optionalAccess",o=>o.frames]))for(let o=i.stacktrace.frames.length-1;o>=0;o--){let s=i.stacktrace.frames[o];s.filename&&!n[s.filename]&&!Po.get(s.filename)&&(r.push(qH(s.filename)),n[s.filename]=1)}}if(r.length>0&&await Promise.all(r),e>0&&_g([t,"access",i=>i.exception,"optionalAccess",i=>i.values]))for(let i of t.exception.values)i.stacktrace&&i.stacktrace.frames&&await QH(i.stacktrace.frames,e);return t}function QH(t,e){for(let n of t)if(n.filename&&n.context_line===void 0){let r=Po.get(n.filename);if(r)try{$C.addContextToFrame(r,n,e)}catch{}}}async function qH(t){let e=Po.get(t);if(e===null)return null;if(e!==void 0)return e;let n=null;try{n=(await MH(t)).split(`
`)}catch{}return Po.set(t,n),n}Ng.ContextLines=PH});var Yg=d(yn=>{var{_optionalChain:Yt}=b();Object.defineProperty(yn,"__esModule",{value:!0});var $H=require("child_process"),nb=require("fs"),ue=require("os"),ev=require("path"),rb=require("util"),tv=W(),ib=rb.promisify(nb.readFile),ob=rb.promisify(nb.readdir),sb="Context",nv=(t={})=>{let e,n={app:!0,os:!0,device:!0,culture:!0,cloudResource:!0,...t};async function r(o){e===void 0&&(e=i());let s=iv(await e);return o.contexts={...o.contexts,app:{...s.app,...Yt([o,"access",a=>a.contexts,"optionalAccess",a=>a.app])},os:{...s.os,...Yt([o,"access",a=>a.contexts,"optionalAccess",a=>a.os])},device:{...s.device,...Yt([o,"access",a=>a.contexts,"optionalAccess",a=>a.device])},culture:{...s.culture,...Yt([o,"access",a=>a.contexts,"optionalAccess",a=>a.culture])},cloud_resource:{...s.cloud_resource,...Yt([o,"access",a=>a.contexts,"optionalAccess",a=>a.cloud_resource])}},o}async function i(){let o={};if(n.os&&(o.os=await ov()),n.app&&(o.app=av()),n.device&&(o.device=ab(n.device)),n.culture){let s=sv();s&&(o.culture=s)}return n.cloudResource&&(o.cloud_resource=Iv()),o}return{name:sb,setupOnce(){},processEvent(o){return r(o)}}},rv=tv.convertIntegrationFnToClass(sb,nv);function iv(t){return Yt([t,"optionalAccess",e=>e.app,"optionalAccess",e=>e.app_memory])&&(t.app.app_memory=process.memoryUsage().rss),Yt([t,"optionalAccess",e=>e.device,"optionalAccess",e=>e.free_memory])&&(t.device.free_memory=ue.freemem()),t}async function ov(){let t=ue.platform();switch(t){case"darwin":return uv();case"linux":return dv();default:return{name:cv[t]||t,version:ue.release()}}}function sv(){try{if(typeof process.versions.icu!="string")return;let t=new Date(9e8);if(new Intl.DateTimeFormat("es",{month:"long"}).format(t)==="enero"){let n=Intl.DateTimeFormat().resolvedOptions();return{locale:n.locale,timezone:n.timeZone}}}catch{}}function av(){let t=process.memoryUsage().rss;return{app_start_time:new Date(Date.now()-process.uptime()*1e3).toISOString(),app_memory:t}}function ab(t){let e={},n;try{n=ue.uptime&&ue.uptime()}catch{}if(typeof n=="number"&&(e.boot_time=new Date(Date.now()-n*1e3).toISOString()),e.arch=ue.arch(),(t===!0||t.memory)&&(e.memory_size=ue.totalmem(),e.free_memory=ue.freemem()),t===!0||t.cpu){let r=ue.cpus();if(r&&r.length){let i=r[0];e.processor_count=r.length,e.cpu_description=i.model,e.processor_frequency=i.speed}}return e}var cv={aix:"IBM AIX",freebsd:"FreeBSD",openbsd:"OpenBSD",sunos:"SunOS",win32:"Windows"},lv=[{name:"fedora-release",distros:["Fedora"]},{name:"redhat-release",distros:["Red Hat Linux","Centos"]},{name:"redhat_version",distros:["Red Hat Linux"]},{name:"SuSE-release",distros:["SUSE Linux"]},{name:"lsb-release",distros:["Ubuntu Linux","Arch Linux"]},{name:"debian_version",distros:["Debian"]},{name:"debian_release",distros:["Debian"]},{name:"arch-release",distros:["Arch Linux"]},{name:"gentoo-release",distros:["Gentoo Linux"]},{name:"novell-release",distros:["SUSE Linux"]},{name:"alpine-release",distros:["Alpine Linux"]}],gv={alpine:t=>t,arch:t=>Te(/distrib_release=(.*)/,t),centos:t=>Te(/release ([^ ]+)/,t),debian:t=>t,fedora:t=>Te(/release (..)/,t),mint:t=>Te(/distrib_release=(.*)/,t),red:t=>Te(/release ([^ ]+)/,t),suse:t=>Te(/VERSION = (.*)\n/,t),ubuntu:t=>Te(/distrib_release=(.*)/,t)};function Te(t,e){let n=t.exec(e);return n?n[1]:void 0}async function uv(){let t={kernel_version:ue.release(),name:"Mac OS X",version:`10.${Number(ue.release().split(".")[0])-4}`};try{let e=await new Promise((n,r)=>{$H.execFile("/usr/bin/sw_vers",(i,o)=>{if(i){r(i);return}n(o)})});t.name=Te(/^ProductName:\s+(.*)$/m,e),t.version=Te(/^ProductVersion:\s+(.*)$/m,e),t.build=Te(/^BuildVersion:\s+(.*)$/m,e)}catch{}return t}function tb(t){return t.split(" ")[0].toLowerCase()}async function dv(){let t={kernel_version:ue.release(),name:"Linux"};try{let e=await ob("/etc"),n=lv.find(a=>e.includes(a.name));if(!n)return t;let r=ev.join("/etc",n.name),i=(await ib(r,{encoding:"utf-8"})).toLowerCase(),{distros:o}=n;t.name=o.find(a=>i.indexOf(tb(a))>=0)||o[0];let s=tb(t.name);t.version=gv[s](i)}catch{}return t}function Iv(){return process.env.VERCEL?{"cloud.provider":"vercel","cloud.region":process.env.VERCEL_REGION}:process.env.AWS_REGION?{"cloud.provider":"aws","cloud.region":process.env.AWS_REGION,"cloud.platform":process.env.AWS_EXECUTION_ENV}:process.env.GCP_PROJECT?{"cloud.provider":"gcp"}:process.env.ALIYUN_REGION_ID?{"cloud.provider":"alibaba_cloud","cloud.region":process.env.ALIYUN_REGION_ID}:process.env.WEBSITE_SITE_NAME&&process.env.REGION_NAME?{"cloud.provider":"azure","cloud.region":process.env.REGION_NAME}:process.env.IBM_CLOUD_REGION?{"cloud.provider":"ibm_cloud","cloud.region":process.env.IBM_CLOUD_REGION}:process.env.TENCENTCLOUD_REGION?{"cloud.provider":"tencent_cloud","cloud.region":process.env.TENCENTCLOUD_REGION,"cloud.account.id":process.env.TENCENTCLOUD_APPID,"cloud.availability_zone":process.env.TENCENTCLOUD_ZONE}:process.env.NETLIFY?{"cloud.provider":"netlify"}:process.env.FLY_REGION?{"cloud.provider":"fly.io","cloud.region":process.env.FLY_REGION}:process.env.DYNO?{"cloud.provider":"heroku"}:void 0}yn.Context=rv;yn.getDeviceContext=ab;yn.readDirAsync=ob;yn.readFileAsync=ib});var lb=d(Xt=>{Object.defineProperty(Xt,"__esModule",{value:!0});function pv(t,e,n){let r=0,i=5,o=0;return setInterval(()=>{o===0?r>t&&(i*=2,n(i),i>86400&&(i=86400),o=i):(o-=1,o===0&&e()),r=0},1e3).unref(),()=>{r+=1}}function Xg(t){return t!==void 0&&(t.length===0||t==="?"||t==="<anonymous>")}function mv(t,e){return t===e||Xg(t)&&Xg(e)}function cb(t){if(t!==void 0)return t.slice(-10).reduce((e,n)=>`${e},${n.function},${n.lineno},${n.colno}`,"")}function Cv(t,e){if(e!==void 0)return cb(t(e,1))}Xt.createRateLimiter=pv;Xt.functionNamesMatch=mv;Xt.hashFrames=cb;Xt.hashFromStack=Cv;Xt.isAnonymous=Xg});var ub=d(qo=>{var{_optionalChain:K}=b();Object.defineProperty(qo,"__esModule",{value:!0});var bv=W(),jo=b(),hv=_t(),Qo=lb();function Fg(t){let e=[],n=!1;function r(s){e=[],!n&&(n=!0,t(s))}e.push(r);function i(s){e.push(s)}function o(s){let a=e.pop()||r;try{a(s)}catch{r(s)}}return{add:i,next:o}}var Tg=class{constructor(){let{Session:e}=require("inspector");this._session=new e}configureAndConnect(e,n){this._session.connect(),this._session.on("Debugger.paused",r=>{e(r,()=>{this._session.post("Debugger.resume")})}),this._session.post("Debugger.enable"),this._session.post("Debugger.setPauseOnExceptions",{state:n?"all":"uncaught"})}setPauseOnExceptions(e){this._session.post("Debugger.setPauseOnExceptions",{state:e?"all":"uncaught"})}getLocalVariables(e,n){this._getProperties(e,r=>{let{add:i,next:o}=Fg(n);for(let s of r)if(K([s,"optionalAccess",a=>a.value,"optionalAccess",a=>a.objectId])&&K([s,"optionalAccess",a=>a.value,"access",a=>a.className])==="Array"){let a=s.value.objectId;i(c=>this._unrollArray(a,s.name,c,o))}else if(K([s,"optionalAccess",a=>a.value,"optionalAccess",a=>a.objectId])&&K([s,"optionalAccess",a=>a.value,"optionalAccess",a=>a.className])==="Object"){let a=s.value.objectId;i(c=>this._unrollObject(a,s.name,c,o))}else(K([s,"optionalAccess",a=>a.value,"optionalAccess",a=>a.value])||K([s,"optionalAccess",a=>a.value,"optionalAccess",a=>a.description]))&&i(a=>this._unrollOther(s,a,o));o({})})}_getProperties(e,n){this._session.post("Runtime.getProperties",{objectId:e,ownProperties:!0},(r,i)=>{n(r?[]:i.result)})}_unrollArray(e,n,r,i){this._getProperties(e,o=>{r[n]=o.filter(s=>s.name!=="length"&&!isNaN(parseInt(s.name,10))).sort((s,a)=>parseInt(s.name,10)-parseInt(a.name,10)).map(s=>K([s,"optionalAccess",a=>a.value,"optionalAccess",a=>a.value])),i(r)})}_unrollObject(e,n,r,i){this._getProperties(e,o=>{r[n]=o.map(s=>[s.name,K([s,"optionalAccess",a=>a.value,"optionalAccess",a=>a.value])]).reduce((s,[a,c])=>(s[a]=c,s),{}),i(r)})}_unrollOther(e,n,r){K([e,"optionalAccess",i=>i.value,"optionalAccess",i=>i.value])?n[e.name]=e.value.value:K([e,"optionalAccess",i=>i.value,"optionalAccess",i=>i.description])&&K([e,"optionalAccess",i=>i.value,"optionalAccess",i=>i.type])!=="function"&&(n[e.name]=`<${e.value.description}>`),r(n)}};function Bv(){try{return new Tg}catch{return}}var gb="LocalVariables",Zv=(t={},e=Bv())=>{let n=new jo.LRUMap(20),r,i=!1;function o(c,{params:{reason:l,data:g,callFrames:u}},I){if(l!=="exception"&&l!=="promiseRejection"){I();return}K([r,"optionalCall",B=>B()]);let m=Qo.hashFromStack(c,K([g,"optionalAccess",B=>B.description]));if(m==null){I();return}let{add:C,next:Z}=Fg(B=>{n.set(m,B),I()});for(let B=0;B<Math.min(u.length,5);B++){let{scopeChain:S,functionName:X,this:R}=u[B],N=S.find(Y=>Y.type==="local"),_=R.className==="global"||!R.className?X:`${R.className}.${X}`;if(K([N,"optionalAccess",Y=>Y.object,"access",Y=>Y.objectId])===void 0)C(Y=>{Y[B]={function:_},Z(Y)});else{let Y=N.object.objectId;C(pe=>K([e,"optionalAccess",Wn=>Wn.getLocalVariables,"call",Wn=>Wn(Y,bs=>{pe[B]={function:_,vars:bs},Z(pe)})]))}}Z([])}function s(c){let l=Qo.hashFrames(K([c,"optionalAccess",I=>I.stacktrace,"optionalAccess",I=>I.frames]));if(l===void 0)return;let g=n.remove(l);if(g===void 0)return;let u=K([c,"access",I=>I.stacktrace,"optionalAccess",I=>I.frames,"optionalAccess",I=>I.length])||0;for(let I=0;I<u;I++){let m=u-I-1;if(!K([c,"optionalAccess",C=>C.stacktrace,"optionalAccess",C=>C.frames,"optionalAccess",C=>C[m]])||!g[I])break;g[I].vars===void 0||c.stacktrace.frames[m].in_app===!1||!Qo.functionNamesMatch(c.stacktrace.frames[m].function,g[I].function)||(c.stacktrace.frames[m].vars=g[I].vars)}}function a(c){for(let l of K([c,"optionalAccess",g=>g.exception,"optionalAccess",g=>g.values])||[])s(l);return c}return{name:gb,setupOnce(){},setup(c){let l=c.getOptions();if(e&&l.includeLocalVariables){if(hv.NODE_VERSION.major<18){jo.logger.log("The `LocalVariables` integration is only supported on Node >= v18.");return}let u=t.captureAllExceptions!==!1;if(e.configureAndConnect((I,m)=>o(l.stackParser,I,m),u),u){let I=t.maxExceptionsPerSecond||50;r=Qo.createRateLimiter(I,()=>{jo.logger.log("Local variables rate-limit lifted."),K([e,"optionalAccess",m=>m.setPauseOnExceptions,"call",m=>m(!0)])},m=>{jo.logger.log(`Local variables rate-limit exceeded. Disabling capturing of caught exceptions for ${m} seconds.`),K([e,"optionalAccess",C=>C.setPauseOnExceptions,"call",C=>C(!1)])})}i=!0}},processEvent(c){return i?a(c):c},_getCachedFramesCount(){return n.size},_getFirstCachedFrame(){return n.values()[0]}}},Gv=bv.convertIntegrationFnToClass(gb,Zv);qo.LocalVariablesSync=Gv;qo.createCallbackList=Fg});var Ug=d(wg=>{Object.defineProperty(wg,"__esModule",{value:!0});var yv=ub(),Av=yv.LocalVariablesSync;wg.LocalVariables=Av});var Kg=d((tt,Ib)=>{var{_optionalChain:$o}=b();Object.defineProperty(tt,"__esModule",{value:!0});var P=W(),et=b(),fv=_t();tt.ChannelName=void 0;(function(t){let e="undici:request:create";t.RequestCreate=e;let n="undici:request:headers";t.RequestEnd=n;let r="undici:request:error";t.RequestError=r})(tt.ChannelName||(tt.ChannelName={}));var es=class t{static __initStatic(){this.id="Undici"}__init(){this.name=t.id}__init2(){this._createSpanUrlMap=new et.LRUMap(100)}__init3(){this._headersUrlMap=new et.LRUMap(100)}constructor(e={}){t.prototype.__init.call(this),t.prototype.__init2.call(this),t.prototype.__init3.call(this),t.prototype.__init4.call(this),t.prototype.__init5.call(this),t.prototype.__init6.call(this),this._options={breadcrumbs:e.breadcrumbs===void 0?!0:e.breadcrumbs,shouldCreateSpanForRequest:e.shouldCreateSpanForRequest}}setupOnce(e){if(fv.NODE_VERSION.major<16)return;let n;try{n=et.dynamicRequire(Ib,"diagnostics_channel")}catch{}!n||!n.subscribe||(n.subscribe(tt.ChannelName.RequestCreate,this._onRequestCreate),n.subscribe(tt.ChannelName.RequestEnd,this._onRequestEnd),n.subscribe(tt.ChannelName.RequestError,this._onRequestError))}_shouldCreateSpan(e){if(this._options.shouldCreateSpanForRequest===void 0)return!0;let n=this._createSpanUrlMap.get(e);if(n!==void 0)return n;let r=this._options.shouldCreateSpanForRequest(e);return this._createSpanUrlMap.set(e,r),r}__init4(){this._onRequestCreate=e=>{if(!$o([P.getClient,"call",g=>g(),"optionalAccess",g=>g.getIntegration,"call",g=>g(t)]))return;let{request:n}=e,r=n.origin?n.origin.toString()+n.path:n.path,i=P.getClient();if(!i||P.isSentryRequestUrl(r,i)||n.__sentry_span__!==void 0)return;let o=i.getOptions(),s=P.getCurrentScope(),a=P.getActiveSpan(),c=this._shouldCreateSpan(r)?Sv(a,n,r):void 0;if(c&&(n.__sentry_span__=c),(g=>{if(o.tracePropagationTargets===void 0)return!0;let u=this._headersUrlMap.get(g);if(u!==void 0)return u;let I=et.stringMatchesSomePattern(g,o.tracePropagationTargets);return this._headersUrlMap.set(g,I),I})(r))if(c){let g=P.getDynamicSamplingContextFromSpan(c),u=et.dynamicSamplingContextToSentryBaggageHeader(g);db(n,P.spanToTraceHeader(c),u)}else{let{traceId:g,sampled:u,dsc:I}=s.getPropagationContext(),m=et.generateSentryTraceHeader(g,void 0,u),C=I||P.getDynamicSamplingContextFromClient(g,i,s),Z=et.dynamicSamplingContextToSentryBaggageHeader(C);db(n,m,Z)}}}__init5(){this._onRequestEnd=e=>{if(!$o([P.getClient,"call",s=>s(),"optionalAccess",s=>s.getIntegration,"call",s=>s(t)]))return;let{request:n,response:r}=e,i=n.origin?n.origin.toString()+n.path:n.path;if(P.isSentryRequestUrl(i,P.getClient()))return;let o=n.__sentry_span__;o&&(o.setHttpStatus(r.statusCode),o.end()),this._options.breadcrumbs&&P.addBreadcrumb({category:"http",data:{method:n.method,status_code:r.statusCode,url:i},type:"http"},{event:"response",request:n,response:r})}}__init6(){this._onRequestError=e=>{if(!$o([P.getClient,"call",o=>o(),"optionalAccess",o=>o.getIntegration,"call",o=>o(t)]))return;let{request:n}=e,r=n.origin?n.origin.toString()+n.path:n.path;if(P.isSentryRequestUrl(r,P.getClient()))return;let i=n.__sentry_span__;i&&(i.setStatus("internal_error"),i.end()),this._options.breadcrumbs&&P.addBreadcrumb({category:"http",data:{method:n.method,url:r},level:"error",type:"http"},{event:"error",request:n})}}};es.__initStatic();function db(t,e,n){t.headers.split(`\r
`).some(o=>o.startsWith("sentry-trace:"))||(t.addHeader("sentry-trace",e),n&&t.addHeader("baggage",n))}function Sv(t,e,n){let r=et.parseUrl(n),i=e.method||"GET",o={"http.method":i};return r.search&&(o["http.query"]=r.search),r.hash&&(o["http.fragment"]=r.hash),$o([t,"optionalAccess",s=>s.startChild,"call",s=>s({op:"http.client",origin:"auto.http.node.undici",description:`${i} ${et.getSanitizedUrlString(r)}`,data:o})])}tt.Undici=es});var kg=d(Jg=>{Object.defineProperty(Jg,"__esModule",{value:!0});var Wv=require("http"),Rv=require("url"),Vv=W(),An=b(),pb="Spotlight",Hv=(t={})=>{let e={sidecarUrl:t.sidecarUrl||"http://localhost:8969/stream"};return{name:pb,setupOnce(){},setup(n){typeof process=="object"&&process.env&&process.env.NODE_ENV!=="development"&&An.logger.warn("[Spotlight] It seems you're not in dev mode. Do you really want to have Spotlight enabled?"),_v(n,e)}}},vv=Vv.convertIntegrationFnToClass(pb,Hv);function _v(t,e){let n=Nv(e.sidecarUrl);if(!n)return;let r=0;if(typeof t.on!="function"){An.logger.warn("[Spotlight] Cannot connect to spotlight due to missing method on SDK client (`client.on`)");return}t.on("beforeEnvelope",i=>{if(r>3){An.logger.warn("[Spotlight] Disabled Sentry -> Spotlight integration due to too many failed requests");return}let o=An.serializeEnvelope(i),s=Wv.request({method:"POST",path:n.pathname,hostname:n.hostname,port:n.port,headers:{"Content-Type":"application/x-sentry-envelope"}},a=>{a.on("data",()=>{}),a.on("end",()=>{}),a.setEncoding("utf8")});s.on("error",()=>{r++,An.logger.warn("[Spotlight] Failed to send envelope to Spotlight Sidecar")}),s.write(o),s.end()})}function Nv(t){try{return new Rv.URL(`${t}`)}catch{An.logger.warn(`[Spotlight] Invalid sidecar URL: ${t}`);return}}Jg.Spotlight=vv});var Cb=d(mb=>{mb.base64WorkerScript="aW1wb3J0IHsgU2Vzc2lvbiB9IGZyb20gJ2luc3BlY3Rvcic7CmltcG9ydCB7IHdvcmtlckRhdGEsIHBhcmVudFBvcnQgfSBmcm9tICd3b3JrZXJfdGhyZWFkcyc7CmltcG9ydCB7IHBvc2l4LCBzZXAgfSBmcm9tICdwYXRoJzsKaW1wb3J0ICogYXMgaHR0cCBmcm9tICdodHRwJzsKaW1wb3J0ICogYXMgaHR0cHMgZnJvbSAnaHR0cHMnOwppbXBvcnQgeyBSZWFkYWJsZSB9IGZyb20gJ3N0cmVhbSc7CmltcG9ydCB7IFVSTCB9IGZyb20gJ3VybCc7CmltcG9ydCB7IGNyZWF0ZUd6aXAgfSBmcm9tICd6bGliJzsKaW1wb3J0IGFzc2VydCBmcm9tICdhc3NlcnQnOwppbXBvcnQgKiBhcyBuZXQgZnJvbSAnbmV0JzsKaW1wb3J0ICogYXMgdGxzIGZyb20gJ3Rscyc7CgovLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L3VuYm91bmQtbWV0aG9kCmNvbnN0IG9iamVjdFRvU3RyaW5nID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZzsKCi8qKgogKiBDaGVja3Mgd2hldGhlciBnaXZlbiB2YWx1ZSdzIHR5cGUgaXMgb25lIG9mIGEgZmV3IEVycm9yIG9yIEVycm9yLWxpa2UKICoge0BsaW5rIGlzRXJyb3J9LgogKgogKiBAcGFyYW0gd2F0IEEgdmFsdWUgdG8gYmUgY2hlY2tlZC4KICogQHJldHVybnMgQSBib29sZWFuIHJlcHJlc2VudGluZyB0aGUgcmVzdWx0LgogKi8KZnVuY3Rpb24gaXNFcnJvcih3YXQpIHsKICBzd2l0Y2ggKG9iamVjdFRvU3RyaW5nLmNhbGwod2F0KSkgewogICAgY2FzZSAnW29iamVjdCBFcnJvcl0nOgogICAgY2FzZSAnW29iamVjdCBFeGNlcHRpb25dJzoKICAgIGNhc2UgJ1tvYmplY3QgRE9NRXhjZXB0aW9uXSc6CiAgICAgIHJldHVybiB0cnVlOwogICAgZGVmYXVsdDoKICAgICAgcmV0dXJuIGlzSW5zdGFuY2VPZih3YXQsIEVycm9yKTsKICB9Cn0KLyoqCiAqIENoZWNrcyB3aGV0aGVyIGdpdmVuIHZhbHVlIGlzIGFuIGluc3RhbmNlIG9mIHRoZSBnaXZlbiBidWlsdC1pbiBjbGFzcy4KICoKICogQHBhcmFtIHdhdCBUaGUgdmFsdWUgdG8gYmUgY2hlY2tlZAogKiBAcGFyYW0gY2xhc3NOYW1lCiAqIEByZXR1cm5zIEEgYm9vbGVhbiByZXByZXNlbnRpbmcgdGhlIHJlc3VsdC4KICovCmZ1bmN0aW9uIGlzQnVpbHRpbih3YXQsIGNsYXNzTmFtZSkgewogIHJldHVybiBvYmplY3RUb1N0cmluZy5jYWxsKHdhdCkgPT09IGBbb2JqZWN0ICR7Y2xhc3NOYW1lfV1gOwp9CgovKioKICogQ2hlY2tzIHdoZXRoZXIgZ2l2ZW4gdmFsdWUncyB0eXBlIGlzIGEgc3RyaW5nCiAqIHtAbGluayBpc1N0cmluZ30uCiAqCiAqIEBwYXJhbSB3YXQgQSB2YWx1ZSB0byBiZSBjaGVja2VkLgogKiBAcmV0dXJucyBBIGJvb2xlYW4gcmVwcmVzZW50aW5nIHRoZSByZXN1bHQuCiAqLwpmdW5jdGlvbiBpc1N0cmluZyh3YXQpIHsKICByZXR1cm4gaXNCdWlsdGluKHdhdCwgJ1N0cmluZycpOwp9CgovKioKICogQ2hlY2tzIHdoZXRoZXIgZ2l2ZW4gdmFsdWUncyB0eXBlIGlzIGFuIG9iamVjdCBsaXRlcmFsLCBvciBhIGNsYXNzIGluc3RhbmNlLgogKiB7QGxpbmsgaXNQbGFpbk9iamVjdH0uCiAqCiAqIEBwYXJhbSB3YXQgQSB2YWx1ZSB0byBiZSBjaGVja2VkLgogKiBAcmV0dXJucyBBIGJvb2xlYW4gcmVwcmVzZW50aW5nIHRoZSByZXN1bHQuCiAqLwpmdW5jdGlvbiBpc1BsYWluT2JqZWN0KHdhdCkgewogIHJldHVybiBpc0J1aWx0aW4od2F0LCAnT2JqZWN0Jyk7Cn0KCi8qKgogKiBDaGVja3Mgd2hldGhlciBnaXZlbiB2YWx1ZSdzIHR5cGUgaXMgYW4gRXZlbnQgaW5zdGFuY2UKICoge0BsaW5rIGlzRXZlbnR9LgogKgogKiBAcGFyYW0gd2F0IEEgdmFsdWUgdG8gYmUgY2hlY2tlZC4KICogQHJldHVybnMgQSBib29sZWFuIHJlcHJlc2VudGluZyB0aGUgcmVzdWx0LgogKi8KZnVuY3Rpb24gaXNFdmVudCh3YXQpIHsKICByZXR1cm4gdHlwZW9mIEV2ZW50ICE9PSAndW5kZWZpbmVkJyAmJiBpc0luc3RhbmNlT2Yod2F0LCBFdmVudCk7Cn0KCi8qKgogKiBDaGVja3Mgd2hldGhlciBnaXZlbiB2YWx1ZSdzIHR5cGUgaXMgYW4gRWxlbWVudCBpbnN0YW5jZQogKiB7QGxpbmsgaXNFbGVtZW50fS4KICoKICogQHBhcmFtIHdhdCBBIHZhbHVlIHRvIGJlIGNoZWNrZWQuCiAqIEByZXR1cm5zIEEgYm9vbGVhbiByZXByZXNlbnRpbmcgdGhlIHJlc3VsdC4KICovCmZ1bmN0aW9uIGlzRWxlbWVudCh3YXQpIHsKICByZXR1cm4gdHlwZW9mIEVsZW1lbnQgIT09ICd1bmRlZmluZWQnICYmIGlzSW5zdGFuY2VPZih3YXQsIEVsZW1lbnQpOwp9CgovKioKICogQ2hlY2tzIHdoZXRoZXIgZ2l2ZW4gdmFsdWUgaGFzIGEgdGhlbiBmdW5jdGlvbi4KICogQHBhcmFtIHdhdCBBIHZhbHVlIHRvIGJlIGNoZWNrZWQuCiAqLwpmdW5jdGlvbiBpc1RoZW5hYmxlKHdhdCkgewogIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdW5zYWZlLW1lbWJlci1hY2Nlc3MKICByZXR1cm4gQm9vbGVhbih3YXQgJiYgd2F0LnRoZW4gJiYgdHlwZW9mIHdhdC50aGVuID09PSAnZnVuY3Rpb24nKTsKfQoKLyoqCiAqIENoZWNrcyB3aGV0aGVyIGdpdmVuIHZhbHVlJ3MgdHlwZSBpcyBhIFN5bnRoZXRpY0V2ZW50CiAqIHtAbGluayBpc1N5bnRoZXRpY0V2ZW50fS4KICoKICogQHBhcmFtIHdhdCBBIHZhbHVlIHRvIGJlIGNoZWNrZWQuCiAqIEByZXR1cm5zIEEgYm9vbGVhbiByZXByZXNlbnRpbmcgdGhlIHJlc3VsdC4KICovCmZ1bmN0aW9uIGlzU3ludGhldGljRXZlbnQod2F0KSB7CiAgcmV0dXJuIGlzUGxhaW5PYmplY3Qod2F0KSAmJiAnbmF0aXZlRXZlbnQnIGluIHdhdCAmJiAncHJldmVudERlZmF1bHQnIGluIHdhdCAmJiAnc3RvcFByb3BhZ2F0aW9uJyBpbiB3YXQ7Cn0KCi8qKgogKiBDaGVja3Mgd2hldGhlciBnaXZlbiB2YWx1ZSBpcyBOYU4KICoge0BsaW5rIGlzTmFOfS4KICoKICogQHBhcmFtIHdhdCBBIHZhbHVlIHRvIGJlIGNoZWNrZWQuCiAqIEByZXR1cm5zIEEgYm9vbGVhbiByZXByZXNlbnRpbmcgdGhlIHJlc3VsdC4KICovCmZ1bmN0aW9uIGlzTmFOJDEod2F0KSB7CiAgcmV0dXJuIHR5cGVvZiB3YXQgPT09ICdudW1iZXInICYmIHdhdCAhPT0gd2F0Owp9CgovKioKICogQ2hlY2tzIHdoZXRoZXIgZ2l2ZW4gdmFsdWUncyB0eXBlIGlzIGFuIGluc3RhbmNlIG9mIHByb3ZpZGVkIGNvbnN0cnVjdG9yLgogKiB7QGxpbmsgaXNJbnN0YW5jZU9mfS4KICoKICogQHBhcmFtIHdhdCBBIHZhbHVlIHRvIGJlIGNoZWNrZWQuCiAqIEBwYXJhbSBiYXNlIEEgY29uc3RydWN0b3IgdG8gYmUgdXNlZCBpbiBhIGNoZWNrLgogKiBAcmV0dXJucyBBIGJvb2xlYW4gcmVwcmVzZW50aW5nIHRoZSByZXN1bHQuCiAqLwpmdW5jdGlvbiBpc0luc3RhbmNlT2Yod2F0LCBiYXNlKSB7CiAgdHJ5IHsKICAgIHJldHVybiB3YXQgaW5zdGFuY2VvZiBiYXNlOwogIH0gY2F0Y2ggKF9lKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQp9CgovKioKICogQ2hlY2tzIHdoZXRoZXIgZ2l2ZW4gdmFsdWUncyB0eXBlIGlzIGEgVnVlIFZpZXdNb2RlbC4KICoKICogQHBhcmFtIHdhdCBBIHZhbHVlIHRvIGJlIGNoZWNrZWQuCiAqIEByZXR1cm5zIEEgYm9vbGVhbiByZXByZXNlbnRpbmcgdGhlIHJlc3VsdC4KICovCmZ1bmN0aW9uIGlzVnVlVmlld01vZGVsKHdhdCkgewogIC8vIE5vdCB1c2luZyBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nIGJlY2F1c2UgaW4gVnVlIDMgaXQgd291bGQgcmVhZCB0aGUgaW5zdGFuY2UncyBTeW1ib2woU3ltYm9sLnRvU3RyaW5nVGFnKSBwcm9wZXJ0eS4KICByZXR1cm4gISEodHlwZW9mIHdhdCA9PT0gJ29iamVjdCcgJiYgd2F0ICE9PSBudWxsICYmICgod2F0ICkuX19pc1Z1ZSB8fCAod2F0ICkuX2lzVnVlKSk7Cn0KCi8qKiBJbnRlcm5hbCBnbG9iYWwgd2l0aCBjb21tb24gcHJvcGVydGllcyBhbmQgU2VudHJ5IGV4dGVuc2lvbnMgICovCgovLyBUaGUgY29kZSBiZWxvdyBmb3IgJ2lzR2xvYmFsT2JqJyBhbmQgJ0dMT0JBTF9PQkonIHdhcyBjb3BpZWQgZnJvbSBjb3JlLWpzIGJlZm9yZSBtb2RpZmljYXRpb24KLy8gaHR0cHM6Ly9naXRodWIuY29tL3psb2lyb2NrL2NvcmUtanMvYmxvYi8xYjk0NGRmNTUyODJjZGM5OWM5MGRiNWY0OWViMGI2ZWRhMmNjMGEzL3BhY2thZ2VzL2NvcmUtanMvaW50ZXJuYWxzL2dsb2JhbC5qcwovLyBjb3JlLWpzIGhhcyB0aGUgZm9sbG93aW5nIGxpY2VuY2U6Ci8vCi8vIENvcHlyaWdodCAoYykgMjAxNC0yMDIyIERlbmlzIFB1c2hrYXJldgovLwovLyBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5Ci8vIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsCi8vIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMKLy8gdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbAovLyBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMKLy8gZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczoKLy8KLy8gVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4KLy8gYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuCi8vCi8vIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SCi8vIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLAovLyBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUKLy8gQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUgovLyBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLAovLyBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOCi8vIFRIRSBTT0ZUV0FSRS4KCi8qKiBSZXR1cm5zICdvYmonIGlmIGl0J3MgdGhlIGdsb2JhbCBvYmplY3QsIG90aGVyd2lzZSByZXR1cm5zIHVuZGVmaW5lZCAqLwpmdW5jdGlvbiBpc0dsb2JhbE9iaihvYmopIHsKICByZXR1cm4gb2JqICYmIG9iai5NYXRoID09IE1hdGggPyBvYmogOiB1bmRlZmluZWQ7Cn0KCi8qKiBHZXQncyB0aGUgZ2xvYmFsIG9iamVjdCBmb3IgdGhlIGN1cnJlbnQgSmF2YVNjcmlwdCBydW50aW1lICovCmNvbnN0IEdMT0JBTF9PQkogPQogICh0eXBlb2YgZ2xvYmFsVGhpcyA9PSAnb2JqZWN0JyAmJiBpc0dsb2JhbE9iaihnbG9iYWxUaGlzKSkgfHwKICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcmVzdHJpY3RlZC1nbG9iYWxzCiAgKHR5cGVvZiB3aW5kb3cgPT0gJ29iamVjdCcgJiYgaXNHbG9iYWxPYmood2luZG93KSkgfHwKICAodHlwZW9mIHNlbGYgPT0gJ29iamVjdCcgJiYgaXNHbG9iYWxPYmooc2VsZikpIHx8CiAgKHR5cGVvZiBnbG9iYWwgPT0gJ29iamVjdCcgJiYgaXNHbG9iYWxPYmooZ2xvYmFsKSkgfHwKICAoZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIHRoaXM7CiAgfSkoKSB8fAogIHt9OwoKLyoqCiAqIEBkZXByZWNhdGVkIFVzZSBHTE9CQUxfT0JKIGluc3RlYWQgb3IgV0lORE9XIGZyb20gQHNlbnRyeS9icm93c2VyLiBUaGlzIHdpbGwgYmUgcmVtb3ZlZCBpbiB2OAogKi8KZnVuY3Rpb24gZ2V0R2xvYmFsT2JqZWN0KCkgewogIHJldHVybiBHTE9CQUxfT0JKIDsKfQoKLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGRlcHJlY2F0aW9uL2RlcHJlY2F0aW9uCmNvbnN0IFdJTkRPVyA9IGdldEdsb2JhbE9iamVjdCgpOwoKY29uc3QgREVGQVVMVF9NQVhfU1RSSU5HX0xFTkdUSCA9IDgwOwoKLyoqCiAqIEdpdmVuIGEgY2hpbGQgRE9NIGVsZW1lbnQsIHJldHVybnMgYSBxdWVyeS1zZWxlY3RvciBzdGF0ZW1lbnQgZGVzY3JpYmluZyB0aGF0CiAqIGFuZCBpdHMgYW5jZXN0b3JzCiAqIGUuZy4gW0hUTUxFbGVtZW50XSA9PiBib2R5ID4gZGl2ID4gaW5wdXQjZm9vLmJ0bltuYW1lPWJhel0KICogQHJldHVybnMgZ2VuZXJhdGVkIERPTSBwYXRoCiAqLwpmdW5jdGlvbiBodG1sVHJlZUFzU3RyaW5nKAogIGVsZW0sCiAgb3B0aW9ucyA9IHt9LAopIHsKICBpZiAoIWVsZW0pIHsKICAgIHJldHVybiAnPHVua25vd24+JzsKICB9CgogIC8vIHRyeS9jYXRjaCBib3RoOgogIC8vIC0gYWNjZXNzaW5nIGV2ZW50LnRhcmdldCAoc2VlIGdldHNlbnRyeS9yYXZlbi1qcyM4MzgsICM3NjgpCiAgLy8gLSBgaHRtbFRyZWVBc1N0cmluZ2AgYmVjYXVzZSBpdCdzIGNvbXBsZXgsIGFuZCBqdXN0IGFjY2Vzc2luZyB0aGUgRE9NIGluY29ycmVjdGx5CiAgLy8gLSBjYW4gdGhyb3cgYW4gZXhjZXB0aW9uIGluIHNvbWUgY2lyY3Vtc3RhbmNlcy4KICB0cnkgewogICAgbGV0IGN1cnJlbnRFbGVtID0gZWxlbSA7CiAgICBjb25zdCBNQVhfVFJBVkVSU0VfSEVJR0hUID0gNTsKICAgIGNvbnN0IG91dCA9IFtdOwogICAgbGV0IGhlaWdodCA9IDA7CiAgICBsZXQgbGVuID0gMDsKICAgIGNvbnN0IHNlcGFyYXRvciA9ICcgPiAnOwogICAgY29uc3Qgc2VwTGVuZ3RoID0gc2VwYXJhdG9yLmxlbmd0aDsKICAgIGxldCBuZXh0U3RyOwogICAgY29uc3Qga2V5QXR0cnMgPSBBcnJheS5pc0FycmF5KG9wdGlvbnMpID8gb3B0aW9ucyA6IG9wdGlvbnMua2V5QXR0cnM7CiAgICBjb25zdCBtYXhTdHJpbmdMZW5ndGggPSAoIUFycmF5LmlzQXJyYXkob3B0aW9ucykgJiYgb3B0aW9ucy5tYXhTdHJpbmdMZW5ndGgpIHx8IERFRkFVTFRfTUFYX1NUUklOR19MRU5HVEg7CgogICAgd2hpbGUgKGN1cnJlbnRFbGVtICYmIGhlaWdodCsrIDwgTUFYX1RSQVZFUlNFX0hFSUdIVCkgewogICAgICBuZXh0U3RyID0gX2h0bWxFbGVtZW50QXNTdHJpbmcoY3VycmVudEVsZW0sIGtleUF0dHJzKTsKICAgICAgLy8gYmFpbCBvdXQgaWYKICAgICAgLy8gLSBuZXh0U3RyIGlzIHRoZSAnaHRtbCcgZWxlbWVudAogICAgICAvLyAtIHRoZSBsZW5ndGggb2YgdGhlIHN0cmluZyB0aGF0IHdvdWxkIGJlIGNyZWF0ZWQgZXhjZWVkcyBtYXhTdHJpbmdMZW5ndGgKICAgICAgLy8gICAoaWdub3JlIHRoaXMgbGltaXQgaWYgd2UgYXJlIG9uIHRoZSBmaXJzdCBpdGVyYXRpb24pCiAgICAgIGlmIChuZXh0U3RyID09PSAnaHRtbCcgfHwgKGhlaWdodCA+IDEgJiYgbGVuICsgb3V0Lmxlbmd0aCAqIHNlcExlbmd0aCArIG5leHRTdHIubGVuZ3RoID49IG1heFN0cmluZ0xlbmd0aCkpIHsKICAgICAgICBicmVhazsKICAgICAgfQoKICAgICAgb3V0LnB1c2gobmV4dFN0cik7CgogICAgICBsZW4gKz0gbmV4dFN0ci5sZW5ndGg7CiAgICAgIGN1cnJlbnRFbGVtID0gY3VycmVudEVsZW0ucGFyZW50Tm9kZTsKICAgIH0KCiAgICByZXR1cm4gb3V0LnJldmVyc2UoKS5qb2luKHNlcGFyYXRvcik7CiAgfSBjYXRjaCAoX29PKSB7CiAgICByZXR1cm4gJzx1bmtub3duPic7CiAgfQp9CgovKioKICogUmV0dXJucyBhIHNpbXBsZSwgcXVlcnktc2VsZWN0b3IgcmVwcmVzZW50YXRpb24gb2YgYSBET00gZWxlbWVudAogKiBlLmcuIFtIVE1MRWxlbWVudF0gPT4gaW5wdXQjZm9vLmJ0bltuYW1lPWJhel0KICogQHJldHVybnMgZ2VuZXJhdGVkIERPTSBwYXRoCiAqLwpmdW5jdGlvbiBfaHRtbEVsZW1lbnRBc1N0cmluZyhlbCwga2V5QXR0cnMpIHsKICBjb25zdCBlbGVtID0gZWwKCjsKCiAgY29uc3Qgb3V0ID0gW107CiAgbGV0IGNsYXNzTmFtZTsKICBsZXQgY2xhc3NlczsKICBsZXQga2V5OwogIGxldCBhdHRyOwogIGxldCBpOwoKICBpZiAoIWVsZW0gfHwgIWVsZW0udGFnTmFtZSkgewogICAgcmV0dXJuICcnOwogIH0KCiAgLy8gQHRzLWV4cGVjdC1lcnJvciBXSU5ET1cgaGFzIEhUTUxFbGVtZW50CiAgaWYgKFdJTkRPVy5IVE1MRWxlbWVudCkgewogICAgLy8gSWYgdXNpbmcgdGhlIGNvbXBvbmVudCBuYW1lIGFubm90YXRpb24gcGx1Z2luLCB0aGlzIHZhbHVlIG1heSBiZSBhdmFpbGFibGUgb24gdGhlIERPTSBub2RlCiAgICBpZiAoZWxlbSBpbnN0YW5jZW9mIEhUTUxFbGVtZW50ICYmIGVsZW0uZGF0YXNldCAmJiBlbGVtLmRhdGFzZXRbJ3NlbnRyeUNvbXBvbmVudCddKSB7CiAgICAgIHJldHVybiBlbGVtLmRhdGFzZXRbJ3NlbnRyeUNvbXBvbmVudCddOwogICAgfQogIH0KCiAgb3V0LnB1c2goZWxlbS50YWdOYW1lLnRvTG93ZXJDYXNlKCkpOwoKICAvLyBQYWlycyBvZiBhdHRyaWJ1dGUga2V5cyBkZWZpbmVkIGluIGBzZXJpYWxpemVBdHRyaWJ1dGVgIGFuZCB0aGVpciB2YWx1ZXMgb24gZWxlbWVudC4KICBjb25zdCBrZXlBdHRyUGFpcnMgPQogICAga2V5QXR0cnMgJiYga2V5QXR0cnMubGVuZ3RoCiAgICAgID8ga2V5QXR0cnMuZmlsdGVyKGtleUF0dHIgPT4gZWxlbS5nZXRBdHRyaWJ1dGUoa2V5QXR0cikpLm1hcChrZXlBdHRyID0+IFtrZXlBdHRyLCBlbGVtLmdldEF0dHJpYnV0ZShrZXlBdHRyKV0pCiAgICAgIDogbnVsbDsKCiAgaWYgKGtleUF0dHJQYWlycyAmJiBrZXlBdHRyUGFpcnMubGVuZ3RoKSB7CiAgICBrZXlBdHRyUGFpcnMuZm9yRWFjaChrZXlBdHRyUGFpciA9PiB7CiAgICAgIG91dC5wdXNoKGBbJHtrZXlBdHRyUGFpclswXX09IiR7a2V5QXR0clBhaXJbMV19Il1gKTsKICAgIH0pOwogIH0gZWxzZSB7CiAgICBpZiAoZWxlbS5pZCkgewogICAgICBvdXQucHVzaChgIyR7ZWxlbS5pZH1gKTsKICAgIH0KCiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcHJlZmVyLWNvbnN0CiAgICBjbGFzc05hbWUgPSBlbGVtLmNsYXNzTmFtZTsKICAgIGlmIChjbGFzc05hbWUgJiYgaXNTdHJpbmcoY2xhc3NOYW1lKSkgewogICAgICBjbGFzc2VzID0gY2xhc3NOYW1lLnNwbGl0KC9ccysvKTsKICAgICAgZm9yIChpID0gMDsgaSA8IGNsYXNzZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBvdXQucHVzaChgLiR7Y2xhc3Nlc1tpXX1gKTsKICAgICAgfQogICAgfQogIH0KICBjb25zdCBhbGxvd2VkQXR0cnMgPSBbJ2FyaWEtbGFiZWwnLCAndHlwZScsICduYW1lJywgJ3RpdGxlJywgJ2FsdCddOwogIGZvciAoaSA9IDA7IGkgPCBhbGxvd2VkQXR0cnMubGVuZ3RoOyBpKyspIHsKICAgIGtleSA9IGFsbG93ZWRBdHRyc1tpXTsKICAgIGF0dHIgPSBlbGVtLmdldEF0dHJpYnV0ZShrZXkpOwogICAgaWYgKGF0dHIpIHsKICAgICAgb3V0LnB1c2goYFske2tleX09IiR7YXR0cn0iXWApOwogICAgfQogIH0KICByZXR1cm4gb3V0LmpvaW4oJycpOwp9CgovKioKICogVGhpcyBzZXJ2ZXMgYXMgYSBidWlsZCB0aW1lIGZsYWcgdGhhdCB3aWxsIGJlIHRydWUgYnkgZGVmYXVsdCwgYnV0IGZhbHNlIGluIG5vbi1kZWJ1ZyBidWlsZHMgb3IgaWYgdXNlcnMgcmVwbGFjZSBgX19TRU5UUllfREVCVUdfX2AgaW4gdGhlaXIgZ2VuZXJhdGVkIGNvZGUuCiAqCiAqIEFUVEVOVElPTjogVGhpcyBjb25zdGFudCBtdXN0IG5ldmVyIGNyb3NzIHBhY2thZ2UgYm91bmRhcmllcyAoaS5lLiBiZSBleHBvcnRlZCkgdG8gZ3VhcmFudGVlIHRoYXQgaXQgY2FuIGJlIHVzZWQgZm9yIHRyZWUgc2hha2luZy4KICovCmNvbnN0IERFQlVHX0JVSUxEJDEgPSAodHlwZW9mIF9fU0VOVFJZX0RFQlVHX18gPT09ICd1bmRlZmluZWQnIHx8IF9fU0VOVFJZX0RFQlVHX18pOwoKLyoqIFByZWZpeCBmb3IgbG9nZ2luZyBzdHJpbmdzICovCmNvbnN0IFBSRUZJWCA9ICdTZW50cnkgTG9nZ2VyICc7Cgpjb25zdCBDT05TT0xFX0xFVkVMUyA9IFsKICAnZGVidWcnLAogICdpbmZvJywKICAnd2FybicsCiAgJ2Vycm9yJywKICAnbG9nJywKICAnYXNzZXJ0JywKICAndHJhY2UnLApdIDsKCi8qKiBUaGlzIG1heSBiZSBtdXRhdGVkIGJ5IHRoZSBjb25zb2xlIGluc3RydW1lbnRhdGlvbi4gKi8KY29uc3Qgb3JpZ2luYWxDb25zb2xlTWV0aG9kcwoKID0ge307CgovKiogSlNEb2MgKi8KCi8qKgogKiBUZW1wb3JhcmlseSBkaXNhYmxlIHNlbnRyeSBjb25zb2xlIGluc3RydW1lbnRhdGlvbnMuCiAqCiAqIEBwYXJhbSBjYWxsYmFjayBUaGUgZnVuY3Rpb24gdG8gcnVuIGFnYWluc3QgdGhlIG9yaWdpbmFsIGBjb25zb2xlYCBtZXNzYWdlcwogKiBAcmV0dXJucyBUaGUgcmVzdWx0cyBvZiB0aGUgY2FsbGJhY2sKICovCmZ1bmN0aW9uIGNvbnNvbGVTYW5kYm94KGNhbGxiYWNrKSB7CiAgaWYgKCEoJ2NvbnNvbGUnIGluIEdMT0JBTF9PQkopKSB7CiAgICByZXR1cm4gY2FsbGJhY2soKTsKICB9CgogIGNvbnN0IGNvbnNvbGUgPSBHTE9CQUxfT0JKLmNvbnNvbGUgOwogIGNvbnN0IHdyYXBwZWRGdW5jcyA9IHt9OwoKICBjb25zdCB3cmFwcGVkTGV2ZWxzID0gT2JqZWN0LmtleXMob3JpZ2luYWxDb25zb2xlTWV0aG9kcykgOwoKICAvLyBSZXN0b3JlIGFsbCB3cmFwcGVkIGNvbnNvbGUgbWV0aG9kcwogIHdyYXBwZWRMZXZlbHMuZm9yRWFjaChsZXZlbCA9PiB7CiAgICBjb25zdCBvcmlnaW5hbENvbnNvbGVNZXRob2QgPSBvcmlnaW5hbENvbnNvbGVNZXRob2RzW2xldmVsXSA7CiAgICB3cmFwcGVkRnVuY3NbbGV2ZWxdID0gY29uc29sZVtsZXZlbF0gOwogICAgY29uc29sZVtsZXZlbF0gPSBvcmlnaW5hbENvbnNvbGVNZXRob2Q7CiAgfSk7CgogIHRyeSB7CiAgICByZXR1cm4gY2FsbGJhY2soKTsKICB9IGZpbmFsbHkgewogICAgLy8gUmV2ZXJ0IHJlc3RvcmF0aW9uIHRvIHdyYXBwZWQgc3RhdGUKICAgIHdyYXBwZWRMZXZlbHMuZm9yRWFjaChsZXZlbCA9PiB7CiAgICAgIGNvbnNvbGVbbGV2ZWxdID0gd3JhcHBlZEZ1bmNzW2xldmVsXSA7CiAgICB9KTsKICB9Cn0KCmZ1bmN0aW9uIG1ha2VMb2dnZXIoKSB7CiAgbGV0IGVuYWJsZWQgPSBmYWxzZTsKICBjb25zdCBsb2dnZXIgPSB7CiAgICBlbmFibGU6ICgpID0+IHsKICAgICAgZW5hYmxlZCA9IHRydWU7CiAgICB9LAogICAgZGlzYWJsZTogKCkgPT4gewogICAgICBlbmFibGVkID0gZmFsc2U7CiAgICB9LAogICAgaXNFbmFibGVkOiAoKSA9PiBlbmFibGVkLAogIH07CgogIGlmIChERUJVR19CVUlMRCQxKSB7CiAgICBDT05TT0xFX0xFVkVMUy5mb3JFYWNoKG5hbWUgPT4gewogICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueQogICAgICBsb2dnZXJbbmFtZV0gPSAoLi4uYXJncykgPT4gewogICAgICAgIGlmIChlbmFibGVkKSB7CiAgICAgICAgICBjb25zb2xlU2FuZGJveCgoKSA9PiB7CiAgICAgICAgICAgIEdMT0JBTF9PQkouY29uc29sZVtuYW1lXShgJHtQUkVGSVh9WyR7bmFtZX1dOmAsIC4uLmFyZ3MpOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9OwogICAgfSk7CiAgfSBlbHNlIHsKICAgIENPTlNPTEVfTEVWRUxTLmZvckVhY2gobmFtZSA9PiB7CiAgICAgIGxvZ2dlcltuYW1lXSA9ICgpID0+IHVuZGVmaW5lZDsKICAgIH0pOwogIH0KCiAgcmV0dXJuIGxvZ2dlciA7Cn0KCmNvbnN0IGxvZ2dlciA9IG1ha2VMb2dnZXIoKTsKCi8qKgogKiBSZW5kZXJzIHRoZSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhpcyBEc24uCiAqCiAqIEJ5IGRlZmF1bHQsIHRoaXMgd2lsbCByZW5kZXIgdGhlIHB1YmxpYyByZXByZXNlbnRhdGlvbiB3aXRob3V0IHRoZSBwYXNzd29yZAogKiBjb21wb25lbnQuIFRvIGdldCB0aGUgZGVwcmVjYXRlZCBwcml2YXRlIHJlcHJlc2VudGF0aW9uLCBzZXQgYHdpdGhQYXNzd29yZGAKICogdG8gdHJ1ZS4KICoKICogQHBhcmFtIHdpdGhQYXNzd29yZCBXaGVuIHNldCB0byB0cnVlLCB0aGUgcGFzc3dvcmQgd2lsbCBiZSBpbmNsdWRlZC4KICovCmZ1bmN0aW9uIGRzblRvU3RyaW5nKGRzbiwgd2l0aFBhc3N3b3JkID0gZmFsc2UpIHsKICBjb25zdCB7IGhvc3QsIHBhdGgsIHBhc3MsIHBvcnQsIHByb2plY3RJZCwgcHJvdG9jb2wsIHB1YmxpY0tleSB9ID0gZHNuOwogIHJldHVybiAoCiAgICBgJHtwcm90b2NvbH06Ly8ke3B1YmxpY0tleX0ke3dpdGhQYXNzd29yZCAmJiBwYXNzID8gYDoke3Bhc3N9YCA6ICcnfWAgKwogICAgYEAke2hvc3R9JHtwb3J0ID8gYDoke3BvcnR9YCA6ICcnfS8ke3BhdGggPyBgJHtwYXRofS9gIDogcGF0aH0ke3Byb2plY3RJZH1gCiAgKTsKfQoKLyoqIEFuIGVycm9yIGVtaXR0ZWQgYnkgU2VudHJ5IFNES3MgYW5kIHJlbGF0ZWQgdXRpbGl0aWVzLiAqLwpjbGFzcyBTZW50cnlFcnJvciBleHRlbmRzIEVycm9yIHsKICAvKiogRGlzcGxheSBuYW1lIG9mIHRoaXMgZXJyb3IgaW5zdGFuY2UuICovCgogICBjb25zdHJ1Y3RvciggbWVzc2FnZSwgbG9nTGV2ZWwgPSAnd2FybicpIHsKICAgIHN1cGVyKG1lc3NhZ2UpO3RoaXMubWVzc2FnZSA9IG1lc3NhZ2U7CiAgICB0aGlzLm5hbWUgPSBuZXcudGFyZ2V0LnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5uYW1lOwogICAgLy8gVGhpcyBzZXRzIHRoZSBwcm90b3R5cGUgdG8gYmUgYEVycm9yYCwgbm90IGBTZW50cnlFcnJvcmAuIEl0J3MgdW5jbGVhciB3aHkgd2UgZG8gdGhpcywgYnV0IGNvbW1lbnRpbmcgdGhpcyBsaW5lCiAgICAvLyBvdXQgY2F1c2VzIHZhcmlvdXMgKHNlZW1pbmdseSB0b3RhbGx5IHVucmVsYXRlZCkgcGxheXdyaWdodCB0ZXN0cyBjb25zaXN0ZW50bHkgdGltZSBvdXQuIEZZSSwgdGhpcyBtYWtlcwogICAgLy8gaW5zdGFuY2VzIG9mIGBTZW50cnlFcnJvcmAgZmFpbCBgb2JqIGluc3RhbmNlb2YgU2VudHJ5RXJyb3JgIGNoZWNrcy4KICAgIE9iamVjdC5zZXRQcm90b3R5cGVPZih0aGlzLCBuZXcudGFyZ2V0LnByb3RvdHlwZSk7CiAgICB0aGlzLmxvZ0xldmVsID0gbG9nTGV2ZWw7CiAgfQp9CgovKioKICogRW5jb2RlcyBnaXZlbiBvYmplY3QgaW50byB1cmwtZnJpZW5kbHkgZm9ybWF0CiAqCiAqIEBwYXJhbSBvYmplY3QgQW4gb2JqZWN0IHRoYXQgY29udGFpbnMgc2VyaWFsaXphYmxlIHZhbHVlcwogKiBAcmV0dXJucyBzdHJpbmcgRW5jb2RlZAogKi8KZnVuY3Rpb24gdXJsRW5jb2RlKG9iamVjdCkgewogIHJldHVybiBPYmplY3Qua2V5cyhvYmplY3QpCiAgICAubWFwKGtleSA9PiBgJHtlbmNvZGVVUklDb21wb25lbnQoa2V5KX09JHtlbmNvZGVVUklDb21wb25lbnQob2JqZWN0W2tleV0pfWApCiAgICAuam9pbignJicpOwp9CgovKioKICogVHJhbnNmb3JtcyBhbnkgYEVycm9yYCBvciBgRXZlbnRgIGludG8gYSBwbGFpbiBvYmplY3Qgd2l0aCBhbGwgb2YgdGhlaXIgZW51bWVyYWJsZSBwcm9wZXJ0aWVzLCBhbmQgc29tZSBvZiB0aGVpcgogKiBub24tZW51bWVyYWJsZSBwcm9wZXJ0aWVzIGF0dGFjaGVkLgogKgogKiBAcGFyYW0gdmFsdWUgSW5pdGlhbCBzb3VyY2UgdGhhdCB3ZSBoYXZlIHRvIHRyYW5zZm9ybSBpbiBvcmRlciBmb3IgaXQgdG8gYmUgdXNhYmxlIGJ5IHRoZSBzZXJpYWxpemVyCiAqIEByZXR1cm5zIEFuIEV2ZW50IG9yIEVycm9yIHR1cm5lZCBpbnRvIGFuIG9iamVjdCAtIG9yIHRoZSB2YWx1ZSBhcmd1cm1lbnQgaXRzZWxmLCB3aGVuIHZhbHVlIGlzIG5laXRoZXIgYW4gRXZlbnQgbm9yCiAqICBhbiBFcnJvci4KICovCmZ1bmN0aW9uIGNvbnZlcnRUb1BsYWluT2JqZWN0KAogIHZhbHVlLAopCgogewogIGlmIChpc0Vycm9yKHZhbHVlKSkgewogICAgcmV0dXJuIHsKICAgICAgbWVzc2FnZTogdmFsdWUubWVzc2FnZSwKICAgICAgbmFtZTogdmFsdWUubmFtZSwKICAgICAgc3RhY2s6IHZhbHVlLnN0YWNrLAogICAgICAuLi5nZXRPd25Qcm9wZXJ0aWVzKHZhbHVlKSwKICAgIH07CiAgfSBlbHNlIGlmIChpc0V2ZW50KHZhbHVlKSkgewogICAgY29uc3QgbmV3T2JqCgogPSB7CiAgICAgIHR5cGU6IHZhbHVlLnR5cGUsCiAgICAgIHRhcmdldDogc2VyaWFsaXplRXZlbnRUYXJnZXQodmFsdWUudGFyZ2V0KSwKICAgICAgY3VycmVudFRhcmdldDogc2VyaWFsaXplRXZlbnRUYXJnZXQodmFsdWUuY3VycmVudFRhcmdldCksCiAgICAgIC4uLmdldE93blByb3BlcnRpZXModmFsdWUpLAogICAgfTsKCiAgICBpZiAodHlwZW9mIEN1c3RvbUV2ZW50ICE9PSAndW5kZWZpbmVkJyAmJiBpc0luc3RhbmNlT2YodmFsdWUsIEN1c3RvbUV2ZW50KSkgewogICAgICBuZXdPYmouZGV0YWlsID0gdmFsdWUuZGV0YWlsOwogICAgfQoKICAgIHJldHVybiBuZXdPYmo7CiAgfSBlbHNlIHsKICAgIHJldHVybiB2YWx1ZTsKICB9Cn0KCi8qKiBDcmVhdGVzIGEgc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIHRoZSB0YXJnZXQgb2YgYW4gYEV2ZW50YCBvYmplY3QgKi8KZnVuY3Rpb24gc2VyaWFsaXplRXZlbnRUYXJnZXQodGFyZ2V0KSB7CiAgdHJ5IHsKICAgIHJldHVybiBpc0VsZW1lbnQodGFyZ2V0KSA/IGh0bWxUcmVlQXNTdHJpbmcodGFyZ2V0KSA6IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh0YXJnZXQpOwogIH0gY2F0Y2ggKF9vTykgewogICAgcmV0dXJuICc8dW5rbm93bj4nOwogIH0KfQoKLyoqIEZpbHRlcnMgb3V0IGFsbCBidXQgYW4gb2JqZWN0J3Mgb3duIHByb3BlcnRpZXMgKi8KZnVuY3Rpb24gZ2V0T3duUHJvcGVydGllcyhvYmopIHsKICBpZiAodHlwZW9mIG9iaiA9PT0gJ29iamVjdCcgJiYgb2JqICE9PSBudWxsKSB7CiAgICBjb25zdCBleHRyYWN0ZWRQcm9wcyA9IHt9OwogICAgZm9yIChjb25zdCBwcm9wZXJ0eSBpbiBvYmopIHsKICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIHByb3BlcnR5KSkgewogICAgICAgIGV4dHJhY3RlZFByb3BzW3Byb3BlcnR5XSA9IChvYmogKVtwcm9wZXJ0eV07CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBleHRyYWN0ZWRQcm9wczsKICB9IGVsc2UgewogICAgcmV0dXJuIHt9OwogIH0KfQoKLyoqCiAqIEdpdmVuIGFueSBvYmplY3QsIHJldHVybiBhIG5ldyBvYmplY3QgaGF2aW5nIHJlbW92ZWQgYWxsIGZpZWxkcyB3aG9zZSB2YWx1ZSB3YXMgYHVuZGVmaW5lZGAuCiAqIFdvcmtzIHJlY3Vyc2l2ZWx5IG9uIG9iamVjdHMgYW5kIGFycmF5cy4KICoKICogQXR0ZW50aW9uOiBUaGlzIGZ1bmN0aW9uIGtlZXBzIGNpcmN1bGFyIHJlZmVyZW5jZXMgaW4gdGhlIHJldHVybmVkIG9iamVjdC4KICovCmZ1bmN0aW9uIGRyb3BVbmRlZmluZWRLZXlzKGlucHV0VmFsdWUpIHsKICAvLyBUaGlzIG1hcCBrZWVwcyB0cmFjayBvZiB3aGF0IGFscmVhZHkgdmlzaXRlZCBub2RlcyBtYXAgdG8uCiAgLy8gT3VyIFNldCAtIGJhc2VkIG1lbW9CdWlsZGVyIGRvZXNuJ3Qgd29yayBoZXJlIGJlY2F1c2Ugd2Ugd2FudCB0byB0aGUgb3V0cHV0IG9iamVjdCB0byBoYXZlIHRoZSBzYW1lIGNpcmN1bGFyCiAgLy8gcmVmZXJlbmNlcyBhcyB0aGUgaW5wdXQgb2JqZWN0LgogIGNvbnN0IG1lbW9pemF0aW9uTWFwID0gbmV3IE1hcCgpOwoKICAvLyBUaGlzIGZ1bmN0aW9uIGp1c3QgcHJveGllcyBgX2Ryb3BVbmRlZmluZWRLZXlzYCB0byBrZWVwIHRoZSBgbWVtb0J1aWxkZXJgIG91dCBvZiB0aGlzIGZ1bmN0aW9uJ3MgQVBJCiAgcmV0dXJuIF9kcm9wVW5kZWZpbmVkS2V5cyhpbnB1dFZhbHVlLCBtZW1vaXphdGlvbk1hcCk7Cn0KCmZ1bmN0aW9uIF9kcm9wVW5kZWZpbmVkS2V5cyhpbnB1dFZhbHVlLCBtZW1vaXphdGlvbk1hcCkgewogIGlmIChpc1Bvam8oaW5wdXRWYWx1ZSkpIHsKICAgIC8vIElmIHRoaXMgbm9kZSBoYXMgYWxyZWFkeSBiZWVuIHZpc2l0ZWQgZHVlIHRvIGEgY2lyY3VsYXIgcmVmZXJlbmNlLCByZXR1cm4gdGhlIG9iamVjdCBpdCB3YXMgbWFwcGVkIHRvIGluIHRoZSBuZXcgb2JqZWN0CiAgICBjb25zdCBtZW1vVmFsID0gbWVtb2l6YXRpb25NYXAuZ2V0KGlucHV0VmFsdWUpOwogICAgaWYgKG1lbW9WYWwgIT09IHVuZGVmaW5lZCkgewogICAgICByZXR1cm4gbWVtb1ZhbCA7CiAgICB9CgogICAgY29uc3QgcmV0dXJuVmFsdWUgPSB7fTsKICAgIC8vIFN0b3JlIHRoZSBtYXBwaW5nIG9mIHRoaXMgdmFsdWUgaW4gY2FzZSB3ZSB2aXNpdCBpdCBhZ2FpbiwgaW4gY2FzZSBvZiBjaXJjdWxhciBkYXRhCiAgICBtZW1vaXphdGlvbk1hcC5zZXQoaW5wdXRWYWx1ZSwgcmV0dXJuVmFsdWUpOwoKICAgIGZvciAoY29uc3Qga2V5IG9mIE9iamVjdC5rZXlzKGlucHV0VmFsdWUpKSB7CiAgICAgIGlmICh0eXBlb2YgaW5wdXRWYWx1ZVtrZXldICE9PSAndW5kZWZpbmVkJykgewogICAgICAgIHJldHVyblZhbHVlW2tleV0gPSBfZHJvcFVuZGVmaW5lZEtleXMoaW5wdXRWYWx1ZVtrZXldLCBtZW1vaXphdGlvbk1hcCk7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gcmV0dXJuVmFsdWUgOwogIH0KCiAgaWYgKEFycmF5LmlzQXJyYXkoaW5wdXRWYWx1ZSkpIHsKICAgIC8vIElmIHRoaXMgbm9kZSBoYXMgYWxyZWFkeSBiZWVuIHZpc2l0ZWQgZHVlIHRvIGEgY2lyY3VsYXIgcmVmZXJlbmNlLCByZXR1cm4gdGhlIGFycmF5IGl0IHdhcyBtYXBwZWQgdG8gaW4gdGhlIG5ldyBvYmplY3QKICAgIGNvbnN0IG1lbW9WYWwgPSBtZW1vaXphdGlvbk1hcC5nZXQoaW5wdXRWYWx1ZSk7CiAgICBpZiAobWVtb1ZhbCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIHJldHVybiBtZW1vVmFsIDsKICAgIH0KCiAgICBjb25zdCByZXR1cm5WYWx1ZSA9IFtdOwogICAgLy8gU3RvcmUgdGhlIG1hcHBpbmcgb2YgdGhpcyB2YWx1ZSBpbiBjYXNlIHdlIHZpc2l0IGl0IGFnYWluLCBpbiBjYXNlIG9mIGNpcmN1bGFyIGRhdGEKICAgIG1lbW9pemF0aW9uTWFwLnNldChpbnB1dFZhbHVlLCByZXR1cm5WYWx1ZSk7CgogICAgaW5wdXRWYWx1ZS5mb3JFYWNoKChpdGVtKSA9PiB7CiAgICAgIHJldHVyblZhbHVlLnB1c2goX2Ryb3BVbmRlZmluZWRLZXlzKGl0ZW0sIG1lbW9pemF0aW9uTWFwKSk7CiAgICB9KTsKCiAgICByZXR1cm4gcmV0dXJuVmFsdWUgOwogIH0KCiAgcmV0dXJuIGlucHV0VmFsdWU7Cn0KCmZ1bmN0aW9uIGlzUG9qbyhpbnB1dCkgewogIGlmICghaXNQbGFpbk9iamVjdChpbnB1dCkpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CgogIHRyeSB7CiAgICBjb25zdCBuYW1lID0gKE9iamVjdC5nZXRQcm90b3R5cGVPZihpbnB1dCkgKS5jb25zdHJ1Y3Rvci5uYW1lOwogICAgcmV0dXJuICFuYW1lIHx8IG5hbWUgPT09ICdPYmplY3QnOwogIH0gY2F0Y2ggKGUpIHsKICAgIHJldHVybiB0cnVlOwogIH0KfQoKLyoqCiAqIERvZXMgdGhpcyBmaWxlbmFtZSBsb29rIGxpa2UgaXQncyBwYXJ0IG9mIHRoZSBhcHAgY29kZT8KICovCmZ1bmN0aW9uIGZpbGVuYW1lSXNJbkFwcChmaWxlbmFtZSwgaXNOYXRpdmUgPSBmYWxzZSkgewogIGNvbnN0IGlzSW50ZXJuYWwgPQogICAgaXNOYXRpdmUgfHwKICAgIChmaWxlbmFtZSAmJgogICAgICAvLyBJdCdzIG5vdCBpbnRlcm5hbCBpZiBpdCdzIGFuIGFic29sdXRlIGxpbnV4IHBhdGgKICAgICAgIWZpbGVuYW1lLnN0YXJ0c1dpdGgoJy8nKSAmJgogICAgICAvLyBJdCdzIG5vdCBpbnRlcm5hbCBpZiBpdCdzIGFuIGFic29sdXRlIHdpbmRvd3MgcGF0aAogICAgICAhZmlsZW5hbWUubWF0Y2goL15bQS1aXTovKSAmJgogICAgICAvLyBJdCdzIG5vdCBpbnRlcm5hbCBpZiB0aGUgcGF0aCBpcyBzdGFydGluZyB3aXRoIGEgZG90CiAgICAgICFmaWxlbmFtZS5zdGFydHNXaXRoKCcuJykgJiYKICAgICAgLy8gSXQncyBub3QgaW50ZXJuYWwgaWYgdGhlIGZyYW1lIGhhcyBhIHByb3RvY29sLiBJbiBub2RlLCB0aGlzIGlzIHVzdWFsbHkgdGhlIGNhc2UgaWYgdGhlIGZpbGUgZ290IHByZS1wcm9jZXNzZWQgd2l0aCBhIGJ1bmRsZXIgbGlrZSB3ZWJwYWNrCiAgICAgICFmaWxlbmFtZS5tYXRjaCgvXlthLXpBLVpdKFthLXpBLVowLTkuXC0rXSkqOlwvXC8vKSk7IC8vIFNjaGVtYSBmcm9tOiBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL2EvMzY0MTc4MgoKICAvLyBpbl9hcHAgaXMgYWxsIHRoYXQncyBub3QgYW4gaW50ZXJuYWwgTm9kZSBmdW5jdGlvbiBvciBhIG1vZHVsZSB3aXRoaW4gbm9kZV9tb2R1bGVzCiAgLy8gbm90ZSB0aGF0IGlzTmF0aXZlIGFwcGVhcnMgdG8gcmV0dXJuIHRydWUgZXZlbiBmb3Igbm9kZSBjb3JlIGxpYnJhcmllcwogIC8vIHNlZSBodHRwczovL2dpdGh1Yi5jb20vZ2V0c2VudHJ5L3JhdmVuLW5vZGUvaXNzdWVzLzE3NgoKICByZXR1cm4gIWlzSW50ZXJuYWwgJiYgZmlsZW5hbWUgIT09IHVuZGVmaW5lZCAmJiAhZmlsZW5hbWUuaW5jbHVkZXMoJ25vZGVfbW9kdWxlcy8nKTsKfQoKY29uc3QgU1RBQ0tUUkFDRV9GUkFNRV9MSU1JVCA9IDUwOwpjb25zdCBTVFJJUF9GUkFNRV9SRUdFWFAgPSAvY2FwdHVyZU1lc3NhZ2V8Y2FwdHVyZUV4Y2VwdGlvbi87CgovKioKICogUmVtb3ZlcyBTZW50cnkgZnJhbWVzIGZyb20gdGhlIHRvcCBhbmQgYm90dG9tIG9mIHRoZSBzdGFjayBpZiBwcmVzZW50IGFuZCBlbmZvcmNlcyBhIGxpbWl0IG9mIG1heCBudW1iZXIgb2YgZnJhbWVzLgogKiBBc3N1bWVzIHN0YWNrIGlucHV0IGlzIG9yZGVyZWQgZnJvbSB0b3AgdG8gYm90dG9tIGFuZCByZXR1cm5zIHRoZSByZXZlcnNlIHJlcHJlc2VudGF0aW9uIHNvIGNhbGwgc2l0ZSBvZiB0aGUKICogZnVuY3Rpb24gdGhhdCBjYXVzZWQgdGhlIGNyYXNoIGlzIHRoZSBsYXN0IGZyYW1lIGluIHRoZSBhcnJheS4KICogQGhpZGRlbgogKi8KZnVuY3Rpb24gc3RyaXBTZW50cnlGcmFtZXNBbmRSZXZlcnNlKHN0YWNrKSB7CiAgaWYgKCFzdGFjay5sZW5ndGgpIHsKICAgIHJldHVybiBbXTsKICB9CgogIGNvbnN0IGxvY2FsU3RhY2sgPSBBcnJheS5mcm9tKHN0YWNrKTsKCiAgLy8gSWYgc3RhY2sgc3RhcnRzIHdpdGggb25lIG9mIG91ciBBUEkgY2FsbHMsIHJlbW92ZSBpdCAoc3RhcnRzLCBtZWFuaW5nIGl0J3MgdGhlIHRvcCBvZiB0aGUgc3RhY2sgLSBha2EgbGFzdCBjYWxsKQogIGlmICgvc2VudHJ5V3JhcHBlZC8udGVzdChsb2NhbFN0YWNrW2xvY2FsU3RhY2subGVuZ3RoIC0gMV0uZnVuY3Rpb24gfHwgJycpKSB7CiAgICBsb2NhbFN0YWNrLnBvcCgpOwogIH0KCiAgLy8gUmV2ZXJzaW5nIGluIHRoZSBtaWRkbGUgb2YgdGhlIHByb2NlZHVyZSBhbGxvd3MgdXMgdG8ganVzdCBwb3AgdGhlIHZhbHVlcyBvZmYgdGhlIHN0YWNrCiAgbG9jYWxTdGFjay5yZXZlcnNlKCk7CgogIC8vIElmIHN0YWNrIGVuZHMgd2l0aCBvbmUgb2Ygb3VyIGludGVybmFsIEFQSSBjYWxscywgcmVtb3ZlIGl0IChlbmRzLCBtZWFuaW5nIGl0J3MgdGhlIGJvdHRvbSBvZiB0aGUgc3RhY2sgLSBha2EgdG9wLW1vc3QgY2FsbCkKICBpZiAoU1RSSVBfRlJBTUVfUkVHRVhQLnRlc3QobG9jYWxTdGFja1tsb2NhbFN0YWNrLmxlbmd0aCAtIDFdLmZ1bmN0aW9uIHx8ICcnKSkgewogICAgbG9jYWxTdGFjay5wb3AoKTsKCiAgICAvLyBXaGVuIHVzaW5nIHN5bnRoZXRpYyBldmVudHMsIHdlIHdpbGwgaGF2ZSBhIDIgbGV2ZWxzIGRlZXAgc3RhY2ssIGFzIGBuZXcgRXJyb3IoJ1NlbnRyeSBzeW50aGV0aWNFeGNlcHRpb24nKWAKICAgIC8vIGlzIHByb2R1Y2VkIHdpdGhpbiB0aGUgaHViIGl0c2VsZiwgbWFraW5nIGl0OgogICAgLy8KICAgIC8vICAgU2VudHJ5LmNhcHR1cmVFeGNlcHRpb24oKQogICAgLy8gICBnZXRDdXJyZW50SHViKCkuY2FwdHVyZUV4Y2VwdGlvbigpCiAgICAvLwogICAgLy8gaW5zdGVhZCBvZiBqdXN0IHRoZSB0b3AgYFNlbnRyeWAgY2FsbCBpdHNlbGYuCiAgICAvLyBUaGlzIGZvcmNlcyB1cyB0byBwb3NzaWJseSBzdHJpcCBhbiBhZGRpdGlvbmFsIGZyYW1lIGluIHRoZSBleGFjdCBzYW1lIHdhcyBhcyBhYm92ZS4KICAgIGlmIChTVFJJUF9GUkFNRV9SRUdFWFAudGVzdChsb2NhbFN0YWNrW2xvY2FsU3RhY2subGVuZ3RoIC0gMV0uZnVuY3Rpb24gfHwgJycpKSB7CiAgICAgIGxvY2FsU3RhY2sucG9wKCk7CiAgICB9CiAgfQoKICByZXR1cm4gbG9jYWxTdGFjay5zbGljZSgwLCBTVEFDS1RSQUNFX0ZSQU1FX0xJTUlUKS5tYXAoZnJhbWUgPT4gKHsKICAgIC4uLmZyYW1lLAogICAgZmlsZW5hbWU6IGZyYW1lLmZpbGVuYW1lIHx8IGxvY2FsU3RhY2tbbG9jYWxTdGFjay5sZW5ndGggLSAxXS5maWxlbmFtZSwKICAgIGZ1bmN0aW9uOiBmcmFtZS5mdW5jdGlvbiB8fCAnPycsCiAgfSkpOwp9Cgpjb25zdCBkZWZhdWx0RnVuY3Rpb25OYW1lID0gJzxhbm9ueW1vdXM+JzsKCi8qKgogKiBTYWZlbHkgZXh0cmFjdCBmdW5jdGlvbiBuYW1lIGZyb20gaXRzZWxmCiAqLwpmdW5jdGlvbiBnZXRGdW5jdGlvbk5hbWUoZm4pIHsKICB0cnkgewogICAgaWYgKCFmbiB8fCB0eXBlb2YgZm4gIT09ICdmdW5jdGlvbicpIHsKICAgICAgcmV0dXJuIGRlZmF1bHRGdW5jdGlvbk5hbWU7CiAgICB9CiAgICByZXR1cm4gZm4ubmFtZSB8fCBkZWZhdWx0RnVuY3Rpb25OYW1lOwogIH0gY2F0Y2ggKGUpIHsKICAgIC8vIEp1c3QgYWNjZXNzaW5nIGN1c3RvbSBwcm9wcyBpbiBzb21lIFNlbGVuaXVtIGVudmlyb25tZW50cwogICAgLy8gY2FuIGNhdXNlIGEgIlBlcm1pc3Npb24gZGVuaWVkIiBleGNlcHRpb24gKHNlZSByYXZlbi1qcyM0OTUpLgogICAgcmV0dXJuIGRlZmF1bHRGdW5jdGlvbk5hbWU7CiAgfQp9CgovKioKICogVVVJRDQgZ2VuZXJhdG9yCiAqCiAqIEByZXR1cm5zIHN0cmluZyBHZW5lcmF0ZWQgVVVJRDQuCiAqLwpmdW5jdGlvbiB1dWlkNCgpIHsKICBjb25zdCBnYmwgPSBHTE9CQUxfT0JKIDsKICBjb25zdCBjcnlwdG8gPSBnYmwuY3J5cHRvIHx8IGdibC5tc0NyeXB0bzsKCiAgbGV0IGdldFJhbmRvbUJ5dGUgPSAoKSA9PiBNYXRoLnJhbmRvbSgpICogMTY7CiAgdHJ5IHsKICAgIGlmIChjcnlwdG8gJiYgY3J5cHRvLnJhbmRvbVVVSUQpIHsKICAgICAgcmV0dXJuIGNyeXB0by5yYW5kb21VVUlEKCkucmVwbGFjZSgvLS9nLCAnJyk7CiAgICB9CiAgICBpZiAoY3J5cHRvICYmIGNyeXB0by5nZXRSYW5kb21WYWx1ZXMpIHsKICAgICAgZ2V0UmFuZG9tQnl0ZSA9ICgpID0+IHsKICAgICAgICAvLyBjcnlwdG8uZ2V0UmFuZG9tVmFsdWVzIG1pZ2h0IHJldHVybiB1bmRlZmluZWQgaW5zdGVhZCBvZiB0aGUgdHlwZWQgYXJyYXkKICAgICAgICAvLyBpbiBvbGQgQ2hyb21pdW0gdmVyc2lvbnMgKGUuZy4gMjMuMC4xMjM1LjAgKDE1MTQyMikpCiAgICAgICAgLy8gSG93ZXZlciwgYHR5cGVkQXJyYXlgIGlzIHN0aWxsIGZpbGxlZCBpbi1wbGFjZS4KICAgICAgICAvLyBAc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9DcnlwdG8vZ2V0UmFuZG9tVmFsdWVzI3R5cGVkYXJyYXkKICAgICAgICBjb25zdCB0eXBlZEFycmF5ID0gbmV3IFVpbnQ4QXJyYXkoMSk7CiAgICAgICAgY3J5cHRvLmdldFJhbmRvbVZhbHVlcyh0eXBlZEFycmF5KTsKICAgICAgICByZXR1cm4gdHlwZWRBcnJheVswXTsKICAgICAgfTsKICAgIH0KICB9IGNhdGNoIChfKSB7CiAgICAvLyBzb21lIHJ1bnRpbWVzIGNhbiBjcmFzaCBpbnZva2luZyBjcnlwdG8KICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9nZXRzZW50cnkvc2VudHJ5LWphdmFzY3JpcHQvaXNzdWVzLzg5MzUKICB9CgogIC8vIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMTA1MDM0L2hvdy10by1jcmVhdGUtYS1ndWlkLXV1aWQtaW4tamF2YXNjcmlwdC8yMTE3NTIzIzIxMTc1MjMKICAvLyBDb25jYXRlbmF0aW5nIHRoZSBmb2xsb3dpbmcgbnVtYmVycyBhcyBzdHJpbmdzIHJlc3VsdHMgaW4gJzEwMDAwMDAwMTAwMDQwMDA4MDAwMTAwMDAwMDAwMDAwJwogIHJldHVybiAoKFsxZTddICkgKyAxZTMgKyA0ZTMgKyA4ZTMgKyAxZTExKS5yZXBsYWNlKC9bMDE4XS9nLCBjID0+CiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tYml0d2lzZQogICAgKChjICkgXiAoKGdldFJhbmRvbUJ5dGUoKSAmIDE1KSA+PiAoKGMgKSAvIDQpKSkudG9TdHJpbmcoMTYpLAogICk7Cn0KCi8qIGVzbGludC1kaXNhYmxlIEB0eXBlc2NyaXB0LWVzbGludC9uby11bnNhZmUtbWVtYmVyLWFjY2VzcyAqLwovKiBlc2xpbnQtZGlzYWJsZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55ICovCgovKioKICogSGVscGVyIHRvIGRlY3ljbGUganNvbiBvYmplY3RzCiAqLwpmdW5jdGlvbiBtZW1vQnVpbGRlcigpIHsKICBjb25zdCBoYXNXZWFrU2V0ID0gdHlwZW9mIFdlYWtTZXQgPT09ICdmdW5jdGlvbic7CiAgY29uc3QgaW5uZXIgPSBoYXNXZWFrU2V0ID8gbmV3IFdlYWtTZXQoKSA6IFtdOwogIGZ1bmN0aW9uIG1lbW9pemUob2JqKSB7CiAgICBpZiAoaGFzV2Vha1NldCkgewogICAgICBpZiAoaW5uZXIuaGFzKG9iaikpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICBpbm5lci5hZGQob2JqKTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9wcmVmZXItZm9yLW9mCiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGlubmVyLmxlbmd0aDsgaSsrKSB7CiAgICAgIGNvbnN0IHZhbHVlID0gaW5uZXJbaV07CiAgICAgIGlmICh2YWx1ZSA9PT0gb2JqKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgIH0KICAgIGlubmVyLnB1c2gob2JqKTsKICAgIHJldHVybiBmYWxzZTsKICB9CgogIGZ1bmN0aW9uIHVubWVtb2l6ZShvYmopIHsKICAgIGlmIChoYXNXZWFrU2V0KSB7CiAgICAgIGlubmVyLmRlbGV0ZShvYmopOwogICAgfSBlbHNlIHsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpbm5lci5sZW5ndGg7IGkrKykgewogICAgICAgIGlmIChpbm5lcltpXSA9PT0gb2JqKSB7CiAgICAgICAgICBpbm5lci5zcGxpY2UoaSwgMSk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CiAgcmV0dXJuIFttZW1vaXplLCB1bm1lbW9pemVdOwp9CgovKioKICogUmVjdXJzaXZlbHkgbm9ybWFsaXplcyB0aGUgZ2l2ZW4gb2JqZWN0LgogKgogKiAtIENyZWF0ZXMgYSBjb3B5IHRvIHByZXZlbnQgb3JpZ2luYWwgaW5wdXQgbXV0YXRpb24KICogLSBTa2lwcyBub24tZW51bWVyYWJsZSBwcm9wZXJ0aWVzCiAqIC0gV2hlbiBzdHJpbmdpZnlpbmcsIGNhbGxzIGB0b0pTT05gIGlmIGltcGxlbWVudGVkCiAqIC0gUmVtb3ZlcyBjaXJjdWxhciByZWZlcmVuY2VzCiAqIC0gVHJhbnNsYXRlcyBub24tc2VyaWFsaXphYmxlIHZhbHVlcyAoYHVuZGVmaW5lZGAvYE5hTmAvZnVuY3Rpb25zKSB0byBzZXJpYWxpemFibGUgZm9ybWF0CiAqIC0gVHJhbnNsYXRlcyBrbm93biBnbG9iYWwgb2JqZWN0cy9jbGFzc2VzIHRvIGEgc3RyaW5nIHJlcHJlc2VudGF0aW9ucwogKiAtIFRha2VzIGNhcmUgb2YgYEVycm9yYCBvYmplY3Qgc2VyaWFsaXphdGlvbgogKiAtIE9wdGlvbmFsbHkgbGltaXRzIGRlcHRoIG9mIGZpbmFsIG91dHB1dAogKiAtIE9wdGlvbmFsbHkgbGltaXRzIG51bWJlciBvZiBwcm9wZXJ0aWVzL2VsZW1lbnRzIGluY2x1ZGVkIGluIGFueSBzaW5nbGUgb2JqZWN0L2FycmF5CiAqCiAqIEBwYXJhbSBpbnB1dCBUaGUgb2JqZWN0IHRvIGJlIG5vcm1hbGl6ZWQuCiAqIEBwYXJhbSBkZXB0aCBUaGUgbWF4IGRlcHRoIHRvIHdoaWNoIHRvIG5vcm1hbGl6ZSB0aGUgb2JqZWN0LiAoQW55dGhpbmcgZGVlcGVyIHN0cmluZ2lmaWVkIHdob2xlLikKICogQHBhcmFtIG1heFByb3BlcnRpZXMgVGhlIG1heCBudW1iZXIgb2YgZWxlbWVudHMgb3IgcHJvcGVydGllcyB0byBiZSBpbmNsdWRlZCBpbiBhbnkgc2luZ2xlIGFycmF5IG9yCiAqIG9iamVjdCBpbiB0aGUgbm9ybWFsbGl6ZWQgb3V0cHV0LgogKiBAcmV0dXJucyBBIG5vcm1hbGl6ZWQgdmVyc2lvbiBvZiB0aGUgb2JqZWN0LCBvciBgIioqbm9uLXNlcmlhbGl6YWJsZSoqImAgaWYgYW55IGVycm9ycyBhcmUgdGhyb3duIGR1cmluZyBub3JtYWxpemF0aW9uLgogKi8KLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnkKZnVuY3Rpb24gbm9ybWFsaXplKGlucHV0LCBkZXB0aCA9IDEwMCwgbWF4UHJvcGVydGllcyA9ICtJbmZpbml0eSkgewogIHRyeSB7CiAgICAvLyBzaW5jZSB3ZSdyZSBhdCB0aGUgb3V0ZXJtb3N0IGxldmVsLCB3ZSBkb24ndCBwcm92aWRlIGEga2V5CiAgICByZXR1cm4gdmlzaXQoJycsIGlucHV0LCBkZXB0aCwgbWF4UHJvcGVydGllcyk7CiAgfSBjYXRjaCAoZXJyKSB7CiAgICByZXR1cm4geyBFUlJPUjogYCoqbm9uLXNlcmlhbGl6YWJsZSoqICgke2Vycn0pYCB9OwogIH0KfQoKLyoqCiAqIFZpc2l0cyBhIG5vZGUgdG8gcGVyZm9ybSBub3JtYWxpemF0aW9uIG9uIGl0CiAqCiAqIEBwYXJhbSBrZXkgVGhlIGtleSBjb3JyZXNwb25kaW5nIHRvIHRoZSBnaXZlbiBub2RlCiAqIEBwYXJhbSB2YWx1ZSBUaGUgbm9kZSB0byBiZSB2aXNpdGVkCiAqIEBwYXJhbSBkZXB0aCBPcHRpb25hbCBudW1iZXIgaW5kaWNhdGluZyB0aGUgbWF4aW11bSByZWN1cnNpb24gZGVwdGgKICogQHBhcmFtIG1heFByb3BlcnRpZXMgT3B0aW9uYWwgbWF4aW11bSBudW1iZXIgb2YgcHJvcGVydGllcy9lbGVtZW50cyBpbmNsdWRlZCBpbiBhbnkgc2luZ2xlIG9iamVjdC9hcnJheQogKiBAcGFyYW0gbWVtbyBPcHRpb25hbCBNZW1vIGNsYXNzIGhhbmRsaW5nIGRlY3ljbGluZwogKi8KZnVuY3Rpb24gdmlzaXQoCiAga2V5LAogIHZhbHVlLAogIGRlcHRoID0gK0luZmluaXR5LAogIG1heFByb3BlcnRpZXMgPSArSW5maW5pdHksCiAgbWVtbyA9IG1lbW9CdWlsZGVyKCksCikgewogIGNvbnN0IFttZW1vaXplLCB1bm1lbW9pemVdID0gbWVtbzsKCiAgLy8gR2V0IHRoZSBzaW1wbGUgY2FzZXMgb3V0IG9mIHRoZSB3YXkgZmlyc3QKICBpZiAoCiAgICB2YWx1ZSA9PSBudWxsIHx8IC8vIHRoaXMgbWF0Y2hlcyBudWxsIGFuZCB1bmRlZmluZWQgLT4gZXFlcSBub3QgZXFlcWVxCiAgICAoWydudW1iZXInLCAnYm9vbGVhbicsICdzdHJpbmcnXS5pbmNsdWRlcyh0eXBlb2YgdmFsdWUpICYmICFpc05hTiQxKHZhbHVlKSkKICApIHsKICAgIHJldHVybiB2YWx1ZSA7CiAgfQoKICBjb25zdCBzdHJpbmdpZmllZCA9IHN0cmluZ2lmeVZhbHVlKGtleSwgdmFsdWUpOwoKICAvLyBBbnl0aGluZyB3ZSBjb3VsZCBwb3RlbnRpYWxseSBkaWcgaW50byBtb3JlIChvYmplY3RzIG9yIGFycmF5cykgd2lsbCBoYXZlIGNvbWUgYmFjayBhcyBgIltvYmplY3QgWFhYWF0iYC4KICAvLyBFdmVyeXRoaW5nIGVsc2Ugd2lsbCBoYXZlIGFscmVhZHkgYmVlbiBzZXJpYWxpemVkLCBzbyBpZiB3ZSBkb24ndCBzZWUgdGhhdCBwYXR0ZXJuLCB3ZSdyZSBkb25lLgogIGlmICghc3RyaW5naWZpZWQuc3RhcnRzV2l0aCgnW29iamVjdCAnKSkgewogICAgcmV0dXJuIHN0cmluZ2lmaWVkOwogIH0KCiAgLy8gRnJvbSBoZXJlIG9uLCB3ZSBjYW4gYXNzZXJ0IHRoYXQgYHZhbHVlYCBpcyBlaXRoZXIgYW4gb2JqZWN0IG9yIGFuIGFycmF5LgoKICAvLyBEbyBub3Qgbm9ybWFsaXplIG9iamVjdHMgdGhhdCB3ZSBrbm93IGhhdmUgYWxyZWFkeSBiZWVuIG5vcm1hbGl6ZWQuIEFzIGEgZ2VuZXJhbCBydWxlLCB0aGUKICAvLyAiX19zZW50cnlfc2tpcF9ub3JtYWxpemF0aW9uX18iIHByb3BlcnR5IHNob3VsZCBvbmx5IGJlIHVzZWQgc3BhcmluZ2x5IGFuZCBvbmx5IHNob3VsZCBvbmx5IGJlIHNldCBvbiBvYmplY3RzIHRoYXQKICAvLyBoYXZlIGFscmVhZHkgYmVlbiBub3JtYWxpemVkLgogIGlmICgodmFsdWUgKVsnX19zZW50cnlfc2tpcF9ub3JtYWxpemF0aW9uX18nXSkgewogICAgcmV0dXJuIHZhbHVlIDsKICB9CgogIC8vIFdlIGNhbiBzZXQgYF9fc2VudHJ5X292ZXJyaWRlX25vcm1hbGl6YXRpb25fZGVwdGhfX2Agb24gYW4gb2JqZWN0IHRvIGVuc3VyZSB0aGF0IGZyb20gdGhlcmUKICAvLyBXZSBrZWVwIGEgY2VydGFpbiBhbW91bnQgb2YgZGVwdGguCiAgLy8gVGhpcyBzaG91bGQgYmUgdXNlZCBzcGFyaW5nbHksIGUuZy4gd2UgdXNlIGl0IGZvciB0aGUgcmVkdXggaW50ZWdyYXRpb24gdG8gZW5zdXJlIHdlIGdldCBhIGNlcnRhaW4gYW1vdW50IG9mIHN0YXRlLgogIGNvbnN0IHJlbWFpbmluZ0RlcHRoID0KICAgIHR5cGVvZiAodmFsdWUgKVsnX19zZW50cnlfb3ZlcnJpZGVfbm9ybWFsaXphdGlvbl9kZXB0aF9fJ10gPT09ICdudW1iZXInCiAgICAgID8gKCh2YWx1ZSApWydfX3NlbnRyeV9vdmVycmlkZV9ub3JtYWxpemF0aW9uX2RlcHRoX18nXSApCiAgICAgIDogZGVwdGg7CgogIC8vIFdlJ3JlIGFsc28gZG9uZSBpZiB3ZSd2ZSByZWFjaGVkIHRoZSBtYXggZGVwdGgKICBpZiAocmVtYWluaW5nRGVwdGggPT09IDApIHsKICAgIC8vIEF0IHRoaXMgcG9pbnQgd2Uga25vdyBgc2VyaWFsaXplZGAgaXMgYSBzdHJpbmcgb2YgdGhlIGZvcm0gYCJbb2JqZWN0IFhYWFhdImAuIENsZWFuIGl0IHVwIHNvIGl0J3MganVzdCBgIltYWFhYXSJgLgogICAgcmV0dXJuIHN0cmluZ2lmaWVkLnJlcGxhY2UoJ29iamVjdCAnLCAnJyk7CiAgfQoKICAvLyBJZiB3ZSd2ZSBhbHJlYWR5IHZpc2l0ZWQgdGhpcyBicmFuY2gsIGJhaWwgb3V0LCBhcyBpdCdzIGNpcmN1bGFyIHJlZmVyZW5jZS4gSWYgbm90LCBub3RlIHRoYXQgd2UncmUgc2VlaW5nIGl0IG5vdy4KICBpZiAobWVtb2l6ZSh2YWx1ZSkpIHsKICAgIHJldHVybiAnW0NpcmN1bGFyIH5dJzsKICB9CgogIC8vIElmIHRoZSB2YWx1ZSBoYXMgYSBgdG9KU09OYCBtZXRob2QsIHdlIGNhbGwgaXQgdG8gZXh0cmFjdCBtb3JlIGluZm9ybWF0aW9uCiAgY29uc3QgdmFsdWVXaXRoVG9KU09OID0gdmFsdWUgOwogIGlmICh2YWx1ZVdpdGhUb0pTT04gJiYgdHlwZW9mIHZhbHVlV2l0aFRvSlNPTi50b0pTT04gPT09ICdmdW5jdGlvbicpIHsKICAgIHRyeSB7CiAgICAgIGNvbnN0IGpzb25WYWx1ZSA9IHZhbHVlV2l0aFRvSlNPTi50b0pTT04oKTsKICAgICAgLy8gV2UgbmVlZCB0byBub3JtYWxpemUgdGhlIHJldHVybiB2YWx1ZSBvZiBgLnRvSlNPTigpYCBpbiBjYXNlIGl0IGhhcyBjaXJjdWxhciByZWZlcmVuY2VzCiAgICAgIHJldHVybiB2aXNpdCgnJywganNvblZhbHVlLCByZW1haW5pbmdEZXB0aCAtIDEsIG1heFByb3BlcnRpZXMsIG1lbW8pOwogICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgIC8vIHBhc3MgKFRoZSBidWlsdC1pbiBgdG9KU09OYCBmYWlsZWQsIGJ1dCB3ZSBjYW4gc3RpbGwgdHJ5IHRvIGRvIGl0IG91cnNlbHZlcykKICAgIH0KICB9CgogIC8vIEF0IHRoaXMgcG9pbnQgd2Uga25vdyB3ZSBlaXRoZXIgaGF2ZSBhbiBvYmplY3Qgb3IgYW4gYXJyYXksIHdlIGhhdmVuJ3Qgc2VlbiBpdCBiZWZvcmUsIGFuZCB3ZSdyZSBnb2luZyB0byByZWN1cnNlCiAgLy8gYmVjYXVzZSB3ZSBoYXZlbid0IHlldCByZWFjaGVkIHRoZSBtYXggZGVwdGguIENyZWF0ZSBhbiBhY2N1bXVsYXRvciB0byBob2xkIHRoZSByZXN1bHRzIG9mIHZpc2l0aW5nIGVhY2gKICAvLyBwcm9wZXJ0eS9lbnRyeSwgYW5kIGtlZXAgdHJhY2sgb2YgdGhlIG51bWJlciBvZiBpdGVtcyB3ZSBhZGQgdG8gaXQuCiAgY29uc3Qgbm9ybWFsaXplZCA9IChBcnJheS5pc0FycmF5KHZhbHVlKSA/IFtdIDoge30pIDsKICBsZXQgbnVtQWRkZWQgPSAwOwoKICAvLyBCZWZvcmUgd2UgYmVnaW4sIGNvbnZlcnRgRXJyb3JgIGFuZGBFdmVudGAgaW5zdGFuY2VzIGludG8gcGxhaW4gb2JqZWN0cywgc2luY2Ugc29tZSBvZiBlYWNoIG9mIHRoZWlyIHJlbGV2YW50CiAgLy8gcHJvcGVydGllcyBhcmUgbm9uLWVudW1lcmFibGUgYW5kIG90aGVyd2lzZSB3b3VsZCBnZXQgbWlzc2VkLgogIGNvbnN0IHZpc2l0YWJsZSA9IGNvbnZlcnRUb1BsYWluT2JqZWN0KHZhbHVlICk7CgogIGZvciAoY29uc3QgdmlzaXRLZXkgaW4gdmlzaXRhYmxlKSB7CiAgICAvLyBBdm9pZCBpdGVyYXRpbmcgb3ZlciBmaWVsZHMgaW4gdGhlIHByb3RvdHlwZSBpZiB0aGV5J3ZlIHNvbWVob3cgYmVlbiBleHBvc2VkIHRvIGVudW1lcmF0aW9uLgogICAgaWYgKCFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwodmlzaXRhYmxlLCB2aXNpdEtleSkpIHsKICAgICAgY29udGludWU7CiAgICB9CgogICAgaWYgKG51bUFkZGVkID49IG1heFByb3BlcnRpZXMpIHsKICAgICAgbm9ybWFsaXplZFt2aXNpdEtleV0gPSAnW01heFByb3BlcnRpZXMgfl0nOwogICAgICBicmVhazsKICAgIH0KCiAgICAvLyBSZWN1cnNpdmVseSB2aXNpdCBhbGwgdGhlIGNoaWxkIG5vZGVzCiAgICBjb25zdCB2aXNpdFZhbHVlID0gdmlzaXRhYmxlW3Zpc2l0S2V5XTsKICAgIG5vcm1hbGl6ZWRbdmlzaXRLZXldID0gdmlzaXQodmlzaXRLZXksIHZpc2l0VmFsdWUsIHJlbWFpbmluZ0RlcHRoIC0gMSwgbWF4UHJvcGVydGllcywgbWVtbyk7CgogICAgbnVtQWRkZWQrKzsKICB9CgogIC8vIE9uY2Ugd2UndmUgdmlzaXRlZCBhbGwgdGhlIGJyYW5jaGVzLCByZW1vdmUgdGhlIHBhcmVudCBmcm9tIG1lbW8gc3RvcmFnZQogIHVubWVtb2l6ZSh2YWx1ZSk7CgogIC8vIFJldHVybiBhY2N1bXVsYXRlZCB2YWx1ZXMKICByZXR1cm4gbm9ybWFsaXplZDsKfQoKLyogZXNsaW50LWRpc2FibGUgY29tcGxleGl0eSAqLwovKioKICogU3RyaW5naWZ5IHRoZSBnaXZlbiB2YWx1ZS4gSGFuZGxlcyB2YXJpb3VzIGtub3duIHNwZWNpYWwgdmFsdWVzIGFuZCB0eXBlcy4KICoKICogTm90IG1lYW50IHRvIGJlIHVzZWQgb24gc2ltcGxlIHByaW1pdGl2ZXMgd2hpY2ggYWxyZWFkeSBoYXZlIGEgc3RyaW5nIHJlcHJlc2VudGF0aW9uLCBhcyBpdCB3aWxsLCBmb3IgZXhhbXBsZSwgdHVybgogKiB0aGUgbnVtYmVyIDEyMzEgaW50byAiW09iamVjdCBOdW1iZXJdIiwgbm9yIG9uIGBudWxsYCwgYXMgaXQgd2lsbCB0aHJvdy4KICoKICogQHBhcmFtIHZhbHVlIFRoZSB2YWx1ZSB0byBzdHJpbmdpZnkKICogQHJldHVybnMgQSBzdHJpbmdpZmllZCByZXByZXNlbnRhdGlvbiBvZiB0aGUgZ2l2ZW4gdmFsdWUKICovCmZ1bmN0aW9uIHN0cmluZ2lmeVZhbHVlKAogIGtleSwKICAvLyB0aGlzIHR5cGUgaXMgYSB0aW55IGJpdCBvZiBhIGNoZWF0LCBzaW5jZSB0aGlzIGZ1bmN0aW9uIGRvZXMgaGFuZGxlIE5hTiAod2hpY2ggaXMgdGVjaG5pY2FsbHkgYSBudW1iZXIpLCBidXQgZm9yCiAgLy8gb3VyIGludGVybmFsIHVzZSwgaXQnbGwgZG8KICB2YWx1ZSwKKSB7CiAgdHJ5IHsKICAgIGlmIChrZXkgPT09ICdkb21haW4nICYmIHZhbHVlICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgKHZhbHVlICkuX2V2ZW50cykgewogICAgICByZXR1cm4gJ1tEb21haW5dJzsKICAgIH0KCiAgICBpZiAoa2V5ID09PSAnZG9tYWluRW1pdHRlcicpIHsKICAgICAgcmV0dXJuICdbRG9tYWluRW1pdHRlcl0nOwogICAgfQoKICAgIC8vIEl0J3Mgc2FmZSB0byB1c2UgYGdsb2JhbGAsIGB3aW5kb3dgLCBhbmQgYGRvY3VtZW50YCBoZXJlIGluIHRoaXMgbWFubmVyLCBhcyB3ZSBhcmUgYXNzZXJ0aW5nIHVzaW5nIGB0eXBlb2ZgIGZpcnN0CiAgICAvLyB3aGljaCB3b24ndCB0aHJvdyBpZiB0aGV5IGFyZSBub3QgcHJlc2VudC4KCiAgICBpZiAodHlwZW9mIGdsb2JhbCAhPT0gJ3VuZGVmaW5lZCcgJiYgdmFsdWUgPT09IGdsb2JhbCkgewogICAgICByZXR1cm4gJ1tHbG9iYWxdJzsKICAgIH0KCiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcmVzdHJpY3RlZC1nbG9iYWxzCiAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgJiYgdmFsdWUgPT09IHdpbmRvdykgewogICAgICByZXR1cm4gJ1tXaW5kb3ddJzsKICAgIH0KCiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcmVzdHJpY3RlZC1nbG9iYWxzCiAgICBpZiAodHlwZW9mIGRvY3VtZW50ICE9PSAndW5kZWZpbmVkJyAmJiB2YWx1ZSA9PT0gZG9jdW1lbnQpIHsKICAgICAgcmV0dXJuICdbRG9jdW1lbnRdJzsKICAgIH0KCiAgICBpZiAoaXNWdWVWaWV3TW9kZWwodmFsdWUpKSB7CiAgICAgIHJldHVybiAnW1Z1ZVZpZXdNb2RlbF0nOwogICAgfQoKICAgIC8vIFJlYWN0J3MgU3ludGhldGljRXZlbnQgdGhpbmd5CiAgICBpZiAoaXNTeW50aGV0aWNFdmVudCh2YWx1ZSkpIHsKICAgICAgcmV0dXJuICdbU3ludGhldGljRXZlbnRdJzsKICAgIH0KCiAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJyAmJiB2YWx1ZSAhPT0gdmFsdWUpIHsKICAgICAgcmV0dXJuICdbTmFOXSc7CiAgICB9CgogICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykgewogICAgICByZXR1cm4gYFtGdW5jdGlvbjogJHtnZXRGdW5jdGlvbk5hbWUodmFsdWUpfV1gOwogICAgfQoKICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzeW1ib2wnKSB7CiAgICAgIHJldHVybiBgWyR7U3RyaW5nKHZhbHVlKX1dYDsKICAgIH0KCiAgICAvLyBzdHJpbmdpZmllZCBCaWdJbnRzIGFyZSBpbmRpc3Rpbmd1aXNoYWJsZSBmcm9tIHJlZ3VsYXIgbnVtYmVycywgc28gd2UgbmVlZCB0byBsYWJlbCB0aGVtIHRvIGF2b2lkIGNvbmZ1c2lvbgogICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2JpZ2ludCcpIHsKICAgICAgcmV0dXJuIGBbQmlnSW50OiAke1N0cmluZyh2YWx1ZSl9XWA7CiAgICB9CgogICAgLy8gTm93IHRoYXQgd2UndmUga25vY2tlZCBvdXQgYWxsIHRoZSBzcGVjaWFsIGNhc2VzIGFuZCB0aGUgcHJpbWl0aXZlcywgYWxsIHdlIGhhdmUgbGVmdCBhcmUgb2JqZWN0cy4gU2ltcGx5IGNhc3RpbmcKICAgIC8vIHRoZW0gdG8gc3RyaW5ncyBtZWFucyB0aGF0IGluc3RhbmNlcyBvZiBjbGFzc2VzIHdoaWNoIGhhdmVuJ3QgZGVmaW5lZCB0aGVpciBgdG9TdHJpbmdUYWdgIHdpbGwganVzdCBjb21lIG91dCBhcwogICAgLy8gYCJbb2JqZWN0IE9iamVjdF0iYC4gSWYgd2UgaW5zdGVhZCBsb29rIGF0IHRoZSBjb25zdHJ1Y3RvcidzIG5hbWUgKHdoaWNoIGlzIHRoZSBzYW1lIGFzIHRoZSBuYW1lIG9mIHRoZSBjbGFzcyksCiAgICAvLyB3ZSBjYW4gbWFrZSBzdXJlIHRoYXQgb25seSBwbGFpbiBvYmplY3RzIGNvbWUgb3V0IHRoYXQgd2F5LgogICAgY29uc3Qgb2JqTmFtZSA9IGdldENvbnN0cnVjdG9yTmFtZSh2YWx1ZSk7CgogICAgLy8gSGFuZGxlIEhUTUwgRWxlbWVudHMKICAgIGlmICgvXkhUTUwoXHcqKUVsZW1lbnQkLy50ZXN0KG9iak5hbWUpKSB7CiAgICAgIHJldHVybiBgW0hUTUxFbGVtZW50OiAke29iak5hbWV9XWA7CiAgICB9CgogICAgcmV0dXJuIGBbb2JqZWN0ICR7b2JqTmFtZX1dYDsKICB9IGNhdGNoIChlcnIpIHsKICAgIHJldHVybiBgKipub24tc2VyaWFsaXphYmxlKiogKCR7ZXJyfSlgOwogIH0KfQovKiBlc2xpbnQtZW5hYmxlIGNvbXBsZXhpdHkgKi8KCmZ1bmN0aW9uIGdldENvbnN0cnVjdG9yTmFtZSh2YWx1ZSkgewogIGNvbnN0IHByb3RvdHlwZSA9IE9iamVjdC5nZXRQcm90b3R5cGVPZih2YWx1ZSk7CgogIHJldHVybiBwcm90b3R5cGUgPyBwcm90b3R5cGUuY29uc3RydWN0b3IubmFtZSA6ICdudWxsIHByb3RvdHlwZSc7Cn0KCi8qKgogKiBOb3JtYWxpemVzIFVSTHMgaW4gZXhjZXB0aW9ucyBhbmQgc3RhY2t0cmFjZXMgdG8gYSBiYXNlIHBhdGggc28gU2VudHJ5IGNhbiBmaW5nZXJwcmludAogKiBhY3Jvc3MgcGxhdGZvcm1zIGFuZCB3b3JraW5nIGRpcmVjdG9yeS4KICoKICogQHBhcmFtIHVybCBUaGUgVVJMIHRvIGJlIG5vcm1hbGl6ZWQuCiAqIEBwYXJhbSBiYXNlUGF0aCBUaGUgYXBwbGljYXRpb24gYmFzZSBwYXRoLgogKiBAcmV0dXJucyBUaGUgbm9ybWFsaXplZCBVUkwuCiAqLwpmdW5jdGlvbiBub3JtYWxpemVVcmxUb0Jhc2UodXJsLCBiYXNlUGF0aCkgewogIGNvbnN0IGVzY2FwZWRCYXNlID0gYmFzZVBhdGgKICAgIC8vIEJhY2tzbGFzaCB0byBmb3J3YXJkCiAgICAucmVwbGFjZSgvXFwvZywgJy8nKQogICAgLy8gRXNjYXBlIFJlZ0V4cCBzcGVjaWFsIGNoYXJhY3RlcnMKICAgIC5yZXBsYWNlKC9bfFxce30oKVtcXV4kKyo/Ll0vZywgJ1xcJCYnKTsKCiAgbGV0IG5ld1VybCA9IHVybDsKICB0cnkgewogICAgbmV3VXJsID0gZGVjb2RlVVJJKHVybCk7CiAgfSBjYXRjaCAoX09vKSB7CiAgICAvLyBTb21ldGltZSB0aGlzIGJyZWFrcwogIH0KICByZXR1cm4gKAogICAgbmV3VXJsCiAgICAgIC5yZXBsYWNlKC9cXC9nLCAnLycpCiAgICAgIC5yZXBsYWNlKC93ZWJwYWNrOlwvPy9nLCAnJykgLy8gUmVtb3ZlIGludGVybWVkaWF0ZSBiYXNlIHBhdGgKICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEBzZW50cnktaW50ZXJuYWwvc2RrL25vLXJlZ2V4cC1jb25zdHJ1Y3RvcgogICAgICAucmVwbGFjZShuZXcgUmVnRXhwKGAoZmlsZTovLyk/Lyoke2VzY2FwZWRCYXNlfS8qYCwgJ2lnJyksICdhcHA6Ly8vJykKICApOwp9CgovLyBTbGlnaHRseSBtb2RpZmllZCAobm8gSUU4IHN1cHBvcnQsIEVTNikgYW5kIHRyYW5zY3JpYmVkIHRvIFR5cGVTY3JpcHQKCi8vIFNwbGl0IGEgZmlsZW5hbWUgaW50byBbcm9vdCwgZGlyLCBiYXNlbmFtZSwgZXh0XSwgdW5peCB2ZXJzaW9uCi8vICdyb290JyBpcyBqdXN0IGEgc2xhc2gsIG9yIG5vdGhpbmcuCmNvbnN0IHNwbGl0UGF0aFJlID0gL14oXFMrOlxcfFwvPykoW1xzXFNdKj8pKCg/OlwuezEsMn18W14vXFxdKz98KShcLlteLi9cXF0qfCkpKD86Wy9cXF0qKSQvOwovKiogSlNEb2MgKi8KZnVuY3Rpb24gc3BsaXRQYXRoKGZpbGVuYW1lKSB7CiAgLy8gVHJ1bmNhdGUgZmlsZXMgbmFtZXMgZ3JlYXRlciB0aGFuIDEwMjQgY2hhcmFjdGVycyB0byBhdm9pZCByZWdleCBkb3MKICAvLyBodHRwczovL2dpdGh1Yi5jb20vZ2V0c2VudHJ5L3NlbnRyeS1qYXZhc2NyaXB0L3B1bGwvODczNyNkaXNjdXNzaW9uX3IxMjg1NzE5MTcyCiAgY29uc3QgdHJ1bmNhdGVkID0gZmlsZW5hbWUubGVuZ3RoID4gMTAyNCA/IGA8dHJ1bmNhdGVkPiR7ZmlsZW5hbWUuc2xpY2UoLTEwMjQpfWAgOiBmaWxlbmFtZTsKICBjb25zdCBwYXJ0cyA9IHNwbGl0UGF0aFJlLmV4ZWModHJ1bmNhdGVkKTsKICByZXR1cm4gcGFydHMgPyBwYXJ0cy5zbGljZSgxKSA6IFtdOwp9CgovKiogSlNEb2MgKi8KZnVuY3Rpb24gZGlybmFtZShwYXRoKSB7CiAgY29uc3QgcmVzdWx0ID0gc3BsaXRQYXRoKHBhdGgpOwogIGNvbnN0IHJvb3QgPSByZXN1bHRbMF07CiAgbGV0IGRpciA9IHJlc3VsdFsxXTsKCiAgaWYgKCFyb290ICYmICFkaXIpIHsKICAgIC8vIE5vIGRpcm5hbWUgd2hhdHNvZXZlcgogICAgcmV0dXJuICcuJzsKICB9CgogIGlmIChkaXIpIHsKICAgIC8vIEl0IGhhcyBhIGRpcm5hbWUsIHN0cmlwIHRyYWlsaW5nIHNsYXNoCiAgICBkaXIgPSBkaXIuc2xpY2UoMCwgZGlyLmxlbmd0aCAtIDEpOwogIH0KCiAgcmV0dXJuIHJvb3QgKyBkaXI7Cn0KCi8qIGVzbGludC1kaXNhYmxlIEB0eXBlc2NyaXB0LWVzbGludC9leHBsaWNpdC1mdW5jdGlvbi1yZXR1cm4tdHlwZSAqLwoKLyoqIFN5bmNQcm9taXNlIGludGVybmFsIHN0YXRlcyAqLwp2YXIgU3RhdGVzOyAoZnVuY3Rpb24gKFN0YXRlcykgewogIC8qKiBQZW5kaW5nICovCiAgY29uc3QgUEVORElORyA9IDA7IFN0YXRlc1tTdGF0ZXNbIlBFTkRJTkciXSA9IFBFTkRJTkddID0gIlBFTkRJTkciOwogIC8qKiBSZXNvbHZlZCAvIE9LICovCiAgY29uc3QgUkVTT0xWRUQgPSAxOyBTdGF0ZXNbU3RhdGVzWyJSRVNPTFZFRCJdID0gUkVTT0xWRURdID0gIlJFU09MVkVEIjsKICAvKiogUmVqZWN0ZWQgLyBFcnJvciAqLwogIGNvbnN0IFJFSkVDVEVEID0gMjsgU3RhdGVzW1N0YXRlc1siUkVKRUNURUQiXSA9IFJFSkVDVEVEXSA9ICJSRUpFQ1RFRCI7Cn0pKFN0YXRlcyB8fCAoU3RhdGVzID0ge30pKTsKCi8vIE92ZXJsb2FkcyBzbyB3ZSBjYW4gY2FsbCByZXNvbHZlZFN5bmNQcm9taXNlIHdpdGhvdXQgYXJndW1lbnRzIGFuZCBnZW5lcmljIGFyZ3VtZW50CgovKioKICogQ3JlYXRlcyBhIHJlc29sdmVkIHN5bmMgcHJvbWlzZS4KICoKICogQHBhcmFtIHZhbHVlIHRoZSB2YWx1ZSB0byByZXNvbHZlIHRoZSBwcm9taXNlIHdpdGgKICogQHJldHVybnMgdGhlIHJlc29sdmVkIHN5bmMgcHJvbWlzZQogKi8KZnVuY3Rpb24gcmVzb2x2ZWRTeW5jUHJvbWlzZSh2YWx1ZSkgewogIHJldHVybiBuZXcgU3luY1Byb21pc2UocmVzb2x2ZSA9PiB7CiAgICByZXNvbHZlKHZhbHVlKTsKICB9KTsKfQoKLyoqCiAqIENyZWF0ZXMgYSByZWplY3RlZCBzeW5jIHByb21pc2UuCiAqCiAqIEBwYXJhbSB2YWx1ZSB0aGUgdmFsdWUgdG8gcmVqZWN0IHRoZSBwcm9taXNlIHdpdGgKICogQHJldHVybnMgdGhlIHJlamVjdGVkIHN5bmMgcHJvbWlzZQogKi8KZnVuY3Rpb24gcmVqZWN0ZWRTeW5jUHJvbWlzZShyZWFzb24pIHsKICByZXR1cm4gbmV3IFN5bmNQcm9taXNlKChfLCByZWplY3QpID0+IHsKICAgIHJlamVjdChyZWFzb24pOwogIH0pOwp9CgovKioKICogVGhlbmFibGUgY2xhc3MgdGhhdCBiZWhhdmVzIGxpa2UgYSBQcm9taXNlIGFuZCBmb2xsb3dzIGl0J3MgaW50ZXJmYWNlCiAqIGJ1dCBpcyBub3QgYXN5bmMgaW50ZXJuYWxseQogKi8KY2xhc3MgU3luY1Byb21pc2UgewoKICAgY29uc3RydWN0b3IoCiAgICBleGVjdXRvciwKICApIHtTeW5jUHJvbWlzZS5wcm90b3R5cGUuX19pbml0LmNhbGwodGhpcyk7U3luY1Byb21pc2UucHJvdG90eXBlLl9faW5pdDIuY2FsbCh0aGlzKTtTeW5jUHJvbWlzZS5wcm90b3R5cGUuX19pbml0My5jYWxsKHRoaXMpO1N5bmNQcm9taXNlLnByb3RvdHlwZS5fX2luaXQ0LmNhbGwodGhpcyk7CiAgICB0aGlzLl9zdGF0ZSA9IFN0YXRlcy5QRU5ESU5HOwogICAgdGhpcy5faGFuZGxlcnMgPSBbXTsKCiAgICB0cnkgewogICAgICBleGVjdXRvcih0aGlzLl9yZXNvbHZlLCB0aGlzLl9yZWplY3QpOwogICAgfSBjYXRjaCAoZSkgewogICAgICB0aGlzLl9yZWplY3QoZSk7CiAgICB9CiAgfQoKICAvKiogSlNEb2MgKi8KICAgdGhlbigKICAgIG9uZnVsZmlsbGVkLAogICAgb25yZWplY3RlZCwKICApIHsKICAgIHJldHVybiBuZXcgU3luY1Byb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewogICAgICB0aGlzLl9oYW5kbGVycy5wdXNoKFsKICAgICAgICBmYWxzZSwKICAgICAgICByZXN1bHQgPT4gewogICAgICAgICAgaWYgKCFvbmZ1bGZpbGxlZCkgewogICAgICAgICAgICAvLyBUT0RPOiDCr1xfKOODhClfL8KvCiAgICAgICAgICAgIC8vIFRPRE86IEZJWE1FCiAgICAgICAgICAgIHJlc29sdmUocmVzdWx0ICk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIHJlc29sdmUob25mdWxmaWxsZWQocmVzdWx0KSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICByZWplY3QoZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHJlYXNvbiA9PiB7CiAgICAgICAgICBpZiAoIW9ucmVqZWN0ZWQpIHsKICAgICAgICAgICAgcmVqZWN0KHJlYXNvbik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIHJlc29sdmUob25yZWplY3RlZChyZWFzb24pKTsKICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgIHJlamVjdChlKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgIF0pOwogICAgICB0aGlzLl9leGVjdXRlSGFuZGxlcnMoKTsKICAgIH0pOwogIH0KCiAgLyoqIEpTRG9jICovCiAgIGNhdGNoKAogICAgb25yZWplY3RlZCwKICApIHsKICAgIHJldHVybiB0aGlzLnRoZW4odmFsID0+IHZhbCwgb25yZWplY3RlZCk7CiAgfQoKICAvKiogSlNEb2MgKi8KICAgZmluYWxseShvbmZpbmFsbHkpIHsKICAgIHJldHVybiBuZXcgU3luY1Byb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewogICAgICBsZXQgdmFsOwogICAgICBsZXQgaXNSZWplY3RlZDsKCiAgICAgIHJldHVybiB0aGlzLnRoZW4oCiAgICAgICAgdmFsdWUgPT4gewogICAgICAgICAgaXNSZWplY3RlZCA9IGZhbHNlOwogICAgICAgICAgdmFsID0gdmFsdWU7CiAgICAgICAgICBpZiAob25maW5hbGx5KSB7CiAgICAgICAgICAgIG9uZmluYWxseSgpOwogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgcmVhc29uID0+IHsKICAgICAgICAgIGlzUmVqZWN0ZWQgPSB0cnVlOwogICAgICAgICAgdmFsID0gcmVhc29uOwogICAgICAgICAgaWYgKG9uZmluYWxseSkgewogICAgICAgICAgICBvbmZpbmFsbHkoKTsKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICApLnRoZW4oKCkgPT4gewogICAgICAgIGlmIChpc1JlamVjdGVkKSB7CiAgICAgICAgICByZWplY3QodmFsKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHJlc29sdmUodmFsICk7CiAgICAgIH0pOwogICAgfSk7CiAgfQoKICAvKiogSlNEb2MgKi8KICAgIF9faW5pdCgpIHt0aGlzLl9yZXNvbHZlID0gKHZhbHVlKSA9PiB7CiAgICB0aGlzLl9zZXRSZXN1bHQoU3RhdGVzLlJFU09MVkVELCB2YWx1ZSk7CiAgfTt9CgogIC8qKiBKU0RvYyAqLwogICAgX19pbml0MigpIHt0aGlzLl9yZWplY3QgPSAocmVhc29uKSA9PiB7CiAgICB0aGlzLl9zZXRSZXN1bHQoU3RhdGVzLlJFSkVDVEVELCByZWFzb24pOwogIH07fQoKICAvKiogSlNEb2MgKi8KICAgIF9faW5pdDMoKSB7dGhpcy5fc2V0UmVzdWx0ID0gKHN0YXRlLCB2YWx1ZSkgPT4gewogICAgaWYgKHRoaXMuX3N0YXRlICE9PSBTdGF0ZXMuUEVORElORykgewogICAgICByZXR1cm47CiAgICB9CgogICAgaWYgKGlzVGhlbmFibGUodmFsdWUpKSB7CiAgICAgIHZvaWQgKHZhbHVlICkudGhlbih0aGlzLl9yZXNvbHZlLCB0aGlzLl9yZWplY3QpOwogICAgICByZXR1cm47CiAgICB9CgogICAgdGhpcy5fc3RhdGUgPSBzdGF0ZTsKICAgIHRoaXMuX3ZhbHVlID0gdmFsdWU7CgogICAgdGhpcy5fZXhlY3V0ZUhhbmRsZXJzKCk7CiAgfTt9CgogIC8qKiBKU0RvYyAqLwogICAgX19pbml0NCgpIHt0aGlzLl9leGVjdXRlSGFuZGxlcnMgPSAoKSA9PiB7CiAgICBpZiAodGhpcy5fc3RhdGUgPT09IFN0YXRlcy5QRU5ESU5HKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBjb25zdCBjYWNoZWRIYW5kbGVycyA9IHRoaXMuX2hhbmRsZXJzLnNsaWNlKCk7CiAgICB0aGlzLl9oYW5kbGVycyA9IFtdOwoKICAgIGNhY2hlZEhhbmRsZXJzLmZvckVhY2goaGFuZGxlciA9PiB7CiAgICAgIGlmIChoYW5kbGVyWzBdKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAodGhpcy5fc3RhdGUgPT09IFN0YXRlcy5SRVNPTFZFRCkgewogICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZmxvYXRpbmctcHJvbWlzZXMKICAgICAgICBoYW5kbGVyWzFdKHRoaXMuX3ZhbHVlICk7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLl9zdGF0ZSA9PT0gU3RhdGVzLlJFSkVDVEVEKSB7CiAgICAgICAgaGFuZGxlclsyXSh0aGlzLl92YWx1ZSk7CiAgICAgIH0KCiAgICAgIGhhbmRsZXJbMF0gPSB0cnVlOwogICAgfSk7CiAgfTt9Cn0KCi8qKgogKiBDcmVhdGVzIGFuIG5ldyBQcm9taXNlQnVmZmVyIG9iamVjdCB3aXRoIHRoZSBzcGVjaWZpZWQgbGltaXQKICogQHBhcmFtIGxpbWl0IG1heCBudW1iZXIgb2YgcHJvbWlzZXMgdGhhdCBjYW4gYmUgc3RvcmVkIGluIHRoZSBidWZmZXIKICovCmZ1bmN0aW9uIG1ha2VQcm9taXNlQnVmZmVyKGxpbWl0KSB7CiAgY29uc3QgYnVmZmVyID0gW107CgogIGZ1bmN0aW9uIGlzUmVhZHkoKSB7CiAgICByZXR1cm4gbGltaXQgPT09IHVuZGVmaW5lZCB8fCBidWZmZXIubGVuZ3RoIDwgbGltaXQ7CiAgfQoKICAvKioKICAgKiBSZW1vdmUgYSBwcm9taXNlIGZyb20gdGhlIHF1ZXVlLgogICAqCiAgICogQHBhcmFtIHRhc2sgQ2FuIGJlIGFueSBQcm9taXNlTGlrZTxUPgogICAqIEByZXR1cm5zIFJlbW92ZWQgcHJvbWlzZS4KICAgKi8KICBmdW5jdGlvbiByZW1vdmUodGFzaykgewogICAgcmV0dXJuIGJ1ZmZlci5zcGxpY2UoYnVmZmVyLmluZGV4T2YodGFzayksIDEpWzBdOwogIH0KCiAgLyoqCiAgICogQWRkIGEgcHJvbWlzZSAocmVwcmVzZW50aW5nIGFuIGluLWZsaWdodCBhY3Rpb24pIHRvIHRoZSBxdWV1ZSwgYW5kIHNldCBpdCB0byByZW1vdmUgaXRzZWxmIG9uIGZ1bGZpbGxtZW50LgogICAqCiAgICogQHBhcmFtIHRhc2tQcm9kdWNlciBBIGZ1bmN0aW9uIHByb2R1Y2luZyBhbnkgUHJvbWlzZUxpa2U8VD47IEluIHByZXZpb3VzIHZlcnNpb25zIHRoaXMgdXNlZCB0byBiZSBgdGFzazoKICAgKiAgICAgICAgUHJvbWlzZUxpa2U8VD5gLCBidXQgdW5kZXIgdGhhdCBtb2RlbCwgUHJvbWlzZXMgd2VyZSBpbnN0YW50bHkgY3JlYXRlZCBvbiB0aGUgY2FsbC1zaXRlIGFuZCB0aGVpciBleGVjdXRvcgogICAqICAgICAgICBmdW5jdGlvbnMgdGhlcmVmb3JlIHJhbiBpbW1lZGlhdGVseS4gVGh1cywgZXZlbiBpZiB0aGUgYnVmZmVyIHdhcyBmdWxsLCB0aGUgYWN0aW9uIHN0aWxsIGhhcHBlbmVkLiBCeQogICAqICAgICAgICByZXF1aXJpbmcgdGhlIHByb21pc2UgdG8gYmUgd3JhcHBlZCBpbiBhIGZ1bmN0aW9uLCB3ZSBjYW4gZGVmZXIgcHJvbWlzZSBjcmVhdGlvbiB1bnRpbCBhZnRlciB0aGUgYnVmZmVyCiAgICogICAgICAgIGxpbWl0IGNoZWNrLgogICAqIEByZXR1cm5zIFRoZSBvcmlnaW5hbCBwcm9taXNlLgogICAqLwogIGZ1bmN0aW9uIGFkZCh0YXNrUHJvZHVjZXIpIHsKICAgIGlmICghaXNSZWFkeSgpKSB7CiAgICAgIHJldHVybiByZWplY3RlZFN5bmNQcm9taXNlKG5ldyBTZW50cnlFcnJvcignTm90IGFkZGluZyBQcm9taXNlIGJlY2F1c2UgYnVmZmVyIGxpbWl0IHdhcyByZWFjaGVkLicpKTsKICAgIH0KCiAgICAvLyBzdGFydCB0aGUgdGFzayBhbmQgYWRkIGl0cyBwcm9taXNlIHRvIHRoZSBxdWV1ZQogICAgY29uc3QgdGFzayA9IHRhc2tQcm9kdWNlcigpOwogICAgaWYgKGJ1ZmZlci5pbmRleE9mKHRhc2spID09PSAtMSkgewogICAgICBidWZmZXIucHVzaCh0YXNrKTsKICAgIH0KICAgIHZvaWQgdGFzawogICAgICAudGhlbigoKSA9PiByZW1vdmUodGFzaykpCiAgICAgIC8vIFVzZSBgdGhlbihudWxsLCByZWplY3Rpb25IYW5kbGVyKWAgcmF0aGVyIHRoYW4gYGNhdGNoKHJlamVjdGlvbkhhbmRsZXIpYCBzbyB0aGF0IHdlIGNhbiB1c2UgYFByb21pc2VMaWtlYAogICAgICAvLyByYXRoZXIgdGhhbiBgUHJvbWlzZWAuIGBQcm9taXNlTGlrZWAgZG9lc24ndCBoYXZlIGEgYC5jYXRjaGAgbWV0aG9kLCBtYWtpbmcgaXRzIHBvbHlmaWxsIHNtYWxsZXIuIChFUzUgZGlkbid0CiAgICAgIC8vIGhhdmUgcHJvbWlzZXMsIHNvIFRTIGhhcyB0byBwb2x5ZmlsbCB3aGVuIGRvd24tY29tcGlsaW5nLikKICAgICAgLnRoZW4obnVsbCwgKCkgPT4KICAgICAgICByZW1vdmUodGFzaykudGhlbihudWxsLCAoKSA9PiB7CiAgICAgICAgICAvLyBXZSBoYXZlIHRvIGFkZCBhbm90aGVyIGNhdGNoIGhlcmUgYmVjYXVzZSBgcmVtb3ZlKClgIHN0YXJ0cyBhIG5ldyBwcm9taXNlIGNoYWluLgogICAgICAgIH0pLAogICAgICApOwogICAgcmV0dXJuIHRhc2s7CiAgfQoKICAvKioKICAgKiBXYWl0IGZvciBhbGwgcHJvbWlzZXMgaW4gdGhlIHF1ZXVlIHRvIHJlc29sdmUgb3IgZm9yIHRpbWVvdXQgdG8gZXhwaXJlLCB3aGljaGV2ZXIgY29tZXMgZmlyc3QuCiAgICoKICAgKiBAcGFyYW0gdGltZW91dCBUaGUgdGltZSwgaW4gbXMsIGFmdGVyIHdoaWNoIHRvIHJlc29sdmUgdG8gYGZhbHNlYCBpZiB0aGUgcXVldWUgaXMgc3RpbGwgbm9uLWVtcHR5LiBQYXNzaW5nIGAwYCAob3IKICAgKiBub3QgcGFzc2luZyBhbnl0aGluZykgd2lsbCBtYWtlIHRoZSBwcm9taXNlIHdhaXQgYXMgbG9uZyBhcyBpdCB0YWtlcyBmb3IgdGhlIHF1ZXVlIHRvIGRyYWluIGJlZm9yZSByZXNvbHZpbmcgdG8KICAgKiBgdHJ1ZWAuCiAgICogQHJldHVybnMgQSBwcm9taXNlIHdoaWNoIHdpbGwgcmVzb2x2ZSB0byBgdHJ1ZWAgaWYgdGhlIHF1ZXVlIGlzIGFscmVhZHkgZW1wdHkgb3IgZHJhaW5zIGJlZm9yZSB0aGUgdGltZW91dCwgYW5kCiAgICogYGZhbHNlYCBvdGhlcndpc2UKICAgKi8KICBmdW5jdGlvbiBkcmFpbih0aW1lb3V0KSB7CiAgICByZXR1cm4gbmV3IFN5bmNQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKICAgICAgbGV0IGNvdW50ZXIgPSBidWZmZXIubGVuZ3RoOwoKICAgICAgaWYgKCFjb3VudGVyKSB7CiAgICAgICAgcmV0dXJuIHJlc29sdmUodHJ1ZSk7CiAgICAgIH0KCiAgICAgIC8vIHdhaXQgZm9yIGB0aW1lb3V0YCBtcyBhbmQgdGhlbiByZXNvbHZlIHRvIGBmYWxzZWAgKGlmIG5vdCBjYW5jZWxsZWQgZmlyc3QpCiAgICAgIGNvbnN0IGNhcHR1cmVkU2V0VGltZW91dCA9IHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgIGlmICh0aW1lb3V0ICYmIHRpbWVvdXQgPiAwKSB7CiAgICAgICAgICByZXNvbHZlKGZhbHNlKTsKICAgICAgICB9CiAgICAgIH0sIHRpbWVvdXQpOwoKICAgICAgLy8gaWYgYWxsIHByb21pc2VzIHJlc29sdmUgaW4gdGltZSwgY2FuY2VsIHRoZSB0aW1lciBhbmQgcmVzb2x2ZSB0byBgdHJ1ZWAKICAgICAgYnVmZmVyLmZvckVhY2goaXRlbSA9PiB7CiAgICAgICAgdm9pZCByZXNvbHZlZFN5bmNQcm9taXNlKGl0ZW0pLnRoZW4oKCkgPT4gewogICAgICAgICAgaWYgKCEtLWNvdW50ZXIpIHsKICAgICAgICAgICAgY2xlYXJUaW1lb3V0KGNhcHR1cmVkU2V0VGltZW91dCk7CiAgICAgICAgICAgIHJlc29sdmUodHJ1ZSk7CiAgICAgICAgICB9CiAgICAgICAgfSwgcmVqZWN0KTsKICAgICAgfSk7CiAgICB9KTsKICB9CgogIHJldHVybiB7CiAgICAkOiBidWZmZXIsCiAgICBhZGQsCiAgICBkcmFpbiwKICB9Owp9Cgpjb25zdCBPTkVfU0VDT05EX0lOX01TID0gMTAwMDsKCi8qKgogKiBBIHBhcnRpYWwgZGVmaW5pdGlvbiBvZiB0aGUgW1BlcmZvcm1hbmNlIFdlYiBBUElde0BsaW5rIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9QZXJmb3JtYW5jZX0KICogZm9yIGFjY2Vzc2luZyBhIGhpZ2gtcmVzb2x1dGlvbiBtb25vdG9uaWMgY2xvY2suCiAqLwoKLyoqCiAqIFJldHVybnMgYSB0aW1lc3RhbXAgaW4gc2Vjb25kcyBzaW5jZSB0aGUgVU5JWCBlcG9jaCB1c2luZyB0aGUgRGF0ZSBBUEkuCiAqCiAqIFRPRE8odjgpOiBSZXR1cm4gdHlwZSBzaG91bGQgYmUgcm91bmRlZC4KICovCmZ1bmN0aW9uIGRhdGVUaW1lc3RhbXBJblNlY29uZHMoKSB7CiAgcmV0dXJuIERhdGUubm93KCkgLyBPTkVfU0VDT05EX0lOX01TOwp9CgovKioKICogUmV0dXJucyBhIHdyYXBwZXIgYXJvdW5kIHRoZSBuYXRpdmUgUGVyZm9ybWFuY2UgQVBJIGJyb3dzZXIgaW1wbGVtZW50YXRpb24sIG9yIHVuZGVmaW5lZCBmb3IgYnJvd3NlcnMgdGhhdCBkbyBub3QKICogc3VwcG9ydCB0aGUgQVBJLgogKgogKiBXcmFwcGluZyB0aGUgbmF0aXZlIEFQSSB3b3JrcyBhcm91bmQgZGlmZmVyZW5jZXMgaW4gYmVoYXZpb3IgZnJvbSBkaWZmZXJlbnQgYnJvd3NlcnMuCiAqLwpmdW5jdGlvbiBjcmVhdGVVbml4VGltZXN0YW1wSW5TZWNvbmRzRnVuYygpIHsKICBjb25zdCB7IHBlcmZvcm1hbmNlIH0gPSBHTE9CQUxfT0JKIDsKICBpZiAoIXBlcmZvcm1hbmNlIHx8ICFwZXJmb3JtYW5jZS5ub3cpIHsKICAgIHJldHVybiBkYXRlVGltZXN0YW1wSW5TZWNvbmRzOwogIH0KCiAgLy8gU29tZSBicm93c2VyIGFuZCBlbnZpcm9ubWVudHMgZG9uJ3QgaGF2ZSBhIHRpbWVPcmlnaW4sIHNvIHdlIGZhbGxiYWNrIHRvCiAgLy8gdXNpbmcgRGF0ZS5ub3coKSB0byBjb21wdXRlIHRoZSBzdGFydGluZyB0aW1lLgogIGNvbnN0IGFwcHJveFN0YXJ0aW5nVGltZU9yaWdpbiA9IERhdGUubm93KCkgLSBwZXJmb3JtYW5jZS5ub3coKTsKICBjb25zdCB0aW1lT3JpZ2luID0gcGVyZm9ybWFuY2UudGltZU9yaWdpbiA9PSB1bmRlZmluZWQgPyBhcHByb3hTdGFydGluZ1RpbWVPcmlnaW4gOiBwZXJmb3JtYW5jZS50aW1lT3JpZ2luOwoKICAvLyBwZXJmb3JtYW5jZS5ub3coKSBpcyBhIG1vbm90b25pYyBjbG9jaywgd2hpY2ggbWVhbnMgaXQgc3RhcnRzIGF0IDAgd2hlbiB0aGUgcHJvY2VzcyBiZWdpbnMuIFRvIGdldCB0aGUgY3VycmVudAogIC8vIHdhbGwgY2xvY2sgdGltZSAoYWN0dWFsIFVOSVggdGltZXN0YW1wKSwgd2UgbmVlZCB0byBhZGQgdGhlIHN0YXJ0aW5nIHRpbWUgb3JpZ2luIGFuZCB0aGUgY3VycmVudCB0aW1lIGVsYXBzZWQuCiAgLy8KICAvLyBUT0RPOiBUaGlzIGRvZXMgbm90IGFjY291bnQgZm9yIHRoZSBjYXNlIHdoZXJlIHRoZSBtb25vdG9uaWMgY2xvY2sgdGhhdCBwb3dlcnMgcGVyZm9ybWFuY2Uubm93KCkgZHJpZnRzIGZyb20gdGhlCiAgLy8gd2FsbCBjbG9jayB0aW1lLCB3aGljaCBjYXVzZXMgdGhlIHJldHVybmVkIHRpbWVzdGFtcCB0byBiZSBpbmFjY3VyYXRlLiBXZSBzaG91bGQgaW52ZXN0aWdhdGUgaG93IHRvIGRldGVjdCBhbmQKICAvLyBjb3JyZWN0IGZvciB0aGlzLgogIC8vIFNlZTogaHR0cHM6Ly9naXRodWIuY29tL2dldHNlbnRyeS9zZW50cnktamF2YXNjcmlwdC9pc3N1ZXMvMjU5MAogIC8vIFNlZTogaHR0cHM6Ly9naXRodWIuY29tL21kbi9jb250ZW50L2lzc3Vlcy80NzEzCiAgLy8gU2VlOiBodHRwczovL2Rldi50by9ub2Ftci93aGVuLWEtbWlsbGlzZWNvbmQtaXMtbm90LWEtbWlsbGlzZWNvbmQtM2g2CiAgcmV0dXJuICgpID0+IHsKICAgIHJldHVybiAodGltZU9yaWdpbiArIHBlcmZvcm1hbmNlLm5vdygpKSAvIE9ORV9TRUNPTkRfSU5fTVM7CiAgfTsKfQoKLyoqCiAqIFJldHVybnMgYSB0aW1lc3RhbXAgaW4gc2Vjb25kcyBzaW5jZSB0aGUgVU5JWCBlcG9jaCB1c2luZyBlaXRoZXIgdGhlIFBlcmZvcm1hbmNlIG9yIERhdGUgQVBJcywgZGVwZW5kaW5nIG9uIHRoZQogKiBhdmFpbGFiaWxpdHkgb2YgdGhlIFBlcmZvcm1hbmNlIEFQSS4KICoKICogQlVHOiBOb3RlIHRoYXQgYmVjYXVzZSBvZiBob3cgYnJvd3NlcnMgaW1wbGVtZW50IHRoZSBQZXJmb3JtYW5jZSBBUEksIHRoZSBjbG9jayBtaWdodCBzdG9wIHdoZW4gdGhlIGNvbXB1dGVyIGlzCiAqIGFzbGVlcC4gVGhpcyBjcmVhdGVzIGEgc2tldyBiZXR3ZWVuIGBkYXRlVGltZXN0YW1wSW5TZWNvbmRzYCBhbmQgYHRpbWVzdGFtcEluU2Vjb25kc2AuIFRoZQogKiBza2V3IGNhbiBncm93IHRvIGFyYml0cmFyeSBhbW91bnRzIGxpa2UgZGF5cywgd2Vla3Mgb3IgbW9udGhzLgogKiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL2dldHNlbnRyeS9zZW50cnktamF2YXNjcmlwdC9pc3N1ZXMvMjU5MC4KICovCmNvbnN0IHRpbWVzdGFtcEluU2Vjb25kcyA9IGNyZWF0ZVVuaXhUaW1lc3RhbXBJblNlY29uZHNGdW5jKCk7CgovKioKICogVGhlIG51bWJlciBvZiBtaWxsaXNlY29uZHMgc2luY2UgdGhlIFVOSVggZXBvY2guIFRoaXMgdmFsdWUgaXMgb25seSB1c2FibGUgaW4gYSBicm93c2VyLCBhbmQgb25seSB3aGVuIHRoZQogKiBwZXJmb3JtYW5jZSBBUEkgaXMgYXZhaWxhYmxlLgogKi8KKCgpID0+IHsKICAvLyBVbmZvcnR1bmF0ZWx5IGJyb3dzZXJzIG1heSByZXBvcnQgYW4gaW5hY2N1cmF0ZSB0aW1lIG9yaWdpbiBkYXRhLCB0aHJvdWdoIGVpdGhlciBwZXJmb3JtYW5jZS50aW1lT3JpZ2luIG9yCiAgLy8gcGVyZm9ybWFuY2UudGltaW5nLm5hdmlnYXRpb25TdGFydCwgd2hpY2ggcmVzdWx0cyBpbiBwb29yIHJlc3VsdHMgaW4gcGVyZm9ybWFuY2UgZGF0YS4gV2Ugb25seSB0cmVhdCB0aW1lIG9yaWdpbgogIC8vIGRhdGEgYXMgcmVsaWFibGUgaWYgdGhleSBhcmUgd2l0aGluIGEgcmVhc29uYWJsZSB0aHJlc2hvbGQgb2YgdGhlIGN1cnJlbnQgdGltZS4KCiAgY29uc3QgeyBwZXJmb3JtYW5jZSB9ID0gR0xPQkFMX09CSiA7CiAgaWYgKCFwZXJmb3JtYW5jZSB8fCAhcGVyZm9ybWFuY2Uubm93KSB7CiAgICByZXR1cm4gdW5kZWZpbmVkOwogIH0KCiAgY29uc3QgdGhyZXNob2xkID0gMzYwMCAqIDEwMDA7CiAgY29uc3QgcGVyZm9ybWFuY2VOb3cgPSBwZXJmb3JtYW5jZS5ub3coKTsKICBjb25zdCBkYXRlTm93ID0gRGF0ZS5ub3coKTsKCiAgLy8gaWYgdGltZU9yaWdpbiBpc24ndCBhdmFpbGFibGUgc2V0IGRlbHRhIHRvIHRocmVzaG9sZCBzbyBpdCBpc24ndCB1c2VkCiAgY29uc3QgdGltZU9yaWdpbkRlbHRhID0gcGVyZm9ybWFuY2UudGltZU9yaWdpbgogICAgPyBNYXRoLmFicyhwZXJmb3JtYW5jZS50aW1lT3JpZ2luICsgcGVyZm9ybWFuY2VOb3cgLSBkYXRlTm93KQogICAgOiB0aHJlc2hvbGQ7CiAgY29uc3QgdGltZU9yaWdpbklzUmVsaWFibGUgPSB0aW1lT3JpZ2luRGVsdGEgPCB0aHJlc2hvbGQ7CgogIC8vIFdoaWxlIHBlcmZvcm1hbmNlLnRpbWluZy5uYXZpZ2F0aW9uU3RhcnQgaXMgZGVwcmVjYXRlZCBpbiBmYXZvciBvZiBwZXJmb3JtYW5jZS50aW1lT3JpZ2luLCBwZXJmb3JtYW5jZS50aW1lT3JpZ2luCiAgLy8gaXMgbm90IGFzIHdpZGVseSBzdXBwb3J0ZWQuIE5hbWVseSwgcGVyZm9ybWFuY2UudGltZU9yaWdpbiBpcyB1bmRlZmluZWQgaW4gU2FmYXJpIGFzIG9mIHdyaXRpbmcuCiAgLy8gQWxzbyBhcyBvZiB3cml0aW5nLCBwZXJmb3JtYW5jZS50aW1pbmcgaXMgbm90IGF2YWlsYWJsZSBpbiBXZWIgV29ya2VycyBpbiBtYWluc3RyZWFtIGJyb3dzZXJzLCBzbyBpdCBpcyBub3QgYWx3YXlzCiAgLy8gYSB2YWxpZCBmYWxsYmFjay4gSW4gdGhlIGFic2VuY2Ugb2YgYW4gaW5pdGlhbCB0aW1lIHByb3ZpZGVkIGJ5IHRoZSBicm93c2VyLCBmYWxsYmFjayB0byB0aGUgY3VycmVudCB0aW1lIGZyb20gdGhlCiAgLy8gRGF0ZSBBUEkuCiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGRlcHJlY2F0aW9uL2RlcHJlY2F0aW9uCiAgY29uc3QgbmF2aWdhdGlvblN0YXJ0ID0gcGVyZm9ybWFuY2UudGltaW5nICYmIHBlcmZvcm1hbmNlLnRpbWluZy5uYXZpZ2F0aW9uU3RhcnQ7CiAgY29uc3QgaGFzTmF2aWdhdGlvblN0YXJ0ID0gdHlwZW9mIG5hdmlnYXRpb25TdGFydCA9PT0gJ251bWJlcic7CiAgLy8gaWYgbmF2aWdhdGlvblN0YXJ0IGlzbid0IGF2YWlsYWJsZSBzZXQgZGVsdGEgdG8gdGhyZXNob2xkIHNvIGl0IGlzbid0IHVzZWQKICBjb25zdCBuYXZpZ2F0aW9uU3RhcnREZWx0YSA9IGhhc05hdmlnYXRpb25TdGFydCA/IE1hdGguYWJzKG5hdmlnYXRpb25TdGFydCArIHBlcmZvcm1hbmNlTm93IC0gZGF0ZU5vdykgOiB0aHJlc2hvbGQ7CiAgY29uc3QgbmF2aWdhdGlvblN0YXJ0SXNSZWxpYWJsZSA9IG5hdmlnYXRpb25TdGFydERlbHRhIDwgdGhyZXNob2xkOwoKICBpZiAodGltZU9yaWdpbklzUmVsaWFibGUgfHwgbmF2aWdhdGlvblN0YXJ0SXNSZWxpYWJsZSkgewogICAgLy8gVXNlIHRoZSBtb3JlIHJlbGlhYmxlIHRpbWUgb3JpZ2luCiAgICBpZiAodGltZU9yaWdpbkRlbHRhIDw9IG5hdmlnYXRpb25TdGFydERlbHRhKSB7CiAgICAgIHJldHVybiBwZXJmb3JtYW5jZS50aW1lT3JpZ2luOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIG5hdmlnYXRpb25TdGFydDsKICAgIH0KICB9CiAgcmV0dXJuIGRhdGVOb3c7Cn0pKCk7CgovKioKICogQ3JlYXRlcyBhbiBlbnZlbG9wZS4KICogTWFrZSBzdXJlIHRvIGFsd2F5cyBleHBsaWNpdGx5IHByb3ZpZGUgdGhlIGdlbmVyaWMgdG8gdGhpcyBmdW5jdGlvbgogKiBzbyB0aGF0IHRoZSBlbnZlbG9wZSB0eXBlcyByZXNvbHZlIGNvcnJlY3RseS4KICovCmZ1bmN0aW9uIGNyZWF0ZUVudmVsb3BlKGhlYWRlcnMsIGl0ZW1zID0gW10pIHsKICByZXR1cm4gW2hlYWRlcnMsIGl0ZW1zXSA7Cn0KCi8qKgogKiBDb252ZW5pZW5jZSBmdW5jdGlvbiB0byBsb29wIHRocm91Z2ggdGhlIGl0ZW1zIGFuZCBpdGVtIHR5cGVzIG9mIGFuIGVudmVsb3BlLgogKiAoVGhpcyBmdW5jdGlvbiB3YXMgbW9zdGx5IGNyZWF0ZWQgYmVjYXVzZSB3b3JraW5nIHdpdGggZW52ZWxvcGUgdHlwZXMgaXMgcGFpbmZ1bCBhdCB0aGUgbW9tZW50KQogKgogKiBJZiB0aGUgY2FsbGJhY2sgcmV0dXJucyB0cnVlLCB0aGUgcmVzdCBvZiB0aGUgaXRlbXMgd2lsbCBiZSBza2lwcGVkLgogKi8KZnVuY3Rpb24gZm9yRWFjaEVudmVsb3BlSXRlbSgKICBlbnZlbG9wZSwKICBjYWxsYmFjaywKKSB7CiAgY29uc3QgZW52ZWxvcGVJdGVtcyA9IGVudmVsb3BlWzFdOwoKICBmb3IgKGNvbnN0IGVudmVsb3BlSXRlbSBvZiBlbnZlbG9wZUl0ZW1zKSB7CiAgICBjb25zdCBlbnZlbG9wZUl0ZW1UeXBlID0gZW52ZWxvcGVJdGVtWzBdLnR5cGU7CiAgICBjb25zdCByZXN1bHQgPSBjYWxsYmFjayhlbnZlbG9wZUl0ZW0sIGVudmVsb3BlSXRlbVR5cGUpOwoKICAgIGlmIChyZXN1bHQpIHsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgfQoKICByZXR1cm4gZmFsc2U7Cn0KCi8qKgogKiBFbmNvZGUgYSBzdHJpbmcgdG8gVVRGOC4KICovCmZ1bmN0aW9uIGVuY29kZVVURjgoaW5wdXQsIHRleHRFbmNvZGVyKSB7CiAgY29uc3QgdXRmOCA9IHRleHRFbmNvZGVyIHx8IG5ldyBUZXh0RW5jb2RlcigpOwogIHJldHVybiB1dGY4LmVuY29kZShpbnB1dCk7Cn0KCi8qKgogKiBTZXJpYWxpemVzIGFuIGVudmVsb3BlLgogKi8KZnVuY3Rpb24gc2VyaWFsaXplRW52ZWxvcGUoZW52ZWxvcGUsIHRleHRFbmNvZGVyKSB7CiAgY29uc3QgW2VudkhlYWRlcnMsIGl0ZW1zXSA9IGVudmVsb3BlOwoKICAvLyBJbml0aWFsbHkgd2UgY29uc3RydWN0IG91ciBlbnZlbG9wZSBhcyBhIHN0cmluZyBhbmQgb25seSBjb252ZXJ0IHRvIGJpbmFyeSBjaHVua3MgaWYgd2UgZW5jb3VudGVyIGJpbmFyeSBkYXRhCiAgbGV0IHBhcnRzID0gSlNPTi5zdHJpbmdpZnkoZW52SGVhZGVycyk7CgogIGZ1bmN0aW9uIGFwcGVuZChuZXh0KSB7CiAgICBpZiAodHlwZW9mIHBhcnRzID09PSAnc3RyaW5nJykgewogICAgICBwYXJ0cyA9IHR5cGVvZiBuZXh0ID09PSAnc3RyaW5nJyA/IHBhcnRzICsgbmV4dCA6IFtlbmNvZGVVVEY4KHBhcnRzLCB0ZXh0RW5jb2RlciksIG5leHRdOwogICAgfSBlbHNlIHsKICAgICAgcGFydHMucHVzaCh0eXBlb2YgbmV4dCA9PT0gJ3N0cmluZycgPyBlbmNvZGVVVEY4KG5leHQsIHRleHRFbmNvZGVyKSA6IG5leHQpOwogICAgfQogIH0KCiAgZm9yIChjb25zdCBpdGVtIG9mIGl0ZW1zKSB7CiAgICBjb25zdCBbaXRlbUhlYWRlcnMsIHBheWxvYWRdID0gaXRlbTsKCiAgICBhcHBlbmQoYFxuJHtKU09OLnN0cmluZ2lmeShpdGVtSGVhZGVycyl9XG5gKTsKCiAgICBpZiAodHlwZW9mIHBheWxvYWQgPT09ICdzdHJpbmcnIHx8IHBheWxvYWQgaW5zdGFuY2VvZiBVaW50OEFycmF5KSB7CiAgICAgIGFwcGVuZChwYXlsb2FkKTsKICAgIH0gZWxzZSB7CiAgICAgIGxldCBzdHJpbmdpZmllZFBheWxvYWQ7CiAgICAgIHRyeSB7CiAgICAgICAgc3RyaW5naWZpZWRQYXlsb2FkID0gSlNPTi5zdHJpbmdpZnkocGF5bG9hZCk7CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAvLyBJbiBjYXNlLCBkZXNwaXRlIGFsbCBvdXIgZWZmb3J0cyB0byBrZWVwIGBwYXlsb2FkYCBjaXJjdWxhci1kZXBlbmRlbmN5LWZyZWUsIGBKU09OLnN0cmluaWZ5KClgIHN0aWxsCiAgICAgICAgLy8gZmFpbHMsIHdlIHRyeSBhZ2FpbiBhZnRlciBub3JtYWxpemluZyBpdCBhZ2FpbiB3aXRoIGluZmluaXRlIG5vcm1hbGl6YXRpb24gZGVwdGguIFRoaXMgb2YgY291cnNlIGhhcyBhCiAgICAgICAgLy8gcGVyZm9ybWFuY2UgaW1wYWN0IGJ1dCBpbiB0aGlzIGNhc2UgYSBwZXJmb3JtYW5jZSBoaXQgaXMgYmV0dGVyIHRoYW4gdGhyb3dpbmcuCiAgICAgICAgc3RyaW5naWZpZWRQYXlsb2FkID0gSlNPTi5zdHJpbmdpZnkobm9ybWFsaXplKHBheWxvYWQpKTsKICAgICAgfQogICAgICBhcHBlbmQoc3RyaW5naWZpZWRQYXlsb2FkKTsKICAgIH0KICB9CgogIHJldHVybiB0eXBlb2YgcGFydHMgPT09ICdzdHJpbmcnID8gcGFydHMgOiBjb25jYXRCdWZmZXJzKHBhcnRzKTsKfQoKZnVuY3Rpb24gY29uY2F0QnVmZmVycyhidWZmZXJzKSB7CiAgY29uc3QgdG90YWxMZW5ndGggPSBidWZmZXJzLnJlZHVjZSgoYWNjLCBidWYpID0+IGFjYyArIGJ1Zi5sZW5ndGgsIDApOwoKICBjb25zdCBtZXJnZWQgPSBuZXcgVWludDhBcnJheSh0b3RhbExlbmd0aCk7CiAgbGV0IG9mZnNldCA9IDA7CiAgZm9yIChjb25zdCBidWZmZXIgb2YgYnVmZmVycykgewogICAgbWVyZ2VkLnNldChidWZmZXIsIG9mZnNldCk7CiAgICBvZmZzZXQgKz0gYnVmZmVyLmxlbmd0aDsKICB9CgogIHJldHVybiBtZXJnZWQ7Cn0KCmNvbnN0IElURU1fVFlQRV9UT19EQVRBX0NBVEVHT1JZX01BUCA9IHsKICBzZXNzaW9uOiAnc2Vzc2lvbicsCiAgc2Vzc2lvbnM6ICdzZXNzaW9uJywKICBhdHRhY2htZW50OiAnYXR0YWNobWVudCcsCiAgdHJhbnNhY3Rpb246ICd0cmFuc2FjdGlvbicsCiAgZXZlbnQ6ICdlcnJvcicsCiAgY2xpZW50X3JlcG9ydDogJ2ludGVybmFsJywKICB1c2VyX3JlcG9ydDogJ2RlZmF1bHQnLAogIHByb2ZpbGU6ICdwcm9maWxlJywKICByZXBsYXlfZXZlbnQ6ICdyZXBsYXknLAogIHJlcGxheV9yZWNvcmRpbmc6ICdyZXBsYXknLAogIGNoZWNrX2luOiAnbW9uaXRvcicsCiAgZmVlZGJhY2s6ICdmZWVkYmFjaycsCiAgLy8gVE9ETzogVGhpcyBpcyBhIHRlbXBvcmFyeSB3b3JrYXJvdW5kIHVudGlsIHdlIGhhdmUgYSBwcm9wZXIgZGF0YSBjYXRlZ29yeSBmb3IgbWV0cmljcwogIHN0YXRzZDogJ3Vua25vd24nLAp9OwoKLyoqCiAqIE1hcHMgdGhlIHR5cGUgb2YgYW4gZW52ZWxvcGUgaXRlbSB0byBhIGRhdGEgY2F0ZWdvcnkuCiAqLwpmdW5jdGlvbiBlbnZlbG9wZUl0ZW1UeXBlVG9EYXRhQ2F0ZWdvcnkodHlwZSkgewogIHJldHVybiBJVEVNX1RZUEVfVE9fREFUQV9DQVRFR09SWV9NQVBbdHlwZV07Cn0KCi8qKiBFeHRyYWN0cyB0aGUgbWluaW1hbCBTREsgaW5mbyBmcm9tIGZyb20gdGhlIG1ldGFkYXRhIG9yIGFuIGV2ZW50cyAqLwpmdW5jdGlvbiBnZXRTZGtNZXRhZGF0YUZvckVudmVsb3BlSGVhZGVyKG1ldGFkYXRhT3JFdmVudCkgewogIGlmICghbWV0YWRhdGFPckV2ZW50IHx8ICFtZXRhZGF0YU9yRXZlbnQuc2RrKSB7CiAgICByZXR1cm47CiAgfQogIGNvbnN0IHsgbmFtZSwgdmVyc2lvbiB9ID0gbWV0YWRhdGFPckV2ZW50LnNkazsKICByZXR1cm4geyBuYW1lLCB2ZXJzaW9uIH07Cn0KCi8qKgogKiBDcmVhdGVzIGV2ZW50IGVudmVsb3BlIGhlYWRlcnMsIGJhc2VkIG9uIGV2ZW50LCBzZGsgaW5mbyBhbmQgdHVubmVsCiAqIE5vdGU6IFRoaXMgZnVuY3Rpb24gd2FzIGV4dHJhY3RlZCBmcm9tIHRoZSBjb3JlIHBhY2thZ2UgdG8gbWFrZSBpdCBhdmFpbGFibGUgaW4gUmVwbGF5CiAqLwpmdW5jdGlvbiBjcmVhdGVFdmVudEVudmVsb3BlSGVhZGVycygKICBldmVudCwKICBzZGtJbmZvLAogIHR1bm5lbCwKICBkc24sCikgewogIGNvbnN0IGR5bmFtaWNTYW1wbGluZ0NvbnRleHQgPSBldmVudC5zZGtQcm9jZXNzaW5nTWV0YWRhdGEgJiYgZXZlbnQuc2RrUHJvY2Vzc2luZ01ldGFkYXRhLmR5bmFtaWNTYW1wbGluZ0NvbnRleHQ7CiAgcmV0dXJuIHsKICAgIGV2ZW50X2lkOiBldmVudC5ldmVudF9pZCAsCiAgICBzZW50X2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksCiAgICAuLi4oc2RrSW5mbyAmJiB7IHNkazogc2RrSW5mbyB9KSwKICAgIC4uLighIXR1bm5lbCAmJiBkc24gJiYgeyBkc246IGRzblRvU3RyaW5nKGRzbikgfSksCiAgICAuLi4oZHluYW1pY1NhbXBsaW5nQ29udGV4dCAmJiB7CiAgICAgIHRyYWNlOiBkcm9wVW5kZWZpbmVkS2V5cyh7IC4uLmR5bmFtaWNTYW1wbGluZ0NvbnRleHQgfSksCiAgICB9KSwKICB9Owp9CgovLyBJbnRlbnRpb25hbGx5IGtlZXBpbmcgdGhlIGtleSBicm9hZCwgYXMgd2UgZG9uJ3Qga25vdyBmb3Igc3VyZSB3aGF0IHJhdGUgbGltaXQgaGVhZGVycyBnZXQgcmV0dXJuZWQgZnJvbSBiYWNrZW5kCgpjb25zdCBERUZBVUxUX1JFVFJZX0FGVEVSID0gNjAgKiAxMDAwOyAvLyA2MCBzZWNvbmRzCgovKioKICogRXh0cmFjdHMgUmV0cnktQWZ0ZXIgdmFsdWUgZnJvbSB0aGUgcmVxdWVzdCBoZWFkZXIgb3IgcmV0dXJucyBkZWZhdWx0IHZhbHVlCiAqIEBwYXJhbSBoZWFkZXIgc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mICdSZXRyeS1BZnRlcicgaGVhZGVyCiAqIEBwYXJhbSBub3cgY3VycmVudCB1bml4IHRpbWVzdGFtcAogKgogKi8KZnVuY3Rpb24gcGFyc2VSZXRyeUFmdGVySGVhZGVyKGhlYWRlciwgbm93ID0gRGF0ZS5ub3coKSkgewogIGNvbnN0IGhlYWRlckRlbGF5ID0gcGFyc2VJbnQoYCR7aGVhZGVyfWAsIDEwKTsKICBpZiAoIWlzTmFOKGhlYWRlckRlbGF5KSkgewogICAgcmV0dXJuIGhlYWRlckRlbGF5ICogMTAwMDsKICB9CgogIGNvbnN0IGhlYWRlckRhdGUgPSBEYXRlLnBhcnNlKGAke2hlYWRlcn1gKTsKICBpZiAoIWlzTmFOKGhlYWRlckRhdGUpKSB7CiAgICByZXR1cm4gaGVhZGVyRGF0ZSAtIG5vdzsKICB9CgogIHJldHVybiBERUZBVUxUX1JFVFJZX0FGVEVSOwp9CgovKioKICogR2V0cyB0aGUgdGltZSB0aGF0IHRoZSBnaXZlbiBjYXRlZ29yeSBpcyBkaXNhYmxlZCB1bnRpbCBmb3IgcmF0ZSBsaW1pdGluZy4KICogSW4gY2FzZSBubyBjYXRlZ29yeS1zcGVjaWZpYyBsaW1pdCBpcyBzZXQgYnV0IGEgZ2VuZXJhbCByYXRlIGxpbWl0IGFjcm9zcyBhbGwgY2F0ZWdvcmllcyBpcyBhY3RpdmUsCiAqIHRoYXQgdGltZSBpcyByZXR1cm5lZC4KICoKICogQHJldHVybiB0aGUgdGltZSBpbiBtcyB0aGF0IHRoZSBjYXRlZ29yeSBpcyBkaXNhYmxlZCB1bnRpbCBvciAwIGlmIHRoZXJlJ3Mgbm8gYWN0aXZlIHJhdGUgbGltaXQuCiAqLwpmdW5jdGlvbiBkaXNhYmxlZFVudGlsKGxpbWl0cywgY2F0ZWdvcnkpIHsKICByZXR1cm4gbGltaXRzW2NhdGVnb3J5XSB8fCBsaW1pdHMuYWxsIHx8IDA7Cn0KCi8qKgogKiBDaGVja3MgaWYgYSBjYXRlZ29yeSBpcyByYXRlIGxpbWl0ZWQKICovCmZ1bmN0aW9uIGlzUmF0ZUxpbWl0ZWQobGltaXRzLCBjYXRlZ29yeSwgbm93ID0gRGF0ZS5ub3coKSkgewogIHJldHVybiBkaXNhYmxlZFVudGlsKGxpbWl0cywgY2F0ZWdvcnkpID4gbm93Owp9CgovKioKICogVXBkYXRlIHJhdGVsaW1pdHMgZnJvbSBpbmNvbWluZyBoZWFkZXJzLgogKgogKiBAcmV0dXJuIHRoZSB1cGRhdGVkIFJhdGVMaW1pdHMgb2JqZWN0LgogKi8KZnVuY3Rpb24gdXBkYXRlUmF0ZUxpbWl0cygKICBsaW1pdHMsCiAgeyBzdGF0dXNDb2RlLCBoZWFkZXJzIH0sCiAgbm93ID0gRGF0ZS5ub3coKSwKKSB7CiAgY29uc3QgdXBkYXRlZFJhdGVMaW1pdHMgPSB7CiAgICAuLi5saW1pdHMsCiAgfTsKCiAgLy8gIlRoZSBuYW1lIGlzIGNhc2UtaW5zZW5zaXRpdmUuIgogIC8vIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9IZWFkZXJzL2dldAogIGNvbnN0IHJhdGVMaW1pdEhlYWRlciA9IGhlYWRlcnMgJiYgaGVhZGVyc1sneC1zZW50cnktcmF0ZS1saW1pdHMnXTsKICBjb25zdCByZXRyeUFmdGVySGVhZGVyID0gaGVhZGVycyAmJiBoZWFkZXJzWydyZXRyeS1hZnRlciddOwoKICBpZiAocmF0ZUxpbWl0SGVhZGVyKSB7CiAgICAvKioKICAgICAqIHJhdGUgbGltaXQgaGVhZGVycyBhcmUgb2YgdGhlIGZvcm0KICAgICAqICAgICA8aGVhZGVyPiw8aGVhZGVyPiwuLgogICAgICogd2hlcmUgZWFjaCA8aGVhZGVyPiBpcyBvZiB0aGUgZm9ybQogICAgICogICAgIDxyZXRyeV9hZnRlcj46IDxjYXRlZ29yaWVzPjogPHNjb3BlPjogPHJlYXNvbl9jb2RlPgogICAgICogd2hlcmUKICAgICAqICAgICA8cmV0cnlfYWZ0ZXI+IGlzIGEgZGVsYXkgaW4gc2Vjb25kcwogICAgICogICAgIDxjYXRlZ29yaWVzPiBpcyB0aGUgZXZlbnQgdHlwZShzKSAoZXJyb3IsIHRyYW5zYWN0aW9uLCBldGMpIGJlaW5nIHJhdGUgbGltaXRlZCBhbmQgaXMgb2YgdGhlIGZvcm0KICAgICAqICAgICAgICAgPGNhdGVnb3J5Pjs8Y2F0ZWdvcnk+Oy4uLgogICAgICogICAgIDxzY29wZT4gaXMgd2hhdCdzIGJlaW5nIGxpbWl0ZWQgKG9yZywgcHJvamVjdCwgb3Iga2V5KSAtIGlnbm9yZWQgYnkgU0RLCiAgICAgKiAgICAgPHJlYXNvbl9jb2RlPiBpcyBhbiBhcmJpdHJhcnkgc3RyaW5nIGxpa2UgIm9yZ19xdW90YSIgLSBpZ25vcmVkIGJ5IFNESwogICAgICovCiAgICBmb3IgKGNvbnN0IGxpbWl0IG9mIHJhdGVMaW1pdEhlYWRlci50cmltKCkuc3BsaXQoJywnKSkgewogICAgICBjb25zdCBbcmV0cnlBZnRlciwgY2F0ZWdvcmllc10gPSBsaW1pdC5zcGxpdCgnOicsIDIpOwogICAgICBjb25zdCBoZWFkZXJEZWxheSA9IHBhcnNlSW50KHJldHJ5QWZ0ZXIsIDEwKTsKICAgICAgY29uc3QgZGVsYXkgPSAoIWlzTmFOKGhlYWRlckRlbGF5KSA/IGhlYWRlckRlbGF5IDogNjApICogMTAwMDsgLy8gNjBzZWMgZGVmYXVsdAogICAgICBpZiAoIWNhdGVnb3JpZXMpIHsKICAgICAgICB1cGRhdGVkUmF0ZUxpbWl0cy5hbGwgPSBub3cgKyBkZWxheTsKICAgICAgfSBlbHNlIHsKICAgICAgICBmb3IgKGNvbnN0IGNhdGVnb3J5IG9mIGNhdGVnb3JpZXMuc3BsaXQoJzsnKSkgewogICAgICAgICAgdXBkYXRlZFJhdGVMaW1pdHNbY2F0ZWdvcnldID0gbm93ICsgZGVsYXk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfSBlbHNlIGlmIChyZXRyeUFmdGVySGVhZGVyKSB7CiAgICB1cGRhdGVkUmF0ZUxpbWl0cy5hbGwgPSBub3cgKyBwYXJzZVJldHJ5QWZ0ZXJIZWFkZXIocmV0cnlBZnRlckhlYWRlciwgbm93KTsKICB9IGVsc2UgaWYgKHN0YXR1c0NvZGUgPT09IDQyOSkgewogICAgdXBkYXRlZFJhdGVMaW1pdHMuYWxsID0gbm93ICsgNjAgKiAxMDAwOwogIH0KCiAgcmV0dXJuIHVwZGF0ZWRSYXRlTGltaXRzOwp9CgovKioKICogQSBub2RlLmpzIHdhdGNoZG9nIHRpbWVyCiAqIEBwYXJhbSBwb2xsSW50ZXJ2YWwgVGhlIGludGVydmFsIHRoYXQgd2UgZXhwZWN0IHRvIGdldCBwb2xsZWQgYXQKICogQHBhcmFtIGFuclRocmVzaG9sZCBUaGUgdGhyZXNob2xkIGZvciB3aGVuIHdlIGNvbnNpZGVyIEFOUgogKiBAcGFyYW0gY2FsbGJhY2sgVGhlIGNhbGxiYWNrIHRvIGNhbGwgZm9yIEFOUgogKiBAcmV0dXJucyBBbiBvYmplY3Qgd2l0aCBgcG9sbGAgYW5kIGBlbmFibGVkYCBmdW5jdGlvbnMge0BsaW5rIFdhdGNoZG9nUmV0dXJufQogKi8KZnVuY3Rpb24gd2F0Y2hkb2dUaW1lcigKICBjcmVhdGVUaW1lciwKICBwb2xsSW50ZXJ2YWwsCiAgYW5yVGhyZXNob2xkLAogIGNhbGxiYWNrLAopIHsKICBjb25zdCB0aW1lciA9IGNyZWF0ZVRpbWVyKCk7CiAgbGV0IHRyaWdnZXJlZCA9IGZhbHNlOwogIGxldCBlbmFibGVkID0gdHJ1ZTsKCiAgc2V0SW50ZXJ2YWwoKCkgPT4gewogICAgY29uc3QgZGlmZk1zID0gdGltZXIuZ2V0VGltZU1zKCk7CgogICAgaWYgKHRyaWdnZXJlZCA9PT0gZmFsc2UgJiYgZGlmZk1zID4gcG9sbEludGVydmFsICsgYW5yVGhyZXNob2xkKSB7CiAgICAgIHRyaWdnZXJlZCA9IHRydWU7CiAgICAgIGlmIChlbmFibGVkKSB7CiAgICAgICAgY2FsbGJhY2soKTsKICAgICAgfQogICAgfQoKICAgIGlmIChkaWZmTXMgPCBwb2xsSW50ZXJ2YWwgKyBhbnJUaHJlc2hvbGQpIHsKICAgICAgdHJpZ2dlcmVkID0gZmFsc2U7CiAgICB9CiAgfSwgMjApOwoKICByZXR1cm4gewogICAgcG9sbDogKCkgPT4gewogICAgICB0aW1lci5yZXNldCgpOwogICAgfSwKICAgIGVuYWJsZWQ6IChzdGF0ZSkgPT4gewogICAgICBlbmFibGVkID0gc3RhdGU7CiAgICB9LAogIH07Cn0KCi8vIHR5cGVzIGNvcGllZCBmcm9tIGluc3BlY3Rvci5kLnRzCgovKioKICogQ29udmVydHMgRGVidWdnZXIuQ2FsbEZyYW1lIHRvIFNlbnRyeSBTdGFja0ZyYW1lCiAqLwpmdW5jdGlvbiBjYWxsRnJhbWVUb1N0YWNrRnJhbWUoCiAgZnJhbWUsCiAgdXJsLAogIGdldE1vZHVsZUZyb21GaWxlbmFtZSwKKSB7CiAgY29uc3QgZmlsZW5hbWUgPSB1cmwgPyB1cmwucmVwbGFjZSgvXmZpbGU6XC9cLy8sICcnKSA6IHVuZGVmaW5lZDsKCiAgLy8gQ2FsbEZyYW1lIHJvdy9jb2wgYXJlIDAgYmFzZWQsIHdoZXJlYXMgU3RhY2tGcmFtZSBhcmUgMSBiYXNlZAogIGNvbnN0IGNvbG5vID0gZnJhbWUubG9jYXRpb24uY29sdW1uTnVtYmVyID8gZnJhbWUubG9jYXRpb24uY29sdW1uTnVtYmVyICsgMSA6IHVuZGVmaW5lZDsKICBjb25zdCBsaW5lbm8gPSBmcmFtZS5sb2NhdGlvbi5saW5lTnVtYmVyID8gZnJhbWUubG9jYXRpb24ubGluZU51bWJlciArIDEgOiB1bmRlZmluZWQ7CgogIHJldHVybiBkcm9wVW5kZWZpbmVkS2V5cyh7CiAgICBmaWxlbmFtZSwKICAgIG1vZHVsZTogZ2V0TW9kdWxlRnJvbUZpbGVuYW1lKGZpbGVuYW1lKSwKICAgIGZ1bmN0aW9uOiBmcmFtZS5mdW5jdGlvbk5hbWUgfHwgJz8nLAogICAgY29sbm8sCiAgICBsaW5lbm8sCiAgICBpbl9hcHA6IGZpbGVuYW1lID8gZmlsZW5hbWVJc0luQXBwKGZpbGVuYW1lKSA6IHVuZGVmaW5lZCwKICB9KTsKfQoKLyoqCiAqIFRoaXMgc2VydmVzIGFzIGEgYnVpbGQgdGltZSBmbGFnIHRoYXQgd2lsbCBiZSB0cnVlIGJ5IGRlZmF1bHQsIGJ1dCBmYWxzZSBpbiBub24tZGVidWcgYnVpbGRzIG9yIGlmIHVzZXJzIHJlcGxhY2UgYF9fU0VOVFJZX0RFQlVHX19gIGluIHRoZWlyIGdlbmVyYXRlZCBjb2RlLgogKgogKiBBVFRFTlRJT046IFRoaXMgY29uc3RhbnQgbXVzdCBuZXZlciBjcm9zcyBwYWNrYWdlIGJvdW5kYXJpZXMgKGkuZS4gYmUgZXhwb3J0ZWQpIHRvIGd1YXJhbnRlZSB0aGF0IGl0IGNhbiBiZSB1c2VkIGZvciB0cmVlIHNoYWtpbmcuCiAqLwpjb25zdCBERUJVR19CVUlMRCA9ICh0eXBlb2YgX19TRU5UUllfREVCVUdfXyA9PT0gJ3VuZGVmaW5lZCcgfHwgX19TRU5UUllfREVCVUdfXyk7CgovKioKICogQ3JlYXRlcyBhIG5ldyBgU2Vzc2lvbmAgb2JqZWN0IGJ5IHNldHRpbmcgY2VydGFpbiBkZWZhdWx0IHBhcmFtZXRlcnMuIElmIG9wdGlvbmFsIEBwYXJhbSBjb250ZXh0CiAqIGlzIHBhc3NlZCwgdGhlIHBhc3NlZCBwcm9wZXJ0aWVzIGFyZSBhcHBsaWVkIHRvIHRoZSBzZXNzaW9uIG9iamVjdC4KICoKICogQHBhcmFtIGNvbnRleHQgKG9wdGlvbmFsKSBhZGRpdGlvbmFsIHByb3BlcnRpZXMgdG8gYmUgYXBwbGllZCB0byB0aGUgcmV0dXJuZWQgc2Vzc2lvbiBvYmplY3QKICoKICogQHJldHVybnMgYSBuZXcgYFNlc3Npb25gIG9iamVjdAogKi8KZnVuY3Rpb24gbWFrZVNlc3Npb24oY29udGV4dCkgewogIC8vIEJvdGggdGltZXN0YW1wIGFuZCBzdGFydGVkIGFyZSBpbiBzZWNvbmRzIHNpbmNlIHRoZSBVTklYIGVwb2NoLgogIGNvbnN0IHN0YXJ0aW5nVGltZSA9IHRpbWVzdGFtcEluU2Vjb25kcygpOwoKICBjb25zdCBzZXNzaW9uID0gewogICAgc2lkOiB1dWlkNCgpLAogICAgaW5pdDogdHJ1ZSwKICAgIHRpbWVzdGFtcDogc3RhcnRpbmdUaW1lLAogICAgc3RhcnRlZDogc3RhcnRpbmdUaW1lLAogICAgZHVyYXRpb246IDAsCiAgICBzdGF0dXM6ICdvaycsCiAgICBlcnJvcnM6IDAsCiAgICBpZ25vcmVEdXJhdGlvbjogZmFsc2UsCiAgICB0b0pTT046ICgpID0+IHNlc3Npb25Ub0pTT04oc2Vzc2lvbiksCiAgfTsKCiAgaWYgKGNvbnRleHQpIHsKICAgIHVwZGF0ZVNlc3Npb24oc2Vzc2lvbiwgY29udGV4dCk7CiAgfQoKICByZXR1cm4gc2Vzc2lvbjsKfQoKLyoqCiAqIFVwZGF0ZXMgYSBzZXNzaW9uIG9iamVjdCB3aXRoIHRoZSBwcm9wZXJ0aWVzIHBhc3NlZCBpbiB0aGUgY29udGV4dC4KICoKICogTm90ZSB0aGF0IHRoaXMgZnVuY3Rpb24gbXV0YXRlcyB0aGUgcGFzc2VkIG9iamVjdCBhbmQgcmV0dXJucyB2b2lkLgogKiAoSGFkIHRvIGRvIHRoaXMgaW5zdGVhZCBvZiByZXR1cm5pbmcgYSBuZXcgYW5kIHVwZGF0ZWQgc2Vzc2lvbiBiZWNhdXNlIGNsb3NpbmcgYW5kIHNlbmRpbmcgYSBzZXNzaW9uCiAqIG1ha2VzIGFuIHVwZGF0ZSB0byB0aGUgc2Vzc2lvbiBhZnRlciBpdCB3YXMgcGFzc2VkIHRvIHRoZSBzZW5kaW5nIGxvZ2ljLgogKiBAc2VlIEJhc2VDbGllbnQuY2FwdHVyZVNlc3Npb24gKQogKgogKiBAcGFyYW0gc2Vzc2lvbiB0aGUgYFNlc3Npb25gIHRvIHVwZGF0ZQogKiBAcGFyYW0gY29udGV4dCB0aGUgYFNlc3Npb25Db250ZXh0YCBob2xkaW5nIHRoZSBwcm9wZXJ0aWVzIHRoYXQgc2hvdWxkIGJlIHVwZGF0ZWQgaW4gQHBhcmFtIHNlc3Npb24KICovCi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBjb21wbGV4aXR5CmZ1bmN0aW9uIHVwZGF0ZVNlc3Npb24oc2Vzc2lvbiwgY29udGV4dCA9IHt9KSB7CiAgaWYgKGNvbnRleHQudXNlcikgewogICAgaWYgKCFzZXNzaW9uLmlwQWRkcmVzcyAmJiBjb250ZXh0LnVzZXIuaXBfYWRkcmVzcykgewogICAgICBzZXNzaW9uLmlwQWRkcmVzcyA9IGNvbnRleHQudXNlci5pcF9hZGRyZXNzOwogICAgfQoKICAgIGlmICghc2Vzc2lvbi5kaWQgJiYgIWNvbnRleHQuZGlkKSB7CiAgICAgIHNlc3Npb24uZGlkID0gY29udGV4dC51c2VyLmlkIHx8IGNvbnRleHQudXNlci5lbWFpbCB8fCBjb250ZXh0LnVzZXIudXNlcm5hbWU7CiAgICB9CiAgfQoKICBzZXNzaW9uLnRpbWVzdGFtcCA9IGNvbnRleHQudGltZXN0YW1wIHx8IHRpbWVzdGFtcEluU2Vjb25kcygpOwoKICBpZiAoY29udGV4dC5hYm5vcm1hbF9tZWNoYW5pc20pIHsKICAgIHNlc3Npb24uYWJub3JtYWxfbWVjaGFuaXNtID0gY29udGV4dC5hYm5vcm1hbF9tZWNoYW5pc207CiAgfQoKICBpZiAoY29udGV4dC5pZ25vcmVEdXJhdGlvbikgewogICAgc2Vzc2lvbi5pZ25vcmVEdXJhdGlvbiA9IGNvbnRleHQuaWdub3JlRHVyYXRpb247CiAgfQogIGlmIChjb250ZXh0LnNpZCkgewogICAgLy8gR29vZCBlbm91Z2ggdXVpZCB2YWxpZGF0aW9uLiDigJQgS2FtaWwKICAgIHNlc3Npb24uc2lkID0gY29udGV4dC5zaWQubGVuZ3RoID09PSAzMiA/IGNvbnRleHQuc2lkIDogdXVpZDQoKTsKICB9CiAgaWYgKGNvbnRleHQuaW5pdCAhPT0gdW5kZWZpbmVkKSB7CiAgICBzZXNzaW9uLmluaXQgPSBjb250ZXh0LmluaXQ7CiAgfQogIGlmICghc2Vzc2lvbi5kaWQgJiYgY29udGV4dC5kaWQpIHsKICAgIHNlc3Npb24uZGlkID0gYCR7Y29udGV4dC5kaWR9YDsKICB9CiAgaWYgKHR5cGVvZiBjb250ZXh0LnN0YXJ0ZWQgPT09ICdudW1iZXInKSB7CiAgICBzZXNzaW9uLnN0YXJ0ZWQgPSBjb250ZXh0LnN0YXJ0ZWQ7CiAgfQogIGlmIChzZXNzaW9uLmlnbm9yZUR1cmF0aW9uKSB7CiAgICBzZXNzaW9uLmR1cmF0aW9uID0gdW5kZWZpbmVkOwogIH0gZWxzZSBpZiAodHlwZW9mIGNvbnRleHQuZHVyYXRpb24gPT09ICdudW1iZXInKSB7CiAgICBzZXNzaW9uLmR1cmF0aW9uID0gY29udGV4dC5kdXJhdGlvbjsKICB9IGVsc2UgewogICAgY29uc3QgZHVyYXRpb24gPSBzZXNzaW9uLnRpbWVzdGFtcCAtIHNlc3Npb24uc3RhcnRlZDsKICAgIHNlc3Npb24uZHVyYXRpb24gPSBkdXJhdGlvbiA+PSAwID8gZHVyYXRpb24gOiAwOwogIH0KICBpZiAoY29udGV4dC5yZWxlYXNlKSB7CiAgICBzZXNzaW9uLnJlbGVhc2UgPSBjb250ZXh0LnJlbGVhc2U7CiAgfQogIGlmIChjb250ZXh0LmVudmlyb25tZW50KSB7CiAgICBzZXNzaW9uLmVudmlyb25tZW50ID0gY29udGV4dC5lbnZpcm9ubWVudDsKICB9CiAgaWYgKCFzZXNzaW9uLmlwQWRkcmVzcyAmJiBjb250ZXh0LmlwQWRkcmVzcykgewogICAgc2Vzc2lvbi5pcEFkZHJlc3MgPSBjb250ZXh0LmlwQWRkcmVzczsKICB9CiAgaWYgKCFzZXNzaW9uLnVzZXJBZ2VudCAmJiBjb250ZXh0LnVzZXJBZ2VudCkgewogICAgc2Vzc2lvbi51c2VyQWdlbnQgPSBjb250ZXh0LnVzZXJBZ2VudDsKICB9CiAgaWYgKHR5cGVvZiBjb250ZXh0LmVycm9ycyA9PT0gJ251bWJlcicpIHsKICAgIHNlc3Npb24uZXJyb3JzID0gY29udGV4dC5lcnJvcnM7CiAgfQogIGlmIChjb250ZXh0LnN0YXR1cykgewogICAgc2Vzc2lvbi5zdGF0dXMgPSBjb250ZXh0LnN0YXR1czsKICB9Cn0KCi8qKgogKiBTZXJpYWxpemVzIGEgcGFzc2VkIHNlc3Npb24gb2JqZWN0IHRvIGEgSlNPTiBvYmplY3Qgd2l0aCBhIHNsaWdodGx5IGRpZmZlcmVudCBzdHJ1Y3R1cmUuCiAqIFRoaXMgaXMgbmVjZXNzYXJ5IGJlY2F1c2UgdGhlIFNlbnRyeSBiYWNrZW5kIHJlcXVpcmVzIGEgc2xpZ2h0bHkgZGlmZmVyZW50IHNjaGVtYSBvZiBhIHNlc3Npb24KICogdGhhbiB0aGUgb25lIHRoZSBKUyBTREtzIHVzZSBpbnRlcm5hbGx5LgogKgogKiBAcGFyYW0gc2Vzc2lvbiB0aGUgc2Vzc2lvbiB0byBiZSBjb252ZXJ0ZWQKICoKICogQHJldHVybnMgYSBKU09OIG9iamVjdCBvZiB0aGUgcGFzc2VkIHNlc3Npb24KICovCmZ1bmN0aW9uIHNlc3Npb25Ub0pTT04oc2Vzc2lvbikgewogIHJldHVybiBkcm9wVW5kZWZpbmVkS2V5cyh7CiAgICBzaWQ6IGAke3Nlc3Npb24uc2lkfWAsCiAgICBpbml0OiBzZXNzaW9uLmluaXQsCiAgICAvLyBNYWtlIHN1cmUgdGhhdCBzZWMgaXMgY29udmVydGVkIHRvIG1zIGZvciBkYXRlIGNvbnN0cnVjdG9yCiAgICBzdGFydGVkOiBuZXcgRGF0ZShzZXNzaW9uLnN0YXJ0ZWQgKiAxMDAwKS50b0lTT1N0cmluZygpLAogICAgdGltZXN0YW1wOiBuZXcgRGF0ZShzZXNzaW9uLnRpbWVzdGFtcCAqIDEwMDApLnRvSVNPU3RyaW5nKCksCiAgICBzdGF0dXM6IHNlc3Npb24uc3RhdHVzLAogICAgZXJyb3JzOiBzZXNzaW9uLmVycm9ycywKICAgIGRpZDogdHlwZW9mIHNlc3Npb24uZGlkID09PSAnbnVtYmVyJyB8fCB0eXBlb2Ygc2Vzc2lvbi5kaWQgPT09ICdzdHJpbmcnID8gYCR7c2Vzc2lvbi5kaWR9YCA6IHVuZGVmaW5lZCwKICAgIGR1cmF0aW9uOiBzZXNzaW9uLmR1cmF0aW9uLAogICAgYWJub3JtYWxfbWVjaGFuaXNtOiBzZXNzaW9uLmFibm9ybWFsX21lY2hhbmlzbSwKICAgIGF0dHJzOiB7CiAgICAgIHJlbGVhc2U6IHNlc3Npb24ucmVsZWFzZSwKICAgICAgZW52aXJvbm1lbnQ6IHNlc3Npb24uZW52aXJvbm1lbnQsCiAgICAgIGlwX2FkZHJlc3M6IHNlc3Npb24uaXBBZGRyZXNzLAogICAgICB1c2VyX2FnZW50OiBzZXNzaW9uLnVzZXJBZ2VudCwKICAgIH0sCiAgfSk7Cn0KCi8qKgogKiBBcHBseSBTZGtJbmZvIChuYW1lLCB2ZXJzaW9uLCBwYWNrYWdlcywgaW50ZWdyYXRpb25zKSB0byB0aGUgY29ycmVzcG9uZGluZyBldmVudCBrZXkuCiAqIE1lcmdlIHdpdGggZXhpc3RpbmcgZGF0YSBpZiBhbnkuCiAqKi8KZnVuY3Rpb24gZW5oYW5jZUV2ZW50V2l0aFNka0luZm8oZXZlbnQsIHNka0luZm8pIHsKICBpZiAoIXNka0luZm8pIHsKICAgIHJldHVybiBldmVudDsKICB9CiAgZXZlbnQuc2RrID0gZXZlbnQuc2RrIHx8IHt9OwogIGV2ZW50LnNkay5uYW1lID0gZXZlbnQuc2RrLm5hbWUgfHwgc2RrSW5mby5uYW1lOwogIGV2ZW50LnNkay52ZXJzaW9uID0gZXZlbnQuc2RrLnZlcnNpb24gfHwgc2RrSW5mby52ZXJzaW9uOwogIGV2ZW50LnNkay5pbnRlZ3JhdGlvbnMgPSBbLi4uKGV2ZW50LnNkay5pbnRlZ3JhdGlvbnMgfHwgW10pLCAuLi4oc2RrSW5mby5pbnRlZ3JhdGlvbnMgfHwgW10pXTsKICBldmVudC5zZGsucGFja2FnZXMgPSBbLi4uKGV2ZW50LnNkay5wYWNrYWdlcyB8fCBbXSksIC4uLihzZGtJbmZvLnBhY2thZ2VzIHx8IFtdKV07CiAgcmV0dXJuIGV2ZW50Owp9CgovKiogQ3JlYXRlcyBhbiBlbnZlbG9wZSBmcm9tIGEgU2Vzc2lvbiAqLwpmdW5jdGlvbiBjcmVhdGVTZXNzaW9uRW52ZWxvcGUoCiAgc2Vzc2lvbiwKICBkc24sCiAgbWV0YWRhdGEsCiAgdHVubmVsLAopIHsKICBjb25zdCBzZGtJbmZvID0gZ2V0U2RrTWV0YWRhdGFGb3JFbnZlbG9wZUhlYWRlcihtZXRhZGF0YSk7CiAgY29uc3QgZW52ZWxvcGVIZWFkZXJzID0gewogICAgc2VudF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLAogICAgLi4uKHNka0luZm8gJiYgeyBzZGs6IHNka0luZm8gfSksCiAgICAuLi4oISF0dW5uZWwgJiYgZHNuICYmIHsgZHNuOiBkc25Ub1N0cmluZyhkc24pIH0pLAogIH07CgogIGNvbnN0IGVudmVsb3BlSXRlbSA9CiAgICAnYWdncmVnYXRlcycgaW4gc2Vzc2lvbiA/IFt7IHR5cGU6ICdzZXNzaW9ucycgfSwgc2Vzc2lvbl0gOiBbeyB0eXBlOiAnc2Vzc2lvbicgfSwgc2Vzc2lvbi50b0pTT04oKV07CgogIHJldHVybiBjcmVhdGVFbnZlbG9wZShlbnZlbG9wZUhlYWRlcnMsIFtlbnZlbG9wZUl0ZW1dKTsKfQoKLyoqCiAqIENyZWF0ZSBhbiBFbnZlbG9wZSBmcm9tIGFuIGV2ZW50LgogKi8KZnVuY3Rpb24gY3JlYXRlRXZlbnRFbnZlbG9wZSgKICBldmVudCwKICBkc24sCiAgbWV0YWRhdGEsCiAgdHVubmVsLAopIHsKICBjb25zdCBzZGtJbmZvID0gZ2V0U2RrTWV0YWRhdGFGb3JFbnZlbG9wZUhlYWRlcihtZXRhZGF0YSk7CgogIC8qCiAgICBOb3RlOiBEdWUgdG8gVFMsIGV2ZW50LnR5cGUgbWF5IGJlIGByZXBsYXlfZXZlbnRgLCB0aGVvcmV0aWNhbGx5LgogICAgSW4gcHJhY3RpY2UsIHdlIG5ldmVyIGNhbGwgYGNyZWF0ZUV2ZW50RW52ZWxvcGVgIHdpdGggYHJlcGxheV9ldmVudGAgdHlwZSwKICAgIGFuZCB3ZSdkIGhhdmUgdG8gYWRqdXQgYSBsb29vdCBvZiB0eXBlcyB0byBtYWtlIHRoaXMgd29yayBwcm9wZXJseS4KICAgIFdlIHdhbnQgdG8gYXZvaWQgY2FzdGluZyB0aGlzIGFyb3VuZCwgYXMgdGhhdCBjb3VsZCBsZWFkIHRvIGJ1Z3MgKGUuZy4gd2hlbiB3ZSBhZGQgYW5vdGhlciB0eXBlKQogICAgU28gdGhlIHNhZmUgY2hvaWNlIGlzIHRvIHJlYWxseSBndWFyZCBhZ2FpbnN0IHRoZSByZXBsYXlfZXZlbnQgdHlwZSBoZXJlLgogICovCiAgY29uc3QgZXZlbnRUeXBlID0gZXZlbnQudHlwZSAmJiBldmVudC50eXBlICE9PSAncmVwbGF5X2V2ZW50JyA/IGV2ZW50LnR5cGUgOiAnZXZlbnQnOwoKICBlbmhhbmNlRXZlbnRXaXRoU2RrSW5mbyhldmVudCwgbWV0YWRhdGEgJiYgbWV0YWRhdGEuc2RrKTsKCiAgY29uc3QgZW52ZWxvcGVIZWFkZXJzID0gY3JlYXRlRXZlbnRFbnZlbG9wZUhlYWRlcnMoZXZlbnQsIHNka0luZm8sIHR1bm5lbCwgZHNuKTsKCiAgLy8gUHJldmVudCB0aGlzIGRhdGEgKHdoaWNoLCBpZiBpdCBleGlzdHMsIHdhcyB1c2VkIGluIGVhcmxpZXIgc3RlcHMgaW4gdGhlIHByb2Nlc3NpbmcgcGlwZWxpbmUpIGZyb20gYmVpbmcgc2VudCB0bwogIC8vIHNlbnRyeS4gKE5vdGU6IE91ciB1c2Ugb2YgdGhpcyBwcm9wZXJ0eSBjb21lcyBhbmQgZ29lcyB3aXRoIHdoYXRldmVyIHdlIG1pZ2h0IGJlIGRlYnVnZ2luZywgd2hhdGV2ZXIgaGFja3Mgd2UgbWF5CiAgLy8gaGF2ZSB0ZW1wb3JhcmlseSBhZGRlZCwgZXRjLiBFdmVuIGlmIHdlIGRvbid0IGhhcHBlbiB0byBiZSB1c2luZyBpdCBhdCBzb21lIHBvaW50IGluIHRoZSBmdXR1cmUsIGxldCdzIG5vdCBnZXQgcmlkCiAgLy8gb2YgdGhpcyBgZGVsZXRlYCwgbGVzdCB3ZSBtaXNzIHB1dHRpbmcgaXQgYmFjayBpbiB0aGUgbmV4dCB0aW1lIHRoZSBwcm9wZXJ0eSBpcyBpbiB1c2UuKQogIGRlbGV0ZSBldmVudC5zZGtQcm9jZXNzaW5nTWV0YWRhdGE7CgogIGNvbnN0IGV2ZW50SXRlbSA9IFt7IHR5cGU6IGV2ZW50VHlwZSB9LCBldmVudF07CiAgcmV0dXJuIGNyZWF0ZUVudmVsb3BlKGVudmVsb3BlSGVhZGVycywgW2V2ZW50SXRlbV0pOwp9Cgpjb25zdCBTRU5UUllfQVBJX1ZFUlNJT04gPSAnNyc7CgovKiogUmV0dXJucyB0aGUgcHJlZml4IHRvIGNvbnN0cnVjdCBTZW50cnkgaW5nZXN0aW9uIEFQSSBlbmRwb2ludHMuICovCmZ1bmN0aW9uIGdldEJhc2VBcGlFbmRwb2ludChkc24pIHsKICBjb25zdCBwcm90b2NvbCA9IGRzbi5wcm90b2NvbCA/IGAke2Rzbi5wcm90b2NvbH06YCA6ICcnOwogIGNvbnN0IHBvcnQgPSBkc24ucG9ydCA/IGA6JHtkc24ucG9ydH1gIDogJyc7CiAgcmV0dXJuIGAke3Byb3RvY29sfS8vJHtkc24uaG9zdH0ke3BvcnR9JHtkc24ucGF0aCA/IGAvJHtkc24ucGF0aH1gIDogJyd9L2FwaS9gOwp9CgovKiogUmV0dXJucyB0aGUgaW5nZXN0IEFQSSBlbmRwb2ludCBmb3IgdGFyZ2V0LiAqLwpmdW5jdGlvbiBfZ2V0SW5nZXN0RW5kcG9pbnQoZHNuKSB7CiAgcmV0dXJuIGAke2dldEJhc2VBcGlFbmRwb2ludChkc24pfSR7ZHNuLnByb2plY3RJZH0vZW52ZWxvcGUvYDsKfQoKLyoqIFJldHVybnMgYSBVUkwtZW5jb2RlZCBzdHJpbmcgd2l0aCBhdXRoIGNvbmZpZyBzdWl0YWJsZSBmb3IgYSBxdWVyeSBzdHJpbmcuICovCmZ1bmN0aW9uIF9lbmNvZGVkQXV0aChkc24sIHNka0luZm8pIHsKICByZXR1cm4gdXJsRW5jb2RlKHsKICAgIC8vIFdlIHNlbmQgb25seSB0aGUgbWluaW11bSBzZXQgb2YgcmVxdWlyZWQgaW5mb3JtYXRpb24uIFNlZQogICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2dldHNlbnRyeS9zZW50cnktamF2YXNjcmlwdC9pc3N1ZXMvMjU3Mi4KICAgIHNlbnRyeV9rZXk6IGRzbi5wdWJsaWNLZXksCiAgICBzZW50cnlfdmVyc2lvbjogU0VOVFJZX0FQSV9WRVJTSU9OLAogICAgLi4uKHNka0luZm8gJiYgeyBzZW50cnlfY2xpZW50OiBgJHtzZGtJbmZvLm5hbWV9LyR7c2RrSW5mby52ZXJzaW9ufWAgfSksCiAgfSk7Cn0KCi8qKgogKiBSZXR1cm5zIHRoZSBlbnZlbG9wZSBlbmRwb2ludCBVUkwgd2l0aCBhdXRoIGluIHRoZSBxdWVyeSBzdHJpbmcuCiAqCiAqIFNlbmRpbmcgYXV0aCBhcyBwYXJ0IG9mIHRoZSBxdWVyeSBzdHJpbmcgYW5kIG5vdCBhcyBjdXN0b20gSFRUUCBoZWFkZXJzIGF2b2lkcyBDT1JTIHByZWZsaWdodCByZXF1ZXN0cy4KICovCmZ1bmN0aW9uIGdldEVudmVsb3BlRW5kcG9pbnRXaXRoVXJsRW5jb2RlZEF1dGgoCiAgZHNuLAogIC8vIFRPRE8gKHY4KTogUmVtb3ZlIGB0dW5uZWxPck9wdGlvbnNgIGluIGZhdm9yIG9mIGBvcHRpb25zYCwgYW5kIHVzZSB0aGUgc3Vic3RpdHV0ZSBjb2RlIGJlbG93CiAgLy8gb3B0aW9uczogQ2xpZW50T3B0aW9ucyA9IHt9IGFzIENsaWVudE9wdGlvbnMsCiAgdHVubmVsT3JPcHRpb25zID0ge30gLAopIHsKICAvLyBUT0RPICh2OCk6IFVzZSB0aGlzIGNvZGUgaW5zdGVhZAogIC8vIGNvbnN0IHsgdHVubmVsLCBfbWV0YWRhdGEgPSB7fSB9ID0gb3B0aW9uczsKICAvLyByZXR1cm4gdHVubmVsID8gdHVubmVsIDogYCR7X2dldEluZ2VzdEVuZHBvaW50KGRzbil9PyR7X2VuY29kZWRBdXRoKGRzbiwgX21ldGFkYXRhLnNkayl9YDsKCiAgY29uc3QgdHVubmVsID0gdHlwZW9mIHR1bm5lbE9yT3B0aW9ucyA9PT0gJ3N0cmluZycgPyB0dW5uZWxPck9wdGlvbnMgOiB0dW5uZWxPck9wdGlvbnMudHVubmVsOwogIGNvbnN0IHNka0luZm8gPQogICAgdHlwZW9mIHR1bm5lbE9yT3B0aW9ucyA9PT0gJ3N0cmluZycgfHwgIXR1bm5lbE9yT3B0aW9ucy5fbWV0YWRhdGEgPyB1bmRlZmluZWQgOiB0dW5uZWxPck9wdGlvbnMuX21ldGFkYXRhLnNkazsKCiAgcmV0dXJuIHR1bm5lbCA/IHR1bm5lbCA6IGAke19nZXRJbmdlc3RFbmRwb2ludChkc24pfT8ke19lbmNvZGVkQXV0aChkc24sIHNka0luZm8pfWA7Cn0KCmNvbnN0IERFRkFVTFRfVFJBTlNQT1JUX0JVRkZFUl9TSVpFID0gMzA7CgovKioKICogQ3JlYXRlcyBhbiBpbnN0YW5jZSBvZiBhIFNlbnRyeSBgVHJhbnNwb3J0YAogKgogKiBAcGFyYW0gb3B0aW9ucwogKiBAcGFyYW0gbWFrZVJlcXVlc3QKICovCmZ1bmN0aW9uIGNyZWF0ZVRyYW5zcG9ydCgKICBvcHRpb25zLAogIG1ha2VSZXF1ZXN0LAogIGJ1ZmZlciA9IG1ha2VQcm9taXNlQnVmZmVyKAogICAgb3B0aW9ucy5idWZmZXJTaXplIHx8IERFRkFVTFRfVFJBTlNQT1JUX0JVRkZFUl9TSVpFLAogICksCikgewogIGxldCByYXRlTGltaXRzID0ge307CiAgY29uc3QgZmx1c2ggPSAodGltZW91dCkgPT4gYnVmZmVyLmRyYWluKHRpbWVvdXQpOwoKICBmdW5jdGlvbiBzZW5kKGVudmVsb3BlKSB7CiAgICBjb25zdCBmaWx0ZXJlZEVudmVsb3BlSXRlbXMgPSBbXTsKCiAgICAvLyBEcm9wIHJhdGUgbGltaXRlZCBpdGVtcyBmcm9tIGVudmVsb3BlCiAgICBmb3JFYWNoRW52ZWxvcGVJdGVtKGVudmVsb3BlLCAoaXRlbSwgdHlwZSkgPT4gewogICAgICBjb25zdCBlbnZlbG9wZUl0ZW1EYXRhQ2F0ZWdvcnkgPSBlbnZlbG9wZUl0ZW1UeXBlVG9EYXRhQ2F0ZWdvcnkodHlwZSk7CiAgICAgIGlmIChpc1JhdGVMaW1pdGVkKHJhdGVMaW1pdHMsIGVudmVsb3BlSXRlbURhdGFDYXRlZ29yeSkpIHsKICAgICAgICBjb25zdCBldmVudCA9IGdldEV2ZW50Rm9yRW52ZWxvcGVJdGVtKGl0ZW0sIHR5cGUpOwogICAgICAgIG9wdGlvbnMucmVjb3JkRHJvcHBlZEV2ZW50KCdyYXRlbGltaXRfYmFja29mZicsIGVudmVsb3BlSXRlbURhdGFDYXRlZ29yeSwgZXZlbnQpOwogICAgICB9IGVsc2UgewogICAgICAgIGZpbHRlcmVkRW52ZWxvcGVJdGVtcy5wdXNoKGl0ZW0pOwogICAgICB9CiAgICB9KTsKCiAgICAvLyBTa2lwIHNlbmRpbmcgaWYgZW52ZWxvcGUgaXMgZW1wdHkgYWZ0ZXIgZmlsdGVyaW5nIG91dCByYXRlIGxpbWl0ZWQgZXZlbnRzCiAgICBpZiAoZmlsdGVyZWRFbnZlbG9wZUl0ZW1zLmxlbmd0aCA9PT0gMCkgewogICAgICByZXR1cm4gcmVzb2x2ZWRTeW5jUHJvbWlzZSgpOwogICAgfQoKICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55CiAgICBjb25zdCBmaWx0ZXJlZEVudmVsb3BlID0gY3JlYXRlRW52ZWxvcGUoZW52ZWxvcGVbMF0sIGZpbHRlcmVkRW52ZWxvcGVJdGVtcyApOwoKICAgIC8vIENyZWF0ZXMgY2xpZW50IHJlcG9ydCBmb3IgZWFjaCBpdGVtIGluIGFuIGVudmVsb3BlCiAgICBjb25zdCByZWNvcmRFbnZlbG9wZUxvc3MgPSAocmVhc29uKSA9PiB7CiAgICAgIGZvckVhY2hFbnZlbG9wZUl0ZW0oZmlsdGVyZWRFbnZlbG9wZSwgKGl0ZW0sIHR5cGUpID0+IHsKICAgICAgICBjb25zdCBldmVudCA9IGdldEV2ZW50Rm9yRW52ZWxvcGVJdGVtKGl0ZW0sIHR5cGUpOwogICAgICAgIG9wdGlvbnMucmVjb3JkRHJvcHBlZEV2ZW50KHJlYXNvbiwgZW52ZWxvcGVJdGVtVHlwZVRvRGF0YUNhdGVnb3J5KHR5cGUpLCBldmVudCk7CiAgICAgIH0pOwogICAgfTsKCiAgICBjb25zdCByZXF1ZXN0VGFzayA9ICgpID0+CiAgICAgIG1ha2VSZXF1ZXN0KHsgYm9keTogc2VyaWFsaXplRW52ZWxvcGUoZmlsdGVyZWRFbnZlbG9wZSwgb3B0aW9ucy50ZXh0RW5jb2RlcikgfSkudGhlbigKICAgICAgICByZXNwb25zZSA9PiB7CiAgICAgICAgICAvLyBXZSBkb24ndCB3YW50IHRvIHRocm93IG9uIE5PSyByZXNwb25zZXMsIGJ1dCB3ZSB3YW50IHRvIGF0IGxlYXN0IGxvZyB0aGVtCiAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzQ29kZSAhPT0gdW5kZWZpbmVkICYmIChyZXNwb25zZS5zdGF0dXNDb2RlIDwgMjAwIHx8IHJlc3BvbnNlLnN0YXR1c0NvZGUgPj0gMzAwKSkgewogICAgICAgICAgICBERUJVR19CVUlMRCAmJiBsb2dnZXIud2FybihgU2VudHJ5IHJlc3BvbmRlZCB3aXRoIHN0YXR1cyBjb2RlICR7cmVzcG9uc2Uuc3RhdHVzQ29kZX0gdG8gc2VudCBldmVudC5gKTsKICAgICAgICAgIH0KCiAgICAgICAgICByYXRlTGltaXRzID0gdXBkYXRlUmF0ZUxpbWl0cyhyYXRlTGltaXRzLCByZXNwb25zZSk7CiAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7CiAgICAgICAgfSwKICAgICAgICBlcnJvciA9PiB7CiAgICAgICAgICByZWNvcmRFbnZlbG9wZUxvc3MoJ25ldHdvcmtfZXJyb3InKTsKICAgICAgICAgIHRocm93IGVycm9yOwogICAgICAgIH0sCiAgICAgICk7CgogICAgcmV0dXJuIGJ1ZmZlci5hZGQocmVxdWVzdFRhc2spLnRoZW4oCiAgICAgIHJlc3VsdCA9PiByZXN1bHQsCiAgICAgIGVycm9yID0+IHsKICAgICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBTZW50cnlFcnJvcikgewogICAgICAgICAgREVCVUdfQlVJTEQgJiYgbG9nZ2VyLmVycm9yKCdTa2lwcGVkIHNlbmRpbmcgZXZlbnQgYmVjYXVzZSBidWZmZXIgaXMgZnVsbC4nKTsKICAgICAgICAgIHJlY29yZEVudmVsb3BlTG9zcygncXVldWVfb3ZlcmZsb3cnKTsKICAgICAgICAgIHJldHVybiByZXNvbHZlZFN5bmNQcm9taXNlKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRocm93IGVycm9yOwogICAgICAgIH0KICAgICAgfSwKICAgICk7CiAgfQoKICAvLyBXZSB1c2UgdGhpcyB0byBpZGVudGlmaWZ5IGlmIHRoZSB0cmFuc3BvcnQgaXMgdGhlIGJhc2UgdHJhbnNwb3J0CiAgLy8gVE9ETyAodjgpOiBSZW1vdmUgdGhpcyBhZ2FpbiBhcyB3ZSdsbCBubyBsb25nZXIgbmVlZCBpdAogIHNlbmQuX19zZW50cnlfX2Jhc2VUcmFuc3BvcnRfXyA9IHRydWU7CgogIHJldHVybiB7CiAgICBzZW5kLAogICAgZmx1c2gsCiAgfTsKfQoKZnVuY3Rpb24gZ2V0RXZlbnRGb3JFbnZlbG9wZUl0ZW0oaXRlbSwgdHlwZSkgewogIGlmICh0eXBlICE9PSAnZXZlbnQnICYmIHR5cGUgIT09ICd0cmFuc2FjdGlvbicpIHsKICAgIHJldHVybiB1bmRlZmluZWQ7CiAgfQoKICByZXR1cm4gQXJyYXkuaXNBcnJheShpdGVtKSA/IChpdGVtIClbMV0gOiB1bmRlZmluZWQ7Cn0KCi8qKiBub3JtYWxpemVzIFdpbmRvd3MgcGF0aHMgKi8KZnVuY3Rpb24gbm9ybWFsaXplV2luZG93c1BhdGgocGF0aCkgewogIHJldHVybiBwYXRoCiAgICAucmVwbGFjZSgvXltBLVpdOi8sICcnKSAvLyByZW1vdmUgV2luZG93cy1zdHlsZSBwcmVmaXgKICAgIC5yZXBsYWNlKC9cXC9nLCAnLycpOyAvLyByZXBsYWNlIGFsbCBgXGAgaW5zdGFuY2VzIHdpdGggYC9gCn0KCi8qKiBDcmVhdGVzIGEgZnVuY3Rpb24gdGhhdCBnZXRzIHRoZSBtb2R1bGUgbmFtZSBmcm9tIGEgZmlsZW5hbWUgKi8KZnVuY3Rpb24gY3JlYXRlR2V0TW9kdWxlRnJvbUZpbGVuYW1lKAogIGJhc2VQYXRoID0gcHJvY2Vzcy5hcmd2WzFdID8gZGlybmFtZShwcm9jZXNzLmFyZ3ZbMV0pIDogcHJvY2Vzcy5jd2QoKSwKICBpc1dpbmRvd3MgPSBzZXAgPT09ICdcXCcsCikgewogIGNvbnN0IG5vcm1hbGl6ZWRCYXNlID0gaXNXaW5kb3dzID8gbm9ybWFsaXplV2luZG93c1BhdGgoYmFzZVBhdGgpIDogYmFzZVBhdGg7CgogIHJldHVybiAoZmlsZW5hbWUpID0+IHsKICAgIGlmICghZmlsZW5hbWUpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIGNvbnN0IG5vcm1hbGl6ZWRGaWxlbmFtZSA9IGlzV2luZG93cyA/IG5vcm1hbGl6ZVdpbmRvd3NQYXRoKGZpbGVuYW1lKSA6IGZpbGVuYW1lOwoKICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBwcmVmZXItY29uc3QKICAgIGxldCB7IGRpciwgYmFzZTogZmlsZSwgZXh0IH0gPSBwb3NpeC5wYXJzZShub3JtYWxpemVkRmlsZW5hbWUpOwoKICAgIGlmIChleHQgPT09ICcuanMnIHx8IGV4dCA9PT0gJy5tanMnIHx8IGV4dCA9PT0gJy5janMnKSB7CiAgICAgIGZpbGUgPSBmaWxlLnNsaWNlKDAsIGV4dC5sZW5ndGggKiAtMSk7CiAgICB9CgogICAgaWYgKCFkaXIpIHsKICAgICAgLy8gTm8gZGlybmFtZSB3aGF0c29ldmVyCiAgICAgIGRpciA9ICcuJzsKICAgIH0KCiAgICBjb25zdCBuID0gZGlyLmxhc3RJbmRleE9mKCcvbm9kZV9tb2R1bGVzJyk7CiAgICBpZiAobiA+IC0xKSB7CiAgICAgIHJldHVybiBgJHtkaXIuc2xpY2UobiArIDE0KS5yZXBsYWNlKC9cLy9nLCAnLicpfToke2ZpbGV9YDsKICAgIH0KCiAgICAvLyBMZXQncyBzZWUgaWYgaXQncyBhIHBhcnQgb2YgdGhlIG1haW4gbW9kdWxlCiAgICAvLyBUbyBiZSBhIHBhcnQgb2YgbWFpbiBtb2R1bGUsIGl0IGhhcyB0byBzaGFyZSB0aGUgc2FtZSBiYXNlCiAgICBpZiAoZGlyLnN0YXJ0c1dpdGgobm9ybWFsaXplZEJhc2UpKSB7CiAgICAgIGxldCBtb2R1bGVOYW1lID0gZGlyLnNsaWNlKG5vcm1hbGl6ZWRCYXNlLmxlbmd0aCArIDEpLnJlcGxhY2UoL1wvL2csICcuJyk7CgogICAgICBpZiAobW9kdWxlTmFtZSkgewogICAgICAgIG1vZHVsZU5hbWUgKz0gJzonOwogICAgICB9CiAgICAgIG1vZHVsZU5hbWUgKz0gZmlsZTsKCiAgICAgIHJldHVybiBtb2R1bGVOYW1lOwogICAgfQoKICAgIHJldHVybiBmaWxlOwogIH07Cn0KCmZ1bmN0aW9uIF9udWxsaXNoQ29hbGVzY2UkMihsaHMsIHJoc0ZuKSB7IGlmIChsaHMgIT0gbnVsbCkgeyByZXR1cm4gbGhzOyB9IGVsc2UgeyByZXR1cm4gcmhzRm4oKTsgfSB9LyoqCiAqIFRoaXMgY29kZSB3YXMgb3JpZ2luYWxseSBmb3JrZWQgZnJvbSBodHRwczovL2dpdGh1Yi5jb20vVG9vVGFsbE5hdGUvcHJveHktYWdlbnRzL3RyZWUvYjEzMzI5NWZkMTZmNjQ3NTU3OGI2YjE1YmQ5YjRlMzNlY2IwZDBiNwogKiBXaXRoIHRoZSBmb2xsb3dpbmcgbGljZW5jZToKICoKICogKFRoZSBNSVQgTGljZW5zZSkKICoKICogQ29weXJpZ2h0IChjKSAyMDEzIE5hdGhhbiBSYWpsaWNoIDxuYXRoYW5AdG9vdGFsbG5hdGUubmV0PioKICoKICogUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nCiAqIGEgY29weSBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZQogKiAnU29mdHdhcmUnKSwgdG8gZGVhbCBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nCiAqIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwKICogZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwgY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvCiAqIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0bwogKiB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6KgogKgogKiBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZQogKiBpbmNsdWRlZCBpbiBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4qCiAqCiAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAnQVMgSVMnLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELAogKiBFWFBSRVNTIE9SIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YKICogTUVSQ0hBTlRBQklMSVRZLCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULgogKiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWQogKiBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULAogKiBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRQogKiBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRSBTT0ZUV0FSRS4KICovCgpjb25zdCBJTlRFUk5BTCA9IFN5bWJvbCgnQWdlbnRCYXNlSW50ZXJuYWxTdGF0ZScpOwoKY2xhc3MgQWdlbnQgZXh0ZW5kcyBodHRwLkFnZW50IHsKCiAgLy8gU2V0IGJ5IGBodHRwLkFnZW50YCAtIG1pc3NpbmcgZnJvbSBgQHR5cGVzL25vZGVgCgogIGNvbnN0cnVjdG9yKG9wdHMpIHsKICAgIHN1cGVyKG9wdHMpOwogICAgdGhpc1tJTlRFUk5BTF0gPSB7fTsKICB9CgogIC8qKgogICAqIERldGVybWluZSB3aGV0aGVyIHRoaXMgaXMgYW4gYGh0dHBgIG9yIGBodHRwc2AgcmVxdWVzdC4KICAgKi8KICBpc1NlY3VyZUVuZHBvaW50KG9wdGlvbnMpIHsKICAgIGlmIChvcHRpb25zKSB7CiAgICAgIC8vIEZpcnN0IGNoZWNrIHRoZSBgc2VjdXJlRW5kcG9pbnRgIHByb3BlcnR5IGV4cGxpY2l0bHksIHNpbmNlIHRoaXMKICAgICAgLy8gbWVhbnMgdGhhdCBhIHBhcmVudCBgQWdlbnRgIGlzICJwYXNzaW5nIHRocm91Z2giIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55LCBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdW5zYWZlLW1lbWJlci1hY2Nlc3MKICAgICAgaWYgKHR5cGVvZiAob3B0aW9ucyApLnNlY3VyZUVuZHBvaW50ID09PSAnYm9vbGVhbicpIHsKICAgICAgICByZXR1cm4gb3B0aW9ucy5zZWN1cmVFbmRwb2ludDsKICAgICAgfQoKICAgICAgLy8gSWYgbm8gZXhwbGljaXQgYHNlY3VyZWAgZW5kcG9pbnQsIGNoZWNrIGlmIGBwcm90b2NvbGAgcHJvcGVydHkgaXMKICAgICAgLy8gc2V0LiBUaGlzIHdpbGwgdXN1YWxseSBiZSB0aGUgY2FzZSBzaW5jZSB1c2luZyBhIGZ1bGwgc3RyaW5nIFVSTAogICAgICAvLyBvciBgVVJMYCBpbnN0YW5jZSBzaG91bGQgYmUgdGhlIG1vc3QgY29tbW9uIHVzYWdlLgogICAgICBpZiAodHlwZW9mIG9wdGlvbnMucHJvdG9jb2wgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgcmV0dXJuIG9wdGlvbnMucHJvdG9jb2wgPT09ICdodHRwczonOwogICAgICB9CiAgICB9CgogICAgLy8gRmluYWxseSwgaWYgbm8gYHByb3RvY29sYCBwcm9wZXJ0eSB3YXMgc2V0LCB0aGVuIGZhbGwgYmFjayB0bwogICAgLy8gY2hlY2tpbmcgdGhlIHN0YWNrIHRyYWNlIG9mIHRoZSBjdXJyZW50IGNhbGwgc3RhY2ssIGFuZCB0cnkgdG8KICAgIC8vIGRldGVjdCB0aGUgImh0dHBzIiBtb2R1bGUuCiAgICBjb25zdCB7IHN0YWNrIH0gPSBuZXcgRXJyb3IoKTsKICAgIGlmICh0eXBlb2Ygc3RhY2sgIT09ICdzdHJpbmcnKSByZXR1cm4gZmFsc2U7CiAgICByZXR1cm4gc3RhY2suc3BsaXQoJ1xuJykuc29tZShsID0+IGwuaW5kZXhPZignKGh0dHBzLmpzOicpICE9PSAtMSB8fCBsLmluZGV4T2YoJ25vZGU6aHR0cHM6JykgIT09IC0xKTsKICB9CgogIGNyZWF0ZVNvY2tldChyZXEsIG9wdGlvbnMsIGNiKSB7CiAgICBjb25zdCBjb25uZWN0T3B0cyA9IHsKICAgICAgLi4ub3B0aW9ucywKICAgICAgc2VjdXJlRW5kcG9pbnQ6IHRoaXMuaXNTZWN1cmVFbmRwb2ludChvcHRpb25zKSwKICAgIH07CiAgICBQcm9taXNlLnJlc29sdmUoKQogICAgICAudGhlbigoKSA9PiB0aGlzLmNvbm5lY3QocmVxLCBjb25uZWN0T3B0cykpCiAgICAgIC50aGVuKHNvY2tldCA9PiB7CiAgICAgICAgaWYgKHNvY2tldCBpbnN0YW5jZW9mIGh0dHAuQWdlbnQpIHsKICAgICAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgYGFkZFJlcXVlc3QoKWAgaXNuJ3QgZGVmaW5lZCBpbiBgQHR5cGVzL25vZGVgCiAgICAgICAgICByZXR1cm4gc29ja2V0LmFkZFJlcXVlc3QocmVxLCBjb25uZWN0T3B0cyk7CiAgICAgICAgfQogICAgICAgIHRoaXNbSU5URVJOQUxdLmN1cnJlbnRTb2NrZXQgPSBzb2NrZXQ7CiAgICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciBgY3JlYXRlU29ja2V0KClgIGlzbid0IGRlZmluZWQgaW4gYEB0eXBlcy9ub2RlYAogICAgICAgIHN1cGVyLmNyZWF0ZVNvY2tldChyZXEsIG9wdGlvbnMsIGNiKTsKICAgICAgfSwgY2IpOwogIH0KCiAgY3JlYXRlQ29ubmVjdGlvbigpIHsKICAgIGNvbnN0IHNvY2tldCA9IHRoaXNbSU5URVJOQUxdLmN1cnJlbnRTb2NrZXQ7CiAgICB0aGlzW0lOVEVSTkFMXS5jdXJyZW50U29ja2V0ID0gdW5kZWZpbmVkOwogICAgaWYgKCFzb2NrZXQpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyBzb2NrZXQgd2FzIHJldHVybmVkIGluIHRoZSBgY29ubmVjdCgpYCBmdW5jdGlvbicpOwogICAgfQogICAgcmV0dXJuIHNvY2tldDsKICB9CgogIGdldCBkZWZhdWx0UG9ydCgpIHsKICAgIHJldHVybiBfbnVsbGlzaENvYWxlc2NlJDIodGhpc1tJTlRFUk5BTF0uZGVmYXVsdFBvcnQsICgpID0+ICggKHRoaXMucHJvdG9jb2wgPT09ICdodHRwczonID8gNDQzIDogODApKSk7CiAgfQoKICBzZXQgZGVmYXVsdFBvcnQodikgewogICAgaWYgKHRoaXNbSU5URVJOQUxdKSB7CiAgICAgIHRoaXNbSU5URVJOQUxdLmRlZmF1bHRQb3J0ID0gdjsKICAgIH0KICB9CgogIGdldCBwcm90b2NvbCgpIHsKICAgIHJldHVybiBfbnVsbGlzaENvYWxlc2NlJDIodGhpc1tJTlRFUk5BTF0ucHJvdG9jb2wsICgpID0+ICggKHRoaXMuaXNTZWN1cmVFbmRwb2ludCgpID8gJ2h0dHBzOicgOiAnaHR0cDonKSkpOwogIH0KCiAgc2V0IHByb3RvY29sKHYpIHsKICAgIGlmICh0aGlzW0lOVEVSTkFMXSkgewogICAgICB0aGlzW0lOVEVSTkFMXS5wcm90b2NvbCA9IHY7CiAgICB9CiAgfQp9CgpmdW5jdGlvbiBkZWJ1ZyQxKC4uLmFyZ3MpIHsKICBsb2dnZXIubG9nKCdbaHR0cHMtcHJveHktYWdlbnQ6cGFyc2UtcHJveHktcmVzcG9uc2VdJywgLi4uYXJncyk7Cn0KCmZ1bmN0aW9uIHBhcnNlUHJveHlSZXNwb25zZShzb2NrZXQpIHsKICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewogICAgLy8gd2UgbmVlZCB0byBidWZmZXIgYW55IEhUVFAgdHJhZmZpYyB0aGF0IGhhcHBlbnMgd2l0aCB0aGUgcHJveHkgYmVmb3JlIHdlIGdldAogICAgLy8gdGhlIENPTk5FQ1QgcmVzcG9uc2UsIHNvIHRoYXQgaWYgdGhlIHJlc3BvbnNlIGlzIGFueXRoaW5nIG90aGVyIHRoYW4gYW4gIjIwMCIKICAgIC8vIHJlc3BvbnNlIGNvZGUsIHRoZW4gd2UgY2FuIHJlLXBsYXkgdGhlICJkYXRhIiBldmVudHMgb24gdGhlIHNvY2tldCBvbmNlIHRoZQogICAgLy8gSFRUUCBwYXJzZXIgaXMgaG9va2VkIHVwLi4uCiAgICBsZXQgYnVmZmVyc0xlbmd0aCA9IDA7CiAgICBjb25zdCBidWZmZXJzID0gW107CgogICAgZnVuY3Rpb24gcmVhZCgpIHsKICAgICAgY29uc3QgYiA9IHNvY2tldC5yZWFkKCk7CiAgICAgIGlmIChiKSBvbmRhdGEoYik7CiAgICAgIGVsc2Ugc29ja2V0Lm9uY2UoJ3JlYWRhYmxlJywgcmVhZCk7CiAgICB9CgogICAgZnVuY3Rpb24gY2xlYW51cCgpIHsKICAgICAgc29ja2V0LnJlbW92ZUxpc3RlbmVyKCdlbmQnLCBvbmVuZCk7CiAgICAgIHNvY2tldC5yZW1vdmVMaXN0ZW5lcignZXJyb3InLCBvbmVycm9yKTsKICAgICAgc29ja2V0LnJlbW92ZUxpc3RlbmVyKCdyZWFkYWJsZScsIHJlYWQpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9uZW5kKCkgewogICAgICBjbGVhbnVwKCk7CiAgICAgIGRlYnVnJDEoJ29uZW5kJyk7CiAgICAgIHJlamVjdChuZXcgRXJyb3IoJ1Byb3h5IGNvbm5lY3Rpb24gZW5kZWQgYmVmb3JlIHJlY2VpdmluZyBDT05ORUNUIHJlc3BvbnNlJykpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9uZXJyb3IoZXJyKSB7CiAgICAgIGNsZWFudXAoKTsKICAgICAgZGVidWckMSgnb25lcnJvciAlbycsIGVycik7CiAgICAgIHJlamVjdChlcnIpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9uZGF0YShiKSB7CiAgICAgIGJ1ZmZlcnMucHVzaChiKTsKICAgICAgYnVmZmVyc0xlbmd0aCArPSBiLmxlbmd0aDsKCiAgICAgIGNvbnN0IGJ1ZmZlcmVkID0gQnVmZmVyLmNvbmNhdChidWZmZXJzLCBidWZmZXJzTGVuZ3RoKTsKICAgICAgY29uc3QgZW5kT2ZIZWFkZXJzID0gYnVmZmVyZWQuaW5kZXhPZignXHJcblxyXG4nKTsKCiAgICAgIGlmIChlbmRPZkhlYWRlcnMgPT09IC0xKSB7CiAgICAgICAgLy8ga2VlcCBidWZmZXJpbmcKICAgICAgICBkZWJ1ZyQxKCdoYXZlIG5vdCByZWNlaXZlZCBlbmQgb2YgSFRUUCBoZWFkZXJzIHlldC4uLicpOwogICAgICAgIHJlYWQoKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IGhlYWRlclBhcnRzID0gYnVmZmVyZWQuc2xpY2UoMCwgZW5kT2ZIZWFkZXJzKS50b1N0cmluZygnYXNjaWknKS5zcGxpdCgnXHJcbicpOwogICAgICBjb25zdCBmaXJzdExpbmUgPSBoZWFkZXJQYXJ0cy5zaGlmdCgpOwogICAgICBpZiAoIWZpcnN0TGluZSkgewogICAgICAgIHNvY2tldC5kZXN0cm95KCk7CiAgICAgICAgcmV0dXJuIHJlamVjdChuZXcgRXJyb3IoJ05vIGhlYWRlciByZWNlaXZlZCBmcm9tIHByb3h5IENPTk5FQ1QgcmVzcG9uc2UnKSk7CiAgICAgIH0KICAgICAgY29uc3QgZmlyc3RMaW5lUGFydHMgPSBmaXJzdExpbmUuc3BsaXQoJyAnKTsKICAgICAgY29uc3Qgc3RhdHVzQ29kZSA9ICtmaXJzdExpbmVQYXJ0c1sxXTsKICAgICAgY29uc3Qgc3RhdHVzVGV4dCA9IGZpcnN0TGluZVBhcnRzLnNsaWNlKDIpLmpvaW4oJyAnKTsKICAgICAgY29uc3QgaGVhZGVycyA9IHt9OwogICAgICBmb3IgKGNvbnN0IGhlYWRlciBvZiBoZWFkZXJQYXJ0cykgewogICAgICAgIGlmICghaGVhZGVyKSBjb250aW51ZTsKICAgICAgICBjb25zdCBmaXJzdENvbG9uID0gaGVhZGVyLmluZGV4T2YoJzonKTsKICAgICAgICBpZiAoZmlyc3RDb2xvbiA9PT0gLTEpIHsKICAgICAgICAgIHNvY2tldC5kZXN0cm95KCk7CiAgICAgICAgICByZXR1cm4gcmVqZWN0KG5ldyBFcnJvcihgSW52YWxpZCBoZWFkZXIgZnJvbSBwcm94eSBDT05ORUNUIHJlc3BvbnNlOiAiJHtoZWFkZXJ9ImApKTsKICAgICAgICB9CiAgICAgICAgY29uc3Qga2V5ID0gaGVhZGVyLnNsaWNlKDAsIGZpcnN0Q29sb24pLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgY29uc3QgdmFsdWUgPSBoZWFkZXIuc2xpY2UoZmlyc3RDb2xvbiArIDEpLnRyaW1TdGFydCgpOwogICAgICAgIGNvbnN0IGN1cnJlbnQgPSBoZWFkZXJzW2tleV07CiAgICAgICAgaWYgKHR5cGVvZiBjdXJyZW50ID09PSAnc3RyaW5nJykgewogICAgICAgICAgaGVhZGVyc1trZXldID0gW2N1cnJlbnQsIHZhbHVlXTsKICAgICAgICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkoY3VycmVudCkpIHsKICAgICAgICAgIGN1cnJlbnQucHVzaCh2YWx1ZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGhlYWRlcnNba2V5XSA9IHZhbHVlOwogICAgICAgIH0KICAgICAgfQogICAgICBkZWJ1ZyQxKCdnb3QgcHJveHkgc2VydmVyIHJlc3BvbnNlOiAlbyAlbycsIGZpcnN0TGluZSwgaGVhZGVycyk7CiAgICAgIGNsZWFudXAoKTsKICAgICAgcmVzb2x2ZSh7CiAgICAgICAgY29ubmVjdDogewogICAgICAgICAgc3RhdHVzQ29kZSwKICAgICAgICAgIHN0YXR1c1RleHQsCiAgICAgICAgICBoZWFkZXJzLAogICAgICAgIH0sCiAgICAgICAgYnVmZmVyZWQsCiAgICAgIH0pOwogICAgfQoKICAgIHNvY2tldC5vbignZXJyb3InLCBvbmVycm9yKTsKICAgIHNvY2tldC5vbignZW5kJywgb25lbmQpOwoKICAgIHJlYWQoKTsKICB9KTsKfQoKZnVuY3Rpb24gX251bGxpc2hDb2FsZXNjZSQxKGxocywgcmhzRm4pIHsgaWYgKGxocyAhPSBudWxsKSB7IHJldHVybiBsaHM7IH0gZWxzZSB7IHJldHVybiByaHNGbigpOyB9IH0gZnVuY3Rpb24gX29wdGlvbmFsQ2hhaW4kMShvcHMpIHsgbGV0IGxhc3RBY2Nlc3NMSFMgPSB1bmRlZmluZWQ7IGxldCB2YWx1ZSA9IG9wc1swXTsgbGV0IGkgPSAxOyB3aGlsZSAoaSA8IG9wcy5sZW5ndGgpIHsgY29uc3Qgb3AgPSBvcHNbaV07IGNvbnN0IGZuID0gb3BzW2kgKyAxXTsgaSArPSAyOyBpZiAoKG9wID09PSAnb3B0aW9uYWxBY2Nlc3MnIHx8IG9wID09PSAnb3B0aW9uYWxDYWxsJykgJiYgdmFsdWUgPT0gbnVsbCkgeyByZXR1cm4gdW5kZWZpbmVkOyB9IGlmIChvcCA9PT0gJ2FjY2VzcycgfHwgb3AgPT09ICdvcHRpb25hbEFjY2VzcycpIHsgbGFzdEFjY2Vzc0xIUyA9IHZhbHVlOyB2YWx1ZSA9IGZuKHZhbHVlKTsgfSBlbHNlIGlmIChvcCA9PT0gJ2NhbGwnIHx8IG9wID09PSAnb3B0aW9uYWxDYWxsJykgeyB2YWx1ZSA9IGZuKCguLi5hcmdzKSA9PiB2YWx1ZS5jYWxsKGxhc3RBY2Nlc3NMSFMsIC4uLmFyZ3MpKTsgbGFzdEFjY2Vzc0xIUyA9IHVuZGVmaW5lZDsgfSB9IHJldHVybiB2YWx1ZTsgfS8qKgogKiBUaGlzIGNvZGUgd2FzIG9yaWdpbmFsbHkgZm9ya2VkIGZyb20gaHR0cHM6Ly9naXRodWIuY29tL1Rvb1RhbGxOYXRlL3Byb3h5LWFnZW50cy90cmVlL2IxMzMyOTVmZDE2ZjY0NzU1NzhiNmIxNWJkOWI0ZTMzZWNiMGQwYjcKICogV2l0aCB0aGUgZm9sbG93aW5nIGxpY2VuY2U6CiAqCiAqIChUaGUgTUlUIExpY2Vuc2UpCiAqCiAqIENvcHlyaWdodCAoYykgMjAxMyBOYXRoYW4gUmFqbGljaCA8bmF0aGFuQHRvb3RhbGxuYXRlLm5ldD4qCiAqCiAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZwogKiBhIGNvcHkgb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUKICogJ1NvZnR3YXJlJyksIHRvIGRlYWwgaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZwogKiB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0cyB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsCiAqIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0bwogKiBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpcyBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8KICogdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOioKICoKICogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUKICogaW5jbHVkZWQgaW4gYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuKgogKgogKiBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgJ0FTIElTJywgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwKICogRVhQUkVTUyBPUiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GCiAqIE1FUkNIQU5UQUJJTElUWSwgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4KICogSU4gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkKICogQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVIgTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwKICogVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUKICogU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTiBUSEUgU09GVFdBUkUuCiAqLwoKZnVuY3Rpb24gZGVidWcoLi4uYXJncykgewogIGxvZ2dlci5sb2coJ1todHRwcy1wcm94eS1hZ2VudF0nLCAuLi5hcmdzKTsKfQoKLyoqCiAqIFRoZSBgSHR0cHNQcm94eUFnZW50YCBpbXBsZW1lbnRzIGFuIEhUVFAgQWdlbnQgc3ViY2xhc3MgdGhhdCBjb25uZWN0cyB0bwogKiB0aGUgc3BlY2lmaWVkICJIVFRQKHMpIHByb3h5IHNlcnZlciIgaW4gb3JkZXIgdG8gcHJveHkgSFRUUFMgcmVxdWVzdHMuCiAqCiAqIE91dGdvaW5nIEhUVFAgcmVxdWVzdHMgYXJlIGZpcnN0IHR1bm5lbGVkIHRocm91Z2ggdGhlIHByb3h5IHNlcnZlciB1c2luZyB0aGUKICogYENPTk5FQ1RgIEhUVFAgcmVxdWVzdCBtZXRob2QgdG8gZXN0YWJsaXNoIGEgY29ubmVjdGlvbiB0byB0aGUgcHJveHkgc2VydmVyLAogKiBhbmQgdGhlbiB0aGUgcHJveHkgc2VydmVyIGNvbm5lY3RzIHRvIHRoZSBkZXN0aW5hdGlvbiB0YXJnZXQgYW5kIGlzc3VlcyB0aGUKICogSFRUUCByZXF1ZXN0IGZyb20gdGhlIHByb3h5IHNlcnZlci4KICoKICogYGh0dHBzOmAgcmVxdWVzdHMgaGF2ZSB0aGVpciBzb2NrZXQgY29ubmVjdGlvbiB1cGdyYWRlZCB0byBUTFMgb25jZQogKiB0aGUgY29ubmVjdGlvbiB0byB0aGUgcHJveHkgc2VydmVyIGhhcyBiZWVuIGVzdGFibGlzaGVkLgogKi8KY2xhc3MgSHR0cHNQcm94eUFnZW50IGV4dGVuZHMgQWdlbnQgewogIHN0YXRpYyBfX2luaXRTdGF0aWMoKSB7dGhpcy5wcm90b2NvbHMgPSBbJ2h0dHAnLCAnaHR0cHMnXTsgfQoKICBjb25zdHJ1Y3Rvcihwcm94eSwgb3B0cykgewogICAgc3VwZXIob3B0cyk7CiAgICB0aGlzLm9wdGlvbnMgPSB7fTsKICAgIHRoaXMucHJveHkgPSB0eXBlb2YgcHJveHkgPT09ICdzdHJpbmcnID8gbmV3IFVSTChwcm94eSkgOiBwcm94eTsKICAgIHRoaXMucHJveHlIZWFkZXJzID0gX251bGxpc2hDb2FsZXNjZSQxKF9vcHRpb25hbENoYWluJDEoW29wdHMsICdvcHRpb25hbEFjY2VzcycsIF8yID0+IF8yLmhlYWRlcnNdKSwgKCkgPT4gKCB7fSkpOwogICAgZGVidWcoJ0NyZWF0aW5nIG5ldyBIdHRwc1Byb3h5QWdlbnQgaW5zdGFuY2U6ICVvJywgdGhpcy5wcm94eS5ocmVmKTsKCiAgICAvLyBUcmltIG9mZiB0aGUgYnJhY2tldHMgZnJvbSBJUHY2IGFkZHJlc3NlcwogICAgY29uc3QgaG9zdCA9ICh0aGlzLnByb3h5Lmhvc3RuYW1lIHx8IHRoaXMucHJveHkuaG9zdCkucmVwbGFjZSgvXlxbfFxdJC9nLCAnJyk7CiAgICBjb25zdCBwb3J0ID0gdGhpcy5wcm94eS5wb3J0ID8gcGFyc2VJbnQodGhpcy5wcm94eS5wb3J0LCAxMCkgOiB0aGlzLnByb3h5LnByb3RvY29sID09PSAnaHR0cHM6JyA/IDQ0MyA6IDgwOwogICAgdGhpcy5jb25uZWN0T3B0cyA9IHsKICAgICAgLy8gQXR0ZW1wdCB0byBuZWdvdGlhdGUgaHR0cC8xLjEgZm9yIHByb3h5IHNlcnZlcnMgdGhhdCBzdXBwb3J0IGh0dHAvMgogICAgICBBTFBOUHJvdG9jb2xzOiBbJ2h0dHAvMS4xJ10sCiAgICAgIC4uLihvcHRzID8gb21pdChvcHRzLCAnaGVhZGVycycpIDogbnVsbCksCiAgICAgIGhvc3QsCiAgICAgIHBvcnQsCiAgICB9OwogIH0KCiAgLyoqCiAgICogQ2FsbGVkIHdoZW4gdGhlIG5vZGUtY29yZSBIVFRQIGNsaWVudCBsaWJyYXJ5IGlzIGNyZWF0aW5nIGEKICAgKiBuZXcgSFRUUCByZXF1ZXN0LgogICAqLwogIGFzeW5jIGNvbm5lY3QocmVxLCBvcHRzKSB7CiAgICBjb25zdCB7IHByb3h5IH0gPSB0aGlzOwoKICAgIGlmICghb3B0cy5ob3N0KSB7CiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ05vICJob3N0IiBwcm92aWRlZCcpOwogICAgfQoKICAgIC8vIENyZWF0ZSBhIHNvY2tldCBjb25uZWN0aW9uIHRvIHRoZSBwcm94eSBzZXJ2ZXIuCiAgICBsZXQgc29ja2V0OwogICAgaWYgKHByb3h5LnByb3RvY29sID09PSAnaHR0cHM6JykgewogICAgICBkZWJ1ZygnQ3JlYXRpbmcgYHRscy5Tb2NrZXRgOiAlbycsIHRoaXMuY29ubmVjdE9wdHMpOwogICAgICBjb25zdCBzZXJ2ZXJuYW1lID0gdGhpcy5jb25uZWN0T3B0cy5zZXJ2ZXJuYW1lIHx8IHRoaXMuY29ubmVjdE9wdHMuaG9zdDsKICAgICAgc29ja2V0ID0gdGxzLmNvbm5lY3QoewogICAgICAgIC4uLnRoaXMuY29ubmVjdE9wdHMsCiAgICAgICAgc2VydmVybmFtZTogc2VydmVybmFtZSAmJiBuZXQuaXNJUChzZXJ2ZXJuYW1lKSA/IHVuZGVmaW5lZCA6IHNlcnZlcm5hbWUsCiAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgZGVidWcoJ0NyZWF0aW5nIGBuZXQuU29ja2V0YDogJW8nLCB0aGlzLmNvbm5lY3RPcHRzKTsKICAgICAgc29ja2V0ID0gbmV0LmNvbm5lY3QodGhpcy5jb25uZWN0T3B0cyk7CiAgICB9CgogICAgY29uc3QgaGVhZGVycyA9CiAgICAgIHR5cGVvZiB0aGlzLnByb3h5SGVhZGVycyA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMucHJveHlIZWFkZXJzKCkgOiB7IC4uLnRoaXMucHJveHlIZWFkZXJzIH07CiAgICBjb25zdCBob3N0ID0gbmV0LmlzSVB2NihvcHRzLmhvc3QpID8gYFske29wdHMuaG9zdH1dYCA6IG9wdHMuaG9zdDsKICAgIGxldCBwYXlsb2FkID0gYENPTk5FQ1QgJHtob3N0fToke29wdHMucG9ydH0gSFRUUC8xLjFcclxuYDsKCiAgICAvLyBJbmplY3QgdGhlIGBQcm94eS1BdXRob3JpemF0aW9uYCBoZWFkZXIgaWYgbmVjZXNzYXJ5LgogICAgaWYgKHByb3h5LnVzZXJuYW1lIHx8IHByb3h5LnBhc3N3b3JkKSB7CiAgICAgIGNvbnN0IGF1dGggPSBgJHtkZWNvZGVVUklDb21wb25lbnQocHJveHkudXNlcm5hbWUpfToke2RlY29kZVVSSUNvbXBvbmVudChwcm94eS5wYXNzd29yZCl9YDsKICAgICAgaGVhZGVyc1snUHJveHktQXV0aG9yaXphdGlvbiddID0gYEJhc2ljICR7QnVmZmVyLmZyb20oYXV0aCkudG9TdHJpbmcoJ2Jhc2U2NCcpfWA7CiAgICB9CgogICAgaGVhZGVycy5Ib3N0ID0gYCR7aG9zdH06JHtvcHRzLnBvcnR9YDsKCiAgICBpZiAoIWhlYWRlcnNbJ1Byb3h5LUNvbm5lY3Rpb24nXSkgewogICAgICBoZWFkZXJzWydQcm94eS1Db25uZWN0aW9uJ10gPSB0aGlzLmtlZXBBbGl2ZSA/ICdLZWVwLUFsaXZlJyA6ICdjbG9zZSc7CiAgICB9CiAgICBmb3IgKGNvbnN0IG5hbWUgb2YgT2JqZWN0LmtleXMoaGVhZGVycykpIHsKICAgICAgcGF5bG9hZCArPSBgJHtuYW1lfTogJHtoZWFkZXJzW25hbWVdfVxyXG5gOwogICAgfQoKICAgIGNvbnN0IHByb3h5UmVzcG9uc2VQcm9taXNlID0gcGFyc2VQcm94eVJlc3BvbnNlKHNvY2tldCk7CgogICAgc29ja2V0LndyaXRlKGAke3BheWxvYWR9XHJcbmApOwoKICAgIGNvbnN0IHsgY29ubmVjdCwgYnVmZmVyZWQgfSA9IGF3YWl0IHByb3h5UmVzcG9uc2VQcm9taXNlOwogICAgcmVxLmVtaXQoJ3Byb3h5Q29ubmVjdCcsIGNvbm5lY3QpOwogICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9iYW4tdHMtY29tbWVudAogICAgLy8gQHRzLWlnbm9yZSBOb3QgRXZlbnRFbWl0dGVyIGluIE5vZGUgdHlwZXMKICAgIHRoaXMuZW1pdCgncHJveHlDb25uZWN0JywgY29ubmVjdCwgcmVxKTsKCiAgICBpZiAoY29ubmVjdC5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgcmVxLm9uY2UoJ3NvY2tldCcsIHJlc3VtZSk7CgogICAgICBpZiAob3B0cy5zZWN1cmVFbmRwb2ludCkgewogICAgICAgIC8vIFRoZSBwcm94eSBpcyBjb25uZWN0aW5nIHRvIGEgVExTIHNlcnZlciwgc28gdXBncmFkZQogICAgICAgIC8vIHRoaXMgc29ja2V0IGNvbm5lY3Rpb24gdG8gYSBUTFMgY29ubmVjdGlvbi4KICAgICAgICBkZWJ1ZygnVXBncmFkaW5nIHNvY2tldCBjb25uZWN0aW9uIHRvIFRMUycpOwogICAgICAgIGNvbnN0IHNlcnZlcm5hbWUgPSBvcHRzLnNlcnZlcm5hbWUgfHwgb3B0cy5ob3N0OwogICAgICAgIHJldHVybiB0bHMuY29ubmVjdCh7CiAgICAgICAgICAuLi5vbWl0KG9wdHMsICdob3N0JywgJ3BhdGgnLCAncG9ydCcpLAogICAgICAgICAgc29ja2V0LAogICAgICAgICAgc2VydmVybmFtZTogbmV0LmlzSVAoc2VydmVybmFtZSkgPyB1bmRlZmluZWQgOiBzZXJ2ZXJuYW1lLAogICAgICAgIH0pOwogICAgICB9CgogICAgICByZXR1cm4gc29ja2V0OwogICAgfQoKICAgIC8vIFNvbWUgb3RoZXIgc3RhdHVzIGNvZGUgdGhhdCdzIG5vdCAyMDAuLi4gbmVlZCB0byByZS1wbGF5IHRoZSBIVFRQCiAgICAvLyBoZWFkZXIgImRhdGEiIGV2ZW50cyBvbnRvIHRoZSBzb2NrZXQgb25jZSB0aGUgSFRUUCBtYWNoaW5lcnkgaXMKICAgIC8vIGF0dGFjaGVkIHNvIHRoYXQgdGhlIG5vZGUgY29yZSBgaHR0cGAgY2FuIHBhcnNlIGFuZCBoYW5kbGUgdGhlCiAgICAvLyBlcnJvciBzdGF0dXMgY29kZS4KCiAgICAvLyBDbG9zZSB0aGUgb3JpZ2luYWwgc29ja2V0LCBhbmQgYSBuZXcgImZha2UiIHNvY2tldCBpcyByZXR1cm5lZAogICAgLy8gaW5zdGVhZCwgc28gdGhhdCB0aGUgcHJveHkgZG9lc24ndCBnZXQgdGhlIEhUVFAgcmVxdWVzdAogICAgLy8gd3JpdHRlbiB0byBpdCAod2hpY2ggbWF5IGNvbnRhaW4gYEF1dGhvcml6YXRpb25gIGhlYWRlcnMgb3Igb3RoZXIKICAgIC8vIHNlbnNpdGl2ZSBkYXRhKS4KICAgIC8vCiAgICAvLyBTZWU6IGh0dHBzOi8vaGFja2Vyb25lLmNvbS9yZXBvcnRzLzU0MTUwMgogICAgc29ja2V0LmRlc3Ryb3koKTsKCiAgICBjb25zdCBmYWtlU29ja2V0ID0gbmV3IG5ldC5Tb2NrZXQoeyB3cml0YWJsZTogZmFsc2UgfSk7CiAgICBmYWtlU29ja2V0LnJlYWRhYmxlID0gdHJ1ZTsKCiAgICAvLyBOZWVkIHRvIHdhaXQgZm9yIHRoZSAic29ja2V0IiBldmVudCB0byByZS1wbGF5IHRoZSAiZGF0YSIgZXZlbnRzLgogICAgcmVxLm9uY2UoJ3NvY2tldCcsIChzKSA9PiB7CiAgICAgIGRlYnVnKCdSZXBsYXlpbmcgcHJveHkgYnVmZmVyIGZvciBmYWlsZWQgcmVxdWVzdCcpOwogICAgICBhc3NlcnQocy5saXN0ZW5lckNvdW50KCdkYXRhJykgPiAwKTsKCiAgICAgIC8vIFJlcGxheSB0aGUgImJ1ZmZlcmVkIiBCdWZmZXIgb250byB0aGUgZmFrZSBgc29ja2V0YCwgc2luY2UgYXQKICAgICAgLy8gdGhpcyBwb2ludCB0aGUgSFRUUCBtb2R1bGUgbWFjaGluZXJ5IGhhcyBiZWVuIGhvb2tlZCB1cCBmb3IKICAgICAgLy8gdGhlIHVzZXIuCiAgICAgIHMucHVzaChidWZmZXJlZCk7CiAgICAgIHMucHVzaChudWxsKTsKICAgIH0pOwoKICAgIHJldHVybiBmYWtlU29ja2V0OwogIH0KfSBIdHRwc1Byb3h5QWdlbnQuX19pbml0U3RhdGljKCk7CgpmdW5jdGlvbiByZXN1bWUoc29ja2V0KSB7CiAgc29ja2V0LnJlc3VtZSgpOwp9CgpmdW5jdGlvbiBvbWl0KAogIG9iaiwKICAuLi5rZXlzCikKCiB7CiAgY29uc3QgcmV0ID0ge30KCjsKICBsZXQga2V5OwogIGZvciAoa2V5IGluIG9iaikgewogICAgaWYgKCFrZXlzLmluY2x1ZGVzKGtleSkpIHsKICAgICAgcmV0W2tleV0gPSBvYmpba2V5XTsKICAgIH0KICB9CiAgcmV0dXJuIHJldDsKfQoKZnVuY3Rpb24gX251bGxpc2hDb2FsZXNjZShsaHMsIHJoc0ZuKSB7IGlmIChsaHMgIT0gbnVsbCkgeyByZXR1cm4gbGhzOyB9IGVsc2UgeyByZXR1cm4gcmhzRm4oKTsgfSB9Ci8vIEVzdGltYXRlZCBtYXhpbXVtIHNpemUgZm9yIHJlYXNvbmFibGUgc3RhbmRhbG9uZSBldmVudApjb25zdCBHWklQX1RIUkVTSE9MRCA9IDEwMjQgKiAzMjsKCi8qKgogKiBHZXRzIGEgc3RyZWFtIGZyb20gYSBVaW50OEFycmF5IG9yIHN0cmluZwogKiBSZWFkYWJsZS5mcm9tIGlzIGlkZWFsIGJ1dCB3YXMgYWRkZWQgaW4gbm9kZS5qcyB2MTIuMy4wIGFuZCB2MTAuMTcuMAogKi8KZnVuY3Rpb24gc3RyZWFtRnJvbUJvZHkoYm9keSkgewogIHJldHVybiBuZXcgUmVhZGFibGUoewogICAgcmVhZCgpIHsKICAgICAgdGhpcy5wdXNoKGJvZHkpOwogICAgICB0aGlzLnB1c2gobnVsbCk7CiAgICB9LAogIH0pOwp9CgovKioKICogQ3JlYXRlcyBhIFRyYW5zcG9ydCB0aGF0IHVzZXMgbmF0aXZlIHRoZSBuYXRpdmUgJ2h0dHAnIGFuZCAnaHR0cHMnIG1vZHVsZXMgdG8gc2VuZCBldmVudHMgdG8gU2VudHJ5LgogKi8KZnVuY3Rpb24gbWFrZU5vZGVUcmFuc3BvcnQob3B0aW9ucykgewogIGxldCB1cmxTZWdtZW50czsKCiAgdHJ5IHsKICAgIHVybFNlZ21lbnRzID0gbmV3IFVSTChvcHRpb25zLnVybCk7CiAgfSBjYXRjaCAoZSkgewogICAgY29uc29sZVNhbmRib3goKCkgPT4gewogICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tY29uc29sZQogICAgICBjb25zb2xlLndhcm4oCiAgICAgICAgJ1tAc2VudHJ5L25vZGVdOiBJbnZhbGlkIGRzbiBvciB0dW5uZWwgb3B0aW9uLCB3aWxsIG5vdCBzZW5kIGFueSBldmVudHMuIFRoZSB0dW5uZWwgb3B0aW9uIG11c3QgYmUgYSBmdWxsIFVSTCB3aGVuIHVzZWQuJywKICAgICAgKTsKICAgIH0pOwogICAgcmV0dXJuIGNyZWF0ZVRyYW5zcG9ydChvcHRpb25zLCAoKSA9PiBQcm9taXNlLnJlc29sdmUoe30pKTsKICB9CgogIGNvbnN0IGlzSHR0cHMgPSB1cmxTZWdtZW50cy5wcm90b2NvbCA9PT0gJ2h0dHBzOic7CgogIC8vIFByb3h5IHByaW9yaXRpemF0aW9uOiBodHRwID0+IGBvcHRpb25zLnByb3h5YCB8IGBwcm9jZXNzLmVudi5odHRwX3Byb3h5YAogIC8vIFByb3h5IHByaW9yaXRpemF0aW9uOiBodHRwcyA9PiBgb3B0aW9ucy5wcm94eWAgfCBgcHJvY2Vzcy5lbnYuaHR0cHNfcHJveHlgIHwgYHByb2Nlc3MuZW52Lmh0dHBfcHJveHlgCiAgY29uc3QgcHJveHkgPSBhcHBseU5vUHJveHlPcHRpb24oCiAgICB1cmxTZWdtZW50cywKICAgIG9wdGlvbnMucHJveHkgfHwgKGlzSHR0cHMgPyBwcm9jZXNzLmVudi5odHRwc19wcm94eSA6IHVuZGVmaW5lZCkgfHwgcHJvY2Vzcy5lbnYuaHR0cF9wcm94eSwKICApOwoKICBjb25zdCBuYXRpdmVIdHRwTW9kdWxlID0gaXNIdHRwcyA/IGh0dHBzIDogaHR0cDsKICBjb25zdCBrZWVwQWxpdmUgPSBvcHRpb25zLmtlZXBBbGl2ZSA9PT0gdW5kZWZpbmVkID8gZmFsc2UgOiBvcHRpb25zLmtlZXBBbGl2ZTsKCiAgLy8gVE9ETyh2Nyk6IEV2YWx1YXRlIGlmIHdlIGNhbiBzZXQga2VlcEFsaXZlIHRvIHRydWUuIFRoaXMgd291bGQgaW52b2x2ZSB0ZXN0aW5nIGZvciBtZW1vcnkgbGVha3MgaW4gb2xkZXIgbm9kZQogIC8vIHZlcnNpb25zKD49IDgpIGFzIHRoZXkgaGFkIG1lbW9yeSBsZWFrcyB3aGVuIHVzaW5nIGl0OiAjMjU1NQogIGNvbnN0IGFnZW50ID0gcHJveHkKICAgID8gKG5ldyBIdHRwc1Byb3h5QWdlbnQocHJveHkpICkKICAgIDogbmV3IG5hdGl2ZUh0dHBNb2R1bGUuQWdlbnQoeyBrZWVwQWxpdmUsIG1heFNvY2tldHM6IDMwLCB0aW1lb3V0OiAyMDAwIH0pOwoKICBjb25zdCByZXF1ZXN0RXhlY3V0b3IgPSBjcmVhdGVSZXF1ZXN0RXhlY3V0b3Iob3B0aW9ucywgX251bGxpc2hDb2FsZXNjZShvcHRpb25zLmh0dHBNb2R1bGUsICgpID0+ICggbmF0aXZlSHR0cE1vZHVsZSkpLCBhZ2VudCk7CiAgcmV0dXJuIGNyZWF0ZVRyYW5zcG9ydChvcHRpb25zLCByZXF1ZXN0RXhlY3V0b3IpOwp9CgovKioKICogSG9ub3JzIHRoZSBgbm9fcHJveHlgIGVudiB2YXJpYWJsZSB3aXRoIHRoZSBoaWdoZXN0IHByaW9yaXR5IHRvIGFsbG93IGZvciBob3N0cyBleGNsdXNpb24uCiAqCiAqIEBwYXJhbSB0cmFuc3BvcnRVcmwgVGhlIFVSTCB0aGUgdHJhbnNwb3J0IGludGVuZHMgdG8gc2VuZCBldmVudHMgdG8uCiAqIEBwYXJhbSBwcm94eSBUaGUgY2xpZW50IGNvbmZpZ3VyZWQgcHJveHkuCiAqIEByZXR1cm5zIEEgcHJveHkgdGhlIHRyYW5zcG9ydCBzaG91bGQgdXNlLgogKi8KZnVuY3Rpb24gYXBwbHlOb1Byb3h5T3B0aW9uKHRyYW5zcG9ydFVybFNlZ21lbnRzLCBwcm94eSkgewogIGNvbnN0IHsgbm9fcHJveHkgfSA9IHByb2Nlc3MuZW52OwoKICBjb25zdCB1cmxJc0V4ZW1wdEZyb21Qcm94eSA9CiAgICBub19wcm94eSAmJgogICAgbm9fcHJveHkKICAgICAgLnNwbGl0KCcsJykKICAgICAgLnNvbWUoCiAgICAgICAgZXhlbXB0aW9uID0+IHRyYW5zcG9ydFVybFNlZ21lbnRzLmhvc3QuZW5kc1dpdGgoZXhlbXB0aW9uKSB8fCB0cmFuc3BvcnRVcmxTZWdtZW50cy5ob3N0bmFtZS5lbmRzV2l0aChleGVtcHRpb24pLAogICAgICApOwoKICBpZiAodXJsSXNFeGVtcHRGcm9tUHJveHkpIHsKICAgIHJldHVybiB1bmRlZmluZWQ7CiAgfSBlbHNlIHsKICAgIHJldHVybiBwcm94eTsKICB9Cn0KCi8qKgogKiBDcmVhdGVzIGEgUmVxdWVzdEV4ZWN1dG9yIHRvIGJlIHVzZWQgd2l0aCBgY3JlYXRlVHJhbnNwb3J0YC4KICovCmZ1bmN0aW9uIGNyZWF0ZVJlcXVlc3RFeGVjdXRvcigKICBvcHRpb25zLAogIGh0dHBNb2R1bGUsCiAgYWdlbnQsCikgewogIGNvbnN0IHsgaG9zdG5hbWUsIHBhdGhuYW1lLCBwb3J0LCBwcm90b2NvbCwgc2VhcmNoIH0gPSBuZXcgVVJMKG9wdGlvbnMudXJsKTsKICByZXR1cm4gZnVuY3Rpb24gbWFrZVJlcXVlc3QocmVxdWVzdCkgewogICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKICAgICAgbGV0IGJvZHkgPSBzdHJlYW1Gcm9tQm9keShyZXF1ZXN0LmJvZHkpOwoKICAgICAgY29uc3QgaGVhZGVycyA9IHsgLi4ub3B0aW9ucy5oZWFkZXJzIH07CgogICAgICBpZiAocmVxdWVzdC5ib2R5Lmxlbmd0aCA+IEdaSVBfVEhSRVNIT0xEKSB7CiAgICAgICAgaGVhZGVyc1snY29udGVudC1lbmNvZGluZyddID0gJ2d6aXAnOwogICAgICAgIGJvZHkgPSBib2R5LnBpcGUoY3JlYXRlR3ppcCgpKTsKICAgICAgfQoKICAgICAgY29uc3QgcmVxID0gaHR0cE1vZHVsZS5yZXF1ZXN0KAogICAgICAgIHsKICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLAogICAgICAgICAgYWdlbnQsCiAgICAgICAgICBoZWFkZXJzLAogICAgICAgICAgaG9zdG5hbWUsCiAgICAgICAgICBwYXRoOiBgJHtwYXRobmFtZX0ke3NlYXJjaH1gLAogICAgICAgICAgcG9ydCwKICAgICAgICAgIHByb3RvY29sLAogICAgICAgICAgY2E6IG9wdGlvbnMuY2FDZXJ0cywKICAgICAgICB9LAogICAgICAgIHJlcyA9PiB7CiAgICAgICAgICByZXMub24oJ2RhdGEnLCAoKSA9PiB7CiAgICAgICAgICAgIC8vIERyYWluIHNvY2tldAogICAgICAgICAgfSk7CgogICAgICAgICAgcmVzLm9uKCdlbmQnLCAoKSA9PiB7CiAgICAgICAgICAgIC8vIERyYWluIHNvY2tldAogICAgICAgICAgfSk7CgogICAgICAgICAgcmVzLnNldEVuY29kaW5nKCd1dGY4Jyk7CgogICAgICAgICAgLy8gIktleS12YWx1ZSBwYWlycyBvZiBoZWFkZXIgbmFtZXMgYW5kIHZhbHVlcy4gSGVhZGVyIG5hbWVzIGFyZSBsb3dlci1jYXNlZC4iCiAgICAgICAgICAvLyBodHRwczovL25vZGVqcy5vcmcvYXBpL2h0dHAuaHRtbCNodHRwX21lc3NhZ2VfaGVhZGVycwogICAgICAgICAgY29uc3QgcmV0cnlBZnRlckhlYWRlciA9IF9udWxsaXNoQ29hbGVzY2UocmVzLmhlYWRlcnNbJ3JldHJ5LWFmdGVyJ10sICgpID0+ICggbnVsbCkpOwogICAgICAgICAgY29uc3QgcmF0ZUxpbWl0c0hlYWRlciA9IF9udWxsaXNoQ29hbGVzY2UocmVzLmhlYWRlcnNbJ3gtc2VudHJ5LXJhdGUtbGltaXRzJ10sICgpID0+ICggbnVsbCkpOwoKICAgICAgICAgIHJlc29sdmUoewogICAgICAgICAgICBzdGF0dXNDb2RlOiByZXMuc3RhdHVzQ29kZSwKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICdyZXRyeS1hZnRlcic6IHJldHJ5QWZ0ZXJIZWFkZXIsCiAgICAgICAgICAgICAgJ3gtc2VudHJ5LXJhdGUtbGltaXRzJzogQXJyYXkuaXNBcnJheShyYXRlTGltaXRzSGVhZGVyKSA/IHJhdGVMaW1pdHNIZWFkZXJbMF0gOiByYXRlTGltaXRzSGVhZGVyLAogICAgICAgICAgICB9LAogICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgKTsKCiAgICAgIHJlcS5vbignZXJyb3InLCByZWplY3QpOwogICAgICBib2R5LnBpcGUocmVxKTsKICAgIH0pOwogIH07Cn0KCmZ1bmN0aW9uIF9vcHRpb25hbENoYWluKG9wcykgeyBsZXQgbGFzdEFjY2Vzc0xIUyA9IHVuZGVmaW5lZDsgbGV0IHZhbHVlID0gb3BzWzBdOyBsZXQgaSA9IDE7IHdoaWxlIChpIDwgb3BzLmxlbmd0aCkgeyBjb25zdCBvcCA9IG9wc1tpXTsgY29uc3QgZm4gPSBvcHNbaSArIDFdOyBpICs9IDI7IGlmICgob3AgPT09ICdvcHRpb25hbEFjY2VzcycgfHwgb3AgPT09ICdvcHRpb25hbENhbGwnKSAmJiB2YWx1ZSA9PSBudWxsKSB7IHJldHVybiB1bmRlZmluZWQ7IH0gaWYgKG9wID09PSAnYWNjZXNzJyB8fCBvcCA9PT0gJ29wdGlvbmFsQWNjZXNzJykgeyBsYXN0QWNjZXNzTEhTID0gdmFsdWU7IHZhbHVlID0gZm4odmFsdWUpOyB9IGVsc2UgaWYgKG9wID09PSAnY2FsbCcgfHwgb3AgPT09ICdvcHRpb25hbENhbGwnKSB7IHZhbHVlID0gZm4oKC4uLmFyZ3MpID0+IHZhbHVlLmNhbGwobGFzdEFjY2Vzc0xIUywgLi4uYXJncykpOyBsYXN0QWNjZXNzTEhTID0gdW5kZWZpbmVkOyB9IH0gcmV0dXJuIHZhbHVlOyB9CmNvbnN0IG9wdGlvbnMgPSB3b3JrZXJEYXRhOwpsZXQgc2Vzc2lvbjsKbGV0IGhhc1NlbnRBbnJFdmVudCA9IGZhbHNlOwoKZnVuY3Rpb24gbG9nKG1zZykgewogIGlmIChvcHRpb25zLmRlYnVnKSB7CiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tY29uc29sZQogICAgY29uc29sZS5sb2coYFtBTlIgV29ya2VyXSAke21zZ31gKTsKICB9Cn0KCmNvbnN0IHVybCA9IGdldEVudmVsb3BlRW5kcG9pbnRXaXRoVXJsRW5jb2RlZEF1dGgob3B0aW9ucy5kc24pOwpjb25zdCB0cmFuc3BvcnQgPSBtYWtlTm9kZVRyYW5zcG9ydCh7CiAgdXJsLAogIHJlY29yZERyb3BwZWRFdmVudDogKCkgPT4gewogICAgLy8KICB9LAp9KTsKCmFzeW5jIGZ1bmN0aW9uIHNlbmRBYm5vcm1hbFNlc3Npb24oKSB7CiAgLy8gb2Ygd2UgaGF2ZSBhbiBleGlzdGluZyBzZXNzaW9uIHBhc3NlZCBmcm9tIHRoZSBtYWluIHRocmVhZCwgc2VuZCBpdCBhcyBhYm5vcm1hbAogIGlmIChzZXNzaW9uKSB7CiAgICBsb2coJ1NlbmRpbmcgYWJub3JtYWwgc2Vzc2lvbicpOwogICAgdXBkYXRlU2Vzc2lvbihzZXNzaW9uLCB7IHN0YXR1czogJ2Fibm9ybWFsJywgYWJub3JtYWxfbWVjaGFuaXNtOiAnYW5yX2ZvcmVncm91bmQnIH0pOwoKICAgIGNvbnN0IGVudmVsb3BlID0gY3JlYXRlU2Vzc2lvbkVudmVsb3BlKHNlc3Npb24sIG9wdGlvbnMuZHNuLCBvcHRpb25zLnNka01ldGFkYXRhKTsKICAgIC8vIExvZyB0aGUgZW52ZWxvcGUgc28gdG8gYWlkIGluIHRlc3RpbmcKICAgIGxvZyhKU09OLnN0cmluZ2lmeShlbnZlbG9wZSkpOwoKICAgIGF3YWl0IHRyYW5zcG9ydC5zZW5kKGVudmVsb3BlKTsKCiAgICB0cnkgewogICAgICAvLyBOb3RpZnkgdGhlIG1haW4gcHJvY2VzcyB0aGF0IHRoZSBzZXNzaW9uIGhhcyBlbmRlZCBzbyB0aGUgc2Vzc2lvbiBjYW4gYmUgY2xlYXJlZCBmcm9tIHRoZSBzY29wZQogICAgICBfb3B0aW9uYWxDaGFpbihbcGFyZW50UG9ydCwgJ29wdGlvbmFsQWNjZXNzJywgXzIgPT4gXzIucG9zdE1lc3NhZ2UsICdjYWxsJywgXzMgPT4gXzMoJ3Nlc3Npb24tZW5kZWQnKV0pOwogICAgfSBjYXRjaCAoXykgewogICAgICAvLyBpZ25vcmUKICAgIH0KICB9Cn0KCmxvZygnU3RhcnRlZCcpOwoKZnVuY3Rpb24gcHJlcGFyZVN0YWNrRnJhbWVzKHN0YWNrRnJhbWVzKSB7CiAgaWYgKCFzdGFja0ZyYW1lcykgewogICAgcmV0dXJuIHVuZGVmaW5lZDsKICB9CgogIC8vIFN0cmlwIFNlbnRyeSBmcmFtZXMgYW5kIHJldmVyc2UgdGhlIHN0YWNrIGZyYW1lcyBzbyB0aGV5IGFyZSBpbiB0aGUgY29ycmVjdCBvcmRlcgogIGNvbnN0IHN0cmlwcGVkRnJhbWVzID0gc3RyaXBTZW50cnlGcmFtZXNBbmRSZXZlcnNlKHN0YWNrRnJhbWVzKTsKCiAgLy8gSWYgd2UgaGF2ZSBhbiBhcHAgcm9vdCBwYXRoLCByZXdyaXRlIHRoZSBmaWxlbmFtZXMgdG8gYmUgcmVsYXRpdmUgdG8gdGhlIGFwcCByb290CiAgaWYgKG9wdGlvbnMuYXBwUm9vdFBhdGgpIHsKICAgIGZvciAoY29uc3QgZnJhbWUgb2Ygc3RyaXBwZWRGcmFtZXMpIHsKICAgICAgaWYgKCFmcmFtZS5maWxlbmFtZSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CgogICAgICBmcmFtZS5maWxlbmFtZSA9IG5vcm1hbGl6ZVVybFRvQmFzZShmcmFtZS5maWxlbmFtZSwgb3B0aW9ucy5hcHBSb290UGF0aCk7CiAgICB9CiAgfQoKICByZXR1cm4gc3RyaXBwZWRGcmFtZXM7Cn0KCmFzeW5jIGZ1bmN0aW9uIHNlbmRBbnJFdmVudChmcmFtZXMsIHRyYWNlQ29udGV4dCkgewogIGlmIChoYXNTZW50QW5yRXZlbnQpIHsKICAgIHJldHVybjsKICB9CgogIGhhc1NlbnRBbnJFdmVudCA9IHRydWU7CgogIGF3YWl0IHNlbmRBYm5vcm1hbFNlc3Npb24oKTsKCiAgbG9nKCdTZW5kaW5nIGV2ZW50Jyk7CgogIGNvbnN0IGV2ZW50ID0gewogICAgZXZlbnRfaWQ6IHV1aWQ0KCksCiAgICBjb250ZXh0czogeyAuLi5vcHRpb25zLmNvbnRleHRzLCB0cmFjZTogdHJhY2VDb250ZXh0IH0sCiAgICByZWxlYXNlOiBvcHRpb25zLnJlbGVhc2UsCiAgICBlbnZpcm9ubWVudDogb3B0aW9ucy5lbnZpcm9ubWVudCwKICAgIGRpc3Q6IG9wdGlvbnMuZGlzdCwKICAgIHBsYXRmb3JtOiAnbm9kZScsCiAgICBsZXZlbDogJ2Vycm9yJywKICAgIGV4Y2VwdGlvbjogewogICAgICB2YWx1ZXM6IFsKICAgICAgICB7CiAgICAgICAgICB0eXBlOiAnQXBwbGljYXRpb25Ob3RSZXNwb25kaW5nJywKICAgICAgICAgIHZhbHVlOiBgQXBwbGljYXRpb24gTm90IFJlc3BvbmRpbmcgZm9yIGF0IGxlYXN0ICR7b3B0aW9ucy5hbnJUaHJlc2hvbGR9IG1zYCwKICAgICAgICAgIHN0YWNrdHJhY2U6IHsgZnJhbWVzOiBwcmVwYXJlU3RhY2tGcmFtZXMoZnJhbWVzKSB9LAogICAgICAgICAgLy8gVGhpcyBlbnN1cmVzIHRoZSBVSSBkb2Vzbid0IHNheSAnQ3Jhc2hlZCBpbicgZm9yIHRoZSBzdGFjayB0cmFjZQogICAgICAgICAgbWVjaGFuaXNtOiB7IHR5cGU6ICdBTlInIH0sCiAgICAgICAgfSwKICAgICAgXSwKICAgIH0sCiAgICB0YWdzOiBvcHRpb25zLnN0YXRpY1RhZ3MsCiAgfTsKCiAgY29uc3QgZW52ZWxvcGUgPSBjcmVhdGVFdmVudEVudmVsb3BlKGV2ZW50LCBvcHRpb25zLmRzbiwgb3B0aW9ucy5zZGtNZXRhZGF0YSk7CiAgLy8gTG9nIHRoZSBlbnZlbG9wZSBzbyB0byBhaWQgaW4gdGVzdGluZwogIGxvZyhKU09OLnN0cmluZ2lmeShlbnZlbG9wZSkpOwoKICBhd2FpdCB0cmFuc3BvcnQuc2VuZChlbnZlbG9wZSk7CiAgYXdhaXQgdHJhbnNwb3J0LmZsdXNoKDIwMDApOwoKICAvLyBEZWxheSBmb3IgNSBzZWNvbmRzIHNvIHRoYXQgc3RkaW8gY2FuIGZsdXNoIGluIHRoZSBtYWluIGV2ZW50IGxvb3AgZXZlciByZXN0YXJ0cy4KICAvLyBUaGlzIGlzIG1haW5seSBmb3IgdGhlIGJlbmVmaXQgb2YgbG9nZ2luZy9kZWJ1Z2dpbmcgaXNzdWVzLgogIHNldFRpbWVvdXQoKCkgPT4gewogICAgcHJvY2Vzcy5leGl0KDApOwogIH0sIDUwMDApOwp9CgpsZXQgZGVidWdnZXJQYXVzZTsKCmlmIChvcHRpb25zLmNhcHR1cmVTdGFja1RyYWNlKSB7CiAgbG9nKCdDb25uZWN0aW5nIHRvIGRlYnVnZ2VyJyk7CgogIGNvbnN0IHNlc3Npb24gPSBuZXcgU2Vzc2lvbigpIDsKICBzZXNzaW9uLmNvbm5lY3RUb01haW5UaHJlYWQoKTsKCiAgbG9nKCdDb25uZWN0ZWQgdG8gZGVidWdnZXInKTsKCiAgLy8gQ29sbGVjdCBzY3JpcHRJZCAtPiB1cmwgbWFwIHNvIHdlIGNhbiBsb29rIHVwIHRoZSBmaWxlbmFtZXMgbGF0ZXIKICBjb25zdCBzY3JpcHRzID0gbmV3IE1hcCgpOwoKICBzZXNzaW9uLm9uKCdEZWJ1Z2dlci5zY3JpcHRQYXJzZWQnLCBldmVudCA9PiB7CiAgICBzY3JpcHRzLnNldChldmVudC5wYXJhbXMuc2NyaXB0SWQsIGV2ZW50LnBhcmFtcy51cmwpOwogIH0pOwoKICBzZXNzaW9uLm9uKCdEZWJ1Z2dlci5wYXVzZWQnLCBldmVudCA9PiB7CiAgICBpZiAoZXZlbnQucGFyYW1zLnJlYXNvbiAhPT0gJ290aGVyJykgewogICAgICByZXR1cm47CiAgICB9CgogICAgdHJ5IHsKICAgICAgbG9nKCdEZWJ1Z2dlciBwYXVzZWQnKTsKCiAgICAgIC8vIGNvcHkgdGhlIGZyYW1lcwogICAgICBjb25zdCBjYWxsRnJhbWVzID0gWy4uLmV2ZW50LnBhcmFtcy5jYWxsRnJhbWVzXTsKCiAgICAgIGNvbnN0IGdldE1vZHVsZU5hbWUgPSBvcHRpb25zLmFwcFJvb3RQYXRoID8gY3JlYXRlR2V0TW9kdWxlRnJvbUZpbGVuYW1lKG9wdGlvbnMuYXBwUm9vdFBhdGgpIDogKCkgPT4gdW5kZWZpbmVkOwogICAgICBjb25zdCBzdGFja0ZyYW1lcyA9IGNhbGxGcmFtZXMubWFwKGZyYW1lID0+CiAgICAgICAgY2FsbEZyYW1lVG9TdGFja0ZyYW1lKGZyYW1lLCBzY3JpcHRzLmdldChmcmFtZS5sb2NhdGlvbi5zY3JpcHRJZCksIGdldE1vZHVsZU5hbWUpLAogICAgICApOwoKICAgICAgLy8gRXZhbHVhdGUgYSBzY3JpcHQgaW4gdGhlIGN1cnJlbnRseSBwYXVzZWQgY29udGV4dAogICAgICBzZXNzaW9uLnBvc3QoCiAgICAgICAgJ1J1bnRpbWUuZXZhbHVhdGUnLAogICAgICAgIHsKICAgICAgICAgIC8vIEdyYWIgdGhlIHRyYWNlIGNvbnRleHQgZnJvbSB0aGUgY3VycmVudCBzY29wZQogICAgICAgICAgZXhwcmVzc2lvbjoKICAgICAgICAgICAgJ2NvbnN0IGN0eCA9IF9fU0VOVFJZX18uaHViLmdldFNjb3BlKCkuZ2V0UHJvcGFnYXRpb25Db250ZXh0KCk7IGN0eC50cmFjZUlkICsgIi0iICsgY3R4LnNwYW5JZCArICItIiArIGN0eC5wYXJlbnRTcGFuSWQnLAogICAgICAgICAgLy8gRG9uJ3QgcmUtdHJpZ2dlciB0aGUgZGVidWdnZXIgaWYgdGhpcyBjYXVzZXMgYW4gZXJyb3IKICAgICAgICAgIHNpbGVudDogdHJ1ZSwKICAgICAgICB9LAogICAgICAgIChfLCBwYXJhbSkgPT4gewogICAgICAgICAgY29uc3QgdHJhY2VJZCA9IHBhcmFtICYmIHBhcmFtLnJlc3VsdCA/IChwYXJhbS5yZXN1bHQudmFsdWUgKSA6ICctLSc7CiAgICAgICAgICBjb25zdCBbdHJhY2VfaWQsIHNwYW5faWQsIHBhcmVudF9zcGFuX2lkXSA9IHRyYWNlSWQuc3BsaXQoJy0nKSA7CgogICAgICAgICAgc2Vzc2lvbi5wb3N0KCdEZWJ1Z2dlci5yZXN1bWUnKTsKICAgICAgICAgIHNlc3Npb24ucG9zdCgnRGVidWdnZXIuZGlzYWJsZScpOwoKICAgICAgICAgIGNvbnN0IGNvbnRleHQgPSBfb3B0aW9uYWxDaGFpbihbdHJhY2VfaWQsICdvcHRpb25hbEFjY2VzcycsIF80ID0+IF80Lmxlbmd0aF0pICYmIF9vcHRpb25hbENoYWluKFtzcGFuX2lkLCAnb3B0aW9uYWxBY2Nlc3MnLCBfNSA9PiBfNS5sZW5ndGhdKSA/IHsgdHJhY2VfaWQsIHNwYW5faWQsIHBhcmVudF9zcGFuX2lkIH0gOiB1bmRlZmluZWQ7CiAgICAgICAgICBzZW5kQW5yRXZlbnQoc3RhY2tGcmFtZXMsIGNvbnRleHQpLnRoZW4obnVsbCwgKCkgPT4gewogICAgICAgICAgICBsb2coJ1NlbmRpbmcgQU5SIGV2ZW50IGZhaWxlZC4nKTsKICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICk7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIHNlc3Npb24ucG9zdCgnRGVidWdnZXIucmVzdW1lJyk7CiAgICAgIHNlc3Npb24ucG9zdCgnRGVidWdnZXIuZGlzYWJsZScpOwogICAgICB0aHJvdyBlOwogICAgfQogIH0pOwoKICBkZWJ1Z2dlclBhdXNlID0gKCkgPT4gewogICAgdHJ5IHsKICAgICAgc2Vzc2lvbi5wb3N0KCdEZWJ1Z2dlci5lbmFibGUnLCAoKSA9PiB7CiAgICAgICAgc2Vzc2lvbi5wb3N0KCdEZWJ1Z2dlci5wYXVzZScpOwogICAgICB9KTsKICAgIH0gY2F0Y2ggKF8pIHsKICAgICAgLy8KICAgIH0KICB9Owp9CgpmdW5jdGlvbiBjcmVhdGVIclRpbWVyKCkgewogIC8vIFRPRE8gKHY4KTogV2UgY2FuIHVzZSBwcm9jZXNzLmhydGltZS5iaWdpbnQoKSBhZnRlciB3ZSBkcm9wIG5vZGUgdjgKICBsZXQgbGFzdFBvbGwgPSBwcm9jZXNzLmhydGltZSgpOwoKICByZXR1cm4gewogICAgZ2V0VGltZU1zOiAoKSA9PiB7CiAgICAgIGNvbnN0IFtzZWNvbmRzLCBuYW5vU2Vjb25kc10gPSBwcm9jZXNzLmhydGltZShsYXN0UG9sbCk7CiAgICAgIHJldHVybiBNYXRoLmZsb29yKHNlY29uZHMgKiAxZTMgKyBuYW5vU2Vjb25kcyAvIDFlNik7CiAgICB9LAogICAgcmVzZXQ6ICgpID0+IHsKICAgICAgbGFzdFBvbGwgPSBwcm9jZXNzLmhydGltZSgpOwogICAgfSwKICB9Owp9CgpmdW5jdGlvbiB3YXRjaGRvZ1RpbWVvdXQoKSB7CiAgbG9nKCdXYXRjaGRvZyB0aW1lb3V0Jyk7CgogIGlmIChkZWJ1Z2dlclBhdXNlKSB7CiAgICBsb2coJ1BhdXNpbmcgZGVidWdnZXIgdG8gY2FwdHVyZSBzdGFjayB0cmFjZScpOwogICAgZGVidWdnZXJQYXVzZSgpOwogIH0gZWxzZSB7CiAgICBsb2coJ0NhcHR1cmluZyBldmVudCB3aXRob3V0IGEgc3RhY2sgdHJhY2UnKTsKICAgIHNlbmRBbnJFdmVudCgpLnRoZW4obnVsbCwgKCkgPT4gewogICAgICBsb2coJ1NlbmRpbmcgQU5SIGV2ZW50IGZhaWxlZCBvbiB3YXRjaGRvZyB0aW1lb3V0LicpOwogICAgfSk7CiAgfQp9Cgpjb25zdCB7IHBvbGwgfSA9IHdhdGNoZG9nVGltZXIoY3JlYXRlSHJUaW1lciwgb3B0aW9ucy5wb2xsSW50ZXJ2YWwsIG9wdGlvbnMuYW5yVGhyZXNob2xkLCB3YXRjaGRvZ1RpbWVvdXQpOwoKX29wdGlvbmFsQ2hhaW4oW3BhcmVudFBvcnQsICdvcHRpb25hbEFjY2VzcycsIF82ID0+IF82Lm9uLCAnY2FsbCcsIF83ID0+IF83KCdtZXNzYWdlJywgKG1zZykgPT4gewogIGlmIChtc2cuc2Vzc2lvbikgewogICAgc2Vzc2lvbiA9IG1ha2VTZXNzaW9uKG1zZy5zZXNzaW9uKTsKICB9CgogIHBvbGwoKTsKfSldKTs="});var ts=d((Mg,Bb)=>{var{_optionalChain:Ev,_optionalChainDelete:bb}=b();Object.defineProperty(Mg,"__esModule",{value:!0});var Yv=require("url"),xg=W(),Og=b(),Lg=_t(),Xv=Cb(),Tv=50,Fv=5e3;function zg(t,...e){Og.logger.log(`[ANR] ${t}`,...e)}function wv(){return Og.dynamicRequire(Bb,"worker_threads")}async function Uv(t){let e={message:"ANR"},n={};for(let r of t.getEventProcessors()){if(e===null)break;e=await r(e,n)}return Ev([e,"optionalAccess",r=>r.contexts])||{}}var hb="Anr",Kv=(t={})=>({name:hb,setupOnce(){},setup(e){if(Lg.NODE_VERSION.major<16||Lg.NODE_VERSION.major===16&&Lg.NODE_VERSION.minor<17)throw new Error("ANR detection requires Node 16.17.0 or later");setImmediate(()=>kv(e,t))}}),Jv=xg.convertIntegrationFnToClass(hb,Kv);async function kv(t,e){let n=await Uv(t),r=t.getDsn();if(!r)return;bb([n,"access",g=>g.app,"optionalAccess",g=>delete g.app_memory]),bb([n,"access",g=>g.device,"optionalAccess",g=>delete g.free_memory]);let i=t.getOptions(),o=t.getSdkMetadata()||{};o.sdk&&(o.sdk.integrations=i.integrations.map(g=>g.name));let s={debug:Og.logger.isEnabled(),dsn:r,environment:i.environment||"production",release:i.release,dist:i.dist,sdkMetadata:o,appRootPath:e.appRootPath,pollInterval:e.pollInterval||Tv,anrThreshold:e.anrThreshold||Fv,captureStackTrace:!!e.captureStackTrace,staticTags:e.staticTags||{},contexts:n};if(s.captureStackTrace){let g=require("inspector");g.url()||g.open(0)}let{Worker:a}=wv(),c=new a(new Yv.URL(`data:application/javascript;base64,${Xv.base64WorkerScript}`),{workerData:s});process.on("exit",()=>{c.terminate()});let l=setInterval(()=>{try{let g=xg.getCurrentScope().getSession(),u=g?{...g,toJSON:void 0}:void 0;c.postMessage({session:u})}catch{}},s.pollInterval);l.unref(),c.on("message",g=>{g==="session-ended"&&(zg("ANR event sent from ANR worker. Clearing session in this thread."),xg.getCurrentScope().setSession(void 0))}),c.once("error",g=>{clearInterval(l),zg("ANR worker error",g)}),c.once("exit",g=>{clearInterval(l),zg("ANR worker exit",g)}),c.unref()}Mg.Anr=Jv});var ns=d(Yr=>{Object.defineProperty(Yr,"__esModule",{value:!0});var de=W(),yb=b();function Zb(t){return t&&t.statusCode!==void 0}function Lv(t){return t&&t.isBoom!==void 0}function zv(t){return t&&t.error!==void 0}function Gb(t){de.captureException(t,{mechanism:{type:"hapi",handled:!1,data:{function:"hapiErrorPlugin"}}})}var Ab={name:"SentryHapiErrorPlugin",version:de.SDK_VERSION,register:async function(t){t.events.on("request",(n,r)=>{let i=de.getActiveTransaction();n.response&&Lv(n.response)?Gb(n.response):zv(r)&&Gb(r.error),i&&(i.setStatus("internal_error"),i.end())})}},fb={name:"SentryHapiTracingPlugin",version:de.SDK_VERSION,register:async function(t){let e=t;e.ext("onPreHandler",(n,r)=>{let i=de.continueTrace({sentryTrace:n.headers["sentry-trace"]||void 0,baggage:n.headers.baggage||void 0},o=>de.startTransaction({...o,op:"hapi.request",name:n.route.path,description:`${n.route.method} ${n.path}`}));return de.getCurrentScope().setSpan(i),r.continue}),e.ext("onPreResponse",(n,r)=>{let i=de.getActiveTransaction();if(n.response&&Zb(n.response)&&i){let o=n.response;o.header("sentry-trace",de.spanToTraceHeader(i));let s=yb.dynamicSamplingContextToSentryBaggageHeader(de.getDynamicSamplingContextFromSpan(i));s&&o.header("baggage",s)}return r.continue}),e.ext("onPostHandler",(n,r)=>{let i=de.getActiveTransaction();return n.response&&Zb(n.response)&&i&&i.setHttpStatus(n.response.statusCode),i&&i.end(),r.continue})}},Sb="Hapi",xv=(t={})=>{let e=t.server;return{name:Sb,setupOnce(){e&&yb.fill(e,"start",n=>async function(){return await this.register(fb),await this.register(Ab),n.apply(this)})}}},Ov=de.convertIntegrationFnToClass(Sb,xv);Yr.Hapi=Ov;Yr.hapiErrorPlugin=Ab;Yr.hapiTracingPlugin=fb});var Pg=d(Dg=>{Object.defineProperty(Dg,"__esModule",{value:!0});var Wb=require("path"),Mv=b();function Rb(t){return t.replace(/^[A-Z]:/,"").replace(/\\/g,"/")}function Dv(t=process.argv[1]?Mv.dirname(process.argv[1]):process.cwd(),e=Wb.sep==="\\"){let n=e?Rb(t):t;return r=>{if(!r)return;let i=e?Rb(r):r,{dir:o,base:s,ext:a}=Wb.posix.parse(i);(a===".js"||a===".mjs"||a===".cjs")&&(s=s.slice(0,a.length*-1)),o||(o=".");let c=o.lastIndexOf("/node_modules");if(c>-1)return`${o.slice(c+14).replace(/\//g,".")}:${s}`;if(o.startsWith(n)){let l=o.slice(n.length+1).replace(/\//g,".");return l&&(l+=":"),l+=s,l}return s}}Dg.createGetModuleFromFilename=Dv});var jg=d(Ft=>{var{_optionalChain:Pv}=b();Object.defineProperty(Ft,"__esModule",{value:!0});var Ie=W(),Tt=b(),jv=TC(),Qv=$l(),qv=pg(),$v=Zg(),e_=Sg(),t_=Rg(),n_=vg(),r_=Eg(),i_=Yg(),o_=Ug(),s_=Kg(),a_=kg();ts();ns();var c_=Pg(),l_=sg(),Vb=[new Ie.InboundFilters,new Ie.FunctionToString,new Ie.LinkedErrors,new qv.Console,new $v.Http,new s_.Undici,new e_.OnUncaughtException,new t_.OnUnhandledRejection,new r_.ContextLines,new o_.LocalVariables,new i_.Context,new n_.Modules,new Ie.RequestData];function g_(t={}){let e=Ie.getMainCarrier();jv.setNodeAsyncContextStrategy();let n=Pv([e,"access",o=>o.__SENTRY__,"optionalAccess",o=>o.integrations])||[];t.defaultIntegrations=t.defaultIntegrations===!1?[]:[...Array.isArray(t.defaultIntegrations)?t.defaultIntegrations:Vb,...n],t.dsn===void 0&&process.env.SENTRY_DSN&&(t.dsn=process.env.SENTRY_DSN);let r=process.env.SENTRY_TRACES_SAMPLE_RATE;if(t.tracesSampleRate===void 0&&r){let o=parseFloat(r);isFinite(o)&&(t.tracesSampleRate=o)}if(t.release===void 0){let o=Hb();o!==void 0?t.release=o:t.autoSessionTracking=!1}t.environment===void 0&&process.env.SENTRY_ENVIRONMENT&&(t.environment=process.env.SENTRY_ENVIRONMENT),t.autoSessionTracking===void 0&&t.dsn!==void 0&&(t.autoSessionTracking=!0),t.instrumenter===void 0&&(t.instrumenter="sentry");let i={...t,stackParser:Tt.stackParserFromStackParserOptions(t.stackParser||vb),integrations:Ie.getIntegrationsToSetup(t),transport:t.transport||l_.makeNodeTransport};if(Ie.initAndBind(t.clientClass||Qv.NodeClient,i),t.autoSessionTracking&&d_(),I_(),t.spotlight){let o=Ie.getClient();if(o&&o.addIntegration){let s=o.getOptions().integrations;for(let a of s)o.addIntegration(a);o.addIntegration(new a_.Spotlight({sidecarUrl:typeof t.spotlight=="string"?t.spotlight:void 0}))}}}function u_(t){if(t===void 0)return!1;let e=t&&t.getOptions();return e&&e.autoSessionTracking!==void 0?e.autoSessionTracking:!1}function Hb(t){return process.env.SENTRY_RELEASE?process.env.SENTRY_RELEASE:Tt.GLOBAL_OBJ.SENTRY_RELEASE&&Tt.GLOBAL_OBJ.SENTRY_RELEASE.id?Tt.GLOBAL_OBJ.SENTRY_RELEASE.id:process.env.GITHUB_SHA||process.env.COMMIT_REF||process.env.VERCEL_GIT_COMMIT_SHA||process.env.VERCEL_GITHUB_COMMIT_SHA||process.env.VERCEL_GITLAB_COMMIT_SHA||process.env.VERCEL_BITBUCKET_COMMIT_SHA||process.env.ZEIT_GITHUB_COMMIT_SHA||process.env.ZEIT_GITLAB_COMMIT_SHA||process.env.ZEIT_BITBUCKET_COMMIT_SHA||process.env.CF_PAGES_COMMIT_SHA||t}var vb=Tt.createStackParser(Tt.nodeStackLineParser(c_.createGetModuleFromFilename()));function d_(){Ie.startSession(),process.on("beforeExit",()=>{let t=Ie.getIsolationScope().getSession();t&&!["exited","crashed"].includes(t.status)&&Ie.endSession()})}function I_(){let t=(process.env.SENTRY_USE_ENVIRONMENT||"").toLowerCase();if(!["false","n","no","off","0"].includes(t)){let e=process.env.SENTRY_TRACE,n=process.env.SENTRY_BAGGAGE,{propagationContext:r}=Tt.tracingContextFromHeaders(e,n);Ie.getCurrentScope().setPropagationContext(r)}}Ft.defaultIntegrations=Vb;Ft.defaultStackParser=vb;Ft.getSentryRelease=Hb;Ft.init=g_;Ft.isAutoSessionTrackingEnabled=u_});var _b=d(qg=>{Object.defineProperty(qg,"__esModule",{value:!0});var rs=require("fs"),Qg=require("path");function p_(t){let e=Qg.resolve(t);if(!rs.existsSync(e))throw new Error(`Cannot read contents of ${e}. Directory does not exist.`);if(!rs.statSync(e).isDirectory())throw new Error(`Cannot read contents of ${e}, because it is not a directory.`);let n=r=>rs.readdirSync(r).reduce((i,o)=>{let s=Qg.join(r,o);return rs.statSync(s).isDirectory()?i.concat(n(s)):(i.push(s),i)},[]);return n(e).map(r=>Qg.relative(e,r))}qg.deepReadDirSync=p_});var Nb=d($g=>{Object.defineProperty($g,"__esModule",{value:!0});var m_=W(),C_=ts();function b_(t){let e=m_.getClient();return new C_.Anr(t).setup(e),Promise.resolve()}$g.enableAnrDetection=b_});var Yb=d(is=>{Object.defineProperty(is,"__esModule",{value:!0});var Eb=b();function h_(t,e){return Eb.extractRequestData(t,{include:e})}function B_(t,e,n={}){return Eb.addRequestDataToEvent(t,e,{include:n})}is.extractRequestData=h_;is.parseRequest=B_});var Tb=d(bt=>{var{_optionalChain:fn}=b();Object.defineProperty(bt,"__esModule",{value:!0});var T=W(),Ct=b(),Z_=_r(),os=jg(),Xb=Yb();function G_(){return function(e,n,r){let i=fn([T.getClient,"call",g=>g(),"optionalAccess",g=>g.getOptions,"call",g=>g()]);if(!i||i.instrumenter!=="sentry"||fn([e,"access",g=>g.method,"optionalAccess",g=>g.toUpperCase,"call",g=>g()])==="OPTIONS"||fn([e,"access",g=>g.method,"optionalAccess",g=>g.toUpperCase,"call",g=>g()])==="HEAD")return r();let o=e.headers&&Ct.isString(e.headers["sentry-trace"])?e.headers["sentry-trace"]:void 0,s=fn([e,"access",g=>g.headers,"optionalAccess",g=>g.baggage]);if(!T.hasTracingEnabled(i))return r();let[a,c]=Ct.extractPathForTransaction(e,{path:!0,method:!0}),l=T.continueTrace({sentryTrace:o,baggage:s},g=>T.startTransaction({name:a,op:"http.server",origin:"auto.http.node.tracingHandler",...g,data:{[T.SEMANTIC_ATTRIBUTE_SENTRY_SOURCE]:c},metadata:{...g.metadata,request:e}},{request:Ct.extractRequestData(e)}));T.getCurrentScope().setSpan(l),n.__sentry_transaction=l,n.once("finish",()=>{setImmediate(()=>{Ct.addRequestDataToTransaction(l,e),l.setHttpStatus(n.statusCode),l.end()})}),r()}}function y_(t={}){let e;if("include"in t)e={include:t.include};else{let{ip:n,request:r,transaction:i,user:o}=t;(n||r||i||o)&&(e={include:Ct.dropUndefinedKeys({ip:n,request:r,transaction:i,user:o})})}return e}function A_(t){let e=y_(t),n=T.getClient();if(n&&os.isAutoSessionTrackingEnabled(n)){n.initSessionFlusher();let r=T.getCurrentScope();r.getSession()&&r.setSession()}return function(i,o,s){if(t&&t.flushTimeout&&t.flushTimeout>0){let a=o.end;o.end=function(c,l,g){T.flush(t.flushTimeout).then(()=>{a.call(this,c,l,g)}).then(null,u=>{Z_.DEBUG_BUILD&&Ct.logger.error(u),a.call(this,c,l,g)})}}T.runWithAsyncContext(()=>{let a=T.getCurrentScope();a.setSDKProcessingMetadata({request:i,requestDataOptionsFromExpressHandler:e});let c=T.getClient();os.isAutoSessionTrackingEnabled(c)&&a.setRequestSession({status:"ok"}),o.once("finish",()=>{let l=T.getClient();os.isAutoSessionTrackingEnabled(l)&&setImmediate(()=>{l&&l._captureRequestSession&&l._captureRequestSession()})}),s()})}}function f_(t){let e=t.status||t.statusCode||t.status_code||t.output&&t.output.statusCode;return e?parseInt(e,10):500}function S_(t){return f_(t)>=500}function W_(t){return function(n,r,i,o){if((t&&t.shouldHandleError||S_)(n)){T.withScope(a=>{a.setSDKProcessingMetadata({request:r});let c=i.__sentry_transaction;c&&!T.getActiveSpan()&&a.setSpan(c);let l=T.getClient();if(l&&os.isAutoSessionTrackingEnabled(l)&&l._sessionFlusher!==void 0){let I=a.getRequestSession();I&&I.status!==void 0&&(I.status="crashed")}let g=T.captureException(n,{mechanism:{type:"middleware",handled:!1}});i.sentry=g,o(n)});return}o(n)}}function R_(t={}){return function({path:e,type:n,next:r,rawInput:i}){let o=fn([T.getClient,"call",l=>l(),"optionalAccess",l=>l.getOptions,"call",l=>l()]),s=T.getCurrentScope().getTransaction();if(s){s.updateName(`trpc/${e}`),s.setAttribute(T.SEMANTIC_ATTRIBUTE_SENTRY_SOURCE,"route"),s.op="rpc.server";let l={procedure_type:n};(t.attachRpcInput!==void 0?t.attachRpcInput:fn([o,"optionalAccess",g=>g.sendDefaultPii]))&&(l.input=Ct.normalize(i)),s.setContext("trpc",l)}function a(l){l.ok||T.captureException(l.error,{mechanism:{handled:!1,data:{function:"trpcMiddleware"}}})}let c;try{c=r()}catch(l){throw T.captureException(l,{mechanism:{handled:!1,data:{function:"trpcMiddleware"}}}),l}return Ct.isThenable(c)?Promise.resolve(c).then(l=>{a(l)},l=>{T.captureException(l,{mechanism:{handled:!1,data:{function:"trpcMiddleware"}}})}):a(c),c}}bt.extractRequestData=Xb.extractRequestData;bt.parseRequest=Xb.parseRequest;bt.errorHandler=W_;bt.requestHandler=A_;bt.tracingHandler=G_;bt.trpcMiddleware=R_});var Fb=d(q=>{Object.defineProperty(q,"__esModule",{value:!0});var V_=pg(),H_=Zg(),v_=Sg(),__=Rg(),N_=vg(),E_=Eg(),Y_=Yg(),X_=W(),T_=Ug(),F_=Kg(),w_=kg(),U_=ts(),K_=ns();q.Console=V_.Console;q.Http=H_.Http;q.OnUncaughtException=v_.OnUncaughtException;q.OnUnhandledRejection=__.OnUnhandledRejection;q.Modules=N_.Modules;q.ContextLines=E_.ContextLines;q.Context=Y_.Context;q.RequestData=X_.RequestData;q.LocalVariables=T_.LocalVariables;q.Undici=F_.Undici;q.Spotlight=w_.Spotlight;q.Anr=U_.Anr;q.Hapi=K_.Hapi});var wb=d(nt=>{Object.defineProperty(nt,"__esModule",{value:!0});var wt=Dl();nt.Apollo=wt.Apollo;nt.Express=wt.Express;nt.GraphQL=wt.GraphQL;nt.Mongo=wt.Mongo;nt.Mysql=wt.Mysql;nt.Postgres=wt.Postgres;nt.Prisma=wt.Prisma});var ss=d(eu=>{Object.defineProperty(eu,"__esModule",{value:!0});var J_=[["january","1"],["february","2"],["march","3"],["april","4"],["may","5"],["june","6"],["july","7"],["august","8"],["september","9"],["october","10"],["november","11"],["december","12"],["jan","1"],["feb","2"],["mar","3"],["apr","4"],["may","5"],["jun","6"],["jul","7"],["aug","8"],["sep","9"],["oct","10"],["nov","11"],["dec","12"],["sunday","0"],["monday","1"],["tuesday","2"],["wednesday","3"],["thursday","4"],["friday","5"],["saturday","6"],["sun","0"],["mon","1"],["tue","2"],["wed","3"],["thu","4"],["fri","5"],["sat","6"]];function k_(t){return J_.reduce((e,[n,r])=>e.replace(new RegExp(n,"gi"),r),t)}eu.replaceCronNames=k_});var kb=d(tu=>{Object.defineProperty(tu,"__esModule",{value:!0});var Ub=W(),Kb=ss(),Jb="Automatic instrumentation of CronJob only supports crontab string";function L_(t,e){let n=!1;return new Proxy(t,{construct(r,i){let[o,s,a,c,l,...g]=i;if(typeof o!="string")throw new Error(Jb);if(n)throw new Error(`A job named '${e}' has already been scheduled`);n=!0;let u=Kb.replaceCronNames(o);function I(m,C){return Ub.withMonitor(e,()=>s(m,C),{schedule:{type:"crontab",value:u},...l?{timeZone:l}:{}})}return new r(o,I,a,c,l,...g)},get(r,i){return i==="from"?o=>{let{cronTime:s,onTick:a,timeZone:c}=o;if(typeof s!="string")throw new Error(Jb);if(n)throw new Error(`A job named '${e}' has already been scheduled`);n=!0;let l=Kb.replaceCronNames(s);return o.onTick=(g,u)=>Ub.withMonitor(e,()=>a(g,u),{schedule:{type:"crontab",value:l},...c?{timeZone:c}:{}}),r.from(o)}:r[i]}})}tu.instrumentCron=L_});var zb=d(nu=>{var{_optionalChain:Lb}=b();Object.defineProperty(nu,"__esModule",{value:!0});var z_=W(),x_=ss();function O_(t){return new Proxy(t,{get(e,n){return n==="schedule"&&e.schedule?new Proxy(e.schedule,{apply(r,i,o){let[s,,a]=o;if(!Lb([a,"optionalAccess",c=>c.name]))throw new Error('Missing "name" for scheduled job. A name is required for Sentry check-in monitoring.');return z_.withMonitor(a.name,()=>r.apply(i,o),{schedule:{type:"crontab",value:x_.replaceCronNames(s)},timezone:Lb([a,"optionalAccess",c=>c.timezone])})}}):e[n]}})}nu.instrumentNodeCron=O_});var xb=d(ru=>{Object.defineProperty(ru,"__esModule",{value:!0});var M_=W(),D_=ss();function P_(t){return new Proxy(t,{get(e,n){return n==="scheduleJob"?new Proxy(e.scheduleJob,{apply(r,i,o){let[s,a]=o;if(typeof s!="string"||typeof a!="string")throw new Error("Automatic instrumentation of 'node-schedule' requires the first parameter of 'scheduleJob' to be a job name string and the second parameter to be a crontab string");let c=s,l=a;return M_.withMonitor(c,()=>r.apply(i,o),{schedule:{type:"crontab",value:D_.replaceCronNames(l)}})}}):e[n]}})}ru.instrumentNodeSchedule=P_});var Fe=d(G=>{Object.defineProperty(G,"__esModule",{value:!0});var f=W(),j_=yC(),Q_=$l(),q_=sg(),as=jg(),iu=b(),$_=_b(),Ob=Pg(),eN=Nb(),tN=Tb(),nN=Fb(),rN=wb(),iN=ns(),oN=kb(),sN=zb(),aN=xb(),cN=Ob.createGetModuleFromFilename(),lN={...f.Integrations,...nN,...rN},gN={instrumentCron:oN.instrumentCron,instrumentNodeCron:sN.instrumentNodeCron,instrumentNodeSchedule:aN.instrumentNodeSchedule};G.Hub=f.Hub;G.SDK_VERSION=f.SDK_VERSION;G.Scope=f.Scope;G.addBreadcrumb=f.addBreadcrumb;G.addEventProcessor=f.addEventProcessor;G.addGlobalEventProcessor=f.addGlobalEventProcessor;G.addIntegration=f.addIntegration;G.captureCheckIn=f.captureCheckIn;G.captureEvent=f.captureEvent;G.captureException=f.captureException;G.captureMessage=f.captureMessage;G.close=f.close;G.configureScope=f.configureScope;G.continueTrace=f.continueTrace;G.createTransport=f.createTransport;G.extractTraceparentData=f.extractTraceparentData;G.flush=f.flush;G.functionToStringIntegration=f.functionToStringIntegration;G.getActiveSpan=f.getActiveSpan;G.getActiveTransaction=f.getActiveTransaction;G.getClient=f.getClient;G.getCurrentHub=f.getCurrentHub;G.getCurrentScope=f.getCurrentScope;G.getGlobalScope=f.getGlobalScope;G.getHubFromCarrier=f.getHubFromCarrier;G.getIsolationScope=f.getIsolationScope;G.inboundFiltersIntegration=f.inboundFiltersIntegration;G.lastEventId=f.lastEventId;G.linkedErrorsIntegration=f.linkedErrorsIntegration;G.makeMain=f.makeMain;G.metrics=f.metrics;G.requestDataIntegration=f.requestDataIntegration;G.runWithAsyncContext=f.runWithAsyncContext;G.setContext=f.setContext;G.setCurrentClient=f.setCurrentClient;G.setExtra=f.setExtra;G.setExtras=f.setExtras;G.setMeasurement=f.setMeasurement;G.setTag=f.setTag;G.setTags=f.setTags;G.setUser=f.setUser;G.spanStatusfromHttpCode=f.spanStatusfromHttpCode;G.startActiveSpan=f.startActiveSpan;G.startInactiveSpan=f.startInactiveSpan;G.startSpan=f.startSpan;G.startSpanManual=f.startSpanManual;G.startTransaction=f.startTransaction;G.trace=f.trace;G.withIsolationScope=f.withIsolationScope;G.withMonitor=f.withMonitor;G.withScope=f.withScope;G.autoDiscoverNodePerformanceMonitoringIntegrations=j_.autoDiscoverNodePerformanceMonitoringIntegrations;G.NodeClient=Q_.NodeClient;G.makeNodeTransport=q_.makeNodeTransport;G.defaultIntegrations=as.defaultIntegrations;G.defaultStackParser=as.defaultStackParser;G.getSentryRelease=as.getSentryRelease;G.init=as.init;G.DEFAULT_USER_INCLUDES=iu.DEFAULT_USER_INCLUDES;G.addRequestDataToEvent=iu.addRequestDataToEvent;G.extractRequestData=iu.extractRequestData;G.deepReadDirSync=$_.deepReadDirSync;G.createGetModuleFromFilename=Ob.createGetModuleFromFilename;G.enableAnrDetection=eN.enableAnrDetection;G.Handlers=tN;G.hapiErrorPlugin=iN.hapiErrorPlugin;G.Integrations=lN;G.cron=gN;G.getModuleFromFilename=cN});var su=d(ou=>{Object.defineProperty(ou,"__esModule",{value:!0});var uN=Fe(),dN=b(),cs=class t{static __initStatic(){this.id="AWSServices"}constructor(e={}){this.name=t.id,this._optional=e.optional||!1}setupOnce(){try{let e=require("aws-sdk/global");dN.fill(e.Service.prototype,"makeRequest",IN)}catch(e){if(!this._optional)throw e}}};cs.__initStatic();function IN(t){return function(e,n,r){let i,o=t.call(this,e,n);return o.on("afterBuild",()=>{i=uN.startInactiveSpan({name:pN(this,e,n),op:"http.client",origin:"auto.http.serverless"})}),o.on("complete",()=>{i&&i.end()}),r&&o.send(r),o}}function pN(t,e,n){let r=`aws.${t.serviceIdentifier}.${e}`;if(n===void 0)return r;switch(t.serviceIdentifier){case"s3":r+=CN(e,n);break;case"lambda":r+=mN(e,n);break}return r}function mN(t,e){let n="";return"FunctionName"in e&&(n+=` ${e.FunctionName}`),n}function CN(t,e){let n="";return"Bucket"in e&&(n+=` ${e.Bucket}`),n}ou.AWSServices=cs});var Xr=d(au=>{Object.defineProperty(au,"__esModule",{value:!0});var bN=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__;au.DEBUG_BUILD=bN});var Fr=d(Tr=>{Object.defineProperty(Tr,"__esModule",{value:!0});var hN=W(),BN=b();function ZN(t){return(...e)=>hN.runWithAsyncContext(()=>t(...e),{reuseExisting:!0})}function GN(t,e,n){let r=e(t),i={apply:(o,s,a)=>r.apply(s,a)};return n&&(i.get=(o,s)=>Object.prototype.hasOwnProperty.call(n,s)?n[s]:o[s]),new Proxy(t,i)}function yN(t){return t.addEventProcessor(e=>(BN.addExceptionMechanism(e,{handled:!1}),e)),t}Tr.domainify=ZN;Tr.markEventUnhandled=yN;Tr.proxyFunction=GN});var eh=d(ht=>{var{_optionalChain:Mb}=b();Object.defineProperty(ht,"__esModule",{value:!0});var Db=require("fs"),AN=require("os"),jb=require("path"),fN=require("util"),j=Fe(),Sn=b(),Qb=require("perf_hooks"),SN=W(),WN=su(),wr=Xr(),Pb=Fr(),{isPromise:RN}=fN.types,qb=[...j.defaultIntegrations,new WN.AWSServices({optional:!0})];function VN(t={}){let e={_metadata:{},defaultIntegrations:qb,...t};e._metadata.sdk=e._metadata.sdk||{name:"sentry.javascript.serverless",integrations:["AWSLambda"],packages:[{name:"npm:@sentry/serverless",version:j.SDK_VERSION}],version:j.SDK_VERSION},j.init(e)}function HN(t,e,n){let r=jb.resolve(t,e,n);return Db.existsSync(r)||Db.existsSync(`${r}.js`)?require(r):require(require.resolve(n,{paths:[t,e]}))}function vN(t){return t.every(e=>Object.prototype.hasOwnProperty.call(e,"status")&&(Object.prototype.hasOwnProperty.call(e,"value")||Object.prototype.hasOwnProperty.call(e,"reason")))}function _N(t){return t.reduce((e,n)=>(n.status==="rejected"&&n.reason&&e.push(n.reason),e),[])}function NN(t,e){let n=jb.basename(e),r=n.match(/^([^.]*)\.(.*)$/);if(!r){wr.DEBUG_BUILD&&Sn.logger.error(`Bad handler ${n}`);return}let[,i,o]=r,s;try{let l=e.substring(0,e.indexOf(n));s=HN(t,l,i)}catch(l){wr.DEBUG_BUILD&&Sn.logger.error(`Cannot require ${e} in ${t}`,l);return}let a,c;if(o.split(".").forEach(l=>{a=s,s=s&&s[l],c=l}),!s){wr.DEBUG_BUILD&&Sn.logger.error(`${e} is undefined or not exported`);return}if(typeof s!="function"){wr.DEBUG_BUILD&&Sn.logger.error(`${e} is not a function`);return}a[c]=$b(s)}function cu(t){return typeof t.getRemainingTimeInMillis=="function"?t.getRemainingTimeInMillis():0}function EN(t,e,n){t.setContext("aws.lambda",{aws_request_id:e.awsRequestId,function_name:e.functionName,function_version:e.functionVersion,invoked_function_arn:e.invokedFunctionArn,execution_duration_in_millis:Qb.performance.now()-n,remaining_time_in_millis:cu(e),"sys.argv":process.argv}),t.setContext("aws.cloudwatch.logs",{log_group:e.logGroupName,log_stream:e.logStreamName,url:`https://console.aws.amazon.com/cloudwatch/home?region=${process.env.AWS_REGION}#logsV2:log-groups/log-group/${encodeURIComponent(e.logGroupName)}/log-events/${encodeURIComponent(e.logStreamName)}?filterPattern="${e.awsRequestId}"`})}function YN(t,e){t.addEventProcessor(n=>(n.transaction=e.functionName,n)),t.setTag("server_name",process.env._AWS_XRAY_DAEMON_ADDRESS||process.env.SENTRY_NAME||AN.hostname()),t.setTag("url",`awslambda:///${e.functionName}`)}function $b(t,e={}){let n=Qb.performance.now(),r={flushTimeout:2e3,callbackWaitsForEmptyEventLoop:!1,captureTimeoutWarning:!0,timeoutWarningLimit:500,captureAllSettledReasons:!1,startTrace:!0,...e},i,o=t.length>2?(s,a)=>new Promise((c,l)=>{let g=t(s,a,(u,I)=>{u==null?c(I):l(u)});RN(g)&&g.then(c,l)}):t;return async(s,a)=>{a.callbackWaitsForEmptyEventLoop=r.callbackWaitsForEmptyEventLoop;let c=Math.ceil(cu(a)/1e3),l=Math.floor(c/60),g=c%60,u=l>0?`${l}m${g}s`:`${g}s`;if(r.captureTimeoutWarning){let m=cu(a)-r.timeoutWarningLimit;i=setTimeout(()=>{j.withScope(C=>{C.setTag("timeout",u),j.captureMessage(`Possible function timeout: ${a.functionName}`,"warning")})},m)}async function I(m){let C=j.getCurrentScope(),Z;try{EN(C,a,n),Z=await o(s,a),r.captureAllSettledReasons&&Array.isArray(Z)&&vN(Z)&&_N(Z).forEach(S=>{j.captureException(S,X=>Pb.markEventUnhandled(X))})}catch(B){throw j.captureException(B,S=>Pb.markEventUnhandled(S)),B}finally{clearTimeout(i),Mb([m,"optionalAccess",B=>B.end,"call",B=>B()]),await j.flush(r.flushTimeout).catch(B=>{wr.DEBUG_BUILD&&Sn.logger.error(B)})}return Z}if(r.startTrace){let m=s,C=m.headers&&Sn.isString(m.headers["sentry-trace"])?m.headers["sentry-trace"]:void 0,Z=Mb([m,"access",S=>S.headers,"optionalAccess",S=>S.baggage]),B=j.continueTrace({sentryTrace:C,baggage:Z});return j.startSpanManual({name:a.functionName,op:"function.aws.lambda",origin:"auto.function.serverless",...B,attributes:{[SN.SEMANTIC_ATTRIBUTE_SENTRY_SOURCE]:"component"}},S=>(YN(j.getCurrentScope(),a),I(S)))}return j.withScope(async()=>I(void 0))}}ht.defaultIntegrations=qb;ht.init=VN;ht.tryPatchHandler=NN;ht.wrapHandler=$b;for(let t in j)t!=="default"&&!ht.hasOwnProperty(t)&&(ht[t]=j[t])});var rh=d(lu=>{var{_optionalChain:th}=b();Object.defineProperty(lu,"__esModule",{value:!0});var XN=Fe(),nh=b(),ls=class t{static __initStatic(){this.id="GoogleCloudGrpc"}constructor(e={}){this.name=t.id,this._optional=e.optional||!1}setupOnce(){try{let e=require("google-gax");nh.fill(e.GrpcClient.prototype,"createStub",TN)}catch(e){if(!this._optional)throw e}}};ls.__initStatic();function TN(t){return async function(...e){let n=th([e,"access",o=>o[1],"optionalAccess",o=>o.servicePath]);if(n==null||n==null)return t.apply(this,e);let r=wN(n),i=await t.apply(this,e);for(let o of Object.keys(Object.getPrototypeOf(i)))FN(i,r,o);return i}}function FN(t,e,n){let r=t[n];if(typeof r!="function")return;let i=!r.requestStream&&!r.responseStream?"unary call":r.requestStream&&!r.responseStream?"client stream":!r.requestStream&&r.responseStream?"server stream":"bidi stream";i=="unary call"&&nh.fill(t,n,o=>(...s)=>{let a=o.apply(t,s);if(typeof th([a,"optionalAccess",l=>l.on])!="function")return a;let c=XN.startInactiveSpan({name:`${i} ${n}`,op:`grpc.${e}`,origin:"auto.grpc.serverless"});return a.on("status",()=>{c&&c.end()}),a})}function wN(t){let e=t.match(/^(\w+)\.googleapis.com$/);return e?e[1]:t}lu.GoogleCloudGrpc=ls});var ih=d(gu=>{Object.defineProperty(gu,"__esModule",{value:!0});var UN=Fe(),KN=b(),gs=class t{static __initStatic(){this.id="GoogleCloudHttp"}constructor(e={}){this.name=t.id,this._optional=e.optional||!1}setupOnce(){try{let e=require("@google-cloud/common");KN.fill(e.Service.prototype,"request",JN)}catch(e){if(!this._optional)throw e}}};gs.__initStatic();function JN(t){return function(e,n){let r=e.method||"GET",i=UN.startInactiveSpan({name:`${r} ${e.uri}`,op:`http.client.${kN(this.apiEndpoint)}`,origin:"auto.http.serverless"});t.call(this,e,(...o)=>{i&&i.end(),n(...o)})}}function kN(t){let e=t.match(/^https:\/\/(\w+)\.googleapis.com$/);return e?e[1]:t.replace(/^(http|https)?:\/\//,"")}gu.GoogleCloudHttp=gs});var oh=d(pu=>{var{_optionalChain:uu}=b();Object.defineProperty(pu,"__esModule",{value:!0});var du=W(),Ur=Fe(),Iu=b(),LN=Xr(),us=Fr();function zN(t,e={}){let n=o=>us.domainify(xN(o,e)),r,i=t.__emulator_func;return i&&(r={__emulator_func:us.proxyFunction(i,n)}),us.proxyFunction(t,n,r)}function xN(t,e={}){let{parseRequestOptions:n}=e,r={flushTimeout:2e3,addRequestDataToEventOptions:n?{include:n}:{},...e};return(i,o)=>{let s=(i.method||"").toUpperCase(),a=Iu.stripUrlQueryAndFragment(i.originalUrl||i.url||""),c=i.headers&&Iu.isString(i.headers["sentry-trace"])?i.headers["sentry-trace"]:void 0,l=uu([i,"access",u=>u.headers,"optionalAccess",u=>u.baggage]),g=Ur.continueTrace({sentryTrace:c,baggage:l});return Ur.startSpanManual({...g,name:`${s} ${a}`,op:"function.gcp.http",origin:"auto.function.serverless.gcp_http",attributes:{[du.SEMANTIC_ATTRIBUTE_SENTRY_SOURCE]:"route"}},u=>{Ur.getCurrentScope().setSDKProcessingMetadata({request:i,requestDataOptionsFromGCPWrapper:r.addRequestDataToEventOptions}),u instanceof du.Transaction&&(o.__sentry_transaction=u);let I=o.end;return o.end=function(m,C,Z){uu([u,"optionalAccess",B=>B.setHttpStatus,"call",B=>B(o.statusCode)]),uu([u,"optionalAccess",B=>B.end,"call",B=>B()]),Ur.flush(r.flushTimeout).then(null,B=>{LN.DEBUG_BUILD&&Iu.logger.error(B)}).then(()=>{I.call(this,m,C,Z)})},du.handleCallbackErrors(()=>t(i,o),m=>{Ur.captureException(m,C=>us.markEventUnhandled(C))})})}}pu.wrapHttpFunction=zN});var ah=d(mu=>{var{_optionalChain:ON}=b();Object.defineProperty(mu,"__esModule",{value:!0});var sh=W(),Kr=Fe(),MN=b(),DN=Xr(),Jr=Fr();function PN(t,e={}){return Jr.proxyFunction(t,n=>Jr.domainify(jN(n,e)))}function jN(t,e={}){let n={flushTimeout:2e3,...e};return(...r)=>{let[i,o,s]=r;return Kr.startSpanManual({name:o.eventType,op:"function.gcp.event",origin:"auto.function.serverless.gcp_event",attributes:{[sh.SEMANTIC_ATTRIBUTE_SENTRY_SOURCE]:"component"}},a=>{Kr.getCurrentScope().setContext("gcp.function.context",{...o});let l=Jr.domainify((...g)=>{g[0]!==null&&g[0]!==void 0&&Kr.captureException(g[0],u=>Jr.markEventUnhandled(u)),ON([a,"optionalAccess",u=>u.end,"call",u=>u()]),Kr.flush(n.flushTimeout).then(null,u=>{DN.DEBUG_BUILD&&MN.logger.error(u)}).then(()=>{typeof s=="function"&&s(...g)})});return t.length>2?sh.handleCallbackErrors(()=>t(i,o,l),g=>{Kr.captureException(g,u=>Jr.markEventUnhandled(u))}):Promise.resolve().then(()=>t(i,o)).then(g=>l(null,g),g=>l(g,void 0))})}}mu.wrapEventFunction=PN});var lh=d(Cu=>{var{_optionalChain:QN}=b();Object.defineProperty(Cu,"__esModule",{value:!0});var ch=W(),kr=Fe(),qN=b(),$N=Xr(),Lr=Fr();function eE(t,e={}){return Lr.proxyFunction(t,n=>Lr.domainify(tE(n,e)))}function tE(t,e={}){let n={flushTimeout:2e3,...e};return(r,i)=>kr.startSpanManual({name:r.type||"<unknown>",op:"function.gcp.cloud_event",origin:"auto.function.serverless.gcp_cloud_event",attributes:{[ch.SEMANTIC_ATTRIBUTE_SENTRY_SOURCE]:"component"}},o=>{kr.getCurrentScope().setContext("gcp.function.context",{...r});let a=Lr.domainify((...c)=>{c[0]!==null&&c[0]!==void 0&&kr.captureException(c[0],l=>Lr.markEventUnhandled(l)),QN([o,"optionalAccess",l=>l.end,"call",l=>l()]),kr.flush(n.flushTimeout).then(null,l=>{$N.DEBUG_BUILD&&qN.logger.error(l)}).then(()=>{i(...c)})});return t.length>1?ch.handleCallbackErrors(()=>t(r,a),c=>{kr.captureException(c,l=>Lr.markEventUnhandled(l))}):Promise.resolve().then(()=>t(r)).then(c=>a(null,c),c=>a(c,void 0))})}Cu.wrapCloudEventFunction=eE});var uh=d(Ut=>{Object.defineProperty(Ut,"__esModule",{value:!0});var ds=Fe(),nE=rh(),rE=ih(),iE=oh(),oE=ah(),sE=lh(),gh=[...ds.defaultIntegrations,new rE.GoogleCloudHttp({optional:!0}),new nE.GoogleCloudGrpc({optional:!0})];function aE(t={}){let e={_metadata:{},defaultIntegrations:gh,...t};e._metadata.sdk=e._metadata.sdk||{name:"sentry.javascript.serverless",integrations:["GCPFunction"],packages:[{name:"npm:@sentry/serverless",version:ds.SDK_VERSION}],version:ds.SDK_VERSION},ds.init(e)}Ut.wrapHttpFunction=iE.wrapHttpFunction;Ut.wrapEventFunction=oE.wrapEventFunction;Ut.wrapCloudEventFunction=sE.wrapCloudEventFunction;Ut.defaultIntegrations=gh;Ut.init=aE});var dh=d(y=>{Object.defineProperty(y,"__esModule",{value:!0});var cE=eh(),lE=uh(),gE=su(),A=Fe();y.AWSLambda=cE;y.GCPFunction=lE;y.AWSServices=gE.AWSServices;y.DEFAULT_USER_INCLUDES=A.DEFAULT_USER_INCLUDES;y.Handlers=A.Handlers;y.Hub=A.Hub;y.Integrations=A.Integrations;y.NodeClient=A.NodeClient;y.SDK_VERSION=A.SDK_VERSION;y.Scope=A.Scope;y.addBreadcrumb=A.addBreadcrumb;y.addEventProcessor=A.addEventProcessor;y.addGlobalEventProcessor=A.addGlobalEventProcessor;y.addIntegration=A.addIntegration;y.addRequestDataToEvent=A.addRequestDataToEvent;y.autoDiscoverNodePerformanceMonitoringIntegrations=A.autoDiscoverNodePerformanceMonitoringIntegrations;y.captureCheckIn=A.captureCheckIn;y.captureEvent=A.captureEvent;y.captureException=A.captureException;y.captureMessage=A.captureMessage;y.close=A.close;y.configureScope=A.configureScope;y.continueTrace=A.continueTrace;y.createTransport=A.createTransport;y.deepReadDirSync=A.deepReadDirSync;y.defaultIntegrations=A.defaultIntegrations;y.defaultStackParser=A.defaultStackParser;y.extractRequestData=A.extractRequestData;y.flush=A.flush;y.getActiveSpan=A.getActiveSpan;y.getActiveTransaction=A.getActiveTransaction;y.getClient=A.getClient;y.getCurrentHub=A.getCurrentHub;y.getCurrentScope=A.getCurrentScope;y.getGlobalScope=A.getGlobalScope;y.getHubFromCarrier=A.getHubFromCarrier;y.getIsolationScope=A.getIsolationScope;y.getSentryRelease=A.getSentryRelease;y.init=A.init;y.lastEventId=A.lastEventId;y.makeMain=A.makeMain;y.makeNodeTransport=A.makeNodeTransport;y.setContext=A.setContext;y.setCurrentClient=A.setCurrentClient;y.setExtra=A.setExtra;y.setExtras=A.setExtras;y.setMeasurement=A.setMeasurement;y.setTag=A.setTag;y.setTags=A.setTags;y.setUser=A.setUser;y.startActiveSpan=A.startActiveSpan;y.startInactiveSpan=A.startInactiveSpan;y.startSpan=A.startSpan;y.startSpanManual=A.startSpanManual;y.startTransaction=A.startTransaction;y.withIsolationScope=A.withIsolationScope;y.withMonitor=A.withMonitor;y.withScope=A.withScope});var dE={};Zh(dE,{ControllerErrorHandlerDecorator:()=>bu,default:()=>uE});module.exports=yh(dE);(function(){try{var t=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[e]="5e9b708e-4e39-415e-a8d3-58cf1a744b3e",t._sentryDebugIdIdentifier="sentry-dbid-5e9b708e-4e39-415e-a8d3-58cf1a744b3e")}catch{}})();var Ih=Gh(dh());var Kt=class t extends Error{constructor(n,r,i,o=500){super(n);this.message=n;this.data=r;this.stack=i;this.statusCode=o;this.name="HttpError",Object.setPrototypeOf(this,t.prototype),Error.captureStackTrace(this,t)}};var Is=class t extends Kt{constructor(n,r,i="HttpConflictError",o="CONFLICT",s=409){super(o,n,r,s);this.data=n;this.stack=r;this.name=i;this.message=o;this.statusCode=s;Object.setPrototypeOf(this,t.prototype),Error.captureStackTrace(this,t)}};var ps=class t extends Kt{constructor(n,r,i="HttpNotFoundError",o="NOT_FOUND",s=404){super(o,n,r,s);this.data=n;this.stack=r;this.name=i;this.message=o;this.statusCode=s;Object.setPrototypeOf(this,t.prototype),Error.captureStackTrace(this,t)}},ms=class t extends Kt{constructor(n,r,i="HttpInternalServerError",o="INTERNAL_SERVER_ERROR",s=500){super(o,n,r,s);this.data=n;this.stack=r;this.name=i;this.message=o;this.statusCode=s;Object.setPrototypeOf(this,t.prototype),Error.captureStackTrace(this,t)}},zr=class t extends Kt{constructor(n="User must be authenticated",r,i="HttpUnauthorizedError",o="UNAUTHORIZED",s=401){super(o,n,r,s);this.data=n;this.stack=r;this.name=i;this.message=o;this.statusCode=s;Object.setPrototypeOf(this,t.prototype),Error.captureStackTrace(this,t)}},Cs=class t extends Kt{constructor(n,r,i="HttpUnprocessableEntityError",o="UNPROCESSABLE_ENTITY",s=422){super(o,n,r,s);this.data=n;this.stack=r;this.name=i;this.message=o;this.statusCode=s;Object.setPrototypeOf(this,t.prototype),Error.captureStackTrace(this,t)}};var bu=class{constructor(e,n){this.logger=e;this.controller=n;this.logger=this.logger.getChild("ControllerErrorHandlerDecorator")}async handle(e){try{return await this.controller.handle(e)}catch(n){return["USER_NOT_CONFIRMED","NotAuthorizedException","NotAuthorizedException: Invalid Refresh Token","USER_NOT_AUTHORIZED","ADMIN_USER_NOT_AUTHORIZED"].includes(n.message)?new zr(n.message):n.message==="NotAuthorizedException: Invalid Refresh Token"?new zr("Invalid Refresh Token"):["USER_NOT_FOUND","ADMIN_USER_NOT_FOUND"].includes(n.message)?new ps(n.message):["USER_ALREADY_EXISTS"].includes(n.message)?new Is(n.message):["SIGNUP_ALREADY_VALIDATED","USER_WITHOUT_PHOTO"].includes(n.message)?new Cs(n.message):(this.logger.error("Internal Server Error",n),Ih.captureException(n),new ms(n))}}};var uE=void 0;0&&(module.exports={ControllerErrorHandlerDecorator});
/*! Bundled license information:

@sentry/node/cjs/integrations/anr/worker-script.js:
  (*! @sentry/node 7.94.1 (cf062ba) | https://github.com/getsentry/sentry-javascript *)
*/
//# sourceMappingURL=ControllerErrorHandlerDecorator.js.map
