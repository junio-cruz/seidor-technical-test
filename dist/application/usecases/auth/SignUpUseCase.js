var C=Object.create;var a=Object.defineProperty;var O=Object.getOwnPropertyDescriptor;var G=Object.getOwnPropertyNames;var A=Object.getPrototypeOf,D=Object.prototype.hasOwnProperty;var E=(t,e)=>{for(var r in e)a(t,r,{get:e[r],enumerable:!0})},x=(t,e,r,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of G(e))!D.call(t,i)&&i!==r&&a(t,i,{get:()=>e[i],enumerable:!(s=O(e,i))||s.enumerable});return t};var v=(t,e,r)=>(r=t!=null?C(A(t)):{},x(e||!t||!t.__esModule?a(r,"default",{value:t,enumerable:!0}):r,t)),N=t=>x(a({},"__esModule",{value:!0}),t);var L={};E(L,{SignUpUseCase:()=>h,default:()=>V});module.exports=N(L);(function(){try{var t=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[e]="da228817-26dd-470d-881f-cf0ce6f5b3b5",t._sentryDebugIdIdentifier="sentry-dbid-da228817-26dd-470d-881f-cf0ce6f5b3b5")}catch{}})();var u=class{async createUser(e){return console.log(e),{userName:e.user_id,userEmail:e.email}}async getUser(e){return console.log(e),{userName:"User Name",userEmail:"user@fanzo.com"}}async deleteUser(e){console.log(e)}async setPhoneNumber(e){console.log(e)}async setUserPassword(e){console.log(e)}async setEmailVerified(e){console.log(e)}async initiateAuth(e){return console.log(e),{access_token:"access_token",refresh_token:"refresh_token",expires_in:30}}async revalidateAuth(e){return console.log(e),{access_token:"access_token",expires_in:30}}};var R=v(require("crypto")),l=new Uint8Array(256),p=l.length;function f(){return p>l.length-16&&(R.default.randomFillSync(l),p=0),l.slice(p,p+=16)}var o=[];for(let t=0;t<256;++t)o.push((t+256).toString(16).slice(1));function P(t,e=0){return o[t[e+0]]+o[t[e+1]]+o[t[e+2]]+o[t[e+3]]+"-"+o[t[e+4]]+o[t[e+5]]+"-"+o[t[e+6]]+o[t[e+7]]+"-"+o[t[e+8]]+o[t[e+9]]+"-"+o[t[e+10]]+o[t[e+11]]+o[t[e+12]]+o[t[e+13]]+o[t[e+14]]+o[t[e+15]]}var _=v(require("crypto")),I={randomUUID:_.default.randomUUID};function k(t,e,r){if(I.randomUUID&&!e&&!t)return I.randomUUID();t=t||{};let s=t.random||(t.rng||f)();if(s[6]=s[6]&15|64,s[8]=s[8]&63|128,e){r=r||0;for(let i=0;i<16;++i)e[r+i]=s[i];return e}return P(s)}var y=k;var d=class{uuidV4(){return y()}};var S=class{constructor(e){this.entityModel=e;this.clientSession=e}clientSession;start(){return this.clientSession=[],!!this.clientSession}getSession(){if(this.clientSession)return this.clientSession;throw new Error("START_DATABASE_ERROR")}updateSession(e){return this.clientSession=e,this.clientSession}},m=new S([]);var c=class{async execute(e){return m.getSession().find(s=>s.user_id===e.user_id||s.auth_token===e.user_id||s.email===e.user_id)||null}};var g=class{async execute(e){let r=m.getSession();return r.push(e),r.find(s=>s.user_id===e.user_id)||e}};var h=class{constructor(e,r,s=new u,i=new d,U=new c,n=new g){this.logger=e;this.appConfig=r;this.identityServiceProvider=s;this.guidGenerator=i;this.getUserRepository=U;this.createRepository=n;this.logger=this.logger.getChild("SignUpUseCase")}async execute(e){this.logger.debug("execute input",JSON.stringify(e));let r=e.email.toLowerCase();try{let s=await this.getUserRepository.execute({user_id:r});if(this.logger.debug("users repository response",s),s)throw new Error("USER_ALREADY_EXISTS");let i=e.role!=="Admin"?new Date:void 0,U={user_id:this.guidGenerator.uuidV4(),auth_token:this.guidGenerator.uuidV4(),email:e.email,email_verified:!1,name:e.name,role:e.role,bio:e.bio,languages:e.languages,approved_at:i,created_at:new Date,photo_url:void 0,deleted_at:void 0},n=await this.createRepository.execute(U);this.logger.debug("create user repository response",n);let w=await this.identityServiceProvider.createUser({email:r,user_id:U.user_id});return this.logger.debug("identityServiceProvider createUser",w),await this.identityServiceProvider.setUserPassword({email:r,password:e.password}),this.logger.debug("identityServiceProvider confirmUser"),this.logger.debug("execute output",n),n}catch(s){throw this.logger.error("error",s),s}}};var V=void 0;0&&(module.exports={SignUpUseCase});
//# sourceMappingURL=SignUpUseCase.js.map
